if @only_omni_channel_availability
  if @proxy_to_mars
    @items.to_json
  else
    @items.map do |omni_agent|
      AgentDecorator.new(omni_agent, {}).channel_agents_availability_data
    end.to_json
  end
else
  agent_types = Account.current.agent_types_from_cache
  @items.map do |agent|
    user = agent.user
    response_hash = {
      available: agent.available,
      occasional: agent.occasional,
      id: agent.user_id,
      signature: agent.signature_html,
      ticket_scope: agent.ticket_permission,
      created_at: agent.created_at.try(:utc),
      updated_at: agent.updated_at.try(:utc),
      last_active_at: agent.last_active_at.try(:utc),
      available_since: agent.active_since.try(:utc),
      type: agent_types.find { |type| type.agent_type_id == agent.agent_type }.name,
      contact: {
        active: user.active,
        email: user.email,
        job_title: user.job_title,
        language: user.language,
        last_login_at: user.last_login_at.try(:utc),
        mobile: user.mobile,
        name: user.name,
        phone: user.phone,
        time_zone: user.time_zone,
        created_at: user.created_at.try(:utc),
        updated_at: user.updated_at.try(:utc)
      }
    }
    if Account.current.freshcaller_enabled?
      response_hash[:freshcaller_agent] = agent.freshcaller_agent.present? ? agent.freshcaller_agent.try(:fc_enabled) : false
    end
    response_hash[:freshchat_agent] = agent.agent_freshchat_enabled? if Account.current.omni_chat_agent_enabled?
    response_hash[:agent_level_id] = agent.scoreboard_level_id if Account.current.gamification_enabled? && Account.current.gamification_enable_enabled?
    response_hash[:contact][:avatar] = AttachmentDecorator.new(user.avatar).to_hash if user.avatar.present?
    response_hash
  end.to_json
end
