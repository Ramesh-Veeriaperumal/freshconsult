<% content_for :layoutType do -%><%- end %>
<%= stylesheet_link_tag_with_rtl :'cdn/ui_daterangepicker' %>
<%= stylesheet_link_tag_with_rtl :'cdn/reports' %>
<%= stylesheet_link_tag_with_rtl :'cdn/livechat_admin' %>
	<div id="loading-box">
		<div class="sloading loading-left loading-small reports-loading"><%=t('livechat.fetching')%></div>
	</div>
	<!-- report content -->
	<div class="row-fluid" id="livechat_archive_page">
		<div class="report-page normal-twipsy" id="report-page">
			<div class="report-content-wrapper">
			<!--report header-->
				<div class="row-fluid report-header">
					<div class="row-fluid">
						<div class="span12 report-header-content">
							<div class="vertical-alignment report-inner-heading">
								<h1 class="lead fc-archive-title" id="report_header_title"><i class="ficon-agent-fchat-on fsize-28"></i><%=t('livechat.message_archives')%></h1>
							</div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="report-filter span12" id="report-filter-details">
							<div class="vertical-alignment report-filter-slide-btn">
								<a class="btn btn-primary" href="#report-filter-edit" data-parent="#report-page" id="sliding"><%=t('livechat.edit')%></a>
							</div>
							<div class="filter-container">
								<ul class="inline" id="filter_container">
									<li><%=t('livechat.filter_by')%>:</li> 
									<li><%=t('filter_options.created_date_range')%>:<strong><%=@dateRange%></strong></li>
									<li><%=t('livechat.chat_type')%>: <strong>All</strong></li>
									<li><%=t('livechat.widget')%>: <strong>All</strong></li>
									<li><%=t('filter_options.responder_id')%>:<strong>All</strong></li>
								</ul>
							</div>
							<div class="report_filters fc-filter">
								<a href="javascript:void(0);" class="drop-right nav-trigger" id="sorting-filter-head" menuid="#sorting-filter" data-sort-type = "desc" ><b><%=t('livechat.sort_order')%></b> <%=t('livechat.desc')%></a>
								<ul class="fd-menu saved-reports-menu" id="sorting-filter" style="visibility: visible; display: none;">
									<li disabled class="disabled"> <%=t('livechat.createdAt')%></li>
									<li class="seperator" ></li>
									<li id="no-report-data" data-sort-type = "asc" class=""> <%=t('livechat.asc')%></li>
									<li id="no-report-data" data-sort-type = "desc" class=""> <%=t('livechat.desc')%></li>
								</ul>
							</div>
						</div>
					</div>
				</div>   
				<div id="archive-container" class="list-page fc-archives">
				</div>
			</div>
		</div>
		<!-- Filter Options -->
		<div class="report-left-filter" id="report-filter-edit">
			<div class="left-filter">    
				<%= render :partial => "filter_options"%>
			</div>
		</div>
		<!-- Conversation View -->
		<div id ="conversation-wrap" >
		</div>
	</div>
	<!--end report content-->
<script type ="text/javascript" >
	var liveChat =window.liveChat || {};
	window.liveChat.widgetList = <%=@widgets%>
	jQuery(document).on('ready pjax:end',function(){
		 jQuery("#date_range_error").hide();
		 var archive_page_id = jQuery('#livechat_archive_page');
		var $dateElement = archive_page_id.find('#date_range');
		archive_page_id.addClass('lc-msg-archives');
		if($dateElement.length >0){
			var dateFormat = getDateFormat('mediumDate').toUpperCase();
			var date = Helpkit.commonSavedReportUtil.getDateRangeDefinition(dateFormat);
			$dateElement.off().daterangepicker({
				latestDate: Date.parse('Today'),
				presetRanges: [
				{	text: '<%= t('reports.date_ranges.today') %>', 
					dateStart: 'Today', 
					dateEnd: 'Today',
					period : 'today'
				},
	    	    {	text: '<%= t('reports.date_ranges.yesterday') %>', 
	    	    	dateStart: 'Today-1', 
	    	    	dateEnd: 'Today-1',
	    	    	period : 'yesterday' 
	    	    },
	      		{	text: '<%= t('helpdesk_reports.this_week') %>', 
	      			dateStart: date.this_week_start, 
	      			dateEnd: date.endDate ,
	      			period : "this_week" 
	      		},
	      		{	text: '<%= t('helpdesk_reports.previous_week') %>', 
	      			dateStart: date.previous_week_start, 
	      			dateEnd: date.previous_week_end ,
	      			period : "previous_week" 
	      		},
	      		{	text: '<%= t('reports.date_ranges.last_7_days') %>', 
	      			dateStart: 'Today-6', 
	      			dateEnd: 'Today' ,
	      			period : "last_7"
	      		},
	      		{
	                text: '<%= t('helpdesk_reports.this_month') %>',
	                dateStart: date.this_month_start,
	                dateEnd: date.previous_week_end,
	                period : "this_month"
	            },
	            {
	                text: '<%= t('helpdesk_reports.previous_month') %>',
	                dateStart: date.previous_month_start,
	                dateEnd: date.previous_month_end,
	                period : "previous_month"
	            },
		  		{	text: '<%= t('reports.date_ranges.last_30_days') %>',
	  				dateStart: 'Today-29', 
	  				dateEnd: 'Today',
	  				period : "last_30"
	      		},
	      		{
	                text: "<%= t('helpdesk_reports.last_num_months', :num => 3 ) %>",
	                dateStart: date.last_3_months,
	                dateEnd: date.previous_month_end,
	                period : "last_3_months"
	            },
	      		{	text: '<%= t('reports.date_ranges.last_90_days') %>',
	  				dateStart: 'Today-89',  
	  				dateEnd: 'Today',
	  				period : "last_90"
	      		},
	      		{
	                text: "<%= t('helpdesk_reports.last_num_months', :num => 6) %>",
	                dateStart: date.last_6_months,
	                dateEnd: date.previous_month_end,
	                period : "last_6_months"
	            },
	            {
	                text: "<%= t('helpdesk_reports.this_year') %>",
	                dateStart: date.this_year_start,
	                dateEnd: date.endDate,
	                period : "this_year"
	            }],
				presets: {
						dateRange: '<%= t('reports.date_ranges.custom') %>'
				},
				dateFormat: window.getDateFormat('datepicker'),
				closeOnSelect: true,
				onChange: function() { jQuery("#date_range_error").hide(); },
				earliestDate: Date.parse('13/06/2013')
			});
			$dateElement.on('keypress keyup keydown', function(ev) {
		   	ev.preventDefault();
		    return false;
		 });

		}
	});
</script>

<%= javascript_include_tag :'cdn/livechat_archive' %>