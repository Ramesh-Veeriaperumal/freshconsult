<% content_for :layoutType %>

<div class='page-header-sticky' rel='sticky' id='contactHeaderSticky'>
	<div class='sticky-header-wrapper'>
		<h3 class='lead pull-left'>
			<%= link_to t('company.title'), '/companies'%>  
			<span class='contact-name ellipsis'> / <%= h(@company.name) %></span>
		</h3>
		<% if privilege?(:manage_contacts) %>
			<div class="pull-right">
				<%= link_to t('edit'), edit_company_path(@company), :class => "btn" %>
			</div>
		<% end %>
	</div>
</div>

<div class="contact-show-wrapper">
	<div class='contact-show'>
		<div class='contact-info-fields'>
			<div class='contact-info-fields-content'>
				<div class="profile_pic avatar-pic">
					<img alt="<%= @company.name %>" src='/images/fillers/company_default_pic.png'>
				</div>
				<div class='user-info'>
					<h1 class='lead break-word'><%= h(@company.name) %></h1>
					<div class='break-word user-job-title'><%= h(@company.description).gsub(/\n/, '<br />') %></div>
					<% if @company_users_size > 0 %>
						<div class='no-contacts'>
							<div class='border-wrap left'></div>
							<div class='no-contacts-msg'>
								<%= link_to t('companies.no_contacts', :no_contacts => @company_users_size), URI::escape('/contacts/filter/all?query=customer_id is ' + @company.id.to_s) %>
							</div>
							<div class='border-wrap right'></div>
						</div>
					<% end %>
				</div>
				<% no_border_class = @company_users_size > 0 ? 'no-border' : '' %>
				<ul class='show-fields <%= no_border_class %>'>
					<% view_company_fields.each do |field| %>
				    	<%=  render_as_list nil, field %>
				    <% end %>
				</ul>
			</div>

		</div>
		<div class='contact-edit-fields'>
			<div id='updateForm' class='contact-edit-padding clearfix'>
				<% form_for :company, @company, 
					:url => {:controller => 'companies', :action => 'update_notes'},
					:html => {
						:class => 'edit_user',
						:method => :put
					} do |f| %>	
					<%= f.error_messages %>
					<h4 class="conv-title"><%=t('company.notes')%></h4>
					<%= f.text_area :note, :class=> "sp_paragraph",:cols => 0,:rows => 0, :placeholder => t("company.info5") %>
					<%= f.hidden_field :id, :value => @company.id, :id => 'companyid' %>
					<% if privilege?(:manage_contacts) %>
						<div class='clearfix'>
							<div class='error ajax-error pull-left'></div>
							<div class="pull-right hide form-save"> 
								<%= link_to t("cancel"), '#' , :class => "btn cancel-form" %>
								<%= f.submit t('save'), :class=>"btn btn-primary save-form" %> 
							</div>
						</div>
					<% end %>
				<% end %>	
			</div>
			<div class='contact-edit-padding'>
				<h1 class='conv-title'> <%= t('contacts.conversations.tickets') %> </h1>
				<p class='muted'> <%= t('contacts.conversations.company_all') %> </p>
				<div class='timeline'>
					<ul class='timeline-list'>
						
						<% company_activities.each do |item| %>
							<li class='timeline-item'>
								<%= ticket_activity(item) %>
							</li>

						<% end %>
					</ul>
				</div>
				<% if @total_company_tickets.size > 10 %>
					<div class='contact_tickets'>
						<div class="more_results">
							<%= link_to t('contacts.view_all').html_safe, helpdesk_company_filter_path(:company_id => @company.id) , :id => "show_more" %>
						</div>
					</div>
				<% end %>
				<% if company_activities.empty? %>
					<p class='no-conv-msg'><%= t('contacts.conversations.no_conversations') %></p>
				<% end %>
			</div>
		</div>
		<div class='contact-sidebar'>
			<div class='contact-sidebar-content'>	
				<% if privilege?(:manage_contacts) %> 
					<div class="sidepanel">
					<h4 class="app-title"><%=t('companies.add_contact')%> 	
						<p class='sub-title break-word'>
							<%= t('companies.add_contact_company', :company_name => @company.name) %> 
						</p>
					</h4>
						<% form_tag({ :action => :quick_contact_with_company, :controller => "contacts", :method => :post }, { :class => "clearfix", :rel=> 'validate'} ) do %>
						<ul>
							<li class='control-group'>
								<div class='control-label'> 
									<label for="user_name"><%=t('user.full_name')%></label> 
								</div>
								<div class='controls'>
									<input class="text required" id="user_name" name="user[name]" size="30" type="text" value="" /> 
								</div>
							</li> 
							<li class='control-group'>
								<div class='control-label'>
									<label for="email_primary"><%=t('user.email')%></label> 
								</div>
								<div class='controls'>
									<input class="text require_from_group user_info" id="email_primary" name="user[email]" size="30" type="text" />
								</div>
							</li>
							<li class='control-group'>
								<div class='control-label'>
									<label for="user_phone"><%=t('user.phone_no')%></label> 
								</div>
								<div class='controls'>
									<input class="text require_from_group user_info" id="phone_work" name="user[phone]" size="30" type="text" /> 
								</div>
							</li>
				    	<%= hidden_field_tag 'user[company_name]', @company.name %>   
						</ul>
						<div class="pull-right"><%= submit_tag t('create'), :class => "btn btn-primary" %></div>
						<% end %>
					</div>
				<% end %>
				<div class="sidepanel">
					<h4 class="app-title"><%= t('company.sla_policy_name') %></h4> 
					<div id="sla_policy" class="sloading loading-small sla-policy-loading"
						 rel="remote-load" 
						 data-unique="true" 
						 data-extra-loading-classes = "sla-policy-loading"
						 data-url="/companies/<%=@company.id%>/sla_policies"></div>
				</div>
				<% unless @company_users.empty? %>
					<div class='sidepanel'>
						<h4 class="app-title margin-set"><%=t('companies.company_contacts')%> (<%= @company_users_size %>) </h4>
						<ul class="user_list">	  
							<% users = @company_users.take(9) %>
							<% users.each do |user| %>
							  	<li title="<%= h(user.name) %>" class='tooltip user-item'>
						      		<%= link_to(user_avatar(user, :thumb), user ) %>
							  	</li>  
							<%end%>
							<% if @company_users_size > 9 %> 
								<li class='tooltip user-item' title="<%= t('view_all')%>">
									<%= link_to '...', URI::escape('/contacts/filter/all?query=customer_id is ' + @company.id.to_s), :class => 'more-users-link' %> 
								</li>
							<% end %>
						</ul>
					</div>
				<% end %>
				<% unless @company.domains.blank? %>
					<div class="sidepanel hide">
						<div class="first">
							<h4 class="app-title"><%=t('company.info2')%></h4>
							<p>
								<%= h(@company.domains) %>	
							</p>	
						</div>
					</div>
				<% end %>
			</div>
		</div>
	</div>
</div>