<% if freshid_enabled? %>
  <%= render :partial => "freshid_edit" %>
<% else %>
<%= content_tag( :h3, t("profile.edit"), :class => "title itil-hide" ) %>
<%= form_for @profile , :url => { :action=> "update", :controller => 'profiles'} , :html => { :multipart => true } do |f| %>
  <%= f.error_messages %>
  <%= render :partial => "form" %>
  <div class="button-container">
    <%if  Account.current.verified? &&  User.current.active? %>
      <a href="#email-preview" class="email-preview" ><%= t("preview")%></a>
    <% end %>
   	<%= f.submit t('save_changes'), { :class => "btn btn-primary" } %>
      <a href="<%= current_account.falcon_ui_enabled?(current_user) ? '/a/' : '/' %>" target="_top" class="btn"><%= t('cancel') %></a>
	</div>	  
<%end%>


<% content_for :sidebar do %>
  <% unless current_account.sso_enabled? %>	
	<div class="sidepanel">
		<%= content_tag( :h3, t("profile.change_password"), :class => "title" ) %>
    <% if current_account.falcon_ui_enabled?(current_user) %>
      <%= form_for "not_resource", :remote => true, :url => { :action => :change_password, :controller => 'profiles', :method => :put} do |f| %>
        <%= render :partial => "change_password_form", :locals => { :f => f } %>
      <% end %>
    <% else %>
    <%= form_tag :action => :change_password, :controller => 'profiles', :method => :put do |f| %>
        <%= render :partial => "change_password_form", :locals => { :f => f } %>
    <% end %>
  <% end %>
</div>
<% end %> 
  <% if current_account.verified? && current_user.agent? && !current_account.launched?(:hide_api_key) %>
    <div class="sidepanel">
    <%= content_tag( :h3, t("profile.api_key.title"), :class => "title" ) %>
    <%= form_tag :action => :reset_api_key, :controller => 'profiles', :method => :put do |f| %>
      <ul class="ui-form">
        <label class="center" for="api_key"><%=@profile.user.single_access_token%></label>
      </ul> 
      <div class="button-container">
          <%= submit_tag t("profile.api_key.reset"), :class => "btn", :confirm => t("profile.api_key.reset_warning") %>
      </div>
    <% end %>
    </div>  
    <% if @slack_url %>
      <div class="slack_auth_cont clearfix">
      <h4 class="title"><%= t('integrations.slack_v3.slack_prof_label') %></h4>
      <p>
      <%= t('integrations.slack_v3.slack_connect_desc') %>
      </p>
      <a class="btn pull-right" onclick="<%= onclick_strategy(@slack_url) %>"><%= @authorized.present? ? t('integrations.slack_v3.slack_reauth_btn') : t('integrations.slack_v3.slack_auth_btn')%>
      </a>
    </div>
  <% end %>
    <% if @teams_url %>
      <div class="slack_auth_cont clearfix">
        <h4 class="title"><%= t('integrations.microsoft_teams.teams_prof_label') %></h4>
        <p>
          <%= t('integrations.microsoft_teams.teams_connect_desc') %>
        </p>
        <a class="btn pull-right <%= @teams_class_names%>" onclick="<%= onclick_strategy(@teams_url) %>"><%= @teams_authorized ? t('integrations.microsoft_teams.reauth_btn') : t('integrations.microsoft_teams.auth_btn')%></a>
      </div>
    <% end %>
  <% end %>
<% end%>

<script type="text/javascript">
jQuery(document).ready(function() { 

  jQuery(function () { 
    var popover_message = jQuery('#password').data('content');
    if(popover_message){
      jQuery("#password").popover({
        html: true,
        trigger: 'manual', 
        placement: 'left',
        reloadContent: false,
        template: "<div class='arrow'></div><div class='inner'><div class='content'><p></p></div></div>",
        content: function(){
                  return "<div class='password-wrapper'><h5 class='policy-title'><%= t("admin.security.password_policy_popover.password_should") %></h5>" +jQuery("#password").attr("data-content") + "</div>"
                }
      }).focus(function(){
          jQuery(this).popover("show");
      }).blur(function(){
          jQuery(this).popover("hide");
      }); 
    }
  });
});
</script>
<% end %>