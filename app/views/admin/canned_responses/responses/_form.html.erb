<% content_for :sidebar do -%><%- end %>

<% javascript_tag do %>

jQuery(document).ready(function(){
	invokeRedactor('ca-content', 'cnt-reply');
  if ('<%=@ca_response.accessible.visibility%>' == '<%=Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:group_agents]%>')
	{
		jQuery('#accessible_group').show();	
		jQuery('#admin_canned_response_visibility_group_id').removeAttr('disabled');
	}
	else
	{
		jQuery('#admin_canned_response_visibility_group_id').attr('disabled','disabled');
	}
	
	jQuery('.l_placeholder').bind("click", function(ev){
			active_email_body = jQuery("#ca-content");
			jQuery('#place-dialog').slideDown();			
	});
});


function toggleGroup(access_id)
{	
	if (access_id == '<%=Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:group_agents]%>')
	{
		jQuery('#accessible_group').show();
		jQuery('#admin_canned_response_visibility_group_id').removeAttr('disabled');
	}
	else
	{
		jQuery('#accessible_group').hide();	
		jQuery('#admin_canned_response_visibility_group_id').attr('disabled','disabled');
	}
}
<% end %> 


<%= f.error_messages :object_name => 'canned_response_response' %>
<ul>
	<li>
		<%= f.label(:title, t('.response_name')) %>
		<%= f.text_field :title, :class => "text required", "minlength" => "3" %>
	</li>
	<li>
		<label for="ca-content">
			<%= t('message') %>
			<a class='l_placeholder slim-button pull-right' href='javascript:void(0)'><%= t('canned_folders.insert_placeholder') %>&raquo;</a>
		</label>
   		<%= f.text_area :content_html, :class => "ca_content_body", :id => 'ca-content' %>		
	</li>
	<li><%= render "attachment_form" %></li>
	<li>
		<ul>
			<%= render :partial => 'attachment', :collection => @item.attachments_sharable  %>
		</ul>
	</li>

	<li class="folder-pane form-horizontal">
		<div class="control-group">
              <%= label_tag(:new_folder_id, t('canned_folders.folder'), :class => "control-label") %>
              <div class="controls">
                <%= select_tag(:new_folder_id, options_from_collection_for_select(@ca_res_folders, 'id', 'name', 
    			@folder.id), :class => 'select2') %>	
              </div>
    	</div>
	</li>
	<li class="inline-field  form-horizontal">
		<div class="control-group">
		<% f.fields_for :visibility do |access| %>	
			<label class="control-label"><%=t('.available_for')%>:</label>
			<div class="controls">
				<label class="radio">
					<%= access.radio_button  :visibility, Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:only_me], {:onclick =>"toggleGroup(this.value)", :class => "radio", :checked => Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:only_me]== @ca_response.accessible.visibility } %> 
					<%= t('.me_only') %>
					<%= access.hidden_field :user_id, :value =>current_user.id %>	
				</label>
			</div>
			<div class="controls">
				<label class="radio">
					<%= access.radio_button  :visibility, Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:all_agents], {:onclick =>"toggleGroup(this.value)",:class => "radio" ,:checked => Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:all_agents]== @ca_response.accessible.visibility } %> 
					<%= t('.all_agents') %>
				</label>
			</div>
			<div class="controls">
				<label class="radio">
					<%= access.radio_button  :visibility, Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:group_agents],{:onclick =>"toggleGroup(this.value)" , :class => "radio" , :checked => Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:group_agents]== @ca_response.accessible.visibility} %> 
					<%= t('.groups') %>
					<div style="display:none;" class="tabbed" id="accessible_group">
			        <%= access.collection_select :group_id, Group.find_all_by_account_id(current_account.id , :order=>'name') , :id, :name, {:class =>"dropdown", :selected => @ca_response.accessible.group_id} %>
			        </div>
			    </label>
			</div>
		<%end%>
		</div>
	</li>
</ul>
<div class="button-container">
	<%= f.submit t('save'), :class => "btn btn-primary" %>	      	
	<%= link_to(t('cancel'), :back , :class => "btn" ) %>
</div>

<% content_for :pagefixed do %>
	<%= render :partial => "/shared/notification_placeholder" %>
<% end %>
