<% content_for :pagefixed do -%>
  <% javascript_tag do %>
  jQuery(function() {
    jQuery("#push_notification").bind("change",
          function(ev){
            if(this.checked){
              jQuery("#gcm").slideDown(400);
              jQuery("#mobihelp_app_config_gcm_api_key").addClass("required");
            }else{
              jQuery("#gcm").slideUp(200);
              jQuery("#mobihelp_app_config_gcm_api_key").removeClass("required");

            }
          }
        ).trigger("change");
    });
<%- end %>
<%- end %>

<% content_for :helpcard do -%>
  <%= render :partial => "helpnote" %>
<%-end %>
<%= render :partial => "integration_details", :locals => {:app => @app} if page == "edit" %>
<span class="seperator"></span>
<%= content_tag :h3, t('admin.mobihelp.apps.edit.title'), :class => "lead" if page == "edit" %>

<%= f.error_messages %>
<div class="portal-page-form mobiapp-form">
  <div class="inline-field">
    <div class="fields">
      <div class="row-fluid">
        <div class="app-image"><div class="<%= @app.platform == Mobihelp::App::PLATFORM_ID_BY_KEY[:android] ? "common-icon-android_grey_big" : "common-icon-apple_grey_big" %> app-icon"></div></div>
        <div class="app-fields">
          <div class="control-group">
            <%= f.label :name, "#{t('name')} <span class='required_star'>*</span>".html_safe, :class => "control-label" %>
            <div class = "controls">
              <%= f.text_field :name, :class => "text required", :placeholder => t('admin.mobihelp.apps.form.app_name') %>
            </div>
          </div>
        </div>
        <%= f.hidden_field :platform, :value => @app.platform %>
      </div>
      <span class="seperator"></span>

      <%= content_tag :h3, t('admin.mobihelp.apps.form.configurations').html_safe, :class => "lead title" %>
      <% f.fields_for :config do |c| %>
        <div class="control-group">
          <%= c.label :bread_crumbs, t('admin.mobihelp.apps.form.bread_crumbs').html_safe, :class => "control-label" %>
          <div class="controls">
            <%= c.select :bread_crumbs, Mobihelp::App::CONFIGURATIONS[:bread_crumbs], {:selected => @app.config[:bread_crumbs]}, :class => "select2 span2" %>
            <%= content_tag( :div, t("admin.mobihelp.apps.form.bread_crumbs_info"), :class => "info-data span12" ) %>
          </div>
        </div>

        <div class="control-group">
          <%= c.label :debug_log_count, t('admin.mobihelp.apps.form.debug_log_count').html_safe, :class => "control-label" %>
          <div class="controls">
            <%= c.select :debug_log_count, Mobihelp::App::CONFIGURATIONS[:debug_log_count], {:selected => @app.config[:debug_log_count]}, :class => "select2 span2"%>
            <%= content_tag( :div, t("admin.mobihelp.apps.form.debug_log_count_info"), :class => "info-data span12" ) %>
          </div>
        </div>
 
        <div class="control-group">
          <%= c.label :solutions, t('admin.mobihelp.apps.form.solutions').html_safe, :class => "control-label" %>
          <div class="controls">
            <%= c.collection_select :solutions, current_account.solution_categories.find(:all, :conditions => "is_default = false"), :id, :name, {:selected => @app.config[:solutions].to_i}, :class => "select2 span5" %>
            <%= content_tag( :div, t("admin.mobihelp.apps.form.solutions_info"), :class => "info-data span12" ) %>
          </div>
        </div>
        
        <div class="control-group">
          <%= c.label :app_review_launch_count, t('admin.mobihelp.apps.form.app_review').html_safe, :class => "control-label" %>
          <div class="controls">
            <%= c.select :app_review_launch_count, @app_review_launches , {:selected => @app.config[:app_review_launch_count]}, :class => "select2 span5" %>
            <%= content_tag( :div, t("admin.mobihelp.apps.form.app_review_info"), :class => "info-data span12" ) %>
          </div>
        </div>

        <% if @app.platform == Mobihelp::App::PLATFORM_ID_BY_KEY[:ios] %>
          <div class="row-fluid">
            <div class="app-fields">
              <div class="control-group">
                <%= c.label :app_store_id, "#{t('admin.mobihelp.apps.form.app_store_id')}".html_safe, :class => "control-label" %>
                <div class = "controls">
                  <%= c.text_field :app_store_id, :value => @app.config[:app_store_id], :class => "text", :placeholder => t('admin.mobihelp.apps.form.app_store_id') %>
                </div>
              </div>
            </div>
          </div>
        <%end%>

        <% if false %>
          <div class="control-group">
            <label class="control-label">
              <%= t('admin.mobihelp.apps.form.enable_push_notification').html_safe %>
            </label>
            <%= c.check_box :push_notification,
                      {:class => "checkbox controls", :rel => "toggle", :id => "push_notification", :checked => @app.push_notification_enabled?}, "true", "false" %>
          </div>
          <div class="control-group" id="gcm">
            <%= c.label :gcm_api_key, "#{t('admin.mobihelp.apps.form.gcm_api_key')}".html_safe, :class => "control-label" %>
            <div class = "controls">
              <%= c.text_field :gcm_api_key, :value => @app.config[:gcm_api_key], :class => "text align-input", :placeholder => t('admin.mobihelp.apps.form.gcm_api_key') %>
            </div>
          </div>
        <%end%>
      <%end%>



      <div class="button-container">
        <%= link_to t('cancel'), admin_mobihelp_apps_path, :class => "btn" %>
        <%= f.submit t('save'), :class => "btn btn-primary" %>
      </div>
    </div>
  </div>
</div>
