<% 
if type == :template 
    @cached_properties = @portal_template.changes.symbolize_keys.keys
   _portal_template = Array(active_tab)
  _coderefresh_ids = "#portal_template_#{_portal_template.to_s}" 
  if active_tab.eql?(:layout)
    cached_data = !(@cached_properties & [:header, :footer, :layout]).blank?
    _portal_template = [:header, :footer, :layout]
    _coderefresh_ids = [:header, :footer, :layout].map{ |a| "#portal_template_#{a.to_s}" }.join(", ")
  else
    cached_data = @cached_properties.include?(active_tab)
  end
  reset_btn = link_to t("portalcss.reset_to_last_published"), 
                      {:action => :soft_reset, :portal_template => _portal_template, :portal_tab => active_tab },
                      :class => "btn #{!cached_data && 'disabled'}", :id => "soft_reset_button", :method => :put
else
  cached_data = @from_cache
  reset_btn = link_to t("portalcss.reset_to_last_published"),
                      {:action => :soft_reset, :page_id => params[:id], :page_type => @portal_page.page_type },
                      :class => "btn #{!cached_data && 'disabled'}", :id => "soft_reset_button", :method => :put
  _coderefresh_ids = "#portal_page_content"
end 
%>

<%= submit_tag t("portalcss.preview"),
              :name => "preview_button",
              :class => "btn btn-primary pull-right",
              "data-loading-text" => t("portalcss.please_wait") %>

<%= submit_tag t("portalcss.save_and_continue"),
              "data-loading-text" => t("portalcss.please_wait"),
              "data-code-refresh" => _coderefresh_ids,              
              :name => 'save_button', :class => "btn pull-right" %>

<%= reset_btn %>