<%= javascript_include_tag :'cdn/survey_admin'  %>
<div class="cust-satisfaction survey" id="survey_new_layout" style="display:none;">
	<div class="survey-overlay center" style="display:none;"><div class="sloading loading-small loading-center"> <div class="survey-overlay-text"><b> <%= t('admin.surveys.new_layout.loading') %> </b></div></div></div>
	<form accept-charset="UTF-8" name="survey_fields" class="form-horizontal" novalidate="novalidate">
		<div class="clearfix">
			<div class="control-group">
				<h3 class="lead itil-hide">
					<%if @layout_params[:action] == 'create'%> 
						<%=t('admin.surveys.index.new') %>
					<%else%>  
						<%=t('admin.surveys.index.edit')%> 
					<%end %> 
					<%=t('admin.surveys.new_layout.survey')%> 
					<div class="pull-right">
					   <input id="TogglesurveyActivate" type="checkbox" name="active"
						class="pull-right pseudoCheckbox" rel="toggle"
						<%if @layout_params[:active]%> checked="checked" <%end%> style="display: none;"
						<% if @layout_params[:id] != "" %>
						onchange="javascript:SurveyStatus.change(<%=@layout_params[:id]%>,this.checked);"
						<% else %>
						onchange="javascript:SurveyStatus.change(0,this.checked);"
						<% end %> />
					   <%= pjax_link_to t('admin.surveys.index.cancel'), @layout_params[:cancelUrl] ,:class=> 'btn' %>
					   <%if !@account.custom_translations_enabled?%>
						   <%if @layout_params[:id] != "" %>
				           		<input type="button" onclick="javascript:SurveyDetail.preview(<%=@layout_params[:id]%>);" id="previewFeedback" class="btn" value="<%=t('admin.surveys.index.preview_survey')%>">
				           <% end %>
			           <% end %>
			           <input type="button" value="<%=t('admin.surveys.index.save_survey')%>" onclick='jQuery("#surveyForm input:submit").submit();' class="btn btn-primary save_survey_btn">
					</div>
				</h3>
				<label class="clearfix"> <%= t('admin.surveys.new_layout.title') %> </label>
				<div class="clearfix">
					<input type="text" maxlength="150" placeholder="<%= t('admin.surveys.new_layout.default_survey') %>" name="title_text" value="<%=@layout_params[:title]%>"/>
					<label id="title_text-error" class="error title_text_error hide"><%= t('admin.surveys.new_layout.title_error_text') %></label>
				</div>
			</div>
		</div>
		<div class="survey_rating_order">
			<div class="rating_order">
				<%= t('admin.surveys.new_layout.rating_order').html_safe%>
				<div class="dropdown btn-default rating_order_select">
				  <a class="dropdown-toggle" id ="order_dropdown" role="button" data-toggle="dropdown" data-target="#">
				      <% if @layout_params[:order] %>
				      	<h5 class="good_to_bad"><%=t('admin.surveys.new_layout.good_to_bad')%><b class="caret"></b></h5>
				      <% else%>
				      	<h5 class="bad_to_good"><%=t('admin.surveys.new_layout.bad_to_good')%><b class="caret"></b></h5>
				      <%end %>
				  </a>
				  <ul class="dropdown-menu" role="menu">
					<li  class= "<%if @layout_params[:order]%>active<%end%>" data-state = "true" onclick="javascript:SurveyAdmin.flipChoiceOrder(this)">
						<span class="good_to_bad"><%=t('admin.surveys.new_layout.good_to_bad')%></span>
					</li>
					<li class= "<%if !@layout_params[:order]%>active<%end%>" data-state = "false" onclick="javascript:SurveyAdmin.flipChoiceOrder(this)">
				  		<span class="bad_to_good"><%=t('admin.surveys.new_layout.bad_to_good')%></span>
					</li>
				   </ul>
				</div>
			</div>
		</div>
		<div id="survey_rating" class="sub-container cust-satisfaction-rating">
		</div>

		<div class="selecting-info">
			<span>
				<i class="ficon-arrow-click"></i>
				<p class="muted"><%=t('admin.surveys.index.survey_help_msg_v3')%></p>
			</span>
		</div>

		<div id="survey_thanks">
		</div>
		<div id="survey_link_scenarios" class="sub-container cust-satisfaction-rating">
		</div>
	</form>
	<form accept-charset="UTF-8" name="survey" class="pull-right" id="surveyForm" surveyId="<%=@layout_params[:id]%>" method="<%=@layout_params[:method]%>" action="<%=@layout_params[:url]%>" novalidate="novalidate">
		<input type="hidden" value="javascript:SurveyAdminUtil.action.split(<%=@layout_params[:action]%>);" name="action">
		<input type="hidden" value="" name="survey">
		<input type="hidden" value="" name="jsonData">
		<%= pjax_link_to t('admin.surveys.index.cancel'), @layout_params[:cancelUrl] ,:class=> 'btn' %>
		<input type="submit" value="<%=t('admin.surveys.index.save_survey')%>" class="btn btn-primary save_survey_btn">
	</form>
	<%if @layout_params[:id].present? && !@layout_params[:default] && !@layout_params[:active]%>
			<input type="button" value="<%=t('admin.surveys.index.delete')%>" class="btn pull-left" onclick="javascript:SurveyList.destroy('<%=@layout_params[:id]%>',true);">
	<% end %>
</div>
<% content_for :helpcard do %>
	<% if @account.custom_translations_enabled? %>
		<%= render 'languages', {language_translations: language_translations} %>
	<% else %>
	<div class="helpcard">
		<% if !@account.default_survey_enabled? %> 
			<%= t('admin.surveys.custom_helptext_v2').html_safe %>
		<% else %>
			<p>	<%= t('admin.surveys.helptext_v2').html_safe %> </p>
		<% end %>
	</div>
	<% end %>
<% end %>

<% content_for :dialogs do %>
	<div id="SurveyConfirmContainer"></div>
<%end%>
<script type="text/javascript">

 jQuery(document).ready(function(){
 	SurveyAdmin.fullSurvey = <%= !@account.default_survey_enabled? %>;
 	SurveyAdmin.hasLayoutCustomization = <%= @account.layout_customization_enabled? %>;
	SurveyAdmin.surveyChoiceGoodToBad = <%= @layout_params[:order] %>;
 });

</script>
