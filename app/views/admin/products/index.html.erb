<% content_for :sidebar do -%>
  <div class="sidepanel">
    <h3 class="title">Multiple Products</h3>
    <p>
      Multiple products helps you to provide product or brand specific support.
    </p>
    <h4 class="title"><strong>Add twitter</strong></h4>
    <p>
      Enable your products twitter channel for the products.
    </p>
  </div>
<%-end %>
<% @page_title = t('.title') %>
<div class="floatr">
	<%= link_to(t('.add_product'), new_admin_product_path, :class => "uiButton") %>
</div>
<%= content_tag :h3, @page_title, :class => "title" %>
<div>	
	<ul class="admin_list">
    <% @products.each do |product| %>	  
      <li>    
        <div class="item_actions">           
          <%= link_to_function "Add Twitter", "twitter_signin(#{product.id})", :class => "slim-button" if product.twitter_handle.nil? %> 
          <%= link_to(t('edit'), edit_admin_product_path(product), :class => "slim-button") %>
          <%= link_to(t('delete'), admin_product_path(product), :method => 'delete', :confirm => t(".delete_product"), :class => "slim-button" ) %>
        </div>
        <table>
          <tr>
            <td class="portal-logo">
              <% if(product.portal_enabled?) %>
                <%= image_tag ((product.portal.logo.nil?) ? "/images/fillers/logo_blank.gif" : product.portal.logo.content.url(:logo), :class => "image_logo") %>
                <div class="color_box">
                  <span class="color_item" style="background-color:<%=portal_pref(product.portal, :header_color)%>"></span>
                  <span class="color_item" style="background-color:<%=portal_pref(product.portal, :tab_color)%>"></span>
                  <span class="color_item" style="background-color:<%=portal_pref(product.portal, :bg_color)%>"></span>
                </div>
              <% else %>
                <%= image_tag ("/images/fillers/logo_blank.gif", :class => "image_logo") %>
              <% end %>
            </td>
            <td class="portal-text">
              <%= link_to(product.name, edit_admin_product_path(product), :class => "big-text") %>
			        <%= content_tag(:div, product.reply_email, :class => "text") %>
              <%= link_to(product.portal.portal_url, product.portal.portal_url, {:class => "text", :target => "_blank"}) if(product.portal_enabled?) %>
              <%= render :partial => "twitter", :locals => { :product => product } %>
            </td>
          </tr>
        </table>
      </li>
    <% end %>
	</ul>
</div>
<% javascript_tag do %>

var twitter_signin_dialog = null;

function twitter_signin(pro_id)
{		   
	twitter_signin_dialog = jQuery("<div id='twitter_new_handle' style='display:none;' />").appendTo("body");		
	var url = '/social/twitters/signin?product_id='+pro_id;
	// load remote content
	twitter_signin_dialog.load(url,{}, function(responseText, textStatus, XMLHttpRequest) {
	       twitter_signin_dialog.dialog({modal:true, width:'700px', height:'auto', title:"Twitter signin"});
	});
		
    //prevent the browser to follow the link
    return false;
}	
<% end %>