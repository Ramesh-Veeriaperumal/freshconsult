<%= render :partial => "admin/quests/criteria_jsinit", :locals => { :filter_type => "quest" } %>

<%= f.error_messages :object_name => 'quest' %>
<h3 class="s-title">Quest type  <%= ' - '+Quest::GAME_TYPE_NAME_BY_KEY[@quest.category] unless @quest.category.blank? %></h3>
<div class="form-section" style="<%= 'display:none' unless @quest.name.blank? %>">	
	<div class="row">
		<% Quest::GAME_TYPES.each do |game_type| %>
		<label class="s-label radio-label span2">
			<%= f.radio_button :category, game_type[3], :class => "quest_types" %>
			<%= t(".#{game_type[0]}") %>
		</label>
		<% end %>
	</div>
</div>
<br />
<div id="enablequest">
	<div class="gamecriteria">
		<h2>Specify Quest Criteria</h2>
		<div class="ui-form gray-box-rounded">
			<div id="questDOM"></div>
			<div class="conditionset" id="filterDOM">
				<div id="RuleList" class="rule_list"></div>
				<fieldset class="empty_choice">
		        	<p>No conditions present</p>
		    	</fieldset>
				<fieldset class="addchoice">
		         	<p><%=t('dispatch.add_condition')%></p> 
		         	<img alt="<%=t('dispatch.add_new_choice')%>" class="add" src="/images/add.png" />
		    	</fieldset>
	    	</div>
		</div>
	</div>

	<div class="gamereward">
		<h3 class="s-title">Reward</h3>
		<p class="help-text">On successful completion of a quest award a badge and bonus points</p>
		<div class="form-section">
			<div class="row">
				<div class="span3">
					<strong>Badge</strong><br />			
					<%= f.hidden_field :badge_id, :class => "required text" %>
					<div class="badges_items">
						<div id="selected-badge">
							<%= content_tag :div, "", :class => "gamesettings-badges #{@badge_class[:classname]}" if @badge_class %>
						</div>
						<span style="margin-left:-3px;" id="selected-badge-name"><%= @badge_class[:name] if @badge_class%></span>
					</div>
					<br />
					<a href="javascript:void(0)" id="showbadges">
						<%= (!@badge_class) ? "Pick a badge" : "Change" %>
					</a>
				</div>
				<div class="span4">
					<strong>Bonus points</strong><br />
					<%= f.text_field :points, :class => "required points" %>
				</div>
			</div>
		</div>
		<div id="select-badge" style="display:none;max-height:340px; overflow:auto;" class="badgelist badges_items">
			<span class="seperator"></span>
			<div class="row">
				<% @available_badges.each do | badges | %>
					<div class="span2">
						<%= content_tag :div, "", 
									:class => "gamesettings-badges center-align #{badges[:classname]}", 
									"data-class" => badges[:classname],
									"data-name" => badges[:name],
									"data-badge-id" => badges[:id] %>
						<p class="aligncenter"><strong><%= badges[:name] %></strong></p>
						<br />
					</div>
				<% end %>
			</div>
		</div>
	</div>
	<br />
	<div class="gamename">
		<h3 class="s-title">...and finally</h3>
		<div class="form-section">
			<%= f.text_field :name, :class => "required text", :placeholder => "Name your quest" %>
			<%= f.text_area :description, :class => "mediumpara", :placeholder => "Brief about the quest" %>
		</div>
	</div>


	<div class="button-container">
		<input type="hidden" name="quest_data" id="quest_quest_data" value=""/>
		<input type="submit" class="uiButton" value="<%=t('save')%>" />
		<%= link_to t('cancel'), {:action => 'index'}, :class => "uiButton" %>
	</div>
</div>

<% content_for :sidebar do %>
	<div class="sidepanel helpcard">
		<p>	<%= t('admin.gamification.helptext') %> </p>
	</div>
<% end %> 