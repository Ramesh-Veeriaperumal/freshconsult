<% content_for :sidebar do %> 
	<%= render :partial => "helpnote" %>	
<% end %>
<div id="emailconfig-list" class="email-settings-header">
  <% if feature?(:multiple_emails) %>
    <%= link_to t('email_configs.new_support_email'), new_admin_email_config_path, :class => "pull-right btn"%>
  <% else %>
    <%= link_to t('email_configs.new_support_email'), "#", :class => "pull-right btn locked tooltip", "data-placement" => 'below', :title => t('non_covered_feature_error') %>
    <% options =  ( current_user.privilege?(:manage_account) ) ? {:tag => :a, :href => subscription_url } : {:tag => :p} %>
    <%= content_tag(options[:tag], t('subscription.upgrade.message'), :href => options[:href], :class => "upgrade-message" ) %>
  <% end %>
  <h3 class="lead"><%=t('email_configs.title')%></h3>
  <div class="lead-desc"><%=t('email_configs.info11')%></div>
</div>
<div class="pull-right email-settings-bcc">
  <%= content_tag :label, "#{I18n.t('email_configs.bcc_text')}: #{truncate(current_account.bcc_email, 20, '...')}", :class=> 'floatl', :title => current_account.bcc_email unless current_account.bcc_email.blank?%>
  <%= link_to( (current_account.bcc_email.blank? ? t('email_configs.add_bcc_text') : t('email_configs.edit')) , { :controller => 'admin/account_additional_settings', :action => "assign_bcc_email" }, :class => "dialog2", :title => t('email_configs.set_bcc_email_text'), "data-width" => "400" ) %>
  <%= content_tag :span, "", :class => "tool-tip", :title=> t('email_configs.info17')%>
</div>
<div class="list-page">
  <h4 class="sub-lead"><%=t('email_configs.global_support_emails')%></h4>
  <div class="list-page-body">
    <table class="table table-striped email-config-styled-table">
        <% @global_email_configs.each do |email_config| %>
          <%= render(:partial => "email_config", :object =>  email_config) %>      
        <% end %>
    </table>
    <% if feature?(:multi_product) %>
      <% @products.each do |product| %>
        </div>
        <br/>
        <h4 class="sub-lead"><%= product.name %></h4> 
        <div class="list-page-body"> 
        <table class="table table-striped email-config-styled-table">
            <% product.email_configs.each do |email_config| %>
              <%= render(:partial => "email_config", :object =>  email_config) %>      
            <% end %>
        </table>
     <% end %>
    <% end %>
  </div>
</div>
<br/>
<div class="row-fluid">
  <div class="span10">
    <h5 class="lead"><%= t('email_configs.Personalized_email_replies') %></h5>   
    <p class="muted lead-desc"> 
      <%= t('email_configs.Personalized_email_replies_info',:current_user_name => current_user.name, :current_account_domain => current_account.default_email ).html_safe%>
    </p> 
  </div>
  <div class="span2 align-right" id="survey_link_con">
    <input rel="toggle" type="checkbox" id="Personalize_email" name="stop_sla_timer" data-checked-label="<%= t('email_configs.Personalized_email_replies_yes') %>" data-unchecked-label="<%= t('email_configs.Personalized_email_replies_no') %>" <%if current_account.features?(:personalized_email_replies)%>checked="true"<%end%>/>
  </div>
</div>
<div class="row-fluid">
  <div class="span10">
    <h5 class="lead"><%= t('email_configs.reply_to_tickets') %></h5>   
    <p class="muted lead-desc"> 
      <%= t('email_configs.reply_to_tickets_info',:current_user_name => current_user.name, :current_account_domain => current_account.default_email ).html_safe%>
    </p> 
  </div>
  <div class="span2 align-right" id="survey_link_con">
    <input rel="toggle" type="checkbox" id="reply_to_based_tickets" name="stop_sla_timer" data-checked-label="<%= t('plain_yes') %>" data-unchecked-label="<%= t('plain_no') %>" <%if current_account.features?(:reply_to_based_tickets)%>checked="true"<%end%> />
  </div>
</div>
<% javascript_tag do %>
    function update_status(status_url){
      jQuery.ajax({
        url: status_url,
        type: "post"  
      })
    }
    
    jQuery("#Personalize_email").on('change.email_config_feature', function(){
      if(this.checked){
        update_status("<%= personalized_email_enable_admin_email_configs_path %>");
      }
      else{
        update_status("<%= personalized_email_disable_admin_email_configs_path %>");
      }
    });

    jQuery("#reply_to_based_tickets").on('change.email_config_feature', function(){
      if(this.checked){
        update_status("<%= reply_to_email_enable_admin_email_configs_path %>");
      }
      else{
        update_status("<%= reply_to_email_disable_admin_email_configs_path %>");
      }
    });
<%end%>
   