<%= form_for @email_config, :url => admin_email_config_path, :object_name => :email_config , :html => { :method => :put, :id => "editEmailConfigForm"} do |f| %>
<%= f.error_messages %>
<h3 class="lead"><%=t('email_configs.title')%></h3>
<ul class="unstyled form-horizontal row-fluid">
	<li class="control-group">
		<label class="control-label" ><%=t('email_configs.name').html_safe%></label>
			<div class="controls">
				<%= f.text_field :name, :class => "text input-xxlarge" %>
				<div class="muted"><%= t('email_configs.name_info_msg').html_safe %> </div>
			</div>
	</li>
	
	<li class="control-group">
			<label class="control-label" ><%=t('email_configs.reply_email').html_safe%><span class="required_star">*</span></label>
			<div class="controls">
				<%= f.text_field :reply_email, :class => "required email muted text input-xxlarge", :id => "reply_to_id" %>
				<div class="muted"><%= t('email_configs.info7').html_safe %> </div>
			</div>
	</li>

	<li class="control-group">
		<label class="control-label" ><%=t('email_configs.info9').html_safe%></label>
		<div class="controls">
			<%= collection_select(:email_config, :group_id, @groups, :id, :name, options = {:include_blank => "..."},:class =>"select2 input-xlarge") %>
			<div class="muted input-xxlarge"><%=t('email_configs.info10').html_safe%> </div>
		<div class="controls">
	</li>

	<% if current_account.multi_product_enabled? && !@products.empty? && !@email_config.primary_role %> 
		<li class="control-group">
			<label class="control-label" ><%=t('email_configs.assign_to_product_msg').html_safe%></label>
			<div class="controls">
				<%= collection_select(:email_config, :product_id, @products, :id, :name, options = {:include_blank => "..." },:class =>"select2 input-xlarge") %>
				<div class="muted"><%=t('email_configs.assign_to_product_info', :products_path => new_admin_product_path).html_safe%></div> 
			</div>
		</li> 
	<% end %>

	<li class="control-group">
		<label class="control-label" ><%=t('mailbox.mail_server').html_safe%></label>
		<div class="controls row-fluid">
      		<% mailbox_enabled = @email_config.smtp_mailbox && !@email_config.smtp_mailbox.new_record? %>
      		<label class="radio span3 inline">
	        	<input checked="checked" id="DisableMailbox" name="email_config[smtp_mailbox_attributes][_destroy]" type="radio" value="1" <%= 'checked="checked"' unless  mailbox_enabled %> >
	        	<%= t('mailbox.use_default')%>
    		</label>
    		<label class="radio inline">
				<input id="EnableMailbox" name="email_config[smtp_mailbox_attributes][_destroy]" type="radio" value="0" <%= 'checked="checked"' if mailbox_enabled %> >
				<%= t('mailbox.use_your_own')%>
			</label>
		</div>
	</li>

	<li class="control-group">
		<div id="FreshdeskMailbox">
			<span class="span4 control-label"> <%=t('email_configs.info8')%>: </span>
			<div class="controls">
				<%= content_tag(:div, @email_config.to_email, :id => "div_reply_email", :class =>"highlight-textbox-info input-xxlarge" ) %>
				<%= f.hidden_field :to_email, :id => "hidden_reply_to" %>
				<a target="_blank" title="Learn how to configure your support email" href="https://support.freshdesk.com/support/solutions/articles/37541-converting-your-support-email-into-freshdesk-tickets"><%= t(:'email_configs.solution_link').html_safe %></a>
			</div>
		</div>

		<div class="hide" id="CustomMailbox">
			<%= f.fields_for :imap_mailbox, @imap_mailbox do |imap_mailbox| %>
				<%= render :partial => "edit_imap_mailbox", :locals => {:imap_mailbox => imap_mailbox} %>
			<% end %>
			<%= f.fields_for :smtp_mailbox, @smtp_mailbox do |smtp_mailbox| %>
				<%= render :partial => "edit_smtp_mailbox", :locals => {:smtp_mailbox => smtp_mailbox} %>
			<% end %>
		</div>
	</li>
</ul>
<hr>

<div class="align-right">
	<%= link_to(t('remove'), admin_email_config_path(@email_config), :method => 'delete', :confirm => t('email_configs.remove_msg'), :class => "btn floatl" ) unless @email_config.primary_role %>
	<%= link_to(t('cancel'), admin_email_configs_path, :class => "btn", :id => "email-form-cancel" )  %>
	<%= f.submit t('save'), :class => "btn btn-primary"  %>
</div> 
<% end %>

<% content_for :pagefixed do -%>
  <%= render :partial => "mailbox_config", :locals => {:mailbox_form_id => "#editEmailConfigForm"} %>
<% end %>
