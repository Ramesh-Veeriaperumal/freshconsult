<% content_for :head do %>
  <style> html {  height:auto; overflow-y:visible; } </style>
<% end %>
<% content_for :sidebar do %>
  <%= render :partial => "helpnote" %>
<% end %>
<div class="contact_fields">
  <%= render :partial => "freshdesk_freshsales_bundle" %>
  <%= render :partial => "/admin/shared/customer_fields_header", :locals => { :field_class => ContactField } %>
  <br/>
  <%= javascript_include_tag :'cdn/contact_fields' %>
  <%= form_for @fields_to_render, :url => { :action => "update" }, :html => { :method => :put, :id => "Updateform" } do |f| %>

    <div class="custom-form-outer">
      <input type="hidden" name="jsonData" id="field_values" value="" />
      <div class="row-fluid">
        <div class='profile-pic-placeholder avatar-pic span3'>
          <img alt="Profile_blank_medium" src="/assets/misc/profile_blank_medium.jpg">
        </div>
        <div class='span9'>
          <ul id="custom-field-form" class="form-horizontal custom-field-form"></ul>
          <ul id="cloned-custom-field-form" class="form-horizontal custom-field-form cloned-custom-fields"></ul>
        </div>
      </div>
    </div>
  
<%end%>

<% content_for :dialogs do %>
	<div id="CustomFieldsPropsDialog">

  </div>
<% end %>
</div>
<% content_for :pagefixed do %>
  <%= javascript_tag do %>
    // Localizing ticket fields js elements
    customFields = <%= RailsFullSanitizer.sanitize(@fields_json) %>;
    tamDropdownFields = <%= Company::DEFAULT_DROPDOWN_FIELDS.map do |x| x.to_s end.to_json.html_safe %>;
    show_sandbox_notification = <%= show_sandbox_notification %>;
    tf_lang = {
      untitled:           '<%= t("ticket_fields.untitled") %>',
      firstChoice:       '<%= t("ticket_fields.first_choice") %>',
      secondChoice:      '<%= t("ticket_fields.second_choice") %>', 
      noChoiceMessage:  '<%= t("ticket_fields.no_choice_message") %>',
      confirmDelete:     '<%= t("ticket_fields.confirm_delete") %>',
      formTitle:     '<%= t("admin.contact_fields.formfield_props.form_title") %>',
      deleteField:     '<%= t("admin.contact_fields.formfield_props.delete_field") %>',
      regExp:     '<%= t("admin.contact_fields.formfield_props.regexp") %>',
      regExpExample:     '<%= escape_javascript t("admin.contact_fields.formfield_props.regexp_example_html", regex: "/^fresh\w/")%>',
      dropdownChoice:     '<%= t("admin.contact_fields.formfield_props.dropdown_choices") %>',
      addNewChoice:     '<%= t("admin.contact_fields.formfield_props.add_new_choice") %>',
      label:     '<%= t("admin.contact_fields.formfield_props.label") %>',
      labelAgent:     '<%= t("admin.contact_fields.formfield_props.field_label_agents") %>',
      labelCustomer:     '<%= t("admin.contact_fields.formfield_props.field_label_customer") %>',
      behavior:     '<%= t("admin.contact_fields.formfield_props.behavior") %>',
      forAgent:     '<%= t("admin.contact_fields.formfield_props.for_agents") %>',
      agentMandatory:     '<%= t("admin.contact_fields.formfield_props.agent_mandatory_submission") %>',
      forCustomer:     '<%= t("admin.contact_fields.formfield_props.for_customer") %>',
      customerVisible:     '<%= t("admin.contact_fields.formfield_props.customer_visible") %>',
      customerEditable:     '<%= t("admin.contact_fields.formfield_props.customer_edit") %>',
      customerMandatory:     '<%= t("admin.contact_fields.formfield_props.customer_mandatory") %>',
      customerEditSignup:     '<%= t("admin.contact_fields.formfield_props.customer_edit_signup") %>',
      validateRegex:     '<%= t("admin.contact_fields.formfield_props.validate_regexp") %>',
      default:          '<%= t("admin.contact_fields.formfield_props.default") %>',
      number:     '<%= t("custom_fields.number") %>',
      text:     '<%= t("custom_fields.text") %>',
      paragraph:      '<%= t("custom_fields.paragraph") %>',
      checkbox:     '<%= t("custom_fields.checkbox") %>',
      dropdown:     '<%= t("custom_fields.dropdown") %>',
      dropdown_blank:     '<%= t("custom_fields.dropdown_blank") %>',
      phone_number:     '<%= t("custom_fields.phone_number") %>',
      url:      '<%= t("custom_fields.url") %>',
      date:     '<%= t("custom_fields.date") %>',
      email:      '<%= t("custom_fields.email") %>',
      learnMore:     '<%= t("group.learn_more") %>',
      cancel:     '<%= t("cancel") %>',
      done:     '<%= t("done") %>',
      maxItemsReached: '<%= t("admin.contact_fields.formfield_props.max_choices") %>',
      multiple_company_message : '<%= t("admin.contact_fields.formfield_props.multiple_company_message") %>',
      multiple_company_field_label : '<%= t("admin.contact_fields.fields.multiple_company") %>',
      multiple_company_dialog_help_text : '<%= t("admin.contact_fields.multiple_company_dialog_help_text") %>',
      multiple_company_dialog_on : '<%= t("admin.contact_fields.multiple_company_dialog_on") %>',
      multiple_company_dialog_warning : '<%= t("admin.contact_fields.multiple_company_dialog_warning") %>',
      multiple_company_message_enable : '<%= t("admin.contact_fields.formfield_props.multiple_company_message_enable") %>',
      sandbox_notification_for_ticketfields: '<%= t("sandbox.sandbox_notification_for_ticketfields").html_safe %>',
      encrypted_field_banner_text:   '<%= t("ticket_fields.encrypted_field_banner_text") %>',
      encrypted_text: '<%= t("custom_fields.encrypted_text") %>'
    };

    window['translate'] = {}; 
    translate.get = function(name){
      return tf_lang[name] || "";
    };

    var is_multiple_contact_feature_present = <%= Account.current.multiple_companies_toggle_enabled?%>;
    var is_multiple_contact_feature_enabled = <%= Account.current.multiple_user_companies_enabled?%>;
    var is_unique_contact_idetifier_enabled = <%= Account.current.unique_contact_identifier_enabled? %>

    var customField = new CustomFields({existingFields : customFields, 
                        customMessages: tf_lang,
                        nonEditableFields: ['default_tag_names', 'default_description', 'default_client_manager', 'default_twitter_profile_status', 'default_twitter_followers_count'],
                        inVisbileFields: ['default_client_manager'],
                        disabledByDefault: {
                                'default_company_name' : 
                                      {
                                        'visible_in_portal' : false,
                                        'editable_in_portal' : true,
                                        'editable_in_signup' : true,
                                        'required_in_portal' : true                         
                                      }
                        },
                        customFieldType: 'contact'
                      });
    customField.init();
    // Show ProfilePic Holder
    jQuery('.profile-pic-placeholder img').removeClass('hide');
  <% end %>
<% end %> 

<% content_for :layoutType do -%>antipattern<%- end %>