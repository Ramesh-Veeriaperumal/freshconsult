<div class="top_banner">
	<div class="top-banner-content">
		<img src="/images/misc/freshdesklogo.png" alt="Freshdesk" width="204px" height="50px"/>
		<span class="marketplace-link">
			<%= t('link_with_marketplace') %>
		</span>
	</div>
</div>
<div class="google-signup-content">
	<ul class="nav nav-tabs">
	  <li class="active"><a href="#new-account" data-toggle="tab"><%= t('.new_account') %></a></li>
	  <li><a href="#existing-user" data-toggle="tab"><%= t('.existing_user') %></a></li>
	</ul>
	<div class="tab-content">
	  <div class="tab-pane active" id="new-account">
	  	<div class="ui-form signup-form" id="signup-form">
				<%= form_for @account, :url => {:controller => :accounts, :action=> :create_account_google} , :html => { :method => "put", :id => "google_sign_up_form" } do |f| %>
					<%= f.error_messages %>
					<%= show_flash %>
				  <input type="hidden" name="call_back" id="call_back_url" value="<%=@call_back_url%>" />
				  <input type="hidden" value="<%=@user.name%>" size="24" name="user[name]" id="user_name" class="textfield">
				  <input type="hidden" value="<%=@user.email%>" size="24" name="user[email]" id="user_email" class="textfield">
				  <input type="hidden" name="utc_offset" id="account_timezone_offset" />
				  <input type="hidden" value="<%=@account.google_domain%>" name="account[google_domain]" id="account_google_domain" class="textfield" />

				  	<input type="hidden" name="session_json" id="session_json" value="">
					<input type="hidden" name="first_referrer" id="first_referrer" value="">
					<input type="hidden" name="first_landing_url" id="first_landing_url" value="">
					<input type="hidden" name="first_search_engine" id="first_search_engine" value="">
					<input type="hidden" name="first_search_query" id="first_search_query" value="">
					<input type="hidden" name="pre_visits" id="pre_visits" value="">

				  <ul>
						<li>
							<label for="account_name"><strong><%= t('.company_name') %> <span class="required_star">*</span></strong></label>
							<input type="text" size="24" name="account[name]" id="account_name" class="text required input-xlarge" value="<%=@account.name%>">
						</li>
						<li>
							<label for="account_sub_domain"><strong><%= t('.helpdesk_url') %> <span class="required_star">*</span></strong></label>
							<div class="textfield">
			      				<div class="domain">
			      					<label for="account_domain" class="ghostwriter_info">
			      						<label class="ghostwriter_hide"></label>
			      						<label></label>
			      					</label>
			      					<div class="input-append">
											  <input type="text" class="span4 required" value="<%=@account.domain%>" size="24" maxlength="60" rel="ghostWriter" autocomplete="off" name="account[domain]" id="account_domain" placeholder="<%= t('.helpdesk_name') %>" data-ghost-text=".freshdesk.com">
											  <span class="add-on"><strong class="big-text"><%= t('.freshdesk_dot_com') %></strong></span>
											</div>
			      				</div>
			      			</div>

							<!--input type="text" value="<%=@account.domain%>" size="24" name="account[domain]" id="account_domain" class="text very_small required"><strong class="big-text">.freshservice-dev.com</strong-->
							<div class="info-data"><%= t('.domain_info') %></div>
						</li>
						<li>
							<label for="user_email"><strong><%= t('.phone_no') %></strong></label>
					      	<input type="text" size="24" name="user[phone]" id="user_phone" class="text input-xlarge" value="<%=@user.phone%>">
						</li>
						<li class="button-container">
							<div><%= submit_tag t('.create_my_account'), :class => "btn btn-primary pull-left" %></div>
							<div class="help_text pull-left">
								<%= t('.terms_and_policy').html_safe %>
							</div>
						</li>
					</ul>
				<% end %>
			</div>
	  </div>
	  <div class="tab-pane" id="existing-user">
	  		<div class="ui-form signup-form" id="change-sub-domain">
					 <%= form_for @account, :url => {:controller => :google_signup, :action=> :associate_google_account} , :html => { :method => "put" } do |f| %>
						<%= error_messages_for :account %>
						<%= show_flash %>
							<input type="hidden" value="<%=@call_back_url%>" name="call_back" id="call_back_url" />
					  	<input type="hidden" value="<%=@user.name%>" size="24" name="user[name]" id="user_name" class="textfield">
					  	<input type="hidden" value="<%=@user.email%>" size="24" name="user[email]" id="user_email" class="textfield">
							<!-- <input type="hidden" value="<%=@open_id_url%>" name="user[uid]" id="open_id_url" /> -->
							<input type="hidden" value="<%=@account.google_domain%>" name="account[google_domain]" id="account_google_domain" class="textfield" />
							<input type="hidden" value="<%=@uid%>" name="user[uid]" id="user_uid"  />
							<ul>
								<li>
									<label for="account_sub_domain"><strong><%= t('.your_freshdesk_url') %></strong><span class="required_star">*</span></label>
									<div class="textfield">
				        				<div class="domain">
				        					<label for="account_sub_domain" class="ghostwriter_info">
				        						<label class="ghostwriter_hide"></label>
				        						<label></label>
				        					</label>
				        					<div class="input-append">
													  <input type="text" class="span3" value="<%=@account.domain%>" size="24" maxlength="60" rel="ghostWriterSubDomain" autocomplete="off" name="account[sub_domain]" id="account_sub_domain" placeholder="<%= t('.helpdesk_name') %>" data-ghost-text=".freshdesk.com">
													  <span class="add-on"><strong class="big-text"><%= t('.freshdesk_dot_com') %></strong></span>
													</div>
				        				</div>
				      				</div>


									<!--input type="text"  size="24" name="account[sub_domain]" id="account_sub_domain" class="text very_small required">
									<strong class="big-text">.freshservice-dev.com</strong-->
									<div class="info-data"><%= t('.domain_info') %></div>
								</li>
								<li class="button-container">
									<%= submit_tag t('.submit'), :class => "btn btn-primary pull-left" %>
								</li>
							</ul>
					<% end %>
				</div>
	  </div>
	</div>
</div>

<%= javascript_tag do %>
  jQuery(document).ready(function(){
    jQuery("#account_timezone_offset").val(getLocalTimeZoneOffset());
    jQuery(".btn-primary").removeClass("disabled");
		jQuery(".btn-primary").attr("Submit","Loading...");
		jQuery(".btn-primary").removeAttribute("disabled");
		sub_domain = '<%=@sub_domain%>'
		if (sub_domain != null && sub_domain != "")
		{
			associate_existing_domain()
		}

	// script to store visitor traffic info in cookie
	if(session){

		 if(!(jQuery.cookie("fd_fr"))){jQuery.cookie("fd_fr",session["current_session"]["referrer"],{expires:365});}
		 if(!(jQuery.cookie("fd_flu"))){jQuery.cookie("fd_flu",session["current_session"]["url"],{expires:365});}

if(!(jQuery.cookie("fd_se"))){jQuery.cookie("fd_se",session["current_session"]["search"]["engine"],{expires:365});}

if(!(jQuery.cookie("fd_sq"))){jQuery.cookie("fd_sq",session["current_session"]["search"]["query"],{expires:365});}

		 var visits = (jQuery.cookie("fd_vi"))||0;
		 jQuery.cookie("fd_vi", (parseInt(visits)+1),{expires:365});

	}

	jQuery("#google_sign_up_form").submit(function(){
			jQuery("#session_json").val(JSON.stringify(session));
			jQuery("#first_referrer").val((jQuery.cookie("fd_fr")||""));
			jQuery("#first_landing_url").val((jQuery.cookie("fd_flu")||""));
			jQuery("#first_search_engine").val((jQuery.cookie("fd_se")||""));
			jQuery("#first_search_query").val((jQuery.cookie("fd_sq")||""));
			jQuery("#pre_visits").val((jQuery.cookie("fd_vi")||0));
			jQuery(".btn-primary").addClass("disabled");
  			jQuery(".btn-primary").attr("value","Loading...");
  			jQuery(".btn-primary").attr("disabled", "disabled");

	})

  });

  function getLocalTimeZoneOffset()
  {
	 var timeZoneOffset = (new Date()).getTimezoneOffset() / 60 * (-1);
	 timeZoneOffset -= (isDST() ? 1 : 0);
	 return timeZoneOffset;
  }

  	function isDST() {
		   var today = new Date();
		   var jan = new Date(today.getFullYear(), 0, 1, 0, 0, 0, 0);
		   var jul = new Date(today.getFullYear(), 6, 1, 0, 0, 0, 0);
		   var temp = jan.toGMTString();
		   var jan_local = new Date(temp.substring(0, temp.lastIndexOf(" ")-1));
		   var temp = jul.toGMTString();
		   var jul_local = new Date(temp.substring(0, temp.lastIndexOf(" ")-1));
		   var hoursDiffStdTime = (jan - jan_local) / (1000 * 60 * 60);
		   var hoursDiffDaylightTime = (jul - jul_local) / (1000 * 60 * 60);

		   return hoursDiffDaylightTime != hoursDiffStdTime;
		}
	function associate_existing_domain()
	{
		jQuery("#signup-form").hide();
		jQuery("#change-sub-domain").show();
	}
	function new_account()
	{
		jQuery("#change-sub-domain").hide();
		jQuery("#signup-form").show();
	}

	jQuery(document).ready(function(){
  		jQuery("[rel=ghostWriter]").ghostWriter();
  		jQuery("[rel=ghostWriterSubDomain]").ghostWriter();

  	});

<% end %>