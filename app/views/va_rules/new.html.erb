<%= javascript_include_tag "condition-filter.js" %>

<script type="text/javascript">
	var filter_Array = $A(<%= @filter_defs %>);
	var condition_Array = $A(<%= @condition_defs %>);
	var action_Array	= $A(<%= @action_defs %>);
	
	var filter_plugin = initRuleList(filter_Array, condition_Array, action_Array, "#RuleList", "#add_filter", "#ActionList", "#add_action", "#VirtualAgent");
	
	jQuery(document).ready(function(){
		jQuery("#RuleList, #ActionList").sortable({ items: "fieldset", containment: "parent", tolerance: "pointer", handle:"span.sort_handle"});
		
			
		jQuery("#VirtualAgent")		
			.submit(function(){
				// Passing the value into a hidden field				
				this['save_json'].value = filter_plugin.get_filter_list("json");
				//console.log(this['save_json'].value);
				return true;
			})
			.validate({
				rules:{
					vagent_name: "required"			
				},
				messages:{
					vagent_name: "Virtual agent name is empty"
				}
			});
			
	});
</script>

<div class="pageContent"> 
	<h3 class="content_title">Virtual Agent - New Rule</h3>
	<span class="seperator"></span>
	<% form_for @va_rule, :html => {:id => "VirtualAgent"} do |f| %>
	
		<input type="hidden" name="id"   value="" />
		<input type="hidden" name="type" value="virtual_agents" />
		<ul class="ui-form">
			<li>
				<%= f.label :name, "Rule Name *" %>
				<label class="overlabel" for="va_rule_name">eg: <em>"Subscription related tickets"</em> </label>
				<%= f.text_field :name, :class => "required" %>
			</li>
			<li>
				<%= f.label :description %>
				<!--label class="overlabel" for="agent_desc">
					We Know it's pretty boring. <br />
					But meaningful descriptions can help you later to quickly identify what this rule does,<br /> 
					when you have a tons of rules. <br />
					Go Ahead and type something like - <br /><em>"All Subscription related tickets will be assigned to Susan"</em>
				</label-->
				<label class="overlabel" for="va_rule_description">
					eg: <em>"All Subscription related tickets will be assigned to Susan"</em>
				</label>
				<%= f.text_area :description, :class => "smallpara" %>
			</li>
			<li><span class="seperator"></span></li>						
			<li class="choicelist">
				<label>When should this rule be applied?</label>
				<%= f.radio_button  :match_type, 'any', :class => "radio" %> <%= f.label :match_type_any, "Match Any", :class => "radiolabel" %>
				<%= f.radio_button  :match_type, 'all', :class => "radio" %> <%= f.label :match_type_all, "Match All", :class => "radiolabel" %>
			</li>	
			<li class="conditionset">			
				<div id="RuleList"></div>			
				<fieldset class="addchoice" id="add_filter">
			         Add new condition <img alt="Add New choice" class="add" src="/images/add.png" />
			     </fieldset>			
			</li>
			<li><span class="seperator"></span></li>
			<li class="choicelist">								
				<label>Actions to Perform?</label>				
			</li>
			<li class="conditionset">
				<div id="ActionList"></div>
				<fieldset class="addchoice" id="add_action">
			        Add new action <img alt="Add New action" class="add" src="/images/add.png" />
			    </fieldset>		
			</li>
		</ul>
		<br />
		<div class="button-container">
			<input type="hidden" name="save_json" value="Test Value" />
			<input type="submit" class="fdbutton" value="Save" />
			<%= link_to "Cancel", {:action => 'index'}, :class => "fdbutton grey" %>
		</div>
	<% end %>
</div>
