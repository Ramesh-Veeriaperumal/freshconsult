<% 
	attach_id ||= "ticket" 
	nsc_param = nsc_param || "helpdesk_ticket"
%>
  <div class="attach_wrapper clearfix">
    <div class="attach_file">
      <label><%= t('attach_file_local') %></label>
      <input type="file" id="<%=attach_id%>_file" name="emptyfile" nameWhenFilled="<%=nsc_param%>[attachments][][resource]" fileContainer="<%=attach_id%>-container" fileList="<%=attach_id%>-attachments" sendFocusTo="<%=attach_id%>-body" />
      <div class="info-data">
        <%=t('attachment_help_info')%>
      </div>
    </div>
    <% unless dropbox_app_key.blank?  %>
    <div class="dropbox_div">       
      <div class="db-chooser" id="dropboxjs" data-app-key="<%=dropbox_app_key%>">
        <label><%= t('dropbox_attach_label') %></label>
          <input type="hidden"  id="<%=attach_id%>_url" name="dropboxURL" nameWhenFilled="[cloud_file_attachments][]" fileContainer="<%=attach_id%>-container" fileList="<%=attach_id%>-attachments" sendFocusTo="<%=attach_id%>-body" />
          <div class="attach-list-wrap tkt-dropbox-atmt">
            <i class="ficon-dropbox fsize-16"></i>
            <input type="button" class="dropbox_button" name="selected-file" id="db-chooser" data-holder="<%=attach_id%>_url" onclick='initDropbox(this);' value="<%=t('dropbox_choose_file_from')%>">
          </div>
          <script type="text/javascript">
              function initDropbox(inp){
                Dropbox.choose({success:function(files){
                    var inputElement = jQuery(inp).data('holder');

                    jQuery('#'+inputElement)
                      .val(JSON.stringify({link: files[0].link, name: files[0].name, provider: 'dropbox'}))
                      .data('filename', files[0].name)
                      .data('provider', 'Dropbox');

                    Helpdesk.Multifile.addFileToList(jQuery('#'+inputElement));
                    newInput = Helpdesk.Multifile.duplicateInput(jQuery('#'+inputElement));
                    jQuery(inp).data('holder',newInput.attr('id'));
                }, extensions:""})
              }
          </script>
      </div>
    </div>
    <%end%>
  </div>
<div class="attachments" id="<%=attach_id%>-container" style="display:none">
  <div id="<%=attach_id%>-attachments" class="shared_attachment_list"></div>
</div>

<%# 
  The following is a template used by multifile.js to create rows in
  the attachments table.
 %>
<%= render :partial => "/shared/multifile_template" %>
<% unless dropbox_app_key.blank? %>
  <script type="text/javascript" src="https://www.dropbox.com/static/api/1/dropbox.js"></script>
<% end %>