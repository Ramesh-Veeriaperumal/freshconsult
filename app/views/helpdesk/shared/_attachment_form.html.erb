<% 
  attach_id ||= "ticket" 
  nsc_param = nsc_param || "helpdesk_ticket"
  public_ticket = public_ticket || false
%>
<div class="attach-wrapper row-fluid single_file <% if cloud_files_installed? and (@ticket.present? ? !@ticket.ecommerce? : true)  %> cloud<% end %>">
  <div class="span10">    
    <% if cloud_files_installed? %>
      <div class="dropdown dropup">        
        <a class="dropdown-toggle attach-link" data-toggle="dropdown" href="#">
          <i class="wicon-paper-clip"></i><%=I18n.t('attach')%><b class="caret"></b>
        </a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
          <li class="portal-attach">
            <a data-file-id="<%=attach_id%>" href="javascript:void(0)" class="attach-link-wrap">
                <%= I18n.t('portal.attach_file').html_safe %> <span class="attachment-help-info"> ( <%= t('total') %> <%= t('attachment_help_info', :attachment_size => attachment_size) %> )</span>
                <div class="attach-file attach-link-file" id="<%= attach_id %>-attach-container">  
                  <input type="file" name="emptyfile" 
                    id="<%=attach_id%>_file"
                    data-attach-id="<%=attach_id%>"
                    nameWhenFilled="<%=nsc_param%>[attachments][][resource]" 
                    fileContainer="<%=attach_id%>-container" 
                    fileList="<%=attach_id%>-attachments"
                    sendFocusTo="<%=attach_id%>-body" />
                </div>
            </a>
          </li>
          <% get_enabled_cloud_files_app.each do |c_f| %>
            <%= render :partial => "integrations/applications/#{c_f}", :formats => [:html], :locals => {:attach_id => attach_id} %>
          <% end %>
        </ul>      
      </div>
    <% else %>      
      <div class="attach_wrapper clearfix">
        <div class="attach_file span5">
        <label><%= t('attach_file_local') %></label>
        <input type="file" id="<%=attach_id%>_file" name="emptyfile" 
               nameWhenFilled="<%=nsc_param%>[attachments][][resource]" 
               fileContainer="<%=attach_id%>-container" fileList="<%=attach_id%>-attachments" 
               sendFocusTo="<%=attach_id%>-body"
               max_size="<%=attachment_size%>" 
               />
        <span class="info-data <%=(public_ticket)? "no-top":""%>">
         <%= t('total') %> <%= t('attachment_help_info', :attachment_size => attachment_size) %>
        </span> 
      </div>
    <% end %>
    <div class="attachments-list-form span5" id="<%= attach_id %>-container" style="display:none">
      <div id="<%= attach_id %>-attachments" class="shared_attachment_list"></div>
    </div>
  </div>
  <script type="text/javascript">
    // Fix for Firefox/IE - To override :hover style persistance after click on input[type=file] element
    jQuery('div.attach-wrapper a[data-toggle="dropdown"]').bind('click', function(){
      jQuery(this).parents('div.attach-wrapper').find('a.attach-link-wrap').first().css({
            'background-color': 'inherit',
            'background-image': 'inherit',
            'color': 'inherit',
            'box-shadow': 'inherit'
        });
    });
    jQuery('li.portal-attach a.attach-link-wrap')
      .bind('mouseover', function(){
        jQuery(this).removeAttr('style');
      })
      .bind('mousemove', function(event){
        // Fix to move "Browse" button along with mouse pointer - fix for IE.
        p=jQuery(this).find('div').first();
        newLeft = Math.min(175, Math.max(event.clientX - p.offset().left + p.position().left - 5, 0));
        window.title = newLeft;
        p.css({left: newLeft, top: 0});
      })
  </script>

<%# 
  The following is a template used by multifile.js to create rows in
  the attachments table.
 %>
<%= render :partial => "/shared/multifile_template_new" %>