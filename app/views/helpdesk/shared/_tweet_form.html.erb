<div class="request_panel" id="<%=cntid%>" style="display:none;" rel="emitter" data-node-name="agent_replying">
<div class='reply_box'>
  <%= form_for note, :url => twitter_helpdesk_ticket_conversations_path(@ticket), :html => {:multipart => true,  :id => "HelpdeskTweets" } do |f| %>
    <%= f.error_messages %>
	<%= hidden_field_tag :tweet, "true", :id => "tweet" %>
    <%= hidden_field_tag(:page , params[:page], :id=>:page  ) unless params[:page].nil? %>  
    <%= f.hidden_field :private , :value => "false" %>
    <ul class="ui-form dont-validate">
      <li class="inline-field field">       
        <%= content_tag( :h4, t(".title", :user=>"@#{@ticket.requester.twitter_id} "), :class => "title") %>
        <label class="caption"><%= t("ticket.from") %></label>
        <div class="fields">
           <%= select_tag :twitter_handle, options_from_collection_for_select(current_account.twitter_handles, :id, :screen_name, {:selected => @ticket.fetch_twitter_handle}) %>
        </div>
	  </li>				
	  <li class="inline-field field">
	    <label class="caption">
				<%= t("message") %> :
			</label>
	    <div class="fields">
	    	<%= f.fields_for(:note_body, Helpdesk::NoteBody.new) do |ff| %>
            <%= ff.text_area :body ,  { :class => 'required tweet auto-height', :id => "#{id}-#{cntid}-body", :value =>default_twitter_body_val(@ticket), :rows => "3" } %>
          	<% end %>
      	<%= f.hidden_field :source , :value => Helpdesk::Note::SOURCE_KEYS_BY_TOKEN["twitter"]%>  
				<%= hidden_field_tag(:ticket_status , params[:ticket_status], :id=>:tweet_ticket_status  )%>        
	    </div>
	  </li>
    <li class="button-container">
       <span id="not_following_message" class="info-highlight center" style="padding:8px 10px;position:relative;left:-20px;top:2px;"></span>
       <span class="tweet-counter" id="SendTweetCounter"></span>
	   <span id="tweet_type_selector" style="display:none;position:relative;">
	   	<%= select_tag :tweet_type , options_for_select(Social::Tweet::TWEET_TYPES, @ticket.tweet ? @ticket.tweet.tweet_type.to_sym : :mention ) ,{}%>
	   </span>
	   
	   <%= submit_tag(t('ticket.reply_form.send'), :class => "uiButton" ) %>
     <% if privilege?(:edit_ticket_properties) %>
	     <a class="btn btn-primary submit_btn" id="tweet-reply-btn" data-tweet-type="<%=@ticket.tweet.tweet_type%>">
     <% end %>
	   <%= button_to_function(t('cancel'), "jQuery('#cnt-tweet').hide().trigger('visibility');", :class => "uiButton" ) %>
    </li>
   </ul> 
  <% end %>
</div>
</div> 	

<% content_for :onload_script do %>
  jQuery("#HelpdeskTweets").validate(); 
  jQuery("#tweet_type").change();
<% end %>

<%= javascript_tag do %>
jQuery(document).ready(function(){
jQuery('#twitter_handle').change(function user_follows(){
twitter_handle= jQuery('#twitter_handle').val();
req_twt_id = '<%=@ticket.requester.twitter_id %>';
istwitter = '<%=@ticket.twitter?%>';
if (!istwitter || req_twt_id == "" || twitter_handle == "")
{
return ;
} 
jQuery('#twitter_handle').change(); 
});
<% end %>
