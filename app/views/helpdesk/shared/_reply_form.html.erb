<% content_for :head do %>
  <%= javascript_include_tag "helpdesk/page_switcher" %>
  <% javascript_tag do %>
    document.observe("dom:loaded", function(){
      new Helpdesk.PageSwitcher({
        toggleMode: true,
        pages: ['attachment-options']
      });	
	  jQuery("#HelpdeskReply").validate();
    }); 
  <% end %>
<% end %>
<div class="request_panel" id="<%=cntid%>" style="display:none;">
  <% form_for note, :html => {:multipart => true, :id => "HelpdeskReply" } do |f| %>
    <%= f.error_messages %>
	<ul class="ui-form dont-validate">
		<li>
			<h3 class="title">Reply to the conversation</h3>
		</li>
    	<li datafor="email" style="display:block">
			<%= f.label(:reply_email, "Send the reply from the following email id") %>
			<%= select :reply_email, :id, options_for_select(@reply_email, @ticket.reply_email) %>
			<span class="seperator"></span>
		</li>
		<li>
			<%= f.label(:body, "Enter your message here", :for =>"#{id}-#{cntid}-body", :class => "overlabel" ) %>
    		<%= f.text_area :body, { :class => 'expando required', :id => "#{id}-#{cntid}-body" , :value => @signature} %>
    	</li>
		
		<% unless @ticket.ticket_topic.nil? %>
		<li datafor="posts">
			<label>
				<%=check_box_tag :post_forums%> Post in linked forum
			</label>
		</li>
		<%end%>	
		
		<!-- reply will be always public -->
		
		<%=f.hidden_field :private , :value => false %>
		
		<!--reply source will be always email-->			
		
		<%=f.hidden_field :source , :value=>Helpdesk::Note::SOURCE_KEYS_BY_TOKEN["email"]%>
	
		<li class="attachment-options"  id="attachment-options">
			<% unless local_assigns[:no_attachments] %>
			<%= render :partial => "/helpdesk/shared/attachment_form", :locals => { :attach_id => id , :nsc_param => "helpdesk_note" } %>
		    <% end %>
		</li>
		<li class="alignright">
      		<%= submit_tag(local_assigns[:submit] || ActiveSupport::Inflector.titleize(id), :class => "uiButton" ) %>
    	</li>      
	</ul>
 	
  <% end %>
</div>
