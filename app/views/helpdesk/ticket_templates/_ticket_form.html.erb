<% current_portal.ticket_fields_including_nested_fields.each do |field|
    next if field.section_field? || field.shared_ownership_field? || (field.field_name.eql?("source") && !current_account.ticket_source_revamp_enabled?) || (field.field_name.eql?("email") && !@parent_id)
    @ticket ||= current_account.tickets.new
    if is_edit
      field_value = field.field_type == "nested_field" ? nested_ticket_field_value(@tkt_template, field) : @tkt_template.template_data[field.field_name]
    elsif field.is_default_field?
      field_value = @ticket[field.field_name]
    end
    field_label = ( field.is_default_field? ) ? I18n.t("ticket_fields.fields.#{(field.name)}").html_safe : (field.label).html_safe
    dom_type    = (field.field_type == "default_source") ? "template_source_dropdown" : field.dom_type
  %>
  <%= construct_new_ticket_element f, :template_data,
                                  field,
                                  field_label,
                                  dom_type,
                                  field.required,
                                  field_value,
                                  "",
                                  false,
                                  is_edit  %>

  <% if field.has_section?
    section_container = construct_new_section_fields(f, :template_data, field, is_edit, @tkt_template, false) %>
    <%=content_tag(:li, section_container.html_safe)%>
  <% end %>
<% end %>
<%= render :partial => "/helpdesk/tickets/remote_tags" , :locals => {:values => @tkt_template.template_data[:tags],  :element_id => :template_data_tags, :element_label => :template_data_tags,:element_name => "template_data[tags]"}%>
<% content_for :onload_script do -%>
  var MAX_TAG_LENGTH_MSG = "<%= I18n.t('helpdesk.tickets.show.max_tag_length_msg') %>";
  // Sync data of agent select box with group
  jQuery(window).on('load', function(){
    jQuery("#template_data_group_id").trigger('change');
  });
<%- end %>