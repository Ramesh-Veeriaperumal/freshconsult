<% content_for :helpcard do %>
  <%= render :partial => "helpnote_without_tour" %>
<% end %>
<%# multifile attachments templates %>
<% if  current_account.launched?(:multifile_attachments)  %>
<%= render "helpdesk/tickets/ticket_widget/multifile_template_generator" %>
<% end %>
<%= form_for @tkt_template, :url => { :controller => "ticket_templates", :action => "create" }, :html => { :multipart => true, :rel => "validate", :class => 'form-unsaved-changes-trigger', :id => "ticket_template"}  do |f| %>
	<div class='page-header-sticky' rel='sticky'>
		<div class='sticky-header-wrapper'>
			<h3 class='lead pull-left'> 
				<%= t('ticket_templates.title') %> 
			</h3>
			<div class="pull-right">
				<%= link_to t('cancel'), helpdesk_ticket_templates_path(), :class => "btn", :'data-pjax' => "#body-container" %>
				<%= f.submit t('save'), :class => "btn btn-primary" %>
			</div>
		</div>
	</div>
	<br/>
	<%= render :partial => "form", :locals => { :f => f, :is_edit => true} %>
<% end %>

<!-- Canned response dialog -->
<%= render :partial => "/helpdesk/ticket_templates/canned"  %>
<% 
attachment_dom = ""
  if current_account.launched?(:multifile_attachments) 
    attachment_dom = ""
  else 
    if @all_attachments.present?
      @all_attachments.each do |att|
        if att.attachable_type != "Account"
          attachment_dom << send(:description_attachment, {:filename=>"#{escape_javascript(att.content_file_name)}",:value => "#{att.id}", :name => "template_data[attachments][][resource]"})
        else 
          attachment_dom << send(:description_attachment, {:filename=>"#{escape_javascript(att.content_file_name)}", :value => "#{att.id}", :name => "shared_attachments[]"})
        end
      end
    end 

    if @cloud_files.present?
      @cloud_files.each do |att|
        attachment_dom << send(:description_attachment, {:filename=>"#{escape_javascript(att.filename)}", :value => "#{att.serialize}", :name => "[cloud_file_attachments][]"})
      end
    end
  end
  
%>

<% content_for :onload_script do  %>
function unescapeHtml(text) {
    var temp = document.createElement("div");
    temp.innerHTML = text;
    var result = temp.childNodes[0].nodeValue;
    temp.removeChild(temp.firstChild);
    return result;
}
<% if @all_attachments.present? or @cloud_files.present? %>
  var x = '<%= escape_javascript(attachment_dom) %>';
  jQuery('#ticket-attachments').html(unescapeHtml(x));
  jQuery("#prev-attachments").html("");
<% end %>
<% end %>



