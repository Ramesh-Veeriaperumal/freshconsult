<% content_for :head do %>
  <%= javascript_include_tag "helpdesk/core" %>
  <%= javascript_include_tag "helpdesk/page_switcher" %>
  <%= javascript_include_tag "helpdesk/take_it_button" %>
  <%= javascript_include_tag "helpdesk/id_selector" %>

  <% javascript_tag do %>
    document.observe("dom:loaded", function(){
      
	  Helpdesk.sel = new Helpdesk.MultiSelectorsOnPages({
	      pages: ['list', 'expanded'],
	      cookieName: 'helpdesk-tickets-page'
	  });
	
	  Helpdesk.sel.submitOnClick('assign-multiple-button', ['responder_id']); 
	  
      new Helpdesk.PageSwitcher({
        toggleMode: true,
        pages: ['assign-options']
      });

      Helpdesk.monitorTakeItButtons();
	  	
      Helpdesk.submitOnChange('sort');
	  
	  Helpdesk.sel.toggleCheckAll = function(source){
	  	if(source.checked)
			Helpdesk.sel.checkAll();
		else
			Helpdesk.sel.uncheckAll();
	  }

	  
	});
	
  <% end %>
<% end %>



<% content_for :main_panel_title do %>
<h3 class="title">
	Tickets Tagged: <span class="tag"><%= @item.name %></span>  	
  <%= render :partial => "/helpdesk/tickets/filters" %>
</h3>
<% end %>

<% content_for :main_panel_actions do %>
  <%= link_to "Rename This Tag", :action => :edit %>
<% end %>

<% content_for :main_panel_toolbar do %>
<% end %>

<% content_for :main_panel_selected_toolbar do %>
<% end %>


<% content_for :main_panel_content do %>

  
  <%# 
    This form is used by JS to submit "Take It" button clicks 
    We couldn't use the button_to helper because it resulted in a 
    form within a form, which caused huge rendering problems in firefox.
  %>
  <%= form_tag "", :method => :put, :style=>'display: none', :id => 'accept-form' do end %>

  <div id="pages" class="tickets-container">
    <%= render :partial => "/helpdesk/tags/ticket_header" %>
    <% form_tag "", { :id => "expanded", :method => :put, :style=>'display: none'} do %>
      <table class="tickets-expanded">
        <%= render :partial => "/helpdesk/shared/expanded/ticket", :collection => @tickets %>
      </table>
    <% end %>

    <% form_tag "", { :id => "list",  :method => :put, :style=>'display: none' } do %>
      <table class="tickets">
        <%= render :partial => "/helpdesk/shared/collapsed/ticket", :collection => @tickets %>
      </table>
    <% end %>
  </div>

  <%= will_paginate @tickets %>

  <div class="clear"></div>
<% end %>




<%= render :partial => "/helpdesk/shared/main_panel" %>
