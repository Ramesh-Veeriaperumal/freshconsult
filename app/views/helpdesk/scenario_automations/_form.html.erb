<%= render :partial => "admin/shared/filter_jsinit", :locals => { :filter_type => "automation", :placeholders => [] } %>

<%= f.error_messages :object_name => 'scenario' %>
<ul class="ui-form observer no-background">
	<li class="row-fluid">
		<div class="row-fluid">
			<%= f.label :name, (t('scenario_label') + "<span class='required_star'>*</span>").html_safe, :class => "span2" %>
			<div class="span8">
				<label class="overlabel" for="va_rule_name"><%= t("example") %>: <em>"<%=t('automations.info5')%>"</em> </label>
				<%= f.text_field :name, :class => "required" %>
			</div>
		</div>
		<div class="row-fluid">
			<%= f.label :description,t('description'), :class => "span2" %>
			<div class="span8">
				<label class="overlabel" for="va_rule_description">
					<%= t("example") %>: <em>"<%=t('automations.info6')%>"</em>
				</label>
				<%= f.text_area :description, :class => "smallpara" %>
			</div>
		</div>
	</li>	

	
	<li>
		<h3 class="lead">
			<%=t('automations.actions')%>
			<label class="muted"><%=t('automations.info7')%></label>
		</h3>

		<div class="conditionset" id="actionDOM">
			<div id="ActionList" class="rule_list"></div>
			<fieldset class="addchoice">
	        <i class="rounded-add-icon"></i>
	        <p><%=t('dispatch.add_new_action')%></p>
	    	</fieldset>

	<li class="inline-field  form-horizontal">
		<div class="control-group">
		<%= f.fields_for :accessible do |access| %>
			<label class="control-label"><%=t('automations.visibility.available_for').html_safe%> :</label>
			<div class="controls">
				<label class="radio" id="only_me">
					<%= access.radio_button  :access_type, Helpdesk::Access::ACCESS_TYPES_KEYS_BY_TOKEN[:users], {:onclick =>"toggleGroup(this.value)", :class => "radio", :checked => Helpdesk::Access::ACCESS_TYPES_KEYS_BY_TOKEN[:users]== @va_rule.accessible.access_type } %>
					<%= t('automations.visibility.me_only') %>
				</label>
			</div>
			<div class="controls">
				<label class="radio" id="all_agents">
					<%= access.radio_button  :access_type, Helpdesk::Access::ACCESS_TYPES_KEYS_BY_TOKEN[:all], {:onclick =>"toggleGroup(this.value)",:class => "radio" ,:checked => Helpdesk::Access::ACCESS_TYPES_KEYS_BY_TOKEN[:all]== @va_rule.accessible.access_type } %>
					<%= t('automations.visibility.all_agents') %>
				</label>
			</div>
			<div class="controls">
				<label class="radio" id="group_agents">
					<%= access.radio_button  :access_type, Helpdesk::Access::ACCESS_TYPES_KEYS_BY_TOKEN[:groups],{:onclick =>"toggleGroup(this.value)" , :class => "radio" , :checked => Helpdesk::Access::ACCESS_TYPES_KEYS_BY_TOKEN[:groups]== @va_rule.accessible.access_type} %>
					<%= t('automations.visibility.groups') %>
				</label>
				<div style="display:none;" class="mt5" id="accessible_group">
					<%= access.select_tag("va_rule[accessible_attributes][group_ids]", options_from_collection_for_select(current_account.groups_from_cache,"id", "name",{:selected=>@va_rule.accessible.groups.collect{|group| group.id} ,:include_blank => true}), {:multiple => true, :class => "select2 span5", :size => 4, :placeholder => "Select groups"}) %>
		     </div>
			</div>
		<%end%>
		</div>
	</li>
</ul>



<div class="button-container">
	<%= link_to t('cancel'), "/helpdesk/scenario_automations/tab/#{@current_tab}", :class => "btn" %>
	<input type="submit" class="btn btn-primary" value="<%=t('save')%>" />
</div>

<% content_for :pagefixed do %>
	<%= render :partial => "/shared/placeholder_help", :locals => { :placeholders => ticket_placeholders }  %>
<% end %>

<%= javascript_tag do %>

jQuery(document).ready(function(){
	toggleGroup(<%=@va_rule.accessible.access_type%>);

	if (!<%=privilege?(:manage_scenario_automation_rules)%>)
	{
	  jQuery('#all_agents,#group_agents,#only_me').children().attr('disabled','disabled');
	  jQuery('#all_agents,#group_agents').addClass("muted");
  }
});

function toggleGroup(access_id)
{
	if (access_id == '<%=Helpdesk::Access::ACCESS_TYPES_KEYS_BY_TOKEN[:groups]%>')
	{
		jQuery('#accessible_group').show();
		jQuery('#accessible_group select').select2();
	}
	else
	{
		jQuery('#accessible_group').hide();
		jQuery('#accessible_group select').select2('val', '')
	}
}
<% end %>

