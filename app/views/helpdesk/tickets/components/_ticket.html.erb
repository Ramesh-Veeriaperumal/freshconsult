<% javascript_tag do %> 
	changeAggentList = function(group_id)
	{
		jQuery('#assigned_to')
			.addClass('loading-right')
			.children("select")
			.replaceWith("...");
		
		jQuery.ajax({type: 'POST',
					 url: '/helpdesk/tickets/get_agents/'+group_id,
					 contentType: 'application/text',
					 success: function(data){
								jQuery('#assigned_to')
									.html(data)
									.hide()
									.removeClass('loading-right')
									.show("highlight", {}, 500);
							  }
					});
	}
	
	function dueDateSelected(date){
		new Date(date);
	}
	
<% end %>

<div id="TicketProperties">
	<h3 class="title"><%=t('ticket_due_by_time')%></h3>
	<ul class="cnt" id="due-by-time-parent">
	   <li>
			<div id="edit-due-by-time" >
				 <span class="edit-item"></span>
				 <span><%= formated_date(ticket.due_by) %></span>
			</div> 
	   </li> 
	</ul>
	<h3 class="title"><%=t('ticket.properties')%></h3>	
	<% form_for ticket, :html => { :id => 'custom_ticket_form' } do |f| %>
	   <ul class="cnt">
		   <!--form values starts here-->
		   <% current_portal.ticket_fields.each do |field| %>
		     <% if field.visible_in_view_form? %>
		      <% 
		          field_value = (field.is_default_field?) ? ticket[field.field_name] : @item.get_ff_value(field.name)
		          dom_type    = (field.field_type == "default_source") ? "dropdown" : field.dom_type
		      %>
          <%= construct_ticket_element :helpdesk_ticket, field, field.label, dom_type, field.required, field_value %>
         <% end %>
       <% end %>
       <% javascript_tag do %>  
         jQuery('#helpdesk_ticket_group_id')
           .bind("change", function(e){
             jQuery('#helpdesk_ticket_responder_id')
                     .html("<option value=''>...</option>");
             jQuery.ajax({
               type:        'POST',
               url: 		     '/helpdesk/tickets/get_agents/'+this.value,
               contentType: 'application/text',
               success:     function(data){
                               jQuery('#helpdesk_ticket_responder_id')
                                 .html(data);
                            }
             });
           });
       <% end %>
			<!--form values ends here-->
			<!-- Custom fields ends here-->
			<li class="button-container">
				<%= f.submit t('update'), :class => "uiButton grey small" %>
			</li>		
	   </ul>
	<% end %> 
</div> 

<% content_for :dialogs do -%>
	<%= render :partial => "helpdesk/tickets/components/due_date", :locals => { :ticket => ticket }  %>
<%- end %>
