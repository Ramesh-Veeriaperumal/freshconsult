<%= will_filter_scripts_tag %>
<div class="leftFilter">    
	  <%= link_to("Save this View...", "/helpdesk/tickets/custom_view_save", :title => "Save ticket view", :class => "slim-button floatr dialog2", :dialogWidth => "540px") %>
    <% @show_options.each_with_index do |c_hash, i| %> 
  	  <div class="title"><%= c_hash[:name] %></div> 
  	  <% content_tag :div, { :id          => "div_ff_#{c_hash[:condition]}", 
                             :class       => "ff_item", 
                             :condition   => c_hash[:condition],
                             :operator    => c_hash[:operator] } do %>
          <%= render :partial => "/helpdesk/tickets/containers/#{c_hash[:container]}", :locals => { :options => c_hash[:options] } %>
      <% end %>  
      <span class="seperator"></span>	 
    <% end %>
</div>

<% javascript_tag do %> 
	var query_hash  = $A();

	jQuery(document).ready(function(){	
	
	if ('<%=@ticket_filter.accessible.visibility%>' == '<%=Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:group_agents]%>')
		{
			jQuery('#accessible_group').show();	
			jQuery('#visibility_group_id').removeAttr('disabled');
		}
		else
		{
			jQuery('#visibility_group_id').attr('disabled','disabled');
		}
   

    jQuery(".view_checkbox").bind("change", function(ev){
     query_hash = $A();
     jQuery("div.ff_item").map(function () {
            condition = this.getAttribute("condition");
            operator  = this.getAttribute("operator");
            value     = jQuery(this).find('input:checkbox:checked').map(function () {
                            return this.value;
                          }).get();
                          
            if(value.length){
              query_hash.push({ 
                condition : this.getAttribute("condition"), 
                operator  : this.getAttribute("operator"),
                value     : value.toString()
              })
            };
     });
     
     jQuery.ajax({
        url: "/helpdesk/tickets/custom_search",
        type: "POST",
        data: { data_hash: query_hash.toJSON() },
        success: function(msg){
          jQuery("#ticket-list").html(msg);
        }
      });  
    });	
  });
  
  
	function toggleGroup(access_id)
	{	
		if (access_id == '<%=Admin::UserAccess::VISIBILITY_KEYS_BY_TOKEN[:group_agents]%>')
		{
			jQuery('#accessible_group').show();
			jQuery('#visibility_group_id').removeAttr('disabled');
		}
		else
		{
			jQuery('#accessible_group').hide();	
			jQuery('#visibility_group_id').attr('disabled','disabled');
		}
	}
	
	
  
 
<% end %>


