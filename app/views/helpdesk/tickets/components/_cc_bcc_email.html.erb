<% content_for :onload_script do -%>

jQuery('#add_cc_btn').bind("click", function(ev){
		ev.preventDefault();
		jQuery("#cc_emails_sec").toggle();
		jQuery("#cc_emails").val("");
		jQuery("#cc_emails").trigger("liszt:updated");
	});

jQuery('#add_bcc_btn').bind("click", function(ev){
		ev.preventDefault();
		jQuery("#bcc_emails_sec").toggle();
		jQuery("#bcc_emails").val("");
		jQuery("#bcc_emails").trigger("liszt:updated");
	});

 function lookup(searchString, callback) { 
                    new Ajax.Request('<%= requesters_search_autocomplete_index_path %>?q='+encodeURIComponent(searchString), 
                                                              { method : "GET",
                                                              onSuccess: function(response) {
                                                                var choices = $A();
                                                                response.responseJSON.results.each(function(item){
																  if(item.value == "") {
				                                                    choices.push([item.details, item.details]);
				                                                  } else {
				                                                    choices.push([item.details , item.details ]);
				                                                  } 
                                                                });                                                
                                                                callback(choices);
                                                              } });
                                                            }
            var cachedBackend = new Autocompleter.Cache(lookup, {searchKey: 0, choices: 10});
            var cachedLookup = cachedBackend.lookup.bind(cachedBackend);
<%- end %>

<div class="new_ticket_cc_button">
	&nbsp;<a href="#" class="align-right" id="add_cc_btn"><%= t('helpdesk.cc') %></a>
	<% if show_bcc %>
		<a href="#" class="align-right" id="add_bcc_btn"><%= t('helpdesk.bcc') %></a>
	<% end %>
</div>

<li id="cc_emails_sec" class="hide">
	<div class="caption" for="ticket_cc_list"><%= t('helpdesk.cc') %></div>
	<% if current_user.agent? %>
		<% content_for :onload_script do -%>
	        new Autocompleter.MultiValue("cc_emails", cachedLookup, 
	        							  $A(),{frequency: 0.1, 
	        							  acceptNewValues: true,separatorRegEx:/;|,/});
		<%- end %>
	<% end %>
    <input type="text" id="cc_emails" name="cc_emails" />
</li>
<li id="bcc_emails_sec" class="hide">
	<div class="caption" for="ticket_bcc_list"><%= t('helpdesk.bcc') %></div>
	<% if current_user.agent? %>
		<% content_for :onload_script do -%>
	        new Autocompleter.MultiValue("bcc_emails", cachedLookup, 
	        							  $A(),{frequency: 0.1, 
	        							  acceptNewValues: true,separatorRegEx:/;|,/});
		<%- end %>
	<% end %>
    <input type="text" id="bcc_emails" name="bcc_emails" />
</li>