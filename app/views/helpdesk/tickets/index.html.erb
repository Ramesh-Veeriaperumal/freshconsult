<% content_for :onload_script do %>
  $J('#rightCol').css("minHeight", $J('#leftcol').height());
  $J("#helpdesk-select-all").bind('toggleState click', function(ev){
    $J("#tickets-expanded input[type=checkbox]").prop("checked", $J(this).prop("checked"));
    $J("#tickets-expanded input[type=checkbox]").trigger('change');
  });

  $J(document).on("change.ticketListEvents", "#select_view_id", function(ev){
    window.location = this.value;
  });

  $J(document).on("click.ticketListEvents", "#assign-options-link", function(ev){
    jQuery("#assign-options").show();
    jQuery(this).hide();
  });

   $J(document).on('pjax:beforeSend.ticketListEvents', function () {
      jQuery(document).off('.ticketListEvents');
    });

  var rep_type_param = <%= params[:report_type].present?.to_s %> ? '?report_type=<%=params[:report_type]%>&tickets_in_current_page=<%= @items.size %>' : '?tickets_in_current_page=<%= @items.size %>';

  var paginate_url = '/helpdesk/tickets/full_paginate';
  paginate_url = paginate_url + rep_type_param
  jQuery.getScript(paginate_url);
<% end %>
<% content_for :onload_script do %>
  var rep_type_param = <%= params[:report_type].present?.to_s %> ? '?report_type=<%=params[:report_type]%>' : '';
  var parallel_url = "/helpdesk/tickets/filter_options"
  parallel_url = parallel_url + rep_type_param
  Fjax.pjax_parallel_request = {parallelUrl: parallel_url, parallelPlaceholder: "#ticket-leftFilter", pjax: "#body-container"};
<% end %>

<% content_for :pagefixed do %>
  <% if @is_auto_refresh_feature %>
    <%= render :partial => "freshdesk_socket_autorefresh" %>
  <% end %>
<% end %>

<% content_for :layoutType do -%>ticket_list<%- end %>
  <div id="leftcol" class="ticket-leftcol" style="display:<%=(['deleted', 'spam', 'monitored_by'].include?(@current_view)) || collab_filter_enabled_for?(@current_view) ? 'none' : 'block' %>">
    <%if @show_options.blank? %>
      <div id="ticket-leftFilter" class="leftFilter">
      </div>
    <%else%>
      <div id="ticket-leftFilter" rel="remote" class="leftFilter">
        <%= render :partial => "helpdesk/shared/filter_options", :locals => { :current_filter => @ticket_filter, :requester_id =>  params[:requester_id] , :shared_ownership_enabled => Account.current.shared_ownership_enabled?} %>
      </div>
    <%end%>
  </div>
  <div id="rightCol" class="contentCol <%="hasRightCol" unless (['deleted', 'spam', 'monitored_by'].include?(@current_view)) || collab_filter_enabled_for?(@current_view) %>">
    <%= render :partial => "helpdesk/shared/ticket_view", :locals => { :items => @items, :current_view => @current_view } , :inline => true %>
  </div>

<script type="text/javascript">
  Fjax.current_page = "ticket_list";
</script>

<%= javascript_tag do %>
    var failedTicketData = <%= @failed_tickets_data.to_json.html_safe %>;
<% end %>
