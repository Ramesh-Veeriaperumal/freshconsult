<% content_for :pagefixed do %>
  <%= javascript_include_tag "helpdesk/core" %>
  <%= javascript_include_tag "helpdesk/page_switcher" %>
  <%= javascript_include_tag "helpdesk/take_it_button" %>
  <%= javascript_include_tag "helpdesk/id_selector" %>
  <% javascript_tag do %>
    document.observe("dom:loaded", function(){      
	  Helpdesk.sel = new Helpdesk.MultiSelector({
	      form: 'expanded',
	      cookieName: 'helpdesk-tickets-page'
	  });		  
   	
		new Helpdesk.PageSwitcher({
       toggleMode: true,
       pages: ['assign-options']
    });

    Helpdesk.monitorTakeItButtons();
	  	
    Helpdesk.submitOnChange('sort');
	  
	  Helpdesk.sel.toggleCheckAll = function(source){
	  	if(source.checked)
				Helpdesk.sel.checkAll();
			else
				Helpdesk.sel.uncheckAll();
	  };
		 	
	  jQuery(".ticket-description-tip").qtip({
			 position: { 
			      my: 'bottom left',
			      at: 'top  left', 
			      viewport: jQuery(window) 
			 }, 
			 style : {
			 	classes: 'ui-tooltip-ticket ui-tooltip-rounded ui-tooltip-shadow'
			 },
			 show: {
			    solo: true,
			    delay: 200,
			    effect: function(offset) {
			        jQuery(this).show("fade", 240); // "this" refers to the tooltip
			    }
			 }
	  });
	  
	  jQuery("#agent-assign-link").click(function(){
	  	jQuery("#assign-options")
	 		.dialog({ modal : true, 
	 			  show : 'puff', 
	 			  title:  '<%= t('ticket.assign_to_agent') %>',
	 			  closeOnEscape: true,
	 			  buttons: [{
        				text: "Assign",
        				click: function() { 
        					 Helpdesk.sel.submit("<%= assign_helpdesk_ticket_path('multiple') %>", "put", ['responder_id']);
        				}
    				}] 
	 			});
	  });	
	  
	  changeSortOrder = function(){		
	  	if ('<%=current_sort_order%>' != 'DESC')
				jQuery('#sort_order_id').val('DESC');
			else
		   	jQuery('#sort_order_id').val('ASC');	  
		  
			jQuery('#sort_form').submit();
		}
	});
  <% end %>
<% end %>

<div class="containerFull clearfix">
  <div id="leftcol">
    <div class="geryImageHeader">
      <h3>
        Filters
      </h3>
    </div>
    <%= render :partial => "helpdesk/tickets/components/custom_filter", :locals => {:items => @items, :wf_filter => @items.wf_filter}%>
  </div>
  <div class="contentCol clearfix hasRightCol">
    <div class="geryImageHeader"> 
      <form class="sort" id="sort_form" action="#" >
        <a href="javascript:void(0);changeSortOrder();" class="sort_order">
          <%= content_tag (:span, "", :class => "image #{current_sort_order} custom-tip-bottom", :title => "Click to change sort order", :id => "sort_order_img" ) %>
        </a>
        <input type="hidden" name="sort_order" id="sort_order_id" value="<%= current_sort_order %>" />
        <span class="label"><%= t('ticket.sort_by') %></span>
        <%= select_tag :sort, options_for_select(TicketsFilter::SORT_FIELD_OPTIONS, (current_sort).to_sym), { :class => "customSelect" } %>
      </form>
      <%= render :partial => "filters" %>
    </div>
    <div id="ticket-list">
  	  <%= render :partial => "helpdesk/tickets/components/custom_results", :locals => {:items => @items} %> 
  	</div>
  </div>
</div>