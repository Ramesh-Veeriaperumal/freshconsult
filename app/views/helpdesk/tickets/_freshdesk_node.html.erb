<% if (!(ticket.nil?) && current_account.features?(:collision) && current_account.agents_from_cache.count > 1 ) %>
    <!-- **** Agent Collision flip animation start **** -->
  <div class="ticket-notifications" id="agent_collision_show">
    <div class="view-flip" rel="notice-popover"  id="agents_viewing" data-object="viewing" data-placement="right" title="Currently viewing">
      <a href="#">
        <div class="flip-front"></div>
        <div class="flip-back">0</div>
      </a>
    </div>

    <div class="reply-flip" rel="notice-popover" id="agents_replying" data-object="replying" data-placement="right" title="Currently replying">
      <a href="#">
        <div class="flip-front"></div>
        <div class="flip-back">0</div>
      </a>
    </div>
  </div>

  <% content_for :pagefixed do %>

  <% end %>
<% end %>

<script type="text/javascript">
  jQuery(document).ready(function() {
    var data = {
      current_user_id : "<%= current_user.id %>",
      faye_host : "<%= agentcollision_host %>",
      client_opts : {
        retry: 10,
        timeout: 120
      },
      faye_server : "<%= agentcollision_server %>",
      faye_auth_params : <%= faye_auth_params %>,
      current_user : "<%= escape_javascript(current_user.name) %>", 
      agent_names : <%= raw current_account.agent_names_from_cache.to_json %>
    };
    channels = {};
    <%  if (ticket.nil?) %> 
      <% if @is_auto_refresh_feature %>
        data["faye_host"] = "<%= autorefresh_host %>"
        data["faye_server"] = "<%= autorefresh_server %>"
        data['auto_refresh'] = { 
          ticketFilterDateoptions :{
            'today' : Date.parse("<%= Time.now.midnight %>"),
            'week' : Date.parse("<%= Time.now.monday %>"),
            'month' : Date.parse("<%= Time.now.beginning_of_month %>"),
            'two_months' : Date.parse("<%= Time.now.beginning_of_month - 2.months %>"),
            'six_months' : Date.parse("<%= Time.now.beginning_of_month - 6.months %>") 
          },
          ticketUpdateTitle : "<%= t('ticket.ticket_updated_icon') %>"
        };
        channels[ "<%= auto_refresh_channel %>"] = window.AutoRefreshIndex.callback 
      <% end %>
    <% else %>
      data['agent_collision_show'] = {
        ticket_path : "<%= helpdesk_ticket_path(ticket.display_id) %>",
        ticket_id : "<%= ticket.display_id %>",
        ticket_reply_channel : "<%= agent_collision_ticket_reply_channel(ticket.display_id) %>",
        ticket_channel : "<%= agent_collision_ticket_channel(ticket.display_id) %>"
      }
      channels["<%= agent_collision_ticket_channel(ticket.display_id) %>"] = window.AgentCollisionShow.ticketChannelCallback;
      channels["<%= agent_collision_ticket_view_channel(ticket.display_id) %>"] = window.AgentCollisionShow.viewChannelCallback;
    <% end %>
    window.channels = channels;
    window.FreshdeskNode.data(data).addChannels(channels).init();
  });
</script>