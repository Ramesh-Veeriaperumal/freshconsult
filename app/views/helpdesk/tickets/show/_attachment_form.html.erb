<% 
	attach_id ||= "ticket" 
	nsc_param = nsc_param || "helpdesk_ticket"
%>
<div class="attachments-wrap">
  <div id="<%=attach_id%>-container" class="attachments-container">
    <label><i>0</i> Attachment(s): </label>
    <div class="attachment_contents">

      <div class="attachment_list" id="<%=attach_id%>-attachments"></div>

      <div class="hidden_upload custom_tip_bottom" title='<%=t('attachment_help_info')%>' class='custom-tip-top'>
        <div class="add_attachment"><span>+</span> Add </div>
        <input type="file" id="<%=attach_id%>_file" name="emptyfile"
                nameWhenFilled="<%=nsc_param%>[attachments][][resource]" 
                fileContainer="<%=attach_id%>-container" 
                fileList="<%=attach_id%>-attachments" 
                sendFocusTo="<%=attach_id%>-body"/>
      </div>
      <% unless dropbox_app_key.blank?  %>
      <div class="dropbox_div">       
        <div class="db-chooser" id="dropboxjs" data-app-key="<%=dropbox_app_key%>">
          <label><%= t('dropbox_attach_label') %></label>
            <input type="hidden"  id="<%=attach_id%>_url" name="dropboxURL" nameWhenFilled="[dropbox_url][]" fileContainer="<%=attach_id%>-container" fileList="<%=attach_id%>-attachments" sendFocusTo="<%=attach_id%>-body">
            <input type="button" class="dropbox_button" name="selected-file" id="db-chooser" data-holder="<%=attach_id%>_url" onclick='initDropbox(this);' value="<%=t('dropbox_choose_file')%>">
            <script type="text/javascript">
                      function initDropbox(inp){
                        Dropbox.choose({success:function(files){

                            //console.log(jQuery(inp).data('holder')+':::: ');
                            var inputElement = jQuery(inp).data('holder');

                            jQuery('#'+inputElement).val(unescape(files[0].link))

                            Helpdesk.Multifile.addFileToList(jQuery('#'+inputElement));
                            newInput = Helpdesk.Multifile.duplicateInput(jQuery('#'+inputElement));
                            jQuery(inp).data('holder',newInput.attr('id'));
                        }})
                      }
            </script>
        </div>
      </div>
      <%end%>
    </div>
  </div>
</div>

<%# 
  The following is a template used by multifile.js to create rows in
  the attachments table.
 %>
<script id="file-list-template" type="text/x-jquery-tmpl">
<div class="item">
  <a class="attachment-close"  href="javascript:void(0)" onclick="Helpdesk.Multifile.remove(this); return false;" inputId="${inputId}"></a>
  <div class="attachment-type file-types-def">
    <a href="javascript:void(0)">${name}</a>
  </div>
</div>
</script>
<% unless dropbox_app_key.blank? %>
  <script type="text/javascript" src="https://www.dropbox.com/static/api/1/dropbox.js"></script>
<% end %>