<%= javascript_tag do %>
jQuery(document).ready(function(){
	var localStore = localStorage["local_ca_response"]
	if(localStore == undefined){
		localStore = "";
	}
	var s = jQuery("#canned_response_show").prop("href")
	jQuery("#canned_response_show").prop("href", s+localStore)
});
<% end %>

<div class="redactor conversation_thread">
	<div class="conversation">
		<div class="avatar-wrap"><%= user_avatar(current_user) %></div>
		<div class="commentbox commentbox-dark">
			<div id="TicketForms">
				<div class="hide">
		      <%= link_to( t(:'ticket.canned_responses.ca_response'), 
		      							"/helpdesk/canned_responses/index/#{@ticket.display_id}?recent_ids=", 
		      							"data-width" => "700", "data-template-footer" => '', :rel => 'freshdialog', 
		      							:id => "canned_response_show", "data-target" => "#canned_responses",
		      							:title => t(:'ticket.canned_responses.ca_responses')) %>
					<%= link_to( t('solution.title_singular'), 
												"/search/related_solutions/ticket/#{@ticket.id}", 
												:title => t(:'ticket.suggested_solutions.title'), :rel => 'freshdialog',
												"data-target" => "#related_solutions", "data-template-footer" => '', 
												:id => "suggested_solutions_show") %>
				</div>
        <% if privilege?(:reply_ticket) %>
       		<%= render(	:partial => '/helpdesk/tickets/show/reply_form', 
			  				:locals => { 	:id => 'send-email', 
			  								:cntid => 'cnt-reply', 
		  									:note => [@ticket, Helpdesk::Note.new(:private => false)], 
		  									:conv_id => nil 
		  								}) if !(@ticket.is_twitter? or @ticket.is_facebook? or @ticket.mobihelp? or @ticket.ecommerce?) and @item.from_email.present? %>
  				<%= render(	:partial => '/helpdesk/tickets/show/tweet_form', 
  							:locals => { 
  										:id => 'send-tweet', 
  										:cntid => 'cnt-reply', 
  										:note => [@ticket, Helpdesk::Note.new(:private => true)] 
  									})  if @ticket.is_twitter? %>
  				<%= render(	:partial => '/helpdesk/tickets/show/facebook_form', 
  							:locals => { 
  										:id => 'send-fb-post', 
  										:cntid => 'cnt-reply', 
  										:note => [@ticket, Helpdesk::Note.new(:private => true)] 
  									}) if @ticket.is_facebook? %>
  				<%= render(	:partial => '/helpdesk/tickets/show/mobihelp_reply_form', 
  							:locals => { 
  										:id => 'send-mobihelp-chat', 
  										:cntid => 'cnt-reply', 
  										:note => [@ticket, Helpdesk::Note.new(:private => true)] 
  									}) if @ticket.mobihelp?%>				
  				<%= render(	:partial => '/helpdesk/tickets/show/ecommerce_reply_form', 
  							:locals => { 
  										:id => 'send-ecommerce-post', 
  										:cntid => 'cnt-reply', 
  										:note => [@ticket, Helpdesk::Note.new(:private => true)] 
  									}) if @ticket.ecommerce? %>						
        <% end %>

			  <% if privilege?(:forward_ticket) %>
  				<div class="request_panel hide" id="cnt-fwd">
  				<%= render(:partial => '/helpdesk/tickets/show/forward_form', 
  							:locals => { 
  										:id => 'send-fwd-email', 
  										:cntid => 'cnt-fwd', 
  										:note => [@ticket, Helpdesk::Note.new(:private => true)], 
  										:conv_id => nil 
  									}) %>
  				</div>
        <% end %>

				<%= render(:partial => '/helpdesk/tickets/show/note_form', 
							:locals => { 
										:id => 'add-note',	
										:cntid => "cnt-note", 
										:note => [@ticket, Helpdesk::Note.new(:private => true)] 
									}) %>
			</div> 
			<div id="TicketPseudoReply" class="pseudo_reply">
				<% if privilege?(:reply_ticket) && @ticket.show_reply? %>
				<a href="" id="FwdButton" rel="note-button" data-note-type="reply" data-replyto-handle="<%= @ticket.is_twitter? ? default_twitter_body_val(@ticket) : "" %>" ><%= t('ticket.reply_to')  %></a> / 
				<% end %>
        <% if privilege?(:forward_ticket) %>
				  <a href="" id="FwdButton" rel="note-button" data-note-type="fwd" ><%= t('fwd_to') %></a> /
        <% end %>
				<a href="#"  rel="note-button" data-note-type="note" ><%= t('ticket.add_note') %></a>
        <% if @ticket.mobihelp? %>
        	/ <%= link_to 'Request App review', "#", :id => "ReviewButton", :rel => "review-button" %>
					<%= render(:partial => '/helpdesk/tickets/show/app_review_form', 
						:locals => { 
								:id => 'review-request',	
								:cntid => "cnt-review-note", 
								:note => [@ticket, Helpdesk::Note.new(:private => true)] 
							}) %>
				<% end %>
			</div>
		</div>

	</div>
</div>