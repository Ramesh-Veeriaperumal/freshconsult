<% 
	default_field_order = [
			"default_priority", "default_status", 
			"default_source", "default_ticket_type", 
			"default_group", 
			"default_agent", 
			"default_product"
	]

	default_fields = []
	custom_fields = []
%>
<% current_portal.ticket_fields.each do |field| 
	
	if field.visible_in_view_form?
		if field.is_default_field?
			field_value = @ticket.send(field.field_name)
			field_label = t("ticket_fields.fields.#{field.name}")
		else
			field_value = @ticket.custom_field_value(field.name)
			field_label = (field.label).html_safe
		end
		dom_type    = default_hidden_fields.include?(field.field_type) ? "dropdown" : field.dom_type
		if(field.field_type == "nested_field")
			field_value = {}
			field.nested_levels.each do |ff|
				field_value[(ff[:level] == 2) ? :subcategory_val : :item_val] = @ticket.custom_field_value(ff[:name])
			end
			field_value.merge!({:category_val => @ticket.custom_field_value(field.name)})
		end
		field_html = construct_ticket_element(form_builder, :helpdesk_ticket, field, field_label, dom_type, field.required, field_value, '', false, false)
		if field.is_default_field?
			default_fields << [ field.field_type , field_html ]
		else
			custom_fields << field_html
		end

	end
end 
default_fields.sort! {|x,y| default_field_order.index(x.first) <=> default_field_order.index(y.first) }
%>
<% default_fields.each do |field| %>
	<%= field.last %>
<% end %>
<% custom_fields.each do |field| %>
	<%= field %>
<% end %>

<%= render :partial => '/helpdesk/tickets/show/tags' %>

<%= javascript_tag do %> 
  jQuery('#custom_ticket_form').find('select, input, textarea').attr('disabled', 'disabled');
<% end %>
