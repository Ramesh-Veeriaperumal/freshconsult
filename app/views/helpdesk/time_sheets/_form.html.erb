<%if params[:from_header] %>
	<div class="alert"><%= @ticket.subject %> (#<%=@ticket.display_id%>) </div>
<% end%>
<dl>
	<% unless params[:from_header] %>
		<dt><%= form.label :user_id, t('.agent') %>: </dt>
		<dd>
			<%= form.collection_select( :user_id, agent_list, :id, :name, {:selected => form.object.nil? ? current_user.id : form.object.user_id}, {:class => "select2"}) %>
		</dd>
	<% end %>

	<dt><%= form.label :hhmm, t('.hours')%>: </dt>
	<dd class="hours">
		<%= form.text_field(:hhmm, { 
					:size => 6,
					:class => "auto hhmm_time_duration", 
					:autocomplete => "off", 
					:placeholder => "HH:MM" }) %>

		<label class="billing_hours floatr">
			<%= form.check_box(:billable, {:checked => (type == :new) ? true : form.object.billable}) %>
			<%= t('.billing_hours')%>
		</label>
		<% unless params[:from_header] %>
			<div class="tip"><%= t('.hours_format_tip') %> </div>
		<% end %>
	</dd>

	<dt><%= form.label :executed_at, 'On'%>: </dt> 
	<dd> <% datepicker_id = type == :new ? "executed_at_new" : "executed_at_#{dom_id(edit)}" %>
		<%= form.text_field :executed_at, 
						:value => (type == :new ? Time.zone.now.strftime("%m/%d/%Y") : edit.executed_at.strftime("%m/%d/%Y")), 
						:size => 10, :class => "auto executed_at datepicker", :id => datepicker_id %>
	</dd>
	<dt><%= form.label :note, t('.note')%>: </dt>
	<dd>
		<%= form.text_area(:note, { :rows => 2, :class => "paragraph auto-height" })%>
	</dd>
</dl>
<% if type == :new %>
<script type="text/javascript">
	jQuery('#new_timeentry [data-submit=modal]')
		.attr('data-start-text', '<%= t(".start_timer") %>')
		.button('start');

	jQuery('#time_entry_hhmm').keyup(function(ev) {
		var btn_state = (trim(jQuery(this).val()) == '') ? 'start' : 'reset';
		jQuery('#new_timeentry [data-submit=modal]').button(btn_state);
	});
</script>
<% end %>

<% if type == :edit %>
<script type="text/javascript">
	jQuery('#edit_timeentry_<%= @time_entry.id %>.modal').on('shown', function() {
		var time = jQuery("#timeentry_timer_<%= @time_entry.id %>").text();
		fill_hours(time, <%= @time_entry.timer_running %>);
	});

	<% if @time_entry.timer_running %>
		jQuery('#edit_timeentry_<%= @time_entry.id %>.modal').on('hidden', function () {
			jQuery('.header-timer').removeClass('stop-timer');
		})
	<% end -%>
</script>
<% end %>