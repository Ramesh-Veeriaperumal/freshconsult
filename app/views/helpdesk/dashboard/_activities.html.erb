<h3 class="title"><%=t('recent_activity')%></h3>
<div id="recent_activities_count" class='more-tweets'></div>
<div id="recent_activities" class='hide'></div>
<ul id="Pages" class="activityfeed">		
	<% @items.each_with_index do |item, i| %>
		<%= render(:partial => "ticket_note", :object => item) %> 
	<% end %>
</ul>
<%= will_paginate @items %>
<%= pageless(@items.total_pages, helpdesk_dashboard_path, t("loading.activities"), { :activity_id => @items.first.id}) unless @items.empty?%>
<%= pageless(@items.total_pages, helpdesk_dashboard_path, t("loading.activities")) if @items.empty? %>

<% javascript_tag do %>
  activity_count = 0;
  previous_id = jQuery('#Pages li').first().prop('id');
    if(previous_id == undefined) previous_id = 0;
  jQuery("#Pages div.activity_time").humaneDates(); 
  latest_activities_timer = new PeriodicalExecuter(function(pe) {
    jQuery.get(
      "/helpdesk/dashboard/latest_activities",
      "previous_id="+previous_id,
      function(data) {
          jQuery('#recent_activities').prepend(data);
          if(jQuery('#recent_activities li.activity').length > 0)
          {   
            activity_count = jQuery('#recent_activities li.activity').length;
            jQuery('#recent_activities_count')
              .html(plural(activity_count, "<%= t('recent_activity') %>", "<%= t('recent_activities') %>"));
            previous_id = jQuery('#recent_activities li.activity').first().attr('id');
          if(previous_id == undefined) previous_id = 0;
            jQuery('#recent_activities_count').slideDown();
          }                                                      
          jQuery("div.activity_time").humaneDates();
    });
  }, 30);

  jQuery('#recent_activities').livequery(function(){}, function(){
    latest_activities_timer.stop();
  });
  
  jQuery('#recent_activities_count').click(function() {
    var new_activites = jQuery("<div />").addClass("borderbottom").hide().prepend(jQuery("#recent_activities").html());   
    jQuery('#Pages').prepend(new_activites);
    new_activites.slideDown();
    jQuery("#recent_activities").empty();     
    jQuery(this).hide();  
  });
<%end%>

