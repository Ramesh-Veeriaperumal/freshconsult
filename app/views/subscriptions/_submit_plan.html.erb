<%= form_for :account, :url => "/subscription/plan", 
                      :html => {  :method => "post",
                                  :id => "plan-change-confirm-#{plan.id}" } do |f| %>
  
  <% if downgrade_message_flag %>
    <%= render :partial => "downgrade_feature_loss", 
                                :locals => { 
                                  :downgrade_msg => downgrade_msg,
                                  :current_plan_name => current_account.subscription.subscription_plan.display_name.upcase,
                                  :current_plan =>current_account.subscription.subscription_plan.name.downcase, 
                                  :new_plan => plan.name.downcase,
                                  :show_omni_warning => show_omni_warning
                                } 
                          %>
  <% end %>

  <%
    hidden_billing_cycle_value = current_account.new_2019_pricing_enabled? ? SubscriptionPlan::BILLING_CYCLE_KEYS_BY_TOKEN[:annual] : 1
  %>
  <input type="hidden" name="billing_cycle" value="<%= hidden_billing_cycle_value %>" />
  <input type="hidden" name="agent_limit" value="<%= agent_limit %>" />
  <input type="hidden" name="plan_id" value="<%= plan.id %>" />
  <input type="hidden" name="currency" value="<%= currency %>" />
  <% if plan_switch %>
  	<input type="hidden" name="plan_switch" value="1" />
  <% end %>
  <% if submit_flag %>
  	<input type="submit" value="<%= t('choose_plan') %>" class="btn btn-flat upgrade-plan" data-loading-text="<%= t('selecting_plan') %>" />
  <% end %>
<% end %>

<%= javascript_tag do %>
  jQuery('.upgrade-plan').on("click", function(){
    jQuery(this).button("loading");
    jQuery('.activate-options').hide();
  })
<% end %>