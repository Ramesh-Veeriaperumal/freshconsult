<% trial_days = current_account.subscription.trial_days %>
<div class="well well-trial well-<%= trial_days > 10 ? 'info' : 'danger' %>">
  <h1 class="lead">
    <%= t('current_plan').html_safe %> :
    <strong>
      <% if current_account.new_pricing_launched? %>
        <%= " #{ @subscription.subscription_plan.display_name }" %>
        <%if previous_plan?(@subscription.subscription_plan)%>
          <%= content_tag(:span, "2016", :class => "label") %>
        <%elsif @subscription.classic?%>
          <%= content_tag(:span, t('classic_label'), :class => "label") %>
        <%end%>
      <%elsif previous_plan?(@subscription.subscription_plan) and !current_account.new_pricing_launched?%>
          <%= " #{ @subscription.subscription_plan.name }" %>
      <%elsif @subscription.classic?%>
        <%= " #{ @subscription.subscription_plan.name.split(" Classic").first }" %>
        <%= content_tag(:span, t('classic_label'), :class => "label") %>
      <% else %>
        <%= " #{ @subscription.subscription_plan.display_name }" %>
      <% end %>
    </strong>
  </h1>
  <span class="label label-<%= trial_days > 10 ? 'success' : 'important' %> label-lead">
    <%= trial_expiry_title(trial_days) %>
  </span>
  <%# if trial_days < 4 %>
    <!--<div>-->
      <!--<%#= render :partial => "/subscriptions/request_trial_extension" %>-->
    <!--</div>-->
  <%# end %>
  <p>
    <% if current_account.new_pricing_launched?%>
      <%= t('choose_plan_trial_v2').html_safe %>
    <% else %>
      <%= t('choose_plan_trial').html_safe %>
    <% end %>
  </p>
</div>

<div class="plan-section-title">
  <div class="pull-right">
    <span class="lead">
      <%= t("currency_label") %>
    </span>
    <%= select_tag :currency, fetch_currencies, :id => "switch-currency", :class => "select2" %>
  </div>
  <%= content_tag(:h3, t('choose_plan'), :class => "lead mb0") %>
  <%= content_tag(:h5, t('downgrade_plan_v2'), :class => "lead-note") %>
</div>
<%= render :partial => current_account.new_pricing_launched? ? "select_new_plans" : "select_plans", :locals => { :plans => plans, :subscription => @subscription, :show_all => true } %>

<script type="text/javascript">
  function render_currency_partial(currency){
    calculate_request = jQuery.post( "/subscription/calculate_plan_amount", { "currency": currency },
      function(data){
        jQuery("#ChangePlan").removeClass("sloading");
        jQuery("#ChangePlan").html(data);
      } );
  }

  jQuery('#switch-currency').on('change', function(){
    jQuery("#ChangePlan").empty();
    jQuery("#ChangePlan").addClass("sloading");
    var currency = this.value;
    render_currency_partial(currency);
  });
</script>
