<% trial_days = current_account.subscription.trial_days %>
<div class="well well-trial well-<%= trial_days > 10 ? 'info' : 'danger' %>">
  <h1 class="lead">
    <%= t('current_plan').html_safe %> :
    <strong>
        <%= " #{ @subscription.subscription_plan.display_name }" %>
        <%if previous_plan?(@subscription.subscription_plan)%>
          <%= content_tag(:span, "2016", :class => "label") %>
        <%elsif @subscription.classic? %>
          <%= content_tag(:span, t('classic_label'), :class => "label") %>
        <%end%>
    </strong>
  </h1>
  <span class="label label-<%= trial_days > 10 ? 'success' : 'important' %> label-lead">
    <%= trial_expiry_title(trial_days) %>
  </span>
  <%# if trial_days < 4 %>
    <!--<div>-->
      <!--<%#= render :partial => "/subscriptions/request_trial_extension" %>-->
    <!--</div>-->
  <%# end %>
  <p>
      <%= t('choose_plan_trial_v2').html_safe %>
  </p>
</div>


  <%
    plan = @subscription.subscription_plan
    is_new_sprout = new_sprout?(plan.name)
  %>

<% if current_account.new_2019_pricing_enabled? %>
  <div class="clearfix choose-plan-container">
    <%= content_tag(:h3, t('choose_plan'), :class => "lead mb0 pull-left") %>
    <div class="pull-right">
      <span class="lead">
        <%= t("currency_label") %>
      </span>
      <%= select_tag :currency, fetch_currencies, :id => "switch-currency", :class => "select2" %>
    </div>
  </div>  
  <img alt="omni channel experience" class="omni-channel-icon" src="/assets/omni-channel.svg" width="52">
  <div class="choose-plan-title">
    <h4 href="#"> 
      <%= t('omni_channel') %>
      <input rel="toggle" type="checkbox" id="omni-toggle" name="omni-toggle" data-checked-label="<%= t('plain_yes') %>" data-unchecked-label="<%= t('plain_no') %>" />
    </h4>
  </div>
  <%= content_tag(:h5, t('omni_channel_content'), :class => "lead-note pb15") %>
<% else %>
  <div class="plan-section-title">
    <div class="pull-right">
      <span class="lead">
        <%= t("currency_label") %>
      </span>
      <%= select_tag :currency, fetch_currencies, :id => "switch-currency", :class => "select2" %>
    </div>
    <%= content_tag(:h3, t('choose_plan'), :class => "lead mb0") %>
    <%= content_tag(:h5, t('downgrade_plan_v2'), :class => "lead-note") %>
  </div>
<% end %>
<%= render :partial => "select_new_plans", :locals => { :plans => plans, :subscription => @subscription, :show_all => true } %>

<script type="text/javascript">
jQuery(document).ready(function() {

    var toHide = ['plan-garden_jan_19', 'plan-estate_jan_19']


    jQuery(document).on('click', ".choose-plan-title .toggle-button", function(i){
      if(jQuery(i.target).closest(".toggle-button").hasClass("active")) {
        jQuery(".plan-feature-list").addClass("showing-omni-features");
        //jQuery("#ChangePlan").animate({'left': '-100%'}, 200).css("opacity", 0).animate({'left': '100%'}, 1);
        toHide.each(function(item){
          jQuery("#"+item).addClass("hide");
        });

        jQuery(".pricelist").each(function(){
          if(jQuery(this).attr("id").indexOf("omni") > 0) {
            jQuery(this).removeClass("hide");
          }
        });
        //jQuery("#ChangePlan").css("opacity", 1).animate({'left': '0'}, 220);
        jQuery(".omni-features").delay(300).removeClass("hide");
        window.scrollTo(0,290);
      } else {
        jQuery(".plan-feature-list").removeClass("showing-omni-features");
        //jQuery("#ChangePlan").animate({'left': '100%'}, 200).css("opacity", 0).animate({'left': '-100%'}, 1);
        toHide.each(function(item){
          jQuery("#"+item).removeClass("hide");
        });

        jQuery(".pricelist").each(function(){
          if(jQuery(this).attr("id").indexOf("omni") > 0) {
            jQuery(this).addClass("hide");
          }
        });
        jQuery(".omni-features").addClass("hide");
        //jQuery("#ChangePlan").css("opacity", 1).animate({'left': '0'}, 220);
      }
    });

});
</script>
<script type="text/javascript">
  function render_currency_partial(currency){
    calculate_request = jQuery.post( "/subscription/calculate_plan_amount", { "currency": currency },
      function(data){
        jQuery("#ChangePlan").removeClass("sloading");
        jQuery("#ChangePlan").html(data);
        if(jQuery(".choose-plan-title .toggle-button").hasClass("active")) {
          jQuery(".choose-plan-title .toggle-button").removeClass("active");
        }
      } );
  }

  jQuery('#switch-currency').on('change', function(){
    jQuery("#ChangePlan").empty();
    jQuery("#ChangePlan").addClass("sloading");
    var currency = this.value;
    render_currency_partial(currency);
  });
</script>


<% if plan.omni_plan? || plan.free_omni_channel_plan? %>
  <script type="text/javascript">
    jQuery(document).ready(function() {
      jQuery(".choose-plan-title .toggle-button").trigger("click");
    });
  </script>
<% end %>