<div id="ticket-list">
	<% if @tickets.first %>
		<div class="c-list">
			<% @tickets.each do |ticket| %>
				<div class="c-row c-ticket-row">
					<span class="status-source sources-detailed-<%= TicketConstants.source_token(ticket.source).to_s %>" 
							 title="<%= t("ticket.reported_from_source", :source => ticket.source_name.to_s.downcase) %>"> </span>
					<span class="<%= ticket.active? ? "label-status-pending" : "label-status-closed" %> label label-small">
						<%= ticket.translated_status_name %>
					</span>
					<div class="ticket-brief">
					    <div class="ellipsis">
                                              <% # TODO-RAILS3:: calling liquid truncate rather Actionview Helper %>
					      	<%= link_to(ticket.subject + " ##{ticket.display_id}", support_ticket_path(ticket), :title => ticket.chat? ? "" : truncate(ticket.description, 350 ), :class => "c-link") %> 
					    </div>
					    <div class="help-text">
							<% unless ticket.requester.nil? or current_user.eql?(ticket.requester) %>
								<%= t('ticket.portal_created_on', {:username => h(ticket.requester.display_name), :date => formated_date(ticket.created_at)}).html_safe %>
							<% else %>
								<%= t('ticket.portal_created_on_same_user', {:date => formated_date(ticket.created_at)}).html_safe %>
							<% end %>

							<% unless ticket.freshness == :new %>
						       <%=t('ticket.assigned_agent')%>: <span class='emphasize'><%=h(ticket.responder.display_name)%></span>
						    <% end %>
						</div>
					</div>
				</div>
			<% end %>
		</div>

		<%= will_paginate @tickets, :params => { :controller => "support/tickets", :action => "index" }, :renderer =>  BootstrapPaginationRenderer %>

	<% else %>

		<%= content_tag :div, t("helpdesk.tickets.views.no_tickets"), :class => "lead"  %>

	<% end %>

	<script type='text/javascript'>
		jQuery("#ticket-export-button").remove();
	  var exportLink = '<a href="<%= configure_export_support_tickets_path %>" data-target="#export-modal" id="ticket-export-button" rel="freshdialog" data-submit-label="<%= t("portal.tickets.submit_export") %>" title="<%= t("portal.tickets.export_ticket_data") %>" data-close-label="<%=t('close')%>"><%= t("portal.tickets.export_ticket_data") %></a>'
	  jQuery(".ticket-toolbar").append(exportLink);

		jQuery("#ticket-export-button").toggle(<%= @tickets.first.present? %>)
	</script>
</div>