<div class="dropdown">  
	<a href="#" class="list-lead dropdown-toggle" data-toggle="dropdown">
	<%= @page_title %> <b class="caret"></b>
	</a>
	<% 	filter_list =
		[[t('helpdesk.tickets.views.all_tickets'), "/support/tickets", (current_filter == 'all' or current_filter.blank?)],
		 [t('open_tickets'), "/support/tickets/filter/open_or_pending", (current_filter == 'open_or_pending')],
		 [t('resolved_tickets'), "/support/tickets/filter/resolved_or_closed", (current_filter == 'resolved_or_closed')],
		 [:divider]
		]
 
		filter_list.concat( current_user.customer.users.map{ |x| [x.name, "/support/company_tickets/requester/#{x.id}"] } )

		concat dropdown_menu(filter_list)
	%>
</div>

<div id="ticket-sub-toolbar">
  <div class="dropdown">
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">         
       <% current_sort_name = "" %>
       <% sort_fields = []
            vfs = visible_fields
            TicketsFilter.sort_fields_options.each { |field| sort_fields.push(field) if vfs.include?(field[1].to_s) }
       %>
       <% sort_fields.each do |sort_item| %>       
         <% content_tag :li, :class => (( sort_item[1] == current_wf_order ) ? "active" : "" ) do %>
           <% link_to "#", :class => "wf_order", :wf_order => sort_item[1] do %>                      
             <% if( sort_item[1] == current_wf_order ) %>
                <% current_sort_name = sort_item[0] %>
             <% end %>            
                <%= sort_item[0] %>
           <% end %>                  
         <% end %>
       <% end %>
      <li class="divider"></li>
      <% TicketsFilter.sort_order_fields_options.each do |sort_order_item| %>
        <% content_tag :li, :class => (( sort_order_item[1] == current_wf_order_type ) ? "active" : "" ) do %>
          <% link_to "#", :class => "wf_order_type", :wf_order_type => sort_order_item[1] do %>
            <%= sort_order_item[0] %>
          <% end %>
        <% end %>
      <% end %>
    </ul>
    <a class="dropdown-toggle help-text" data-toggle="dropdown" href="#">
      <%= t('ticket.sort_by') %> <b><%= current_sort_name || sort_fields.first[0] %></b>
      <b class="caret"></b>
    </a>
  </div>
  <%#= render :partial => "/support/shared/ticket_sort" unless @tickets.empty? %>
</div>

<% javascript_tag do %>
  jQuery('.wf_order_type, .wf_order').live("click", function(ev){
      ev.preventDefault();
      setCookie(this.className, this.getAttribute(this.className),'/support/');
      jQuery("#ticket-list").html("<div class='loading-box'></div>"); 
      jQuery.ajax({
        url: "/support/tickets/filter/<%=current_filter%>?partial=true",
        type: "POST",
        dataType: "script"
      }); 
    jQuery(this).hide();  
  });
  var query_hash  = $A();
  
  function getFilterData(){
    query_hash = $A(); 
    jQuery("div.ff_item").map(function () {
      condition = this.getAttribute("condition");
      container = this.getAttribute("container");
      operator  = this.getAttribute("operator");
      _selector = 'input:checkbox:checked'; 
      var value;
          
      if(container == "multi_select") _selector = 'option:selected';
       
      if(container == "nested_field") {         
        value = jQuery(this).children('select').val();
      } else {
        value = jQuery(this).find(_selector).map(function(){ return this.value; }).get();
      }
                        
      if(value && value.length && ((container != "nested_field") || ((container == "nested_field") && (value != -1)))){
        query_hash.push({ 
          condition : this.getAttribute("condition"), 
          operator  : this.getAttribute("operator"),
          value     : value.toString()
        });
      }
    });
    jQuery("#FilterOptions input[name=page]").val(1);
  }

  jQuery(document).ready(function(ev){
    jQuery("#exportbutton").trigger("click");
  })
  
<%end%>