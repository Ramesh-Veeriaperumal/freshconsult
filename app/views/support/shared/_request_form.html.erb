<%= content_tag ( :h3, t('ticket.submit_ticket_title') ,:class => "title" ) %>
	<ul class="ui-form">
		<% @customizer = ActiveSupport::JSON.decode(@ticket.customizer.requester_view)
		   @customizer.each do |field|
				#field_class = field["type"] + ((field["customer"]["required"]) ? " required" : "")
				field_class = field["type"] 
				case field["label"]
					 when "Requester" then 
					%>
					<li> 	
				  		<label id="requester-label">Email*</label>
				  		<input type="text" id="helpdesk_ticket_email" class="text email required" name="helpdesk_ticket[email]" value="<%=@ticket.email%>"></input>
				   	</li>	
					<% when "Subject" then%>
						<li>
				        	<%= request_form.label :subject, "Subject" %>
				          	<%= request_form.text_field :subject, :class => field_class %>
				   		</li>
					<%when "Type" then%>		
						<li class="dropdown">
          					<%= request_form.label :ticket_type, t('ticket.type') %>
         					<%= request_form.select :ticket_type, Helpdesk::Ticket::TYPE_OPTIONS, :class => field_class %>
        				</li>
					<%when "Source" then%>
						<li class="dropdown">
				  			<%= request_form.label :source, "Source" %>
				 			<%= request_form.select :source, Helpdesk::Ticket::SOURCE_OPTIONS, :class => field_class %>
				        </li>
								
					<%when "Status" then%>
						<li class="dropdown">
				          	<%= request_form.label :status, "Status" %>
				         	<%= request_form.select :status, Helpdesk::Ticket::STATUS_OPTIONS, :class => field_class %>
				        </li>
						
					<%when "Group" then%>
						<li class="dropdown">
				          	<%= request_form.label :group_id, "Group" %>
				          	<%= request_form.collection_select :group_id, Group.find_all_by_account_id(current_account.id), :id, :name,{:include_blank => 'None'}, { :onchange => "changeAggentList(this.options[this.selectedIndex].value)" ,:class => field_class} %>
				        </li>
						
					<%when "Assigned to" then%>	
						<li class="dropdown" id="assigned_to">
				          	<%= request_form.label :responder_id, "Assigned To" %>
				          	<%= request_form.collection_select :responder_id, Helpdesk::Authorization.find_all_by_permission(:manage_tickets), :user_id, :name, {:include_blank => 'Nobody'}, :class => field_class %>
				        </li>
						
					<%when "Priority" then%>
						<li class="dropdown">
				 			<%= request_form.label :priority, "Priority" %>          
							<%= request_form.select :priority, Helpdesk::Ticket::PRIORITY_OPTIONS, :class => field_class %>
				    	</li>
					
					<%when "Description" then%>
						<li>
							<%= request_form.label :description, "Description" %>
				    		<%= request_form.text_area :description, :class=> field_class %>
						</li>				
					
					<%else%> 
						<% request_form.fields_for :custom_field do |cust_form| %>
						<% 
							field_label = (field["customer"]["required"]) ? "#{field["display_name"]}*" : "#{field["display_name"]}"  
							 
						%>
							<% case field["type"] when "text","number" then %>				
								<li class="<%= field['label'] %>">		 
									<%= cust_form.label "#{field["label"]}", field_label %>  
				 					<%= cust_form.text_field "#{field["label"]}", :class => field_class %>
								</li>		 
										
							<% when "paragraph" then %>
								<li class="paragraph">
									<%= cust_form.label "#{field["label"]}", field_label %>  
				 					<%= cust_form.text_area "#{field["label"]}" ,:class => field_class %>
								</li>
									
							<% when "dropdown" then %>
								<li class="dropdown">
									<% Array values =[]
										field["choices"].each {|choice| values.push(choice["value"])}%>
										 <%= cust_form.label "#{field["label"]}", field_label %>  
				 						 <%= cust_form.select "#{field["label"]}", values ,:class=> field_class %>
							    </li>
											
						   <% when "checkbox" then %>
								<li class="checkbox">
									<%= cust_form.check_box "#{field["label"]}" ,:class=>field_class %>					
									<%= field_label %>
							     </li>
						   <% end %>
						 <% end %>			 
						<% end %>
					<% end %>
					
					<li>
						<%= render :partial=>"/helpdesk/shared/attachment_form"  %>
					</li>	
					<li>
						<span class="seperator"></span>
					</li>
					<li>
						<% if !logged_in? %>
						  	<%= content_tag ( :label, t('ticket.verify_human') ) %>
						  	<%= recaptcha_tags :display => { :theme => "white" }  %>
						<% end %> 
					</li>
					
	</ul>
	<div class="button-container">
		<%= request_form.submit t('ticket.submit_ticket'), :class => "uiButton" %>
		<%# Any fields named like meta[fieldname] will be saved by the helpdesk as metadata %>
		<%= hidden_field_tag "meta[user_agent]", request.env["HTTP_USER_AGENT"] %>
		<%= link_to t("cancel"), :back, :class => "uiButton" %>
	</div>