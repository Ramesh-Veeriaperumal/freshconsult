<%= stylesheet_link_tag_with_rtl :'cdn/survey' %>

<link href="<%= helpdesk_theme_url %>" media="screen" rel="stylesheet" type="text/css">

<%= javascript_include_tag :'cdn/survey'  %>

<%= javascript_tag do %>
  surveyFeedbackI18n = {};
  surveyFeedbackI18n.thanksFeedback =  "<%= t('admin.surveys.new_thanks.thanks_feedback')%>";
  surveyFeedbackI18n.surveyFeedback = "<%=t('admin.surveys.index.survey_feedback')%>";
  surveyFeedbackI18n.portalMsg = "<%= t('admin.surveys.index.portal_msg') %>";
<% end %>

<script>
	var isCommentable = <%=@survey_handle.survey.can_comment%>;
	var isPreview = <%=@survey_handle.preview?%>
	var hasQuestandComments = false
	<% if @survey_handle.survey.feedback_questions.blank? && !@survey_handle.survey.can_comment? %>
		hasQuestandComments = true
	<% end %>
</script>

<% cache ["v1","survey",@survey_handle.portal] do %>
	<%
		cssText = render(:partial=>"rating_text")
		engine = Sass::Engine.new(cssText , :syntax => :scss, :cache => true, :style => :compressed)
	%>
	<style>
	<%= engine.render %>
	</style>
<% end %>

<% csat_email_scan_compatibile = @survey_handle.account.csat_email_scan_compatibility_enabled? %>

<script type="text/javascript">
	if(document.referrer.length>0){
		Feedback.refreshTab();
	}
	<% if @rating_via_handle && !csat_email_scan_compatibile %>
		Feedback.surveySaveHit(null, "<%= @rating %>","<%= @survey_code %>");
	<% end %>
</script>

<body class="single">
	<div class="cust-survey-wrapper content rounded-6">
		<%= form_for :survey_handle, html: {
					id: 'survey_form', method: :post, onsubmit: csat_email_scan_compatibile ? "javascript:Feedback.surveySaveHit(event, '#{@rating}', '#{@survey_code}')" : "javascript:Feedback.submit(event)", 'data-email-scan-compatible': csat_email_scan_compatibile } do |f| -%>
			<div class="highlighter">
				<h2><%=@survey_handle.survey.thanks_text%></h2>
				<div class="survey-overlay center" style="display:none;"></div>
				<div class="loading">
					<span class='loading-text'> <%=t('admin.surveys.index.portal_msg')%> </span>
				</div>
			</div>
			<div class="survey_question_list" id='survey_question'>
				<% unless @survey_handle.survey.feedback_questions.blank? %>
					<div class="survey_question_wrapper">
						<% @survey_handle.survey.feedback_questions.each_with_index do |question,qindex| %>
							<div class="survey-question">
								<span class="pull-left"><%= qindex+1 %>.</span>
								<div class = "ques-desc"><%=question.label%></div>
								<div class="ques-ans">
									<% question.choices.each_with_index do |option, index| %>
										<span class="survey-rating none question-rating-<%=qindex%>" id="rating_<%=index%>" data-class="<%=CustomSurvey::Survey::CUSTOMER_RATINGS_STYLE[option[:face_value]]%>" data-id="<%=option[:face_value]%>" data-question-id="<%=qindex%>" data-name="<%=option[:name]%>" onmouseover="javascript:SurveyRating.hover(this);" onmouseout="javascript:SurveyRating.resetLabel(this);" onclick="javascript:SurveyRating.input(this);"></span>
									<%end%>
									<label id="rating-label-<%=qindex%>" class="muted rating-label" data-selected-value="&nbsp;" data-selected-id="none" data-custom-field="<%=question.name%>">&nbsp;</label>
								</div>
							</div>
						<%end%>
					</div>
				<%end%>
				<%if @survey_handle.survey.can_comment? %>
					<textarea autocomplete="off" class="input-comment required" id="survey_feedback" name="feedback" rel="ghostwriter" type="text" width="100%"
						placeholder= "<%= @survey_handle.survey.comments_text %>" ></textarea>
				<% end %>
				<% if csat_email_scan_compatibile || (!@survey_handle.survey.feedback_questions.blank? || @survey_handle.survey.can_comment?) %>
					<%= f.submit t('support.surveys.new.submit'), :class => "btn btn-primary btn-comment" %>
				<% end %>
			</div>
		<%end%>
	</div>
</body>