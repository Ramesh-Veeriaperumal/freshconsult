<% unless current_user %>
	<%= post_topic_in_portal current_portal.to_liquid, true %>
<% else %>
	<%= form_for @topic, :url => @topic.new_record? ? support_discussions_topics_path : support_discussions_topic_path(@topic), 
						:method => @topic.new_record? ? :post : :put,
						:html => { :multipart => true, :rel => "validate", :class => "form-portal" } do |form| -%>
	<%= form.error_messages %>					
	<div class="control-group">
		<label class="control-label required" for="topic_title">
			<%= t('portal.topic.topic_title') %>
		</label>
		<div class="controls suggestions">
			<%= form.text_field :title, :class => "required text span12", 
			:autocomplete => :off, :autofocus => true, 
			'data-suggestions' => @topic.new_record? ? "/support/search/topics/suggest" : '', 
			'data-left-position' => "96.5%", 'data-top-position' => "5%" %>
		</div> 	
	</div> 	
	<div class="control-group">
		<label class="control-label required description-label" for="topic_body">
			<%= t('message') %>
		</label>
		<div class="controls">
			<%= form.rich_editor :body_html,
				:rows => 12, "editor-type" => :forum, :class => "required_redactor" %>
		</div>
	</div>	
	<div class="control-group">
		<label class="control-label required">
			<%= t('portal.topic.post_topic') %>
		</label>
		<div class="controls">
			<%= form.select :forum_id, grouped_options_for_select(forum_options, @topic.forum_id), 
				{ :include_blank => true },
				{ :class => "required custom-select", 
				  :disabled => !@topic.new_record?,
				  :data => { :placeholder => t("portal.topic.default_select_option") } } %>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label"><%= t('attach_files') %></label>	
		<% attach_id = attach_id || "post"
		   nsc_param = nsc_param || "post" %>
		 <div class="controls">
			<%= render :partial=>'/support/shared/attachment_form', :locals=>{:attach_id=>attach_id, :nsc_param=>nsc_param} %>
		 </div>
		<%= render :partial => "/support/shared/multifile_template" %>
	</div>
	<% unless @topic.new_record? %>
	<div class="control-group">
		<div class="controls">

			<div class="attachment-list-container" >
				<%= content_tag('h5', t('attachments')) %>
				<% unless @topic.posts.first.attachments.empty? %>
					<%= attachment_container(@topic.posts.first.attachments, true, "article", nil) %>
				<% end %>
				<% unless @topic.posts.first.cloud_files.empty? %>
					<%= attachment_container(@topic.posts.first.cloud_files, true, "cloud_file", nil) %>
				<% end %>
			</div>
		</div>
	</div>
	<%end%>

	<% if @topic.new_record? && current_account.launched?(:still_enable_captcha) && !current_account.forum_captcha_disable_enabled? %>
		<div class="control-group"> 
	    	<div class="controls recaptcha-control">
	    		<iframe 
	              src="/support/recaptcha#<%= ENV["RECAPTCHA_SITE_KEY"] %>"
	              class="recaptcha-frame"
	              id="recaptcha-frame"
	              height="100px"
	              width="320px">
	            </iframe>
	    	</div>
	  	</div>
  	<% end %>
	
	<div class="form-actions">
		<input type="submit" class="btn btn-primary" value=<%= t('save') %> />
		<a href="javascript:history.back()" class="btn"><%= t('cancel') %></a>
		<% unless @topic.new_record? %>
			<%= link_to t('delete'), support_discussions_topic_path(@topic), 
				:class => "btn btn-danger pull-right", 
				"data-method" => "delete",
				"data-confirm" => "#{t('delete_topic_msg')}?" %>
		<% end %>
	</div>
	<% end %>
<% end %>