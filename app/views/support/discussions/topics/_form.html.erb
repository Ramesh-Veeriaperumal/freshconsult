<% form_for @topic, :url => support_discussions_forum_topics_path(@forum), 
					:html => { :multipart => true, :class => "form-horizontal" } do |form| -%>
<%= include_tiny_mce_if_needed %>
<fieldset>
	<div class="control-group">
		<label class="control-label" for="topic_title"><%= t('topic.name') %>*</label>
		<div class="controls">
			<%= form.text_field :title, :onchange => "/*TopicForm.editNewTitle(this);*/", :class => "required text", :tabindex => 10 %>
		</div>
	</div> 
	<div class="control-group">
		<label class="control-label" for="topic_body"><%= t('message') %></label>
		<div class="controls">
			<% if @topic.new_record? %>
				<%= form.text_area  :body_html, :class => "mceEditor", :id => 'topic_body' %>
			<% else %>
				<%= form.text_area :body_html, :rows => 12, :tabindex => 20, :value => @topic.posts.first.body_html , :class => "mceEditor"%>
			<% end %>
		</div>
	</div>	
	<div class="control-group">
		<div class="controls">
			<% if ["new"].include? params[:action] %>
				<label class="checkbox" id="monitor-topic-lable"><%= check_box_tag 'monitor', '', true %> Monitor this topic</label>
			<%end%>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label">Attach files</label>	
		<% attach_id = attach_id || "post" %>
		<div class="controls">
			<input type="file" id="<%=attach_id%>_file" name="emptyfile" nameWhenFilled="post[attachments][][resource]" fileContainer="<%=attach_id%>-container" fileList="<%=attach_id%>-attachments" sendFocusTo="<%=attach_id%>-body" />
			<div class="attachments" id="<%=attach_id%>-container" style="display:none">
			  <div id="<%=attach_id%>-attachments"></div>
			</div>
		</div>	

		<%# 
		  The following is a template used by multifile.js to create rows in
		  the attachments table.
		 %>
					
		<script id="file-list-template" type="text/x-jquery-tmpl">			
		  <div class="item">
		  	<span>
		  		${name} - <a href="javascript:void(0)" onclick="Helpdesk.Multifile.remove(this); return false;", inputId="${inputId}">remove</a>
			</span>
		  </div>
		</script>
	</div>
	
	<% unless @topic.new_record? %>
	<div class="attachment-list-container">
	    <%= content_tag('h5', 'Attachments') unless @topic.posts.first.attachments.empty? %>
	    <table class="attachment-list">
	      <%= render(
	        :partial => '/helpdesk/shared/attachment', 
	        :collection => @topic.posts.first.attachments,
	        :locals => {:show_delete => true, :url => [@topic.posts.first] }) %>
	    </table>
	  </div>
	<%end%>
</fieldset>
<div class="form-actions">
	<input type="submit" class="btn btn-primary" value="Submit" />		
</div>
<% end %>
<%= javascript_include_tag "helpdesk/multifile.js" %>