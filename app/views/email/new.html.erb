<head>
  <% if @debuging%>
    <script type="text/javascript">
        var t_pagestart = new Date().getTime();
      </script>
    <%end%>
    <meta charset="utf-8">
  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title><%= h(page_title) %></title>
  <meta name="description" content="<%= page_description %>">
  <meta name="author" content="">
  <meta name="keywords" content="<%= page_keywords %>">
  <!-- Adding meta tag for CSRF token -->
  <%= csrf_meta_tag %>
  <!-- End meta tag for CSRF token -->
  <!-- Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <% unless page_canonical.blank? %>
    <link rel="canonical" href="<%= page_canonical %>" />
  <% end %>
  <link rel="canonical shortcut icon" href="<%= fav_icon_url %>" />

  <!-- TODO-RAILS3 Clean up the below module oriented items -->
   
  <%= stylesheet_link_tag_with_rtl :'cdn/common' %>
  <%= stylesheet_link_tag_with_rtl :'cdn/pattern', :media => "screen, print, projection"  %>
  <%= stylesheet_link_tag_with_rtl :'cdn/plugins'  %>
  <%= stylesheet_link_tag_with_rtl :'cdn/sprites'  %>
  <%= stylesheet_link_tag_with_rtl :'cdn/app' %>
  <%= stylesheet_link_tag_with_rtl :'cdn/non_pattern' %>
  <%= stylesheet_link_tag_with_rtl :'cdn/tour_my_app' %>

  <script type="text/javascript">
    /* TODO-RAILS3 need to cross check this area */
    PROFILE_BLANK_THUMB_PATH = '<%= asset_host_url %>/assets/misc/profile_blank_thumb.gif';
    PROFILE_BLANK_MEDIUM_PATH = '<%= asset_host_url %>/assets/misc/profile_blank_medium.gif';
    SPACER_IMAGE_PATH = '<%= spacer_image_url %>';
    FILLER_IMAGES = {
      imageLoading : '<%= asset_host_url %>/assets/animated/image_upload_placeholder.gif'
    };
    cloudfront_version = "<%= CLOUDFRONT_VERSION %>";
    cloudfront_host_url = "<%= asset_host_url %>";
  </script>
    
  <%= javascript_include_tag :'cdn/defaults'  %>
  <%= javascript_include_tag :'cdn/frameworks' %>
  <%= javascript_include_tag :'cdn/workspace' %>
  <%= javascript_include_tag :'cdn/syntaxhighlighter' %>
  <%= javascript_include_tag :'cdn/pattern'  %>

  <%= javascript_include_tag :"cdn/lang/#{I18n.locale.to_s.downcase}" %>

  <script type="text/javascript">
    Fjax.pjax_parallel_request = null;
    $LAB.setGlobalDefaults({
      BasePath: cloudfront_host_url + '/assets/'
    });
    Fjax.Assets.setup(<%= asset_manifest(:js).to_json.html_safe %>, {app:[], plugins:[]}, "", cloudfront_host_url);
    Fjax.Manager.start();
  </script>

  <%= yield :head %>
  
</head>


<%= form_tag '/email', :multipart => true, :id => "EmailTicketForm" do -%>

  <label for="from">From email</label>
  <input id="from" name="from" size="30" type="text" />
  
  <label for="to">To email</label>
  <input id="to" name="to" size="30" type="text" />
  
  <label for="cc">CC email</label>
  <input id="cc" name="cc" size="30" type="text" />
  
  <label for="envelope">envelope</label>
  <input id="envelope" name="envelope" size="30" type="text" value='{"to":["support@localhost.com"],"from":"customer@domain.com"}'/>
  
  <input id="type" name="charsets" value= '{"to":"UTF-8","html":"UTF-8","subject":"UTF-8","from":"UTF-8","text":"UTF-8"}' size="30" type="hidden" />
  
  
  <div id="form-uploads">
    <label>Attach a file</label>
    <input type="file" id="email_attachment_file" name="emptyfile" nameWhenFilled="attachment" fileContainer="attachment-container" fileList="attachments-list" sendFocusTo="email_attachment-body" />
    <div class="info-data">
      <%=t('attachment_help_info')%>
    </div>    
  </div>
  <input type="hidden" id="attachments-count" name="attachments" />
<script id="file-list-template" type="text/x-jquery-tmpl">      
  <div class="item">
    <span>
      ${name} - <a href="javascript:void(0)" onclick="Helpdesk.Multifile.remove(this); return false;", inputId="${inputId}">remove</a>
  </span>
  </div>
</script>
<div class="attachments" id="attachment-container" style="display:none">
  <div id="attachments-list"></div>
</div>
  
  
  <label for="subject">Subject</label>
  <input id="subject" name="subject" size="30" type="text" />
  
  <label for="text">How may we help you?</label>
  <textarea cols="40" id="html" name="html" rows="20"></textarea>

  <label for="headers">Header, whatever you want..</label>
  <textarea cols="40" id="headers" name="headers" rows="20"></textarea>
	
  <div><%= submit_tag 'Save' %></div>
<% end -%>
<% content_for :onload_script do -%> 
jQuery('#html').redactor({ focus: false, autoresize:false, buttons:['bold','italic','underline','|','unorderedlist', 'orderedlist',  '|','fontcolor', 'backcolor', '|' ,'link']});
<%- end %>


<script type="text/javascript">
  jQuery("#EmailTicketForm").bind("submit", function(){
    var _uploads = jQuery("#form-uploads input[name=attachment]")
    jQuery.each(_uploads, function(i, item){
      item.name += i+1
    })
    jQuery("#attachments-count").val(_uploads.length)
  })

</script>