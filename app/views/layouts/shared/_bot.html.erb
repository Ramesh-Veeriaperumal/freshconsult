<script type='text/javascript'>
  (function(d, w, c) {
    if (!d.getElementById("spd-busns-spt")) {
      var n = d.getElementsByTagName('script')[0],
      s = d.createElement('script');
      var loaded = false;
      s.id = "spd-busns-spt";
      s.async = "async";
      s.src = '<%= BOT_CONFIG[:widget_code_src] %>'
      s.setAttribute("data-prdct-hash", "<%= BOT_CONFIG[:freshdesk_product_id] %>"); 
      s.setAttribute("data-ext-client-id", "<%= current_bot.external_id %>");
      s.setAttribute("data-env", "<%= BOT_CONFIG[:widget_code_env] %>");
      s.setAttribute("data-self-init", "<%= BotConstants::WIDGET_CODE_SELF_INIT %>");
      s.setAttribute("data-init-type", "<%= BotConstants::WIDGET_CODE_INIT_TYPE %>");
      s.setAttribute("data-region", "<%= BOT_CONFIG[:widget_code_region] %>");
      if (c) {
        s.onreadystatechange = s.onload = function() {
          if (!loaded) {
            c();
          }
          loaded = true;
        };
      }
      n.parentNode.insertBefore(s, n);
    }
  })(document, window, function () {
    Freshbots.initiateWidget({
      getClientParams: function () {
        return {
          "cstmr::nm": "<%= current_user.name if current_user%>",
          "cstmr::eml": "<%= current_user.email if current_user%>"
        };
      }
    });
  });
</script>
