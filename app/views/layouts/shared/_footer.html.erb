<div id="footer" class="wrapper">  
	<div class="wrapper-shadow">
			<% if current_account.launched?(:new_footer_feedback_box) %>
				<%= render "layouts/shared/footer_feedback_box" %>
			<% else %>
				<%= render "layouts/shared/footer_no_feedback_box" %>
			<% end %>		  			 
	</div>
</div>
<%if current_user and current_account.node_feature_list.present?  %>
	<%= javascript_include_tag :'cdn/fd_node_feature' %>
	<script>
	var FdSocket = fdio('<%= fd_socket_host %>','<%= fd_node_auth_params %>',{transports: ['websocket','xhr-polling','polling','htmlfile','flashsocket']});
	</script>
<% end %>

<%= render :partial => 'shared/shortcuts_help_chart' %>

<% if current_user && current_user.agent? %>
	<% cti_app = current_account.cti_installed_app_from_cache %>
	<% if cti_app.present? %>
    <% if current_account.features?(:cti) && cti_app.application.name == 'cti' %>
	    <%= render :partial => 'shared/integrations/cti/screen_pop' %>
    <% else %>
	    <% cti_app_name = cti_app.application.name %>
	    <%= render :partial => 'layouts/shared/integrations/cti/cti_toolbar', :locals => {:app => cti_app.application} %>
	    <%= render :partial => 'layouts/shared/integrations/cti/' + cti_app_name, :locals => {:installed_app => cti_app} %>
    <% end %>
	<% end %>
<% end %>
<%if @debuging %>
	<script type="text/javascript" src="/javascripts/labs/boomerang.js"></script>
	<script type="text/javascript" src="/javascripts/labs/benchmark_init.js"></script>
<% end %>

<% if shortcuts_enabled? %>
<script type="text/javascript">
	Fjax.Assets.plugin('shortcut');
</script>
<% end %>

<% if current_user %>
<% if Rails.env.development? %>
<% @LoadAsset=request.protocol.to_s+request.host_with_port %>
<% @LoadAsset1=request.protocol.to_s+request.host_with_port.to_s+"/widget" %>

<% elsif Rails.env.staging? %>
<% @LoadAsset="https://s3.amazonaws.com/assets.freshpo.com" %>
<% @LoadAsset1="https://s3.amazonaws.com/assets.freshpo.com/widget" %>

<% elsif Rails.env.production? %>
<% @LoadAsset="https://s3.amazonaws.com/assets.freshdesk.com" %>
<% @LoadAsset1="https://s3.amazonaws.com/assets.freshdesk.com/widget" %>
<% end %>
	 <script type="text/javascript" src="<%= @LoadAsset %>/widget/freshwidget.js"></script>
<style type="text/css" media="screen, projection">
	@import url(<%= @LoadAsset %>/widget/freshwidget.css); 
</style> 
	<script type="text/javascript">
		FreshWidget.init("", {"queryString": "&widgetType=popup&screenshot=no&helpdesk_ticket[requester]=<%= current_user.email.presence %>", "widgetType": "popup", "buttonText": "Support", "buttonColor": "white", "buttonBg": "#006063", "backgroundImage": "", "alignment": "4", "offset": "-500px", "formHeight": "550px", "url": "<%= AppConfig['support_url'] %>","assetUrl":"<%= @LoadAsset1 %>"} );
		
		jQuery("body").on("click",'#footer_feedback_widget', function(ev){
	    	ev.preventDefault();
	    	if(window.widget_updated){
	    		FreshWidget.update({"queryString": "&widgetType=popup&screenshot=no&helpdesk_ticket[requester]=<%= current_user.email.presence %>", "widgetType": "popup", "buttonText": "Support", "buttonColor": "white", "buttonBg": "#006063", "backgroundImage": "", "alignment": "4", "offset": "-500px", "formHeight": "550px", "url": "<%= AppConfig['support_url'] %>","assetUrl":"<%= @LoadAsset1 %>"} );
	    	}
	    	window.widget_updated = false;
	    	FreshWidget.show();	
	    });
	    
		jQuery("body").on("click",'.chat-support-link', function(ev){
			ev.preventDefault();
			try{
				livechat.MainView.renderAgentSupport();
			}
			catch(err){
				console.log('Livechat error: support chat has not loaded');
			}
		});
		
	  var APP_ENV = "<%= Rails.env %>";
	</script>

<% if (current_user.privilege?(:admin_tasks) && current_account.onboarding_pending?)  %>
  <%= javascript_include_tag :'cdn/admin_onboarding' %>
  <%= render partial: "admin_onboarding/onboarding_modal" %>
<% else %>
	<% if current_account.launched?(:onboarding_inlinemanual) %>
		<% if Rails.env.production? %>
			<script src="https://inlinemanual.com/embed/player.<%=INLINE_MANUAL_TOKENS['access_key']%>.js" async ></script>
		<% else %>
			<script>!function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.async=1,e.src="https://inlinemanual.com/embed/player.<%=INLINE_MANUAL_TOKENS['access_key']%>.js",e.charset="UTF-8",t.parentNode.insertBefore(e,t)}();</script>
		<% end %>
		<script type="text/javascript" >
			window.inlineManualTracking = <%= inline_manual_people_tracing.to_json.html_safe %>
			window.im_option = {
				to_activate : <%= show_onboarding? %>,	
				topic_id : <%= inlinemanual_topic_id %>
			}
		</script>
		<%= javascript_include_tag :'cdn/inline_manual_trigger' %>
		<div class="hide" id="inline-manual-meta">
			<span class="<%= inline_manual_classes_for_multilingual %>" id="multilingual-meta-info"></span>
		</div>
	<% end %>
<% end %>

<% if current_user.falcon_invite_eligible? %>
	<%= javascript_include_tag :'cdn/falcon_invite' %>
	<%= render partial: "admin_onboarding/falcon_invite" %>
<% end %>

<script >
	//TODO: Migrate to i18n Js
	window.feedback_subject_required_error = "<%= t('footer.errors.feedback_subject_required') %>"
	window.current_account_full_domain = "<%= current_account.full_domain %>"
	window.is_current_user_admin = "<%= current_user.privilege?(:view_admin) %>"
</script>
			
<% if current_account.launched?(:new_footer_feedback_box) %>
	<%= javascript_include_tag :'cdn/footer_feedback' %>
<% end %>

<% end %>


<!-- Autopilot headsup: for in-app messaging -->
<% if(current_account.launched?(:autopilot_headsup) && current_user.privilege?(:view_admin)) %>
	<script type="text/javascript">(function(o){var b="https://api.autopilothq.com/anywhere/",t="<%= AUTOPILOT_TOKENS["ui_token"] %>",a=window.AutopilotAnywhere={_runQueue:[],run:function(){this._runQueue.push(arguments);}},c=encodeURIComponent,s="SCRIPT",d=document,l=d.getElementsByTagName(s)[0],p="t="+c(d.title||"")+"&u="+c(d.location.href||"")+"&r="+c(d.referrer||""),j="text/javascript",z,y;if(!window.Autopilot) window.Autopilot=a;if(o.app) p="devmode=true&"+p;z=function(src,asy){var e=d.createElement(s);e.src=src;e.type=j;e.async=asy;l.parentNode.insertBefore(e,l);};if(!o.noaa){z(b+"aa/"+t+'?'+p,false)};y=function(){z(b+t+'?'+p,true);};if(window.attachEvent){window.attachEvent("onload",y);}else{window.addEventListener("load",y,false);}})({"app":true});</script>
	<script type="text/javascript">
		if(Autopilot){
			Autopilot.run("associate", {Email: '<%= current_user.email %>'});
		}
	</script>
<% end %>

<!-- For Iris Notifications and Collaboration -->
<% if current_account.user_notifications_enabled? || current_account.collaboration_enabled? %>
	<script type="text/javascript" src="<%= IrisNotificationsConfig['socketioUrl'] %>"></script>
	<script type="text/javascript" src="<%= IrisNotificationsConfig['rtsUrl'] %>"></script>
<% end %>

<!-- For Iris Notifications -->
<% if current_account.user_notifications_enabled? %>
	<script type="text/javascript" src="<%= IrisNotificationsConfig['irisUrl'] %>"></script>
	<%= javascript_include_tag :'cdn/user_notifications' %>
<% end %>

<!-- For Collaboration -->
<% if current_account.collaboration_enabled? %>
	<%= javascript_include_tag :'cdn/collaboration' %>
<% end %>

<!-- For Year In Review Analytics -->
<% if current_user && current_account.launched?(:heap_analytics) %>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load("<%= HEAP_PROJECT_ID %>");
      heap.identify("<%= current_user.id %>");
      heap.addUserProperties({
        'email': "<%= current_user.email %>",
        'account_url': "<%= current_account.full_domain %>",
        'account_name': "<%= current_account.name %>",
        'agent_name': "<%= current_user.name %>",
		<% subscription = current_account.subscription %>
		"account_plan": "<%= subscription.subscription_plan.name %>",
		"agents_count" : "<%= subscription.agent_limit.presence || current_account.technicians.count %>",
        'account_state': "<%= subscription.state %>",
        'account_mrr' : "<%= subscription.cmrr %>",
        'role' : "<%= current_user.privilege?(:admin_tasks) ? 'admin' : 'agent' %>"
      });
  </script>
<% end %>