<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<%= render :partial => "layouts/report/v2/shared/pdf_files", :formats => [:html], :locals => {} %>
<div class="reports-wrapper" id="reports_wrapper">
  <div class="reports-main">
    <div class="reports-header row-fluid">
     <%= render :partial => "layouts/report/v2/shared/header.html.erb", :formats => [:html], :locals => {report_type: report_type, filter_name: filter_name, last_dump_time: last_dump_time}  %> 
    </div>
    <div class="helpkit-glance glance-pdf">
      <div class="glance-chart-wrapper" id="glance_chart_wrapper" style="margin-left:0px">
        <div id="glance_main"></div>
      </div>
      
    </div>
</div>
</div>

<script type="text/javascript">
  jQuery(document).ready(function () {
    
    window.HelpdeskReports = window.HelpdeskReports || {};
    HelpdeskReports.locals = HelpdeskReports.locals || {};
    HelpdeskReports.locals.report_type = "<%= report_type %>";
    HelpdeskReports.locals.field_name_mapping = <%= label_hash.to_json.html_safe %>;
    HelpdeskReports.locals.date_range = "<%= date_range %>";
    HelpdeskReports.locals.report_options_hash = <%= nf_hash.to_json.html_safe %>;
    HelpdeskReports.locals.custom_fields_group_by = [];
    HelpdeskReports.locals.select_hash  = <%= filters.to_json.html_safe%> 
    HelpdeskReports.locals.chart_hash = <%= data.to_json.html_safe %>;
    HelpdeskReports.locals.is_non_sprout_plan = <%= Account.current.subscription.non_sprout_plan? || Account.current.advanced_reporting_enabled? %>;
    HelpdeskReports.locals.pdf = true;
    HelpdeskReports.locals.pdf_custom_field = '<%= pdf_cf %>'

    var locals = HelpdeskReports.locals;
    var err = <%= @filter_err ? @filter_err.to_json.html_safe : false %>;

    if (err) {
      var div = ["reports_container"];
        HelpdeskReports.CoreUtil.populateEmptyChart(div, err);
    } else {
      HelpdeskReports.ChartsInitializer.Glance.pdf(locals.chart_hash);
    }
    
    HelpdeskReports.CoreUtil.setFilterDisplayData();
  });
</script>