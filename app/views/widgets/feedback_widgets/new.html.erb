<%= content_tag (:h3, (params[:formTitle].blank?) ? t('feedbackwidget_defaulttitle') : params[:formTitle], :class => "title") %>
<% form_for :helpdesk_ticket, @ticket, :url => widgets_feedback_widget_path(:submit_message => params[:submitThanks]) , :html => {:method => :post, :multipart => true }  do |f| %>
  <%= f.error_messages %>
    <ul class="ui-form"> 
      <% current_portal.customer_editable_ticket_fields.each do |field| %>
				<% 
					dom_type_correction = 
						(case field.dom_type
							when "requester" then "email"
							when "html_paragraph" then "paragraph"
							else field.dom_type
						 end)
					field_name_correction = (field.field_name == "description_html") ? "description" : field.field_name
				%>  
        <%= construct_ticket_element :helpdesk_ticket, field, 
                                       field.label_in_portal,
                                       dom_type_correction, 
                                       field.required_in_portal, 
                                       (field.dom_type == "requester" && logged_in?) ? @ticket.email : "",
                                       field_name_correction
                                       %>
      <% end %>
      <li>
        <%= render :partial=>"/helpdesk/shared/attachment_form"  %>
      </li>
	  </ul>
	<div class="button-container">
		<%= f.submit t('ticket.submit_ticket'), :class => "uiButton" %>
		<%# Any fields named like meta[fieldname] will be saved by the helpdesk as metadata %>
		<%= hidden_field_tag "meta[user_agent]", request.env["HTTP_USER_AGENT"] %> 
	</div>
<% end %>