<!--Copyright Â© 2014 Freshdesk Inc. All Rights Reserved.-->
<div class="report-page reports-main" id="report-page">
  <div class="report-content-wrapper" id="">
    <!--report header-->
    <div class="row-fluid reports-header">
      <div class="reports-title span12">
        <span class="report-icon">
            <i class="fsize-36 ficon-live_chat"></i>
        </span>
        <span class="report-title-block" data-action="pop-report-type-menu" >
          <span class="unsaved_star vertical-alignment hide">*</span>
          <span id="report-title">
              <%=t('helpdesk_reports.chat_summary.title')%>
          </span>
          <span class="grey-arrow-down title-dropdown"></span>
          <p class="muted" id="report_header_date"></p>
        </span>
        <% if current_account.subscription.non_sprout_plan? %>
          <%= render :partial => "reports/shared/save_report_controls"%>
        <% end %>
        <% if current_user.privilege?(:export_reports) %>
          <button class="generate-pdf-button" id="email_pdf" name="button" onclick="this.blur();">
            <%= t('helpdesk_reports.export.email_report_pdf')%>
          </button>
        <% end %>
      </div>
      <div class="reports-filter span12" id="report-filter-details">
          <div class="span1 edit-filter report-filter-slide-btn">
                        <a class="btn btn-primary" href="#report-filter-edit" data-parent="#report-page" id="sliding"><%=t('helpdesk_reports.edit_filter') %></a>
          </div>
          <div class="filter-type span11">
            <ul class="inline" id="filter_container">
            </ul>
          </div>
          <div class="reports-menu hide" id="reports_type_menu">
          </div>
      </div>
    </div>

    <div class="row-fluid  report-summary" id="metric_container">
      <div>
       <h3 class="header-lead"><span><%= t('helpdesk_reports.summary') %> </span><a href='<%=Reports::Constants::REPORT_ARTICAL_LINKS[:freshchat_summary]%>' target="_blank" class="report-help-icon pull-right">?</a>
        </h3>
         <div class="row-fluid report-summary-wrapper" id="chat_metrics">
          
        </div>
      </div>
      <div>
       <h3 class="header-lead"><span><%= t('helpdesk_reports.chats') %> </span><a href='<%=Reports::Constants::REPORT_ARTICAL_LINKS[:freshchat_summary]%>' target="_blank" class="report-help-icon pull-right">?</a>
        </h3>
         <div class="row-fluid report-summary-wrapper" id="freshchat_line_chart">
          
        </div>
      </div>
      <div class="row-fluid control-group">
      <div class="vertical-alignment time-sheet-top-margin">
        <strong><%=t('reports.livechat.agent_chat_summary')%></strong>
      </div>
      <%if current_user.privilege?(:export_reports) %>
        <span class="pull-right time-sheet-top-margin">
            <a href="javascript:void(0);" id='export_as_csv'><%=t('export_to_CSV')%></a>
            <form id="pdf_form" method="post" action="<%= export_pdf_reports_freshchat_summary_reports_url %>" target="_blank">
        <input type="hidden" name="pdf_args" class="serialize" id="pdf_args" value="" />
      </form>
        </span>
      <% end %>
      </div>
      <div class="grid report row-fluid"> 
          <table width="100%" id="agent_summary">
            <tr>
              <% @table_headers.keys.each do |header|
                concat content_tag :th, h(@table_headers[header]), :class => header
               end %>
            </tr>
         </table>
      </div>
      <!--end call list-->

    </div>

  </div>
</div>

<!-- Filter Options -->
<div class="report-left-filter" id="report-filter-edit">
<div class="left-filter">    
  <%= render :partial => "reports/freshchat/shared/filter_options"%>
</div>
</div>
<%= render :partial => "reports/shared/dialog"%>
<%= javascript_tag do%>
  jQuery(function(){
    jQuery('#report-page').on('click.helpdesk_reports', '[data-action="pop-report-type-menu"]', function (event) {
              event.stopImmediatePropagation();
             var menu = jQuery('#reports_type_menu');
              if (!menu.is(':visible')) {
                  menu.removeClass('hide');
              } else {
                  menu.addClass('hide');
              }
        });

    jQuery('#report-page').on('click.helpdesk_reports', function () {
          var menu = jQuery('#reports_type_menu');
          if (menu.is(':visible')) {
              menu.addClass('hide');
          }
    });
  });

   jQuery("#email_pdf").on('click.helpdesk_reports',function(){

     var params = getPdfParams();
     
     jQuery.ajax({
            url: "<%=export_pdf_reports_freshchat_summary_reports_url%>",
            type: "POST",
            contentType: 'application/json',
            data: Browser.stringify(params),
            success: function(data){ 
                 var msg = "<%= t('adv_reports.report_export_success') %>";
                 var text = "<span id='email-reports-msg'>"+msg+"</span>";
                 showResponseMessage(text);  
              }
        });

});

      
<% end %>
