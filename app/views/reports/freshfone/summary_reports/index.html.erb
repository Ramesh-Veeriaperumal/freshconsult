<!--Copyright Â© 2014 Freshdesk Inc. All Rights Reserved.-->
<% content_for :layoutType do -%>reports_page<%- end %>

<%= javascript_include_tag :'cdn/report_date'  %>
<%= stylesheet_link_tag_with_rtl :'cdn/ui_daterangepicker', :media => "screen" %> 
<%= stylesheet_link_tag_with_rtl :'cdn/reports' %>
<%= javascript_include_tag :'cdn/reports'  %>
  <div id="loading-box">
   <div class="sloading loading-left loading-small reports-loading"><%=t('adv_reports.glance.loading_msg')%></div> 
   </div>
<!--report header-->
<div class="row-fluid">
  <div class="span12 report-breadcrum-wrapper">
    <ul class="breadcrumb">
      <li><a href="<%=reports_url%>"><%=t('adv_reports.glance.all_reports')%></a> <span class="divider">/</span></li>
      <li><%=t('adv_reports.glance.report_view')%></li>
    </ul>
  </div>
</div>
 <!--end report header-->
<!-- report content -->
<div class="row-fluid" id="freshfone_summary_report">
  <div class="report-page reports-main" id="report-page">
    <div class="report-content-wrapper" id="">
    <!--report header-->
    <div class="row-fluid reports-header">
      <div class="reports-title span12">
        <span class="report-icon">
            <i class="fsize-36 ficon-phone_summary"></i>
        </span>
        <span class="report-title-block" data-action="pop-report-type-menu" >
          <span class="unsaved_star vertical-alignment hide">*</span>
          <span id="report-title">
            <%=t('helpdesk_reports.phone_summary.title')%>
          </span>
          <span class="grey-arrow-down title-dropdown"></span>
          <p class="muted" id="report_header_date"></p>
        </span>
        <% if current_account.subscription.non_sprout_plan? %>
          <%= render :partial => "reports/shared/save_report_controls"%>
        <% end %>
        <% if current_user.privilege?(:export_reports) %>
          <button class="generate-pdf-button" id="export_pdf" name="button" onclick="this.blur();">
            <%= t('helpdesk_reports.export.email_report_pdf') %>
          </button>
        <% end %>
      </div>
      <div class="reports-filter span12" id="report-filter-details">
        <div class="span1 edit-filter report-filter-slide-btn">
            <a class="btn btn-primary reports-metrics" href="#report-filter-edit" data-parent="#report-page" id="sliding">
              <%= t('helpdesk_reports.edit_filter')%></a>
        </div>
        <div class="span11 filter-type filter-container" id="filter_container">
          <%= render :partial => 'filter_header' %>
        </div>
        <div class="">
          <!-- report filter name if any -->
        </div>
        <div class="reports-menu hide" id="reports_type_menu">
          <!-- Saved reports menu -->   
        </div>
      </div>
    </div>
      <%= render :partial => "call_list" %> 
    </div>
  </div>
  <!-- Filter Options -->
  <div class="report-left-filter" id="report-filter-edit">
    <div class="left-filter">    
      <%= render :partial => "reports/freshfone/shared/filter_options"%>
    </div>
  </div> 
  </div>
<!--end report content-->
</div>
<%= render :partial => "reports/shared/dialog"%>
<%= javascript_tag do %> 
  jQuery(window).on("load", function () {
      App.Phone.Metrics.recordSource("REPORTS_LOAD");
      App.Phone.Metrics.push_event();
  });
  jQuery('body').on('assetLoaded.fjax', function() {
    App.Freshfonereports.summaryReports('<%=generate_reports_freshfone_summary_reports_url%>');
    App.Freshfonereports.groupOptions(<%= filter_group_options.html_safe %>,'<%=t("reports.freshfone.options.all_groups")%>');
    App.Freshfonereports.numberOptions(<%= filter_number_options.html_safe %> , <%=filter_default_number.html_safe %>);
    App.Freshfonereports.businessHoursOptions(<%= filter_by_business_hours_options.html_safe %>, '<%=t("reports.freshfone.filter_option_all_calls")%>');
    if (typeof freshfoneReports === "undefined") { freshfoneReports = {}; }
    freshfoneReports.group_cache = <%= group_cache.blank? ? 0 : group_cache %>
    freshfoneReports.business_hours_cache = <%= business_hours_cache.blank? ? 0 : business_hours_cache %>
   });

  jQuery(function(){
    jQuery('#report-page').on('click.helpdesk_reports', '[data-action="pop-report-type-menu"]',  function (event) {
                event.stopImmediatePropagation();
               var menu = jQuery('#reports_type_menu');
               var hash = Helpkit.report_filter_data;
             if(hash.length == 0 || ( hash.length == 1 && Helpkit.commonSavedReportUtil.default_report_is_scheduled)) {

             } else {
                  if (!menu.is(':visible')) {
                      menu.removeClass('hide');
                  } else {
                      menu.addClass('hide');
                  }
            }
          });

    jQuery('#report-page').on('click.helpdesk_reports', function () {
            var menu = jQuery('#reports_type_menu');
            if (menu.is(':visible')) {
                menu.addClass('hide');
            }
    });
  });
  
  var Helpkit = Helpkit || {};
  Helpkit.report_filter_data = <%= @report_filter_data.to_json.html_safe %>;
  Helpkit.report_type = "phone_summary"
  jQuery("#export_pdf").on('click.helpdesk_reports',function(){
    var params = getPdfParams();
    jQuery.ajax({
            url: "<%=export_pdf_reports_freshfone_summary_reports_url%>",
            type: "POST",
            contentType: 'application/json',
            data: Browser.stringify(params),
            success: function(){ 
                 var msg = "<%= t('adv_reports.report_export_success') %>";
                 var text = "<span id='email-reports-msg'>"+msg+"</span>";
                 showResponseMessage(text);
              }
        });
  });
  Helpkit._token = "<%= form_authenticity_token %>";
  Helpkit.enable_schedule_report = <%= enable_schedule_report? %>;
  current_user = {
    mail : '<%= current_user.email %>',
    id : '<%= current_user.id %>',
    time_zone : '<%= @user_time_zone_abbr %>',
    name : '<%= current_user.name %>'
  }
  day_names = <%=t('date.day_names').to_json.html_safe%>;
<%end%>