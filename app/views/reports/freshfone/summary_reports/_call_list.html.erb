<!--Copyright Â© 2014 Freshdesk Inc. All Rights Reserved.-->
<div class="report-page" id="report-page">
  <div class="report-content-wrapper" id="">
    <!--report header-->
    <div class="row-fluid report-header">
      <div class="row-fluid">
        <div class="span12 report-header-content">
          <div class="span7">
              <img src="/images/reports/report-icon.png" alt="" class="vertical-alignment report-header-icon">
            <div class="vertical-alignment report-inner-heading">
              <h1 class="lead" id="report_header_title"><%=t('reports.freshfone.report_title')%></h1>
              <p class="muted" id="report_header_date"><%=@report_date%></p>
            </div>
          </div>
        </div>
      </div>
      <div class="row-fluid">
        <div class="report-filter span12" id="report-filter-details">
          <div class="vertical-alignment report-filter-slide-btn">
                    <a class="btn btn-primary" href="#report-filter-edit" data-parent="#report-page" id="sliding">Edit</a>
          </div>
          <div class="filter-container">
            <ul class="inline" id="filter_container">
              <li><%=t('reports.freshfone.filter_by_title')%>:</li>
              <li><%=t('reports.freshfone.time_period')%> : <strong><%= @report_date.blank? ? "#{30.days.ago.strftime("%d %B %Y")} - #{1.days.ago.strftime("%d %B %Y")}" :  @report_date%></strong></li>

              <% unless @freshfone_number.blank? %>
                  <li><%=t('reports.freshfone.number')%> : <strong><%=freshfone_numbers.find(@freshfone_number).number_name%></strong></li>
              <%end%>
                <% unless @call_type.blank? || (@call_type.to_i == 0)%>
                <% call_type_str = Freshfone::Call::CALL_TYPE_REVERSE_HASH[@call_type.to_i]%>
                <li><%=t('reports.freshfone.call_type')%> : <strong>
                <%=t("reports.freshfone.options.#{call_type_str}")%></strong></li>
              <%end%>
              <% unless @group_id.empty? %>
                <li><%=t('reports.freshfone.group')%> : <strong><%=@group_id.map{|grp| agent_groups_hash[grp.to_i] }.join(', ')%></strong></li>
              <%end%>
            </ul>
          </div>
          <div class="">
              <!-- report filter name if any -->
          </div>
        </div>
      </div>
    </div>
    <div class="row-fluid  report-summary" id="metric_container">
      <div>
        <h3 class="header-lead"><span><%=t('adv_reports.summary')%> </span></h3>
        <div class="row-fluid report-summary-wrapper">
          <%= render :partial => "call_metrics", :locals => { :calls => @calls, :old_calls => @old_calls } %>
        </div>
      </div>
      <div class="row-fluid control-group">
      <div class="vertical-alignment time-sheet-top-margin">
        <strong><%=t('reports.freshfone.summary_title')%></strong>
      </div>
        <span class="pull-right time-sheet-top-margin">
            <a href="javascript:void(0);" onclick='jQuery("#generate-pdf").trigger("click");' 'id'='export_as_csv'><%=t('export_to_CSV')%></a>
        </span>
      </div>
      <div class="grid report row-fluid"> 
          <table width="100%">
            <tr>
              <% table_headers.keys.each do |header|
                concat content_tag :th, h(table_headers[header]), :class => header
               end %>
            </tr>
            
          <% if @calls.size > 0 %>
              <%= render :partial => "calls", :object => @calls ,:locals=>{:headers => table_headers } %>  

            <%else%>
              <tr>
                <td colspan="<%=table_headers.length%>">            
                <div class="list-noinfo"><%=t('reports.no_data')%></div>
                </td>         
            </tr>
          <%end%>
           
         </table>
      </div>
      <!--end call list-->
    </div>
  </div>
</div>

<!-- Filter Options -->
<div class="report-left-filter" id="report-filter-edit">
<div class="left-filter">    
  <%= render :partial => "reports/freshfone/shared/filter_options"%>
</div>
</div>      
<% javascript_tag do %>

jQuery(document).ready(function(){

    if(jQuery("#report-filter-edit").css('visibility') == 'visible'){
      jQuery('#sliding').slide();
      jQuery('#loading-box').hide();
    }

    jQuery("#cancel").on('click',function(){
        jQuery('#sliding').click();
    });

    //add the link which fire event on close button.
    jQuery("#filter-close-icon").on('click',function(){
        jQuery("#cancel").click();
    });
   
    jQuery("#submit").click(function(ev){
      jQuery("#loading-box").show(); 
      jQuery("#freshfone_summary_report").css('opacity','0.2'); 
      jQuery("#loading-box").css('background','transparent'); 
      jQuery(".reports-loading").css('margin-top','330px'); 
      jQuery.ajax({
          url: '<%=generate_reports_freshfone_summary_reports_url%>',
          type: "POST",
          data: jQuery('#report_filters').serializeArray(),
          success: function(data){ 
              jQuery("#loading-box").hide(); 
              jQuery("#freshfone_summary_report").css('opacity','1'); 
              jQuery("#freshfone_summary_report").removeClass('slide-shadow');
              jQuery("#freshfone_summary_report").html(data);
            }
      });

    });

    jQuery("#export_as_csv").on('click',function(){
        jQuery("#generate-pdf").trigger("click");
    });


});
<% end %>
