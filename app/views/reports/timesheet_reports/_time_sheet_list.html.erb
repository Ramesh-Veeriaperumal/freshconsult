  <div class="report-page time-sheet-summary reports-main" id="report-page" style="background:white">
    <div class="report-content-wrapper" id="">
      <!--report header-->
    <div class="reports-header row-fluid">
      <div class="reports-title span12">
        <span class="report-icon">
          <% unless generate_pdf_action? %>
            <i class="fsize-36 ficon-time_sheet"></i>
          <% end %>
        </span>
        <span class="report-title-block" data-action="pop-report-type-menu" >
          <span class="unsaved_star vertical-alignment hide">*</span>
          <span id="report-title">
            <%=t('helpdesk_reports.timesheet_reports.title')%>
          </span>
          <span class="grey-arrow-down title-dropdown"></span>
        </span>
        <% if current_account.subscription.non_sprout_plan? %>
          <%= render :partial => "reports/shared/save_report_controls.html.erb"%>
        <% end %>
        <!-- PDF link -->
        <% if current_user.privilege?(:export_reports) %>
          <button class="generate-pdf-button" id="export_pdf" name="button" onclick="this.blur();">
            <%= t('helpdesk_reports.export.email_report_pdf')%>
          </button>
        <% end %>
      </div>
      <div class="reports-filter span12" id="report-filter-details">
        <% unless generate_pdf_action? %>
          <div class="span1 edit-filter report-filter-slide-btn">
                        <a class="btn btn-primary" id="metric-edit" data-action="open-filter-menu"><%=t('helpdesk_reports.edit_filter')%></a>
          </div>
        <% end %>
        <div class="filter-type span11">
          <ul id="filter_text">
            <li><%=t('reports.time_sheets.filter_by_title')%>:</li>
            <li><%=t('reports.time_sheets.time_period')%> : <strong><%= @report_date.blank? ? date_range_val((Time.zone.now.ago 30.day),Time.zone.now) :  @report_date%></strong></li>
          </ul>
          <ul id="filter_text_others"></ul>
        </div>
        <div class="reports-menu hide" id="reports_type_menu">

        </div>
      </div><!-- New Header-->
    </div>
      <div class="row-fluid  report-summary" id="metric_container">
      <div>
            <h3 class="header-lead"><span><%=t('adv_reports.summary')%> </span></h3>
        <div class="row-fluid report-summary-wrapper">
          <%=render :partial =>"reports/timesheet_reports/time_sheets_metric.html.erb" %>
        </div>
      </div>
      <% grp_data = [params[:group_by] ? params[:group_by].to_sym : Helpdesk::TimeSheet.group_by_options.first[1]] %>
      <% if generate_pdf_action? %>
        <div class="row-fluid control-group">
          <div class="vertical-alignment">
            <strong><%=t('helpdesk.time_sheets.group_by')%>: </strong>
          </div>
          <div class="vertical-alignment">
            <%= Helpdesk::TimeSheet.group_by_options.select { |ele| ele[0] if ele[1] == params[:group_by].to_sym}[0][0] %>
          </div>
        </div>
      <% else %>
        <!-- Groupby and Export options -->
        <% if @time_sheets.size > 0 %>
            <div class="row-fluid control-group">
                <div class="vertical-alignment">
                  <strong><%=t('helpdesk.time_sheets.group_by')%>: </strong>
                </div>
                <div class="vertical-alignment">
                  <%= select_tag :group_by_field , options_for_select(Helpdesk::TimeSheet.group_by_options,grp_data),
                          { :multiple => false, :class => "select2 filter_item", "data-width" => "150"}%>
                </div>

                <span class="pull-right column-options mt10 mb10">
                    <% if current_user.privilege?(:export_reports) %>
                      <a href="javascript:void(0);" id='export_as_csv'><%=t('export')%></a> <span class="seperatr"> | </span>
                    <% end %>
                    <a href="javascript:void(0)" data-action="show-column-selection"><%=t('reports.time_sheets.pick_columns')%> <i class="ficon-caret-down fsize-16 pick_arrow"></i></a>
                    <div class="picker hide">
                        <div class="lists" rel="column_items"></div>
                        <div class="footer">
                            <span class="limit-error message hide pull-left"> <%=t('helpdesk.time_sheets.max_columns')%></span>
                            <span class="archive-error message hide pull-left"> <%=t('helpdesk.time_sheets.archive_tickets_column_error')%></span>
                            <button data-action="submit-column-selection" class="pull-right btn btn-cancel">
                              <%= t('reports.generate_button') %>
                            </button>
                        </div>
                    </div>
                </span>

            </div>
        <% end %>

      <% end %>
      <% if @time_sheets.size > 0 %>
        <div class="grid_table report row-fluid">
            <table id="timesheet_table" width="100%">
              <thead class="title">
              <%colspan = @headers.length-1%>
              <% master_header_hash = @master_column_header_hash %>
                <% @headers.each do |header|
                  concat content_tag :th, master_header_hash[header].present? ? CGI::unescapeHTML(master_header_hash[header]) : '', :class => header
                 end %>
              </thead>
              <%= render :partial => "reports/timesheet_reports/time_sheet.html.erb", :object => @time_sheets ,:locals=>{:colspan=>colspan,:group_by=>grp_data,:times_spent => @group_count, :group_header => nil, :group_names => @group_names, :load_time => @load_time } %>
           </table>
           <%else%>
                <div class="list-noinfo"><%=t('helpdesk.time_sheets.no_entry')%></div>
           <%end%>
        </div>
        <!--end time_sheet_list-->
      </div>
    </div>
    <% unless generate_pdf_action? %>
          <%= render :partial => "reports/timesheet_reports/filters_revamped.html.erb"%>
    <% end %>
  </div>


   <%= javascript_tag do%>

      Helpkit.locals = Helpkit.locals || {};
      Helpkit.locals.pagination = {};

      Helpkit.locals.pagination['endpoint'] = '<%=time_entries_list_reports_timesheet_url%>';
      Helpkit.locals.pagination['scroll_position'] = 1;
      Helpkit.locals.pagination['load_time'] = "<%= @load_time %>";
      Helpkit.locals.pagination['latest_timesheet_id'] = "<%= @latest_timesheet_id %>";
      Helpkit.locals.pagination['current_group'] = "<%= @current_group %>";
      Helpkit.locals.pagination['previous_group_id'] = "<%= @time_sheets.keys.last %>";
      Helpkit.locals.pagination['previous_entry_id'] = <%= @time_sheets.values.flatten.last ? @time_sheets.values.flatten.last.id : 0 %>;
      Helpkit.locals.pagination['group_count'] = <%= @group_count.to_json.html_safe %>;
      Helpkit.locals.pagination['group_names'] = <%= @group_names.to_json.html_safe %>;
      Helpkit.locals.pagination['total_row_count'] = <%= @row_count %>;
      Helpkit.locals.pagination['row_count'] = 90;
      //Helpkit.locals.pagination['totaltime'] = <%= @group_count.values.sum %>;
      Helpkit.locals['current_params'] = {current_params: <%= @current_params.to_json.html_safe %>};
      Helpkit.locals.headers = <%= @headers.to_json.html_safe %>;
      Helpkit.locals.colspan = <%= colspan %> - 1;

      Helpkit.TimesheetInitializer.init();
      jQuery(document).ready(function(){
        jQuery('#loading-box').hide();
        if(jQuery("#report-filter-edit").css('visibility') == 'visible'){
          jQuery('#sliding').slide();
          jQuery('#loading-box').hide();
        }
      });
   <% end %>

