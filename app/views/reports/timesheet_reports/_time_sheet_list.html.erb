	<div class="report-page time-sheet-summary reports-main" id="report-page" style="background:white">
		<div class="report-content-wrapper" id="">
	    <!--report header-->
	 	<div class="reports-header row-fluid">
		 	<div class="reports-title span12">
				<span class="report-icon">
					<% unless generate_pdf_action? %>
						<i class="fsize-36 ficon-time_sheet"></i>
					<% end %>
				</span>
				<span class="report-title-block" data-action="pop-report-type-menu" >
					<span class="unsaved_star vertical-alignment hide">*</span>
					<span id="report-title">
						<%=t('helpdesk_reports.timesheet_reports.title')%>
					</span>
					<span class="grey-arrow-down title-dropdown"></span>
				</span>
				<% if current_account.subscription.non_sprout_plan? %>
					<%= render :partial => "reports/shared/save_report_controls.html.erb"%>
				<% end %>
				<!-- PDF link -->
			</div>
			<div class="reports-filter span12" id="report-filter-details">
				<% unless generate_pdf_action? %>
					<div class="span1 edit-filter report-filter-slide-btn">
					              <a class="btn btn-primary" href="#report-filter-edit" data-parent="#report-page" id="sliding">Edit</a>
					</div>
				<% end %>
				<div class="filter-type span11">
					<ul id="filter_text">
						<li><%=t('reports.time_sheets.filter_by_title')%>:</li>
						<li><%=t('reports.time_sheets.time_period')%> : <strong><%= @report_date.blank? ? date_range_val((Time.zone.now.ago 30.day),Time.zone.now) :  @report_date%></strong></li>
					</ul>
					<ul id="filter_text_others"></ul>
				</div>
				<div class="reports-menu hide" id="reports_type_menu">

				</div>
			</div><!-- New Header-->
		</div>
	    <div class="row-fluid  report-summary" id="metric_container">
      <div>
      			<h3 class="header-lead"><span><%=t('adv_reports.summary')%> </span></h3>
	 			<div class="row-fluid report-summary-wrapper">
					<%=render :partial =>"reports/timesheet_reports/time_sheets_metric.html.erb" %>
				</div>
			</div>
			<% grp_data = Helpdesk::TimeSheet.group_by_options.collect {|grp| grp[1] if !(@headers.include?(grp[1])) } %>
			<% if generate_pdf_action? %>
				<div class="row-fluid control-group">
					<div class="vertical-alignment">
						<strong><%=t('helpdesk.time_sheets.group_by')%>: </strong>
					</div>
					<div class="vertical-alignment">
						<%= Helpdesk::TimeSheet.group_by_options.select { |ele| ele[0] if ele[1] == params[:group_by].to_sym}[0][0] %>
					</div>
				</div>
			<% else %>
			<div class="row-fluid control-group">
				<div class="vertical-alignment">
					<strong><%=t('helpdesk.time_sheets.group_by')%>: </strong>
				</div>
				<div class="vertical-alignment">
					<%= select_tag :group_by_field , options_for_select(Helpdesk::TimeSheet.group_by_options,grp_data),
									{ :multiple => false, :class => "select2 filter_item"}%>
				</div>
				<span class="pull-right time-sheet-top-margin">
				    <a href="javascript:void(0);" onclick='jQuery("#generate-pdf").trigger("click");' 'id'='export_as_csv'><%=t('export_to_CSV')%></a>
			  </span>
			</div>
			<% end %>
				<div class="grid report row-fluid">	
						<table width="100%">
							<tr>
							<%colspan = 8%>
							  <% @headers.each do |header|
								 	concat content_tag :th, h(Helpdesk::TimeSheet.report_list[header]), :class => header
								 end %>
							</tr>
							
					 	<% if @time_sheets.size > 0 %>
							<%= render :partial => "reports/timesheet_reports/time_sheet.html.erb", :object => @time_sheets ,:locals=>{:colspan=>colspan,:group_by=>grp_data} %>
					    <%else%>
						    <tr>
						    	<td colspan="<%=(colspan+1)%>">		    		
									<div class="list-noinfo"><%=t('helpdesk.time_sheets.report.no_timeentry')%></div>
						    	</td>		      
							</tr>
						<%end%>
				     
				   </table>
				</div>
				<!--end time_sheet_list-->
			</div>
		</div>
	</div>
		<% unless generate_pdf_action? %>
			<div class="report-left-filter" id="report-filter-edit">
				<div class="left-filter">    
					<%= render :partial => "reports/timesheet_reports/filter_options.html.erb"%>
				</div>
			</div>			
		<% end %>
	
   <%= javascript_tag do%>
   	 try{
   	   total_mins = $$("strong.group_time")
	 					.collect(function(t){ return t.innerHTML })
						.inject(0, function(acc, n){
							hm = n.split(':');
							return parseInt(acc) + hm[0]*60 + parseInt(hm[1]);
						});
		hours = parseInt(total_mins/60);
		mins = total_mins%60;						
		hour_val = (jQuery.trim(hours).length === 1) ? '0' + hours : hours;
	   $("totaltime").innerHTML = hour_val+":"+sprintf("%02f",mins);
	  }catch(e){}	 
		jQuery(document).ready(function(){
			 	if(jQuery("#report-filter-edit").css('visibility') == 'visible'){
		      jQuery('#sliding').slide();
				  jQuery('#loading-box').hide();
				}
			jQuery('#group_by_field').change(function(){
					jQuery('#group_by').val(jQuery('#group_by_field').val());
					jQuery("#submit").trigger("click");
			});
 	  	
 	  	jQuery("#cancel").on('click',function(){
      		jQuery('#sliding').click();
  		});

	    //add the link which fire event on close button.
	    jQuery("#filter-close-icon").on('click',function(){
	      	jQuery("#cancel").click();
    	});
    
    	jQuery("#submit").click(function(ev){
	   		jQuery("#loading-box").show(); 
	   		jQuery("#time_sheet_report").css('opacity','0.2'); 
	   		jQuery("#loading-box").css('background','transparent'); 
	   		jQuery(".reports-loading").css('margin-top','330px');
	   		setFilterText();

    		jQuery.ajax({
		        url: '<%=report_filter_timesheet_reports_url%>',
		        type: "POST",
		        data: jQuery('#report_filters').serializeArray(),
		        success: function(data){ 
		      	 		jQuery("#loading-box").hide(); 
		      	 		jQuery("#time_sheet_report").css('opacity','1'); 
		      	 		jQuery("#time_sheet_report").removeClass('slide-shadow');
		      	 		//Markup replaced on submit so copy and re insert
		      	 		var save_menu = jQuery('#reports_type_menu').html();
		      	 		var title_block = jQuery('#report-title').html();
		      	 		var filter_block = jQuery("#filter_text_others").html();

		      	 		jQuery("#time_sheet_report").html(data);
		      	 		jQuery('#reports_type_menu').html(save_menu);
		      	 		jQuery('#report-title').html(title_block);
		      	 		jQuery("#filter_text_others").html(filter_block);
		      	 		trigger_event("report_refreshed",{});
		        	}
				});

			});

		jQuery(".proxy-generate-pdf").click(function(ev){
			jQuery("#report_filters").attr("action","<%= generate_pdf_timesheet_reports_url%>" );
			jQuery("#report_filters").attr("target", "_blank");
			jQuery("#generate_pdf_submit").trigger("click");
			jQuery("#report_filters").attr("action", "<%= export_csv_timesheet_reports_url %>");
			jQuery("#report_filters").removeAttr("target");
		});
		
			jQuery("#export_as_csv").on('click',function(){
					jQuery("#generate-pdf").trigger("click");
 			});
		
		});

		jQuery('#report-page').on('click.helpdesk_reports', '[data-action="pop-report-type-menu"]', function (event) {
	            event.stopImmediatePropagation();
	           var menu = jQuery('#reports_type_menu');
	            if (!menu.is(':visible')) {
	                menu.removeClass('hide');
	            } else {
	                menu.addClass('hide');
	            }
        });
   <% end %>	
