	<div class="report-page time-sheet-summary" id="report-page" style="background:white">
		<div class="report-content-wrapper" id="">
	    <!--report header-->
			<div class="row-fluid report-header">
			  <div class="row-fluid">
			    <div class="span12 report-header-content">
			      <div class="span7">
			      	<% unless generate_pdf_action? %>
			          <img src="/images/reports/report-icon.png" alt="" class="vertical-alignment report-header-icon">
			        <% end %>
			        <div class="vertical-alignment report-inner-heading">
			          <h1 class="lead" id="report_header_title"><%=t('reports.timesheet_reports.index.title')%></h1>
			          <p class="muted" id="report_header_date"><%=@report_date%></p>
			        </div>
			      </div>
			    </div>
			  </div>
				<div class="row-fluid">
			  	<div class="report-filter span12" id="report-filter-details">
			  		<% unless generate_pdf_action? %>
				    <div class="vertical-alignment report-filter-slide-btn">
				              <a class="btn btn-primary" href="#report-filter-edit" data-parent="#report-page" id="sliding">Edit</a>
				    </div>
				    <% end %>
					  <div class="filter-container">
						  <ul class="inline" id="filter_container">
						  	<li><%=t('reports.time_sheets.filter_by_title')%>:</li>
						  	<li><%=t('reports.time_sheets.time_period')%> : <strong><%= @report_date.blank? ? date_range_val((Time.zone.now.ago 30.day),Time.zone.now) :  @report_date%></strong></li>
						  </ul>
						  </ul>
					  </div>
					 	<div class="">
					  		<!-- report filter name if any -->
					  </div>
					</div>
				</div>
	 		</div>
	    <div class="row-fluid  report-summary" id="metric_container">
      <div>
        <h3 class="header-lead"><span><%=t('adv_reports.summary')%> </span></h3>
	 			<div class="row-fluid report-summary-wrapper">
					<%=render :partial =>"time_sheets_metric" %>
				</div>
			</div>
			<% if generate_pdf_action? %>
				<% grp_data = [] %>
				<div class="row-fluid control-group">
					<div class="vertical-alignment">
						<strong><%=t('helpdesk.time_sheets.group_by')%>: </strong>
					</div>
					<div class="vertical-alignment">
						<%= Helpdesk::TimeSheet.group_by_options.select { |ele| ele[0] if ele[1] == params[:group_by].to_sym}[0][0] %>
					</div>
				</div>
			<% else %>
			<div class="row-fluid control-group">
				<div class="vertical-alignment">
					<strong><%=t('helpdesk.time_sheets.group_by')%>: </strong>
				</div>
				<div class="vertical-alignment">
					<% grp_data = Helpdesk::TimeSheet.group_by_options.collect {|grp| grp[1] if !(@headers.include?(grp[1])) } %>
								<%= select_tag :group_by_field , options_for_select(Helpdesk::TimeSheet.group_by_options,grp_data),
									{ :multiple => false, :class => "select2 filter_item"}%>
				</div>
				<span class="pull-right time-sheet-top-margin">
				    <a href="javascript:void(0);" onclick='jQuery("#generate-pdf").trigger("click");' 'id'='export_as_csv'><%=t('export_to_CSV')%></a>
			  </span>
			</div>
			<% end %>
				<div class="grid report row-fluid">	
						<table width="100%">
							<tr>
							<%colspan = 8%>
							  <% @headers.each do |header|
								 	concat content_tag :th, h(Helpdesk::TimeSheet.report_list[header]), :class => header
								 end %>
							</tr>
							
					 	<% if @time_sheets.size > 0 %>
				     		<%= render :partial => "time_sheet", :object => @time_sheets ,:locals=>{:colspan=>colspan,:group_by=>grp_data} %>	
							<tr>
				       			<th colspan="<%=colspan%>" class="align-right">&nbsp;<%=t('helpdesk.time_sheets.report.total')%></th>
				       			<th class="hours"><div id="totaltime"></div></th>
				     		</tr>
					    <%else%>
						    <tr>
						    	<td colspan="<%=(colspan+1)%>">		    		
									<div class="list-noinfo"><%=t('helpdesk.time_sheets.report.no_timeentry')%></div>
						    	</td>		      
							</tr>
						<%end%>
				     
				   </table>
				</div>
				<!--end time_sheet_list-->
			</div>
		</div>
	</div>
		<% unless generate_pdf_action? %>
			<div class="report-left-filter" id="report-filter-edit">
				<div class="left-filter">    
					<%= render :partial => "reports/timesheet_reports/filter_options"%>
				</div>
			</div>			
		<% end %>
	
   <% javascript_tag do%>
   	 try{
   	   total_mins = $$("strong.group_time")
	 					.collect(function(t){ return t.innerHTML })
						.inject(0, function(acc, n){
							hm = n.split(':');
							return parseInt(acc) + hm[0]*60 + parseInt(hm[1]);
						});
		hours = parseInt(total_mins/60);
		mins = total_mins%60;						
		hour_val = (jQuery.trim(hours).length === 1) ? '0' + hours : hours;
	   $("totaltime").innerHTML = hour_val+":"+sprintf("%02f",mins);
	  }catch(e){}	 
		jQuery(document).ready(function(){
			 	if(jQuery("#report-filter-edit").css('visibility') == 'visible'){
		      jQuery('#sliding').slide();
				  jQuery('#loading-box').hide();
				}
			jQuery('#group_by_field').change(function(){
					jQuery('#group_by').val(jQuery('#group_by_field').val());
					jQuery("#submit").trigger("click");
			});
 	  	
 	  	jQuery("#cancel").on('click',function(){
      		jQuery('#sliding').click();
  		});

	    //add the link which fire event on close button.
	    jQuery("#filter-close-icon").on('click',function(){
	      	jQuery("#cancel").click();
    	});
    
    	jQuery("#submit").click(function(ev){
	   		jQuery("#loading-box").show(); 
	   		jQuery("#time_sheet_report").css('opacity','0.2'); 
	   		jQuery("#loading-box").css('background','transparent'); 
	   		jQuery(".reports-loading").css('margin-top','330px'); 
    		jQuery.ajax({
		        url: '<%=report_filter_timesheet_reports_url%>',
		        type: "POST",
		        data: jQuery('#report_filters').serializeArray(),
		        success: function(data){ 
		      	 		jQuery("#loading-box").hide(); 
		      	 		jQuery("#time_sheet_report").css('opacity','1'); 
		      	 		jQuery("#time_sheet_report").removeClass('slide-shadow');
		      	 		jQuery("#time_sheet_report").html(data);
		        	}
				});

			});

		jQuery(".proxy-generate-pdf").click(function(ev){
			jQuery("#report_filters").attr("action","<%= generate_pdf_timesheet_reports_url%>" );
			jQuery("#report_filters").attr("target", "_blank");
			jQuery("#generate_pdf_submit").trigger("click");
			jQuery("#report_filters").attr("action", "<%= export_csv_timesheet_reports_url %>");
			jQuery("#report_filters").removeAttr("target");
		});
		
			jQuery("#export_as_csv").on('click',function(){
					jQuery("#generate-pdf").trigger("click");
 			});
		
		});

   <% end %>	
