<% unless current_portal.preferences.nil? %>
	$background: 	<%= current_portal.preferences[:bg_color] %>;
	$header_color: 	<%= current_portal.preferences[:header_color] %>;
	$tab_color:		<%= current_portal.preferences[:tab_color] %>;
	
	$bg_ctxt_color:	    if(lightness($background) > 50, black, white) !default;
	$header_ctxt_color: if(lightness($header_color) > 50, black, white) !default;
	$tab_ctxt_color:	if(lightness($tab_color) > 50, black, white) !default;
	$subtxt_color: if(lightness($background) > 50, #222, #EEE) !default;
	$alternate_txt_color: if(lightness($background) > 50, white, black) !default;
	$alternate_bg_color: if(lightness($background) > 50, #666, #AAA) !default;

	    
	body { background: $background; }
	.sp_border, .pagearea, .sidepanel, .flash_info,  #errorExplanation { border-color: darken($background, 15%); }
	.reminders:before { border-color:$background $background #734e3d #734e3d; }
		
	/* Header color */
	.header { background-color: $header_color; }
	.brand .logo_text, .header_links, .header_links a, .header_links a:hover, .ui-widget-header { color: $header_ctxt_color; }
	.header_links a.nav-trigger:before { border-top-color: $header_ctxt_color; }
	.brand .logo_text { border-color:rgba($header_ctxt_color, 0.3); }
	a.new_ticket, .nav_search div.search_bar { border-color:darken($tab_color, 8%); }
		 
	/* Tab color settings */
	.top_nav_bg { background: $tab_color; }
	
	.theme-tab, .title-highlight{ background-color: $tab_color; color: $tab_ctxt_color;  }
	.theme-tab:before{ border-left-color: $tab_color; }
	
	
	input:focus, textarea:focus{ border-color: $tab_color !important; }
	input:focus, select:focus, textarea:focus{ 
		  -moz-box-shadow: $tab_color 0 0 3px;
		  -webkit-box-shadow: $tab_color 0 0 3px;
		  box-shadow: $tab_color 0 0 3px;
	}
		
	ul.header-tabs li.active a, ul.header-tabs li.active a:hover { background: $background; color: $bg_ctxt_color; }
	ul.header-tabs li a  { color: $tab_ctxt_color; }
	ul.header-tabs li a:hover { background: lighten($tab_color, 3%);  color: $tab_ctxt_color; }
		
	.uiButton:hover, .forum_button:hover, .ui-state-hover, .ui-widget-content .ui-state-hover, 
	.ui-widget-header .ui-state-hover, .ui-state-focus, .ui-widget-content .ui-state-focus, .ui-widget-header .ui-state-focus, .special.uiButton:hover  {
		 background-color:$tab_color; 
		 border-color: darken($tab_color, 20%);  
		 color:$tab_ctxt_color; 
	}
	
	.special.uiButton, .uiButton.disabled, .uiButton.disabled:hover{ 
	   background-color:darken($tab_color, 6%); 
	   border-color: darken($tab_color, 13%); 
	   color:$tab_ctxt_color;  
	} 
	.footerContent, .footerContent a{ color:$bg_ctxt_color; border-color:$bg_ctxt_color;  }
	.footerContent a:hover{ color:$bg_ctxt_color; }
	.iphone-inactive.uiButton{
		background-color:#e7e7e7;
		color:#7f7f7f;
		border-color:#a4a4a4;
		text-shadow: 0 0 0 rgba(0, 0, 0, 0);
	}

	.ticket-leftcol h3.title, .ticket-leftcol h4.title, .contentCol .view_filters .link-item .nav-trigger {
		color:$bg_ctxt_color;
	}

	.ticket-leftcol .leftFilter .item, .drop-right {
		color:$subtxt_color;	
	}

	.drop-right:hover {
		color: $alternate_txt_color;
		background-color: $alternate_bg_color;
	}

	.contentCol .view_filters .link-item .nav-trigger.selected, .contentCol .view_filters .link-item .nav-trigger:hover,  .drop-right.selected, .drop-right.selected *  {
		color: $alternate_txt_color;
		background-color: $alternate_bg_color;
	}
	.sort-bar {
		color:$subtxt_color;	
	}

	#view_manage_links a, #save_filter {
	color: invert($background);
}
<% end %>