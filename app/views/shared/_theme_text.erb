<% if current_portal.preferences.present? %>
	$background: 	<%= current_portal.preferences[:bg_color] %>;
	$header_color: 	<%= current_portal.preferences[:header_color] %>;
	$tab_color:		<%= current_portal.preferences[:tab_color] %>;
	
	$bg_ctxt_color:	    if(lightness($background) > 50, black, white) !default;
	$header_ctxt_color: if(lightness($header_color) > 50, black, white) !default;
	$tab_ctxt_color:	if(lightness($tab_color) > 50, black, white) !default;
	$subtxt_color: if(lightness($background) > 50, #222, #EEE) !default;
	$subtxt_hover_color: if(lightness($background) > 50, #000, #FFF) !default;
	$alternate_txt_color: if(lightness($background) > 50, white, black) !default;
	$alternate_bg_color: if(lightness($background) > 50, #666, #AAA) !default;

	$lightness_val: lightness($header_color);
	
	$lightness_val: lightness($header_color);
	
	//$loading_color: darken($header_color, 10%);
	$loading_color: rgba(60,60,60,0.2);

	@if $lightness_val < 10 {
		$loading_color: rgba(255,255,255,0.8)
	 	//$loading_color: lighten($header_color, 20%);
	} @else if $lightness_val < 50 {
		$loading_color: rgba(255,255,255,0.6)
	 	//$loading_color: lighten($header_color, 15%);
	}



	$filterTextShadow: if(lightness($background) > 50, #FFF 1px 1px 0, #333 -1px -1px 0) !default;

	body { background: $background; }
	
	.sp_border, #errorExplanation { 
		border-color: darken($background, 15%); 
	}
	
	/* ------------------------------------------------------------------------------------------- */
	/* 										 Footer Styles 										   */
	/* ------------------------------------------------------------------------------------------- */

	.footer{
		color:$bg_ctxt_color;
	}
	/* ------------------------------------------------------------------------------------------- 	*/
	/* 											Header color 										*/
	/* ------------------------------------------------------------------------------------------- 	*/	

	.header { background-color: $header_color; }
	.brand .logo_text, .header_links, .header_links a, .header_links a:hover, .ui-widget-header { 
		color: $header_ctxt_color; 
	}
	.header_links a.nav-trigger:before { border-top-color: $header_ctxt_color; }
	.header-link-wrapper{
		border-color: $header_ctxt_color;
   		border-color: rgba($header_ctxt_color, .2);
	}
	.header-link-wrapper a img.header-spinner{
		background: linear-gradient(rgba($header_ctxt_color,0.3) 50%, rgba($header_ctxt_color,0.5) 50%), linear-gradient(rgba($header_ctxt_color,0.5) 50%, rgba($header_ctxt_color,0.3) 50%);
		background-position: 0 0,100% 0;
	    background-size: 53% 101%;
	    background-repeat: no-repeat;
	}
	.brand .logo_text { border-color:rgba($header_ctxt_color, 0.3); }
	.nav_search div.search_bar { border-color:darken($tab_color, 8%); } 

	/* -------------------------------------------------------------------------------------------  */
	/* 										Tab color settings 										*/
	/* -------------------------------------------------------------------------------------------  */

	.top_nav_bg { background: $tab_color; }
	
	.theme-tab, .title-highlight{ background-color: $tab_color; color: $tab_ctxt_color;  }
	.theme-tab:before{ border-left-color: $tab_color; }	
	
	input:focus, textarea:focus{ border-color: $tab_color; }
	input:focus, select:focus, textarea:focus{ 
		  -moz-box-shadow: $tab_color 0 0 3px;
		  -webkit-box-shadow: $tab_color 0 0 3px;
		  box-shadow: $tab_color 0 0 3px;
	}
	a.new_ticket, ul.header-tabs li a  { color: $tab_ctxt_color; }
	ul.header-tabs li a:hover { background: lighten($tab_color, 3%);  color: $tab_ctxt_color; }
	a.new_ticket:hover{ color: lighten($tab_ctxt_color, 3%); }
	/* -------------------------------------------------------------------------------------------  */
	/* 										Common settings 										*/
	/* -------------------------------------------------------------------------------------------  */

	.uiButton:hover, .forum_button:hover, .ui-state-hover, .ui-widget-content .ui-state-hover, 
	.ui-widget-header .ui-state-hover, .ui-state-focus, .ui-widget-content .ui-state-focus, .ui-widget-header .ui-state-focus, .special.uiButton:hover  {
		 background-color:$tab_color; 
		 border-color: darken($tab_color, 20%);  
		 color:$tab_ctxt_color; 
	}      
	.reminders:before { 
		border-color:$background $background #734e3d #734e3d; 
	}
	.ticket-leftcol h3.title, .ticket-leftcol h4.title,  .view_filters .link-item .nav-trigger {
		color:$bg_ctxt_color;
	}

	.view_filters .link-item .nav-trigger {
		text-shadow: $filterTextShadow;
	}

	.ticket-leftcol .leftFilter .item, .drop-right {
		color:$subtxt_color;	
	}

	.ticket-leftcol .leftFilter .item:hover span{
		color:$subtxt_hover_color;
	}

	.drop-right:hover,  .view_filters .link-item .nav-trigger.selected,  .view_filters .link-item .nav-trigger:hover,  .drop-right.selected, .drop-right.selected *  {
		color: $subtxt_color;
		
	}
	.sort-bar {
		color:$subtxt_color;	
	}

	#view_manage_links a, #save_filter {
		color: invert($background);
	}
	/* ------------------------------------------------------------------------------------------- */
	/* 										Button settings 									   */
	/* ------------------------------------------------------------------------------------------- */

	.special.uiButton, .uiButton.disabled, .uiButton.disabled:hover{ 
	   background-color:darken($tab_color, 6%); 
	   border-color: darken($tab_color, 13%); 
	   color:$tab_ctxt_color;  
	}
	.iphone-inactive.uiButton{
		background-color:#e7e7e7;
		color:#7f7f7f;
		border-color:#a4a4a4;
		text-shadow: 0 0 0 rgba(0, 0, 0, 0);
	}
<% end %>