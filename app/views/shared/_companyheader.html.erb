<% content_for :onload_script do %>
	
	jQuery("#customers-select-all").on("change", function(ev){
		jQuery("#contacts-table .customers_selector, #companies .customers_selector")
			.not('[disabled]')
			.prop("checked", this.checked)
			.parents("tr").toggleClass("diffColor", this.checked);

		jQuery("#customers-toolbar .bulk-action .btn")
			.attr('disabled',!this.checked);
	});


	jQuery('.customers_selector').on("change", function(ev){
		jQuery(this).parents("tr").toggleClass("diffColor", this.checked);

		if(jQuery('.customers_selector:checked').length == 0 )
			jQuery("#customers-toolbar .bulk-action .btn").attr('disabled','disabled');
		else
			jQuery("#customers-toolbar .bulk-action .btn").removeAttr('disabled');

		jQuery("#customers-select-all")
			.prop('checked', jQuery('.customers_selector:checked').length == jQuery('.customers_selector').length);
	});
	jQuery('.send-activation').on('ajax:success', function (ev, data) {
		var _self = jQuery(this);
		console.log(data.activation_sent);
		if(data.access_denied){ 
			_self.html("Access denied");
		}
		setTimeout(function(){
			_self.twipsy('hide');
			_self.addClass("disabled");
		}, 10);
	})
<% end %>
<%= javascript_tag do%>
jQuery(document).ready(function(){
  jQuery("#segment-flash-close").click(function(ev){
    jQuery("#segment-notice").fadeOut(600);
    sessionStorage.setItem("segment-notice", "closed");
  });

  if(sessionStorage.getItem("segment-notice") == "closed")
  {
    jQuery("#segment-notice").remove();
  }
  else
  {
    jQuery("#segment-notice").fadeIn(600);
  }
});
<% end %>
<div class="list-page-header">
  <%if current_account.segments_enabled?%>
    <div id = "segment-notice" class="info-highlight fs-notify notice alert-with-close alert-text hide segment-flash">
      <span><%=t('segment_notice')%> <a href = "/enable_falcon" data-method='post' rel='nofollow'><%=t('mint')%></a></span>
      <a id = "segment-flash-close" class = "close"></a>
    </div>
  <%end%>
	<div class="row-fluid">
		<div class="span4"><h3 class="lead"><%= @page_title = t('customers') %></h3></div>
		 <div class="span8 pull-right pagination-right header_buttons align-right" >
		 	<% if privilege?(:export_customers) %>
				<%= link_to t('export'), {:action => "configure_export"}, 
					:rel => "freshdialog", 
					"data-submit-label" => t('export'),
					"data-width" => "700",
					"data-title" => t('contacts.export_title', :type => type.capitalize.pluralize),
					:title => t('contacts.export_title', :type => type.capitalize.pluralize),
					"data-close-label" =>  t('cancel') ,
					"data-submit-loading" => t('please_wait'),
					"data-target"=>"#customer_export" %>
			<% end %>
			<%if type == 'contact' && privilege?(:manage_contacts)%>
        &middot;  
          <%= link_to(t('import'), "/imports/contact", :'data-pjax' => "#body-container", :title => t('customer_import.import_csv', :type => 'Contacts'), :class => "", :id => "customers_import") %>
      <%elsif type == 'company' && privilege?(:manage_companies)%>
        &middot;
          <%= link_to(t('import'), "/imports/company", :'data-pjax' => "#body-container", :title => t('customer_import.import_csv', :type => 'Companies'), :class => "", :id => "customers_import") %>
      <%end%> 
      <%if privilege?(:manage_contacts)%>
        <%= link_to(t('contacts.new'), new_contact_url, :class => "margin-left btn", :'data-pjax' => "#body-container") %>
      <%end%>
      <%if privilege?(:manage_companies)%>
        <%= link_to t('company.new'), new_company_path, :class => "margin-left btn", :'data-pjax' => "#body-container" %>
      <%end%>
        </div>
	</div>
</div>
<%= contact_tabs type %>