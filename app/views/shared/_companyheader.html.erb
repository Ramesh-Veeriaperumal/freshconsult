<% content_for :onload_script do %>
	
	jQuery("#customers-select-all").live("change", function(ev){
		jQuery("#contacts-table .customers_selector, #companies .customers_selector")
			.not('[disabled]')
			.prop("checked", this.checked)
			.parents("tr").toggleClass("diffColor", this.checked);

		jQuery("#customers-toolbar .bulk-action .btn")
			.attr('disabled',!this.checked);
	});


	jQuery('.customers_selector').live("change", function(ev){
		jQuery(this).parents("tr").toggleClass("diffColor", this.checked);

		if(jQuery('.customers_selector:checked').length == 0 )
			jQuery("#customers-toolbar .bulk-action .btn").attr('disabled','disabled');
		else
			jQuery("#customers-toolbar .bulk-action .btn").removeAttr('disabled');

		jQuery("#customers-select-all")
			.prop('checked', jQuery('.customers_selector:checked').length == jQuery('.customers_selector').length);
	});

	jQuery('.send-activation').one("click", function(ev) {
    	ev.preventDefault();
    	jQuery(this).button("loading")
    	var _o_data = jQuery(this).data(),
    	    _href = jQuery(this).data("url"),
			_self = jQuery(this),
			_post_data = { 
				"_method" : jQuery(this).data("method")
			}
		jQuery.ajax({
			type: 'POST',
			url: _href,
			data: _post_data,
			dataType: "json",
			success: function(data){		
				if(data.access_denied){ 
					_self.button("reset").html("Access denied")
				}

				if(data.activation_sent)
					_self.button("complete")
					setTimeout(function(){
						_self.addClass("disabled")
					}, 10);
			}
		})
	});
<% end %>
<div class="list-page-header"	>
	<div class="row-fluid">
		<div class="span6"><h3 class="lead"><%= @page_title = t('customers') %></h3></div>
		 <div class="span6 pull-right pagination-right header_buttons align-right" >
			<%= link_to t('export'), {:action => "configure_export"}, 
				:rel => "freshdialog", 
				"data-submit-label" => t('export'),
				"data-width" => "550",
				"data-title" => t('contacts.export_title', :type => type.capitalize.pluralize),
				:title => t('contacts.export_title', :type => type.capitalize.pluralize),
				"data-submit-loading" => t('please_wait'),
				"data-target"=>"#customer_export" %>
			<% if privilege?(:manage_contacts) %>
				&middot;  
  		 	<%= link_to(t('import'), csv_contact_import_path, :title => t("contacts.import_csv"), :class => " margin-right", :id => "contacts_import") %>
  			<div style="display:none;"><%= link_to(t('contacts.import_google'), google_contact_import_path, :class => "uiButton grey") %></div>
  			<%= link_to t('company.new'), new_company_path, :class => "btn" %>			
  			<%= link_to(t('contacts.new'), new_contact_url, :class => "btn") %>
			<% end %>      
        </div>
	</div>
</div>
<%= contact_tabs type %>
