<div class="loading-box" id="loading-box" style="display: none"> 
	<div class="reports-loading sloading loading-small loading-left repo generate-hd-reports">Searching</div> 
</div>
<% content_for :layoutType do %>search-page<% end %>
<% if current_account.features?(:advanced_search) %>
<div class="search-sticky">
<% else %>
  <div id="sticky_header" class="search-sticky" data-scroll-top="true">
    <% end %>
	<%= form_tag("/search/#{current_filter}", {:method => :get, :class => "search-form"}) do %>
		<span class="search-dark"></span>
		<input class="search-input lead" value="<%= @search_key %>" 
				placeholder="Search" autocomplete="off" name="term" />
	<% end %>
	<div class="search-sorting-wrapper">
		<div class="row-fluid">
		    <div class="span4" id='search-sort-menu'>
				<%= render :partial => '/search/search_sort_menu_dropdown' %>
			</div>
			<div class="span7 menu-list pull-right">
				<ul class="inline pull-right nav nav-tabs">
					<%= search_filter_tabs %>
				</ul>
			</div>
			<div class="clear"></div>
		</div>
	</div>
</div>
<% unless @search_results.blank? %>
	<!-- Pane for filtered search for tickets -->
	<% if current_filter.eql?('tickets') %>
		<%= render :partial => '/search/filter_pane' %>
	<% end %>

	<div class="result-wrapper" id="result-wrapper">
		<%= render :partial => '/search/result_wrapper' %>
	</div>
<% else %>
	<div class="big-info">
	  <div class="no-info-text">
			<%= t('search.no_matching_results', :search_key => h(@search_key)).html_safe %>
	  </div>
	</div>
<% end %>

<script type="text/javascript">
jQuery('body').one('assetLoaded.fjax', function() {
	App.AdvancedSearch = {};
	SEARCH_RESULTS_PAGE = {
		data : <%= @result_json.html_safe %>,
		initializeSearchPageDefaults : function(){
			window['search_page'] = new window.SearchResults();
			window['search_page'].asyncRender();
		}
	}
	SEARCH_RESULT_LANG = {
								agent : "<%= t('search.agent') %>",
								status: "<%= t('search.status') %>",
								by	: "<%= t('search.by') %>",
								in : "<%= t('search.in') %>",
								phone : "<%= t('search.phone') %>",
								priority: "<%= t('filter_options.priority') %>:",
								group: "<%= t('Group') %>:"
							}
	SEARCH_RESULTS_PAGE.is_tickets_page = <%= current_filter.eql?('tickets') %>
	App.AdvancedSearch.time_zone = '<%= @account_time_zone %>'; 
	App.AdvancedSearch.is_adv_search_feature_enabled = <%= current_account.has_feature?(:advanced_search) %>;
	App.AdvancedSearch.is_advanced_search_bulk_actions_feature_enabled = <%= current_account.has_feature?(:advanced_search_bulk_actions) %>;
	App.AdvancedSearch.has_bulk_action_privilege = <%= privilege?(:edit_ticket_properties) || privilege?(:reply_ticket) %>
	SEARCH_RESULTS_PAGE.initializeSearchPageDefaults();
	<% if current_filter.eql?('tickets') %>
		App.FilterOps.Filters.locals.search_fields_hash = <%= @filter_fields.to_json.html_safe %>;
		App.FilterOps.Filters.bindSearchFilterEvents(window['search_page']);
	<% end %>
});
</script>
