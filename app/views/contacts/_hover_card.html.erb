<% user ||= @user %>
<% show_recent_tickets ||= :filter %>
<% link_target = local_assigns.has_key?(:new_tab) ? "_blank" : "_self"  %>
<div class="contact_hover">
    <%= user_avatar(user) %>
  <div class="infoblock muted">
    <%= content_tag :div, link_to(h(user.display_name), user, :target => link_target), :class => "user_name"%>
    <% if user.parent.present? %>
      <div class="contact-append">
        <%= t('contacts.merged_into') %> <%= link_to h(user.parent.name), contact_path(user.parent_id), :class => "hover-contact-box" , :target => link_target if local_assigns.has_key? :new_tab %>
      </div>
    <% else %>
      <div class="user_design">
        <%= render :partial => "helpdesk/tickets/components/company_info", :locals => { :user => user } %>
        <% if feature?(:gamification) and feature?(:gamification_enable) and user.agent? %>
          <%= content_tag :div, h(user.agent.level.name) unless user.agent.level.blank? %>
        <% end %>
      </div>

      <% unless user.email.blank? %>
        <div class="contact-append">
          <span class="add-on"><i class="product-email-logo"></i></span>
          <%= content_tag :a, h(user.email), :class => "hover-contact-box lowercase" %>
        </div>
      <% end %>

      <% unless user.phone.blank? %>
        <div class="contact-append">
          <span class="add-on"><i class="product-call"></i></span>
          <%= can_make_calls(user.phone, "hover-contact-box")%>
        </div>
      <% else %>
        <% unless user.mobile.blank? %>
          <div class="contact-append">
            <span class="add-on"><i class="product-call"></i></span>
            <%= can_make_calls(user.mobile, "hover-contact-box")%>
          </div>
        <% end %>
      <% end %>
      <% unless user.email.present? and user.phone.present? and user.mobile.present? %>
        <% unless user.twitter_id.blank? %>
          <div class="contact-append">
            <span class="add-on"><i class="product-twitter"></i></span>
            <%= content_tag :a, h(user.twitter_id), :class => "hover-contact-box" %>
          </div>
        <% end %>
      <% end %>
      <% unless user.agent? %>
        <div class="recent-tickets">
            <% case show_recent_tickets %>                
              <% when :dialog then %>
                <%= link_to t('ticket.recent_tickets'), 
                      "/helpdesk/tickets/#{ticket.id}/component?component=requester_tickets", 
                      :rel => 'freshdialog', 
                      "data-target" => "#requester_tickets",
                      "data-template-footer" => "",
                      :title => t('contacts.info4', :nick_name => h(user.display_name)) if ticket.present? %>
              <% when :filter then %>
                <% if local_assigns.has_key? :new_tab %>
                  <%= link_to t('ticket.recent_tickets'), 
                      helpdesk_requester_filter_path(:requester_id => user.id),
                      :title => t('contacts.info4', :nick_name => h(user.display_name)), :target => "_blank" %>
                <% else %>
                  <%= link_to t('ticket.recent_tickets'), 
                      helpdesk_requester_filter_path(:requester_id => user.id),
                      :title => t('contacts.info4', :nick_name => h(user.display_name)) %>
                <% end %>
            <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

