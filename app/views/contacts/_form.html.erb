<% content_for :onload_script do %>               
  jQuery("#contact_customer").autocomplete({
      source: function(request, response) {
          jQuery.ajax({
              url: "<%=autocomplete_contacts_path%>",
              data: {
                  v: request.term
              },
              success: function(data) {
                  response(jQuery.map(data.results,
                  function(item) {
                      return {
                          label: item.value,
                          value: item.value
                      }
                  }));
              }
          });
      },
      select: function(event, ui) {
      			jQuery("#user_address").focus();
          },
      open: function() {
          jQuery(this).removeClass('ui-corner-all');
      }
  }).data("autocomplete")
  ._renderItem = function(ul, item) {
      return jQuery("<li></li>")
      .data("item.autocomplete", item)
      .append("<a>" + item.label + "</a>")
      .appendTo(ul);
  };

  jQuery("#contact_submit").bind("click",
  function(ev){
  	var company_name=jQuery('#contact_customer').val().trim();
  	if(company_name=='')
 	  {
  		jQuery('#contact_role').removeAttr('checked');
   	}
  	return true;
	});

  jQuery("#contact_customer").bind("keyup",
  function(ev) {
      var company = this.value.trim();
      if (company != null && company != "")
      {
          jQuery('#contact_role').removeAttr("disabled");
      }
      else
      {
          jQuery('#contact_role').removeAttr('checked');
          jQuery('#contact_role').prop("disabled", true);
      }
  });
	jQuery("#user_tags").select2({
	  	tags: "<%= escape_javascript(current_account.tags.most_used(25).collect{|tag| tag.name}.join(',').html_safe) %>".split(","),
	  	tokenSeparators: [',']
	}); 

  jQuery(".ui-menu-item").live("click",function(ev){
  	jQuery("#user_address").focus();
	});

<% end %>

 	 <% if @existing_user %>
	  	<div id="errorExplanation" class="errorExplanation">
			<%= "#{t('agent.info2')} " %>
			<%= link_to(t('agent.view_user') , @existing_user ) %>
		</div>
	  <%else%>		
	   	<%= error_messages_for :user %>
	 <%end%>


	 	 
	<ul class="form-horizontal">	
		<li class="control-group">
			<%= label(:user, :name, t('user.full_name'), :class => "control-label") %>
			<div class="controls">
				<%= text_field(:user, :name, :class => "text required input-xlarge" )  %>
			</div>
		</li>
		<li class="control-group">
			<%= label(:user, :job_title, t('user.title'), :class => "control-label") %>
			<div class="controls">
				<%= text_field(:user, :job_title, :class => "text input-xlarge" ) %>
			</div>
		</li>
		<li class="control-group">
			<%= label(:user, :email, t('user.email'), :class => "control-label") %> 
			<div class="controls">
				<%= text_field(:user, :email, :id => "email_primary", :class => "email input-xlarge") %> 
			</div>
		</li>
		<li class="control-group">
			<%= label(:user, :phone, "#{t('user.work_phone')}.",:class => "control-label" ) %>
			<div class="controls">
				<%= text_field(:user, :phone, :class => "text input-xlarge", :id => "phone_work" , :placeholder => t('user.work') ) %>
			</div>
		</li>
		<li class="control-group">
			<%= label(:user, :phone, "#{t('user.mobile_phone')}.",:class => "control-label" ) %>
			<div class="controls">
				<%= text_field(:user, :mobile, :class => "text input-xlarge", :id => "phone_mobile" , :placeholder => t('user.mobile') ) %>
			</div>
		</li>
		<li class="control-group">
			<%= label(:user, :twitter_id, t('user.twitter_id'), :class => "control-label") %>
			<div class="controls">
				<%= text_field(:user, :twitter_id, :class => "text input-xlarge" ) %>
			</div>
		</li>
		<li class="control-group">
			<label class="control-label"><%=t("user.profile_picture")%></label>
			<div class="controls">
				<%= render :partial => "/shared/profileavatar.html", :locals => { :user => @user, :type => type } %> 
			</div>
		</li>


		<li class="control-group">
			<%
				company_name = "";
				role_disabled = true
				unless @user.customer.nil?
					company_name =  @user.customer.name
					role_disabled = false
				end
			%>
			<%= label(:user, :customer, t('user.company'), :class => "control-label") %>
			<div class="controls">
				<%= text_field(:user, :customer, :class => "text input-xlarge" , :value => company_name, :id => "contact_customer") %>
			</div>
		</li>
		<li class="control-group">	
			<label class="control-label"></label>
			<div class="controls">		
			<%= check_box(:user, :client_manager, { :disabled => role_disabled, :id =>'contact_role', :checked => @user.privilege?(:client_manager) }, true, false) %>
			   	<%= t('contacts.role.info') %>
			</div>
		</li>
		<li class="control-group">
			<%= label(:user, :address, t('user.address'), :class => "control-label") %>
			<div class="controls">
				<%= text_area(:user, :address, :class => "text input-xlarge", :rows => 5 ) %>
			</div>
		</li>		
		
		<% if feature?(:multi_timezone) %>
			<li class="control-group">
				<%= label(:user, :time_zone, t('account.time_zone'), :class => "control-label") %>
				<div class="controls">
					<%= f.time_zone_select :time_zone, ActiveSupport::TimeZone.all , {:default => @user.time_zone} , {:class => 'select2 input-large'} %>
				</div>
			</li>
		<% end %>
		
		<% if feature?(:multi_language) %>  
			<li class="control-group">
				<%= label(:user, :language, t('account.language'), :class => "control-label") %>
				<div class="controls">
					<%= f.select :language, I18n.available_locales_with_name , {:selected => @user.language ? @user.language.to_sym() : current_portal.language.to_sym()} , :class => "select2 input-medium"%>
				</div>
			</li>
		<% end %>
		<li class="control-group">
			<%= label(:user, :tags, t('tag.title'), :class => "control-label") %>
			<div class="controls">
				<%= text_field :user, :tags, :value => @user.tags.collect{|tag| tag.name}.join(','), :class => "select2  input-xxlarge"%>
			</div>
		</li>
		<li class="control-group">
			<%= label(:user, :description, t('user.back_info'), :class => "control-label") %>
			<div class="controls">
				<%= text_area(:user, :description, :class => "text input-xxlarge", :id => "user_binfo", :rows => 5, 
					:placeholder => "example - LA Lakers fan etc." ) %>
			</div>
		</li>		
		
	</ul>	 
