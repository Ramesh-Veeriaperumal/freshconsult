<%= form_for @user, :url => contacts_path, :method => 'post', 
      :html => { :id => "add_requester_form", :rel => "validate", "data-remote" => true } do |add_requester| %>
  <div id="errorExplanation" class="errorExplanation" style="display:none;">
  </div>
  <div id="errorMessages" style="display:none;">
  </div>
  <ul class="add-requester-form dont-validate">
    <li>
      <%= add_requester.label t('user.name') %>
      <%= add_requester.text_field :name, :class => "required"%>
    </li>
    <li>
      <%= add_requester.label t('user.email') %>
      <%= add_requester.fields_for :user_emails do |ue| %>
        <%= ue.text_field :email, :class => "require_from_group user_info email" %>
      <% end %>
    </li>
    <li>
      <%= add_requester.label t('user.phone_no') %>
      <%= add_requester.text_field :phone, :class => "require_from_group user_info" %>
    </li>
    <li>
      <%= add_requester.label t('user.company') %>
      <%= add_requester.text_field :company_name %>
      <div id="user_company_choices" class="autocomplete select2ui"></div>
    </li>
  </ul>
  <div class="button-container">
    <%= link_to t('cancel'), "javascript:void(0);", :class => "btn", :id => "cancel_button" %>
     <%= add_requester.submit t('create'), :class => "btn btn-primary", :"data-loading-text" => "Creating..." %>
  </div>
<% end %>

<%= javascript_tag do %>
  function lookup(searchString, callback) { 
    new Ajax.Request('<%= autocomplete_contacts_path %>?v='+encodeURIComponent(searchString), 
                        { parameters: {name: searchString, rand: (new Date()).getTime()},
                          method: 'GET',
                          onSuccess:  function(response) {
                                        var choices = $A();
                                        response.responseJSON.results
                                          .each(function(item){
                                            choices.push(item.value);
                                          });                                             
                                        callback(choices);
                                      } });
  }
  var cachedBackend = new Autocompleter.Cache(lookup, {choices: 20});
  var cachedLookup = cachedBackend.lookup.bind(cachedBackend);
  
  new Autocompleter.Json("user_company_name", "user_company_choices", cachedLookup, {});

  jQuery('#cancel_button').live('click', function(){
    jQuery('#add_requester_form').modal('hide');
  });

  jQuery('#user_name').focus();
<%end%>