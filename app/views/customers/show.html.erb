<% content_for :layoutType do -%>bg_pulp<%-end %>
<% content_for :sidebar do %> 
	
	<% unless @customer.domains.blank? %>
		<div class="sidepanel">
			<div class="element first" style="display:none;">
				<h4 class="title"><%=t('company.info2')%></h4>
				<p>
					<%= h(@customer.domains) %>	
				</p>	
			</div>
		</div> 
	<% end %>
  <% if privilege?(:manage_contacts) %> 
  	<div class="sidepanel">
  	<h4 class="title"><%=t('contacts.new')%> <span class="highlight">in <%=h(@customer.name)%></span></h4> 	
  		<% form_tag :action=> :quick_customer,:controller => "contacts", :method =>:post do %>
  		  <%= hidden_field_tag 'customer_id', params[:id] %> 	
    		<ul class="ui-form">
    		<li> 
    			<label for="user_name"><%=t('user.full_name')%></label> 
    			<input class="text" id="user_name" name="user[name]" size="30" type="text" value="" /> 
    		</li> 
    		<li>
    			<label for="email_primary"><%=t('user.email')%></label> 
    			<input class="text" id="email_primary" name="user[email]" size="30" type="text" />
    		</li>
    		<li>
    			<label for="user_phone"><%=t('user.phone_no')%></label> 
    			<input class="text" id="phone_work" name="user[phone]" size="30" type="text" /> 
    		</li>
    		</ul>
    		<div class="button-container"><%= submit_tag t('create'), :class => "uiButton grey small" %></div>
  		<% end %>
  	</div>
  <% end %>
<% end %>
<div class="company_box">
	<div class="action_buttons hide">
    <% if privilege?(:manage_contacts) %>
		  <%= link_to t('edit'), edit_customer_path(@customer), :class => "last" %>
    <% end %>
	</div>
	<h3 class="title"><%= h(@customer.name) %></h3>
	<div><%=h(@customer.description).gsub(/\n/, '<br />') unless @customer.description.blank? %></div>
	<% sla_policy = @customer.sla_policy_in_use %>
	<span><%= t('company.sla_policy_name') %> : <%= link_to sla_policy.name, edit_helpdesk_sla_policy_path(sla_policy), :class => "last" %> </span>
</div> 
<h4 class="title"><%=t('company.info4',:name => h(@customer.name)).html_safe%></h4>	
<% form_for(@customer) do |f| %>
	<label class="overlabel" for="comp_notes">
		<%=t('company.info5')%>
	</label>
	<%= f.text_area :note, :class=> "sp_paragraph", :id => "comp_notes" %>
  <% if privilege?(:manage_contacts) %>
  	<div class="alignright"> 
  		<%= f.submit t('save'), :class=>"uiButton small grey"  %> &nbsp;
  	</div>
  <% end %>
<% end %>	  

<% unless @customer.users.empty? %>
<span class="seperator"></span>
<h4 class="title margin-set"><%=t('company.info6',:name => (@customer.name))%> (<%= @customer.users.size %>) </h4>
	<ul class="user_list">	  
			  <% @customer.users.each do |user| %>
			  <li>
			  	<%= link_to(user_avatar(user, :thumb), user, :title => h(user.name) ) %>
			  	<br />
			  	<% user_name = user.name %>
			  	<% if (user_name.length > 27) %>
			  	<% user_name = user_name[0..27] + "..."  %>
			  	<% end %> 
			  	<%= link_to(h(user_name), user, :class => 'username') %>
				<%# link_to (h(user.name), user, :class => 'username') %>
				<%# user.job_title %>
			  </li>  
			  <%end%>
	</ul>
<% end %>
<span class="seperator"></span>
<h4 class="title"><%=t('contacts.info4',:nick_name => h(@customer.name)).html_safe%></h4>
	
	<% if (@customer.tickets.visible.size == 0) %>
		<%= "#{t('company.info7')}" %>
	<% else %> 
		<ul class="history-list">
			<% @customer.tickets.visible.newest(5).each do |ticket| %>		
				<%= render :partial => "/contact_shared/ticket", :object => ticket %> 
			<% end %>	
		</ul>	
	<%end%>
	
</div>
<% javascript_tag do %>
  // need to convert this to a util
  jQuery(document).ready(function(){
    if (jQuery.trim( jQuery('div.action_buttons').text() ).length != 0) {
      jQuery('div.action_buttons').show();
    }
});
<% end %>
