<%
topic = post.topic
post_type = post.original_post? ? 'new_topic' : 'reply'
entry_delete_path = "/discussions/topics/#{topic.id}"
entry_delete_path << "/posts/#{post.id}" if post_type=='reply'
%>

<div class="comm-item span12 row-fluid clear-left-margin comm-item-post" id="post_<%= post.id %>" data-user="<%= post.user_id %>">
	<div class="pull-left">
		<%= user_avatar(post.user, :thumb, "preview_pic", {:width => "30px", :height => "30px" }) %>
	</div>
	<div class="comm-item-main row-fluid">
		<div class="comm-item-main-content">
			<div>
				<span class="label <%= post_type %>">
								<%= t("contacts.#{post_type}") %></span>
				<span class='muted'>
					<abbr data-livestamp='<%= post.created_at.to_i %>'><%= formated_date(post.created_at) %></abbr>,
					In <%= pjax_link_to topic.forum.name, discussions_forum_path(topic.forum_id), :class => 'muted' %>
				</span>
			</div>
			<div class="comm-item-details">
				<strong><%= link_to_user(post.user, :class => 'hover-link') %></strong>
				<%= post.original_post? ? t('discussions.topics.post.created_topic') : t('discussions.topics.post.replied_to') %>
				<%= pjax_link_to topic.title, "#{discussions_topic_path(topic.id)}/page/last/##{dom_id(post)}" %>
			</div>
			<div class="post-desc pl20 mt5">
				<%= truncate( post.body, :length => 400 )%>
			</div>
		</div>
	</div>
	<div class="post-action-bar">
			<div class="action-icon">
				<%= link_to '', approve_discussions_moderation_path(post),
					:method => :put,
					:class => font_class("checkmark-round", 28, "tooltip post-approve"),
					:id => 'approve-post',
					:title => t('.approve_tooltip'),
					:"data-track" => 'Action on Unpublished post',
					:"data-event-data" => {:action => 'Publish', :spam => post.spam? }.to_json,
					:remote => true
			    %>
			</div>
		<% unless post.spam? %>
			<div class="action-icon">
				<%= link_to '', entry_delete_path,
					:method => :delete,
					:class => font_class("trash", 28, "tooltip post-delete delete_action"),
					:id => 'delete-post',
					:title => t('delete'),
					:"data-track" => 'Action on Unpublished post',
					:"data-event-data" => {:action => 'Delete', :spam => false }.to_json,
					:remote => true
				%>
			</div>
			<div class="action-icon">
				<%= link_to_if privilege?(:delete_contact), "", ban_discussions_moderation_path(post),
					:method => :put,
					:class => font_class("notice", 28, "tooltip post-ban-user"),
					:id => 'delete-contact',
					:title => t('.ban_tooltip'),
					:"data-placement" => "left",
					:"data-track" => 'Action on Unpublished post',
					:"data-event-data" => {:action => 'Spam and Ban User', :spam => false }.to_json,
					:remote => true
				%>
			</div>
		<% end %>
	</div>
</div>

<%-# TODO-RAILS3 - Move to js files (Added ids above, to make it bind to multiple elements) -%>
<%= javascript_tag do %>
(function($) {
  jQuery("#delete-contact, #delete-post, #approve-post').bind("ajax:before", function(et, e){
	$(this).hide(); 
	$(this).parent().addClass('sloading loading-small')
  });
})(jQuery)
<% end %>
