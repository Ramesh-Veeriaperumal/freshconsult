<% 
  default_field_order = [
      "default_priority", "default_status", 
      "default_source", "default_ticket_type", 
      "default_group", 
      "default_agent", 
      "default_product"
  ]

  default_fields = []
  default_ticket_type_field = ""
%>
<% ticket_fields.each do |field| 
  if field.visible_in_view_form?
    field_value = @ticket.send(field.field_name)
    field_label = t("ticket_fields.fields.#{field.name}")
    dom_type    = (field.field_type == "default_source") ? "dropdown" : field.dom_type
    field_value = nested_ticket_field_value(@ticket, field) if(field.field_type == "nested_field") and !@ticket.new_record?
    field_html = construct_ticket_element(form_builder, :helpdesk_ticket, 
                                          field, field_label, dom_type, 
                                          field.required, field_value, '', false, false)
    if(field.field_type == "default_ticket_type" && field.has_sections_feature?)
      default_ticket_type_field  << field_html.html_safe
    else
      default_fields << [ field.field_type , field_html ]
    end
  end
end
default_fields.sort! {|x,y| default_field_order.index(x.first) <=> default_field_order.index(y.first) }
%>
<% default_fields.each do |field| %>
  <%= field.last %>
<% end %>
<%= default_ticket_type_field.html_safe unless default_ticket_type_field == "" %>

<%= javascript_tag do %>  
  <% if @ticket.ticket_status.deleted? %>
    jQuery("#helpdesk_ticket_status")
    .append('<option disabled="disabled" value = "<%= @ticket.status %>"> <%= @ticket.status_name %> </option>')
    .val("<%=@ticket.status%>")
  <% end %>
<% end %>
<%= render :partial => '/helpdesk/tickets/show/tags' %>