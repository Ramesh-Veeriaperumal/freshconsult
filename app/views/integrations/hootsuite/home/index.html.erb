<html>
	<head>
	</head>
	<body>
		<script src="https://d2l6uygi1pgnys.cloudfront.net/jsapi/0-6/hsp.js"></script>
		<%= stylesheet_link_tag_with_rtl :'cdn/hootsuite' %>
		<%= javascript_include_tag :'cdn/hootsuite' %>
		<script>
		var args = "?uid="+'<%= params[:uid]%>'+"&ts="+'<%= params[:ts]%>'+"&token="+'<%= params[:token]%>'+"&pid="+'<%= params[:pid]%>';
		function openTicket(i){
			hsp.showCustomPopup(location.origin+'/integrations/hootsuite/tickets/'+i+args, 'Freshdesk', '900', '500') ;
		}
		jQuery(document).ready(function(){
			hsp.init({
				apiKey: '<%= ThirdPartyAppConfig["hootsuite"]["api_key"] %>',
				receiverPath: location.origin+'/my_receiver.html'
			});
			hsp.updatePlacementSubtitle('<%= current_user.name %>');
			
			hsp.bind('refresh', function() {
				if(jQuery(window).scrollTop() < 20){
					hs_refresh();
				}
			});
		});
		</script>
	<div class="hs_stream">
		<%= render 'integrations/hootsuite/home/top_bar' %>
		<% if @tickets.blank?%>
			<div class="hs_error">
				<p><%= t("integrations.hootsuite.no_ticket_msg")%></p>
			</div>
		<%end%>
		<div id="loaderFD" class="hide"><img src="/images/animated/ajax-loader.gif"/></div>
		<div id='Pages'>
			<%= render :partial => 'integrations/hootsuite/home/ticket', :collection => @tickets %>
		</div>

		<% opts = params.merge(:uid => params[:uid],
						:ts => params[:ts],
						:token => params[:token],
						:pid => params[:pid]
					) %>
		<%= pageless(@total_pages, url_for(:controller => 'integrations/hootsuite/home', :action => 'index'), "", opts	) unless @tickets.empty?%>
	</div>

	<script type="text/javascript">
		function hs_refresh(){
			jQuery.ajax({
			type: 'GET',
			url: '/integrations/hootsuite/home/refresh'+args,
			contentType: 'application/json',
			beforeSend: function (argument) {
				jQuery("#Pages").empty();
				jQuery("#loaderFD").show();
			},
			});
	}
	</script>
</body>
</html>