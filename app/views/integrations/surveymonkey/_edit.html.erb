<%	app = Integrations::Application.find_by_name('surveymonkey') %>

<% if installed_app %>

	<div id="survey-fields-container">
		<div id="survey-collector-dropdowns" class="row-fluid">
			<div class="span6">
				<span class="title black_and_bold"><%= t('integrations.surveymonkey.edit_form.survey') %><sup>*</sup></span><br>
				<div id="survey-list-wrapper" class="sloading loading-small loading-left">
					<select id="survey_list" class="hide required">
						<option value="">- <%= t('integrations.surveymonkey.edit_form.select') %> -</option>
					</select>
				</div>
			</div>

			<div class="span6 hide" id="collector-container">
				<span class="title black_and_bold"><%= t('integrations.surveymonkey.edit_form.collector') %><sup>*</sup></span><br>
				<div id="collector-list-wrapper">
					<select id="collector_list" name="configs[survey_link]" class="required">
						<option value="">- <%= t('integrations.surveymonkey.edit_form.select') %> -</option>
					</select>
				</div>
			</div>
		</div>

		<input type="hidden" name="configs[survey_id]" id="configured_survey_id" value="<%=installed_app.configs[:inputs]['survey_id']%>">
		<input type="hidden" name="configs[collector_id]" id="configured_collector_id" value="<%=installed_app.configs[:inputs]['collector_id']%>">
		
		<div class="survey-text-container">
			<label for="survey_text">
				<span class="black_and_bold"><%= t('integrations.surveymonkey.edit_form.survey_link_text.label') %><sup>*</sup> </span><br>
				<%= t('integrations.surveymonkey.edit_form.survey_link_text.description') %>
			</label>
			<textarea id="survey_text" class="required" name="configs[survey_text]"><%= installed_app.configs[:inputs]['survey_text'] ||  t('integrations.surveymonkey.edit_form.survey_link_text.default_content') %></textarea>
		</div>

		<div class="send_while_container">
			<div class="send_while">
				<%=t('integrations.surveymonkey.edit_form.send_while_title').html_safe%> <sup>*</sup>
			</div>
			
			<label>
			  <%= "<input type=\"radio\" name=\"configs[send_while]\" value=\"#{Survey::CLOSED_NOTIFICATION}\">".html_safe %>
				<%=t('admin.surveys.satisfaction_settings.send_while_option3').html_safe%>
			</label>
			
			<label>
			  <%= "<input type=\"radio\" name=\"configs[send_while]\" value=\"#{Survey::RESOLVED_NOTIFICATION}\">".html_safe %>
			  <%=t('admin.surveys.satisfaction_settings.send_while_option2').html_safe%>
			</label>
			
			<label>
				<%= "<input type=\"radio\" name=\"configs[send_while]\" value=\"#{Survey::ANY_EMAIL_RESPONSE}\">".html_safe %>
				<%=t('admin.surveys.satisfaction_settings.send_while_option1').html_safe%>
			</label>
			
			<label>
				<%= "<input type=\"radio\" name=\"configs[send_while]\" value=\"#{Survey::SPECIFIC_EMAIL_RESPONSE}\">".html_safe %>
				<%=t('admin.surveys.satisfaction_settings.send_while_option4').html_safe%>
			</label>		
		</div>

		<script type="text/javascript">
			jQuery('div.send_while_container input[value="<%=installed_app.configs[:inputs]['send_while'] ||
				Survey::RESOLVED_NOTIFICATION %>"]').attr("checked", true);
		</script>
			
	</div>


	<input type="hidden" id="configured_survey_url" value="<%=installed_app.configs[:inputs]['survey_link']%>">
	<script type="text/javascript">
	 CustomWidget.include_js('/javascripts/integrations/surveymonkey.js')
	</script>

<% else %>
	
	<span> <%= t('integrations.surveymonkey.enable_integration_text') %> </span>
	<script type="text/javascript">
		jQuery("#InstallApplication input[type=\"submit\"]").click(function(e){
			e.preventDefault();
			window.location.href = "<%=app.oauth_url({:account_id => current_account.id, :portal_id => current_portal.id})%>";
		});			
	</script>

<%end%>

