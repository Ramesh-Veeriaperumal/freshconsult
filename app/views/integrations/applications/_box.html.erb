<% unless installed_apps[:box].blank? %>
  <li id="boxjs">
      <input type="hidden"  id="<%=attach_id%>_box_url" name="boxURL" nameWhenFilled="[cloud_file_attachments][]" fileContainer="<%=attach_id%>-container" fileList="<%=attach_id%>-attachments" sendFocusTo="<%=attach_id%>-body" />
      <a href="#" class="dropbox_button" name="selected-file" id="box-chooser" 
        data-holder="<%=attach_id%>_box_url" onclick='initBox(this); event.preventDefault(); '><%=I18n.t('box_attach_from').html_safe %></a>         
  </li>
<% end %>
<% unless installed_apps[:box].blank? %>
  <script type="text/javascript" src="/javascripts/integrations/box.js"></script>
  <script type="text/javascript">
    function initBox(inp) {
    Box.choose({
                success: function(files, doc, file1_json) {
                    function singleFile() {
                        var inputElement = jQuery(inp).data('holder');
                        jQuery('#' + inputElement)
                            .val(JSON.stringify({
                                link: files[0].link,
                                name: files[0].name,
                                provider: 'box'
                            }))
                            .data('filename', files[0].name)
                            .data('provider', 'Box');
                        Helpdesk.Multifile.addFileToList(jQuery('#' + inputElement));
                        newInput = Helpdesk.Multifile.duplicateInput(jQuery('#' + inputElement));
                        jQuery(inp).data('holder', newInput.attr('id'));
                    }
                    // for portal 
                    if (jQuery('.single_file').length !== 0) {
                        singleFile();
                    }
                    // for app
                    else {
                      
                            var attachments = JSON.stringify(files[0]);
                            var cloud_file_object = [{
                                fileName: files[0].name,
                                provider: 'Box',
                                attachments: attachments
                            }];
                            var file_list = window.localStorage.getItem('current-file-list');
                            jQuery("#attach-limt-" + file_list).hide();
                            jQuery("#attachment-template").tmpl({
                                render_type: "new",
                                type: "cloud",
                                files: cloud_file_object
                            }).appendTo(".multiple-filelist-" + file_list);
                        }
                }
            });
  }
  </script>
<% end %>