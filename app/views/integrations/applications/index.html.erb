<%= javascript_include_tag  '/javascripts/frameworks/list.min.js' %>
<% content_for :sidebar do -%><%-end %>
<h3 class="title"><%=t('application.title')%></h3>
<div class="intro"><%=t('application.desc')%></div>
<%= link_to image_tag("symbols/add.png"), new_integrations_application_path, :class => "button custom-tip-bottom", :title => t("application.add_addon") %>		

<div id="integrations-list">
	<input class="search" placeholder="Search Integrations"/>
	<ul class="table-list">
		<% disp_header = 0
			@applications.each do |application| %>
			<%next if (!feature?(:timesheets) && (application.name == 'freshbooks' or application.name == 'harvest' or application.name == 'workflow_max'))%>

		  	<% # TODO: Bad logic to disply headers.  Fix it.
		  	if application.system_app?
		  	 if disp_header < 2
		  		disp_header = 2%>
					<h2>Native Applications</h2>
		  	<%end
		  	else
		  	 if disp_header == 0
		  		disp_header = 1%>
					<h2>Custom Applications</h2>
		  	<%end
		  	end%>

			<li>
				<div class="application">
					<div class="logo application-logo-<%= application.name %>"></div>
		  		<div class="actions"> 
		  			<% i_app_index=@installed_applications.index { |i_app| true if(i_app.application == application) }

				  if application.system_app? # System Applications
					  if i_app_index.nil?
					  	#use direct_install option in applications to install the application directly from the "Enable" in applications menu.
					  	if application[:options][:direct_install].blank? %>
					  		<%= link_to "<strong> #{t('application.disabled')} </strong><span></span>", integrations_application_path(application), :class => "uiButton special iphone-inactive custom-tip-bottom", :title => t("application.click_to_enable") %>		
					  	<% else 
					  		if application[:options][:oauth_url].blank? %>
					  			<!-- Custom logic to call the installed_applications "Enable" directly from applications list when direct_install is provided and oauth_url is empty -->

					  		<% else 
					  			 auth_url = AppConfig['integrations_url'][Rails.env] + Liquid::Template.parse(application[:options][:oauth_url]).render("account_id" => current_portal.id)%>
						  		 <%= link_to "<strong> #{t('application.disabled')} </strong><span></span>", auth_url , :class => "uiButton special iphone-inactive custom-tip-bottom", :title => t("application.click_to_enable") %>		
					  		<% end %>
					  	<% end %>
		  	    		
					  <%else
						if application[:options][:direct_install].blank? %>
			  	    		<%= link_to image_tag("symbols/setting.png"), edit_integrations_installed_application_path(@installed_applications[i_app_index]), :class => "button custom-tip-bottom", :title => t("application.configure_addon") %>		
			  	    	<% end %>
			  	    	<%= link_to t('application.enabled') + "<span></span>", uninstall_integrations_installed_application_path(@installed_applications[i_app_index]), :class => "uiButton special iphone-active custom-tip-bottom", :confirm => t("application.confirm_disable"), :title => t("application.click_to_disable") %>	
					  <%end%>
				</div>
				<div class="col-center">
				  <%if i_app_index.nil? or !application[:options][:direct_install].blank?%>
					  <%= content_tag(:h2, t(application.display_name)) %>
					<%else%>
					  <%= content_tag(:h2, link_to(t(application.display_name),edit_integrations_installed_application_path(@installed_applications[i_app_index]), :title => t("application.configure_addon") )) %>
					<%end%>
					<div class="info-data"><%= t(application.description) %></div>

				<%else # Custom Applications%>
				    <%= link_to t('delete'), application, :confirm => 'Are you sure?', :method => :delete, :class => "uiButton" %>
	    			<%= link_to image_tag("symbols/setting.png"), edit_integrations_application_path(application), :class => "button custom-tip-bottom", :title => t("application.configure_addon") %>		
					  <%if i_app_index.nil?%>
				  		<%= link_to "<strong> #{t('application.disabled')} </strong><span></span>", auth_url , :class => "uiButton special iphone-inactive custom-tip-bottom", :title => t("application.click_to_enable") %>		
				  	<%else%>
	  	    		<%= link_to t('application.enabled') + "<span></span>", uninstall_integrations_installed_application_path(@installed_applications[i_app_index]), :class => "uiButton special iphone-active custom-tip-bottom", :confirm => t("application.confirm_disable"), :title => t("application.click_to_disable") %>	
	  	    	<%end%>
					</div>
					<div class="col-center">
						<%= content_tag(:h2, link_to(application.display_name, edit_integrations_application_path(application), :title => t("application.configure_addon") )) %>
						<div class="info-data"><%= application.system_app? ? t(application.description) : application.description%></div>
			  <% end %>
				</div>
			</div>
	 	</li>
	<% end %>
</ul>
</div>
<script>
	var options = {
		valueNames: [ 'info-data' ],
		listClass: [ 'table-list' ]
	};

	var integrationsList = new List('integrations-list', options);
</script>
