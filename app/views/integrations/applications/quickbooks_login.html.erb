<%= form_for :account, :url => {:action=> :create}, :html => { :class => "form", :method => "post", :rel => "validate" } do |f| %>
	<div class="logo">
		<i class="remote-configurations-freshdesk-logo"></i><i class="remote-configurations-arrow"></i><i class="remote-configurations-<%= page %>-logo"></i>
	</div>

	<div class="input_box" id="input_box">
		<div class="input_group">
			<label class="input_label" for="fd_input"><%= t("integrations.remote_login.freshdesk_url") %></label>
			<input type="text" class="input_field required url" id="fd_domain" name="domain" placeholder="https://test.freshdesk.com"/>
		</div>
		<div class="submit_box">
			<%= submit_tag t('integrations.remote_login.connect'), :class => "button" %>
			<% unless params[:operation] %>
			<p>
				<%= t("integrations.remote_login.new_to_freshdesk") %>				
				<a href="#" class="anchor" onClick = "showMsgAndRedirect('<%= t('integrations.quickbooks.remote_configurations.signup') %>', 'http://freshdesk.com/signup')"><%= t("integrations.remote_login.sign_up") %></a>
			</p>
			<% end %>
		</div>
		<input type="hidden" name="app" value="<%= params[:app] %>" />
		<input type="hidden" name="operation" value="<%= params[:operation] %>" />
<% end %>
<% if flash[:notice] %>
	<div id="noti" class="notice"><%= flash[:notice] %></div>
<% end %>
<script>
function showMsgAndRedirect(msg, loc){
	$('#input_box').html(msg)
	delayedRedirectTo(loc)
}
function delayedRedirectTo(loc){
	setTimeout( function() {
		window.location = loc
	}, 10000);
}
<% if @valid_domain 
		if params[:operation] == 'launch' %>
$(document).ready(function() {
	showMsgAndRedirect("<%= t('integrations.quickbooks.remote_configurations.launch').html_safe %>", "<%= params[:domain] + '/helpdesk' %>");
})
		<% elsif params[:operation] == 'disconnect' %>
$(document).ready(function() {
	showMsgAndRedirect("<%= t('integrations.quickbooks.remote_configurations.disconnect').html_safe %>", "<%= params[:domain] + integrations_applications_path %>");
})
		<% else %>
$(document).ready(function() {
	showMsgAndRedirect("<%= t('integrations.quickbooks.remote_configurations.connect').html_safe %>", "<%= params[:domain] + integrations_applications_path %>");
})
<% end
end %>
</script>
