<%google_accs = Integrations::GoogleAccount.find_all_installed_google_accounts(current_account)%>
<%oauth_url = @installing_application.oauth_url({:account_id => current_account.id, :portal_id => current_portal.id}) %>
<%if google_accs.blank?
	action_name = params[:action] == "edit" ? t("integrations.google_contacts.add_more") : t("application.enable")%>
	<%=t("integrations.google_contacts.form.account_not_configured", :action => action_name).html_safe%>
	<div class="center"><%= link_to(t("integrations.google_contacts.add_more"), "#{oauth_url}", :class => "uiButton special") if params[:action] == "edit" %></div><br/>
<%else
	google_acc = google_accs[0]
%>
	<div class="google_accounts">
		<table borer="0" width="100%">
			<tr class="headings">
				<th><%= t('integrations.google_contacts.account').html_safe%></th>
				<th><%= t('integrations.google_contacts.tag_label').html_safe%></th>
				<th><%= t('integrations.google_contacts.last_sync_time').html_safe%></th>
				<th></th>
			</tr>
	
			<%google_accs.each { |google_acc|%>
				<tr class="main_rows">
					<td>
						<span><strong><%=google_acc.name%> </strong><br /><%=google_acc.email%></span>
					</td>
					<td>
						<%=google_acc.sync_tag.name unless google_acc.sync_tag.blank?%>
					</td>
					<td>
			        	<%if !google_acc.last_sync_status.blank? and google_acc.last_sync_status[:status] == :progress%>
			        		<%=t("integrations.google_contacts.syncing_in_progress").html_safe%>
			        	<%elsif google_acc.last_sync_time.year == 1970%>
			        		<%if !google_acc.last_sync_status.blank? and google_acc.last_sync_status[:status] == :success%>
					        	<%=t("integrations.google_contacts.import_complete").html_safe%>
							<%end%>
				        	<%=t("integrations.google_contacts.not_yet_synced").html_safe%>
						<%else%>
			        		<%=formated_date(google_acc.last_sync_time)%>
						<%end%>
					</td>
					<td>
						<%=link_to("Delete", {:controller=>"google_accounts", :action => "delete", :id => google_acc.id },
					      :confirm => "Are you sure?", :class => "button", :method => :delete) %>
						</td>
				</tr>
			<%}%>
		</table>
		<div class="buttons">
			<%= link_to(t("integrations.google_contacts.add_more").html_safe, "#{oauth_url}", :class => "uiButton special") if params[:action] == "edit" %>
		</div>
	</div>
<%end%>
