<%= content_tag(:h3, t('integrations.'+@installing_application.name+'.label') + " " + t("settings"), :class => "title") %>
<%
  install_action = @installing_application.options[:install_action] # If the form needs different install action, then this can be used.
  url = { :controller=> "installed_applications", :action => "install" }  # default url for installing an app.
  html = {:id => "InstallApplication" } # default html for installing an app.
  html[:target] = "_top" if @installing_application.name == 'google_contacts'
  if install_action.present?
	  url = url.merge(install_action[:url]) if install_action[:url].present?
	  html = html.merge(install_action[:html]) if install_action[:html].present?
  end
%>

<%=  form_for @installing_application, :url => url, :html => html do |f| %>
  <ul class="ui-form">  
		<li class="inline-field">
			<label class="caption">
				<div class="logo application-logo-<%= @installing_application.name %>"></div>
			  <div class="logo info-data">
					<%= t(@installing_application.description) %>
				</div>
			</label>
   		<%= render :partial => "application_form", :object => f, :locals => { :is_edit => false, :installed_app =>Integrations::InstalledApplication.new, :form => f } %>
		</li>
  </ul>

  <div class="button-container">
    <% if current_account.marketplace_gallery_enabled? %>
      <a id="cancel-app-btn" class="uiButton uiButton--uppercase floatl"><%= t("back") %></a>
    <% else %>
      <a class="uiButton uiButton--uppercase floatl"><%= t("back") %></a>
    <% end %>
    <% if @installing_application.name != "seoshop" %>
      <%= f.submit t('application.enable'), :class => "btn btn-primary" %>
    <%end%>
  </div>
<% end %>

<% if current_account.marketplace_gallery_enabled? %>
  <% content_for :onload_script do %>
    jQuery("#cancel-app-btn").on("click", function(ev){
      ev.preventDefault();
      window.App.Channel.port1.postMessage({action: "load_marketplace_gallery"});
    });
  <% end %>
<% end %>