var hideDelay=10000;var $J=jQuery.noConflict();var GettingStarted={i18n:{},translate:function(a){return GettingStarted.i18n[a]},map:function(a,b){GettingStarted.i18n[a]=b}};var Validate={email:function(f){var a=f.split(",");var c=/\b[-a-zA-Z0-9.'â€™_%+]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}\b/;for(var d=0;d<a.length;d++){var b=Validate.extract_email(a[d]);if(c.test(b)){return true}else{return false}}},extract_email:function(a){email_match=a.match(/<(.+?)>/);if(email_match!=null){a=email_match[1]}return a},colorCode:function(b){var a=/^#(?:[0-9a-fA-F]{3}){1,2}$/;return a.test(b)},isEmpty:function(b){var a=/^\s*$/;return a.test(b)}};var Loading={updateStatus:function(b,a,c){b.find("div.gs_"+a).html(c);b.attr("class",a)},error:function(a,b){a.find("div.gs_failure").html(b);a.attr("class","failure")},success:function(a,b){a.find("div.gs_success").html(b);a.attr("class","success")},getContainer:function(a,b){var c=document.createElement("div");c.innerHTML='<div id="status_update"><div class="gs_success"></div><div class="gs_failure"></div><div class="gs_update"></div></div>';c.id=a;c.className="ajx_loading_status";jQuery(b).append(c);c=jQuery(c);c.width(parseInt((jQuery(document.body).width()*4)/5));return c}};var SendTestMail={success:function(b){var a=jQuery("#send_mail_content");a.animate({opaque:0.5},{duration:1000});a.attr("class","gs_response");a.animate({opaque:1},{duration:1000})},fail:function(c){var b=jQuery("#email_config_status");b=(b.length>0)?b:Loading.getContainer("email_config_status","#email_config_box");var a=b.find("#status_update");Loading.updateStatus(a,"failure",GettingStarted.translate("email_send_problem"));b.delay(5000).hide(1)},confirm:function(b){var a=jQuery("#send_mail_content");a.attr("class","gs_"+b);a.delay(300).fadeIn(100)},request:function(b){var a=jQuery(b);if(a.data("progress")){return}jQuery.ajax({type:"put",url:a.data("test-url")}).complete(function(){a.data("progress",false);a.val(a.data("value"))}).done(function(){SendTestMail.success()}).fail(function(){SendTestMail.fail()});a.data("progress",true);a.val(a.data("loading"))}};var activeSlide=1;jQuery(document).ready(function(){jQuery("#ResetColors").click(function(){jQuery("#HeaderColor").val("#252525").trigger("keyup");jQuery("#TabColor").val("#006063").trigger("keyup");jQuery("#BackgroundColor").val("#efefef").trigger("keyup")});jQuery("input#email_config_submit").click(function(g){var f=jQuery("form#email_config");var b=f.find("#reply_to_id");var d=b.val();var e=f.find("#hidden_reply_to").val();var c=jQuery(this).data("test-url");var a=jQuery(this);jQuery(this).val("").addClass("loading");if(Validate.email(d)){totango.track("Support Email Changed","Getting Started Page");jQuery.ajax({type:"PUT",cache:false,url:c,data:{"email_config[reply_email]":d,"email_config[to_email]":e},dataType:"script",success:function(){a.removeClass("loading").addClass("saved");setTimeout(function(){a.removeClass("saved").fadeOut()},1500);setTimeout(function(){a.val("Save")},2000)}})}else{a.removeClass("loading").addClass("warning");jQuery(".warning-tip").show();b.addClass("gs_error_highlight").focus();setTimeout(function(){a.removeClass("warning").hide().val("Save");jQuery(".warning-tip").hide()},2500);g.stopPropagation();return false}});jQuery("input#reply_to_id").live("keyup",function(){submit=jQuery("#email_config_submit");jQuery(this).val()==""?submit.fadeOut():submit.fadeIn()});jQuery("input#agent_invite_submit").click(function(d){var c=jQuery("form#agent_invite");var f=jQuery("#agent_invite_status");f=(f.length>0)?f:Loading.getContainer("agent_invite_status","#agent_box");var a=f.find("#status_update");f.show();var e=c.find("#agent_invite");var b="";var g=false;jQuery.each(jQuery("input:text","#agent_invite"),function(h,i){if(Validate.isEmpty(i.name)){i.name="agents_invite_email[]"}});jQuery.each(jQuery('input:[name="agents_invite_email[]"]',"#agent_invite"),function(h,j){var i=jQuery(j).val();if(Validate.isEmpty(i)){return}if(!Validate.email(i)){jQuery(j).closest("li").addClass("error_bubble");g=true}b=(b)?b+",":"";b+=i});if(Validate.isEmpty(b)){Loading.updateStatus(a,"failure",GettingStarted.translate("agent_email_required"));return false}if(!g){Loading.updateStatus(a,"update",GettingStarted.translate("agent_email_sending"));totango.track("Agents Added","Getting Started Page")}else{Loading.updateStatus(a,"failure",GettingStarted.translate("emails_invalid"));g=false;f.delay(hideDelay).hide(1);setFormFocus();d.stopPropagation();return false}});jQuery(".custom-upload input[type=file]").change(function(){jQuery(this).next().find("input").val(jQuery(this).val())});jQuery(window).bind("hashchange",function(){jQuery("#nav-controls [href="+window.location.hash+"]").trigger("click")});jQuery("#slide1-1, #slide1-2, #slide1-3, #slide1-4").click(function(a){jQuery(this).siblings().removeClass("active");jQuery(this).addClass("active");jQuery("#content").css("left",jQuery(this).data("translate"));jQuery("#indicator-arrow").css("left",jQuery(this).data("translateArrow"));activeSlide=parseInt(this.id.split("-")[1]);if(activeSlide>1){jQuery("a#back").removeClass("inactive");jQuery("a#back").addClass("active")}else{jQuery("a#back").removeClass("active");jQuery("a#back").addClass("inactive")}if(activeSlide==4){jQuery("#next_text").text(GettingStarted.translate("next_alt_link"))}else{jQuery("#next_text").text(GettingStarted.translate("next_link"))}setFormFocus()});jQuery("#next").click(function(a){a.preventDefault();if(activeSlide==4){goto_helpdesk();return}activeSlide=Math.min(4,activeSlide+1);jQuery("#slide1-"+activeSlide).trigger("click")});jQuery("#back").click(function(a){a.preventDefault();if(activeSlide==1){return}activeSlide=Math.max(1,activeSlide-1);jQuery("#slide1-"+activeSlide).trigger("click")});jQuery(".mColorPicker").live("change",function(a){jQuery("#"+jQuery(this).attr("id")+"View").css("background-color",jQuery(this).val())});jQuery("form#agent_invite").bind("keydown",function(a){if(a.keyCode==13){if(jQuery(a.target).attr("id")!="agent_invite_submit"&&jQuery(a.target).val()){jQuery(a.target).blur();setTimeout(function(){jQuery("form#agent_invite :input[type=text][value=]").each(function(){jQuery(this).focus()})},100);a.preventDefault();return false}}});jQuery(document).bind("keydown",function(a){if(a.keyCode==9){if((!a.shiftKey&&jQuery(a.target).data("tab-ignore")==true)||(a.shiftKey&&jQuery(a.target).data("shift-tab-ignore")==true)){a.preventDefault();return false}}});jQuery("input.send-mail[type=button]").bind("click",function(a){SendTestMail.request(a.target)});jQuery("input.change-logo-but[type=button]").bind("click",function(a){jQuery("input#account_main_portal_attributes_logo_attributes_content[type=file]").click()});if(jQuery.browser.msie){jQuery("#rebrand_submit").css("visibility","visible");jQuery("#rebrand_from_ie").val("true");jQuery("input#rebrand_submit").click(function(a){return validate_colorcode()})}else{jQuery("#rebrand_from_ie").val("false");jQuery("form#rebrand").ajaxForm({success:function(a){if(REDIRECT_CALL){redirect_to_helpdesk()}}});jQuery("form#rebrand").change(function(a){IS_REBRAND_CHANGED=true;trigger_rebrand()})}});function setFormFocus(){var a=["#email_config","#agent_invite","#rebrand"];if(activeSlide<=a.length){setTimeout(function(){jQuery(a[activeSlide-1]+" :input:text:first").focus()},200)}}var rms=0;var IS_REBRAND_TIMEOUT_ALIVE=false;var REBRAND_TIMEOUT=null;var IS_REBRAND_CHANGED=false;var REDIRECT_CALL=false;function trigger_rebrand(a){if(!validate_colorcode()||IS_REBRAND_TIMEOUT_ALIVE){return}REBRAND_TIMEOUT=setTimeout("rebrand("+rms+")",5000);IS_REBRAND_TIMEOUT_ALIVE=true}function rebrand(){if(validate_colorcode()){jQuery("form#rebrand").submit()}if(REBRAND_TIMEOUT){clearTimeout(REBRAND_TIMEOUT);REBRAND_TIMEOUT=null}IS_REBRAND_CHANGED=false;IS_REBRAND_TIMEOUT_ALIVE=false}function validate_colorcode(){var d=jQuery("form#rebrand");var a=d.find("#HeaderColor");var c=d.find("#TabColor");var e=d.find("#BackgroundColor");var b="";if(!Validate.colorCode(a.val())){b=Validate.isEmpty(a.val())?GettingStarted.translate("rebrand_header_empty"):GettingStarted.translate("rebrand_header_invalid");a.focus()}else{if(!Validate.colorCode(c.val())){b=Validate.isEmpty(c.val())?GettingStarted.translate("rebrand_tab_empty"):GettingStarted.translate("rebrand_tab_invalid");c.focus()}else{if(!Validate.colorCode(e.val())){b=Validate.isEmpty(e.val())?GettingStarted.translate("rebrand_bg_empty"):GettingStarted.translate("rebrand_bg_invalid");e.focus()}}}return show_rebrand_error(b)}function show_rebrand_error(b){var c=jQuery("#rebrand_submit_status");c=(c.length>0)?c:Loading.getContainer("rebrand_submit_status","#rebrand_box");if(!Validate.isEmpty(b)){var a=c.find("#status_update");Loading.error(a,b);c.show();c.delay(hideDelay).hide(1);return false}c.hide();return true}function execPendingJob(){if(IS_REBRAND_CHANGED){REDIRECT_CALL=true;rebrand();return}redirect_to_helpdesk()}function update_image(b){if(b.files&&b.files[0]){var a=new FileReader();a.onload=function(c){jQuery("div.custom-upload").css("background-image","url("+c.target.result+")");jQuery("div.custom-upload").css("background-size","contain");jQuery("#logo-preview").attr("src",c.target.result);totango.track("Logo Changed","Getting Started Page");rebrand()};a.readAsDataURL(b.files[0])}setTimeout(function(){jQuery("input.change-logo-but[type=button]").val("Change Logo")},1)}function update_logo(a){jQuery("div.custom-upload").css("background-image","url("+a+")");jQuery("div.custom-upload").css("background-size","contain");jQuery("#logo-preview").attr("src",a)}function goto_helpdesk(){jQuery("#next_text").text(GettingStarted.translate("next_please_wait"));if(jQuery.browser.msie){redirect_to_helpdesk();return}execPendingJob()}function redirect_to_helpdesk(){window.location.href="/helpdesk"};