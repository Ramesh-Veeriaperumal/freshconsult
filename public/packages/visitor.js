var session_fetch=(function(f,h,a){var c=0.4;var j={use_html5_location:false,ipinfodb_key:false,gapi_location:true,location_cookie:"location",location_cookie_timeout:5,session_timeout:32,session_cookie:"first_session"};var g=function(){String.prototype.contains=function(s){if(typeof(s)==="string"){return(this.indexOf(s)!==-1)}for(var t=0;t<s.length;t++){if(this.indexOf(s[t])!==-1){return true}}return false};if(f.session&&f.session.options){for(option in f.session.options){j[option]=f.session.options[option]}}var q={api_version:c,locale:b.locale(),current_session:b.session(),original_session:b.session(j.session_cookie,j.session_timeout*24*60*60*1000),browser:b.browser(),plugins:b.plugins(),time:b.time(),device:b.device()};if(j.use_html5_location){q.location=b.html5_location()}else{if(j.ipinfodb_key){q.location=b.ipinfodb_location(j.ipinfodb_key)}else{if(j.gapi_location){q.location=b.gapi_location()}}}if(f.session&&f.session.start){var r=f.session.start}var l=0,o,k,m=function(s){if(s){l--}if(l===0){if(r){r(f.session)}}};f.session={};for(var n in q){o=q[n];if(typeof o==="function"){try{o(function(s){f.session[n]=s;m(true)});l++}catch(p){if(f.console&&typeof(console.log)==="function"){console.log(p);m(true)}}}else{f.session[n]=o}}m()};var e={detect:function(){return{browser:this.search(this.data.browser),version:this.search(a.userAgent)||this.search(a.appVersion),os:this.search(this.data.os)}},search:function(o){if(typeof o==="object"){for(var l=0;l<o.length;l++){var m=o[l].string,n=o[l].prop;this.version_string=o[l].versionSearch||o[l].identity;if(m){if(m.indexOf(o[l].subString)!=-1){return o[l].identity}}else{if(n){return o[l].identity}}}}else{var k=o.indexOf(this.version_string);if(k==-1){return}return parseFloat(o.substr(k+this.version_string.length+1))}},data:{browser:[{string:a.userAgent,subString:"Chrome",identity:"Chrome"},{string:a.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:a.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:f.opera,identity:"Opera",versionSearch:"Version"},{string:a.vendor,subString:"iCab",identity:"iCab"},{string:a.vendor,subString:"KDE",identity:"Konqueror"},{string:a.userAgent,subString:"Firefox",identity:"Firefox"},{string:a.vendor,subString:"Camino",identity:"Camino"},{string:a.userAgent,subString:"Netscape",identity:"Netscape"},{string:a.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:a.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:a.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:a.platform,subString:"Win",identity:"Windows"},{string:a.platform,subString:"Mac",identity:"Mac"},{string:a.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:a.userAgent,subString:"iPad",identitiy:"iPad"},{string:a.platform,subString:"Linux",identity:"Linux"},{string:a.userAgent,subString:"Android",identity:"Android"}]}};var b={browser:function(){return e.detect()},time:function(){var l=new Date(),k=new Date();l.setMonth(0);l.setDate(1);k.setMonth(6);k.setDate(1);return({tz_offset:-(new Date().getTimezoneOffset())/60,observes_dst:(l.getTimezoneOffset()!==k.getTimezoneOffset())})},locale:function(){var k=((a.language||a.browserLanguage||a.systemLanguage||a.userLanguage)||"").split("-");if(k.length==2){return{country:k[1].toLowerCase(),lang:k[0].toLowerCase()}}else{if(k){return{lang:k[0].toLowerCase(),country:null}}else{return{lang:null,country:null}}}},device:function(){var k={screen:{width:f.screen.width,height:f.screen.height}};k.viewport={width:f.innerWidth||h.body.clientWidth||h.documentElement.clientWidth,height:f.innerHeight||h.body.clientHeight||h.documentElement.clientHeight};k.is_tablet=!!a.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i);k.is_phone=!k.is_tablet&&!!a.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i);k.is_mobile=k.is_tablet||k.is_phone;return k},plugins:function(){var k=function(l){if(a.plugins){var o,m=0,n=a.plugins.length;for(;m<n;m++){o=a.plugins[m];if(o&&o.name&&o.name.toLowerCase().indexOf(l)!==-1){return true}}return false}return false};return{flash:k("flash"),silverlight:k("silverlight"),java:k("java"),quicktime:k("quicktime")}},session:function(k,m){var r=d.get_obj(k);if(r==null){r={visits:1,start:new Date().getTime(),last_visit:new Date().getTime(),url:f.location.href,path:f.location.pathname,referrer:h.referrer,referrer_info:d.parse_url(h.referrer),search:{engine:null,query:null}};var n=[{name:"Google",host:"google",query:"q"},{name:"Bing",host:"bing.com",query:"q"},{name:"Yahoo",host:"search.yahoo",query:"p"},{name:"AOL",host:"search.aol",query:"q"},{name:"Ask",host:"ask.com",query:"q"},{name:"Baidu",host:"baidu.com",query:"wd"}],l=n.length,s,q,p=0,t="q query term p wd query text".split(" ");for(p=0;p<l;p++){s=n[p];if(r.referrer_info.host.indexOf(s.host)!==-1){r.search.engine=s.name;r.search.query=r.referrer_info.query[s.query];r.search.terms=r.search.query?r.search.query.split(" "):null;break}}if(r.search.engine===null&&r.referrer_info.search.length>1){for(p=0;p<t.length;p++){var o=r.referrer_info.query[t[p]];if(o){r.search.engine="Unknown";r.search.query=o;r.search.terms=o.split(" ");break}}}}else{r.last_visit=new Date().getTime();r.visits++}d.set_cookie(k,d.package_obj(r),m);return r},html5_location:function(){return function(k){a.geolocation.getCurrentPosition(function(l){l.source="html5";k(l)},function(l){if(j.gapi_location){b.gapi_location()(k)}else{k({error:true,source:"html5"})}})}},gapi_location:function(){return function(l){var k=d.get_obj(j.location_cookie);if(!k||k.source!=="google"){f.gloader_ready=function(){if("google" in f){if(f.google.loader.ClientLocation){f.google.loader.ClientLocation.source="google";l(f.google.loader.ClientLocation)}else{l({error:true,source:"google"})}d.set_cookie(j.location_cookie,d.package_obj(f.google.loader.ClientLocation),j.location_cookie_timeout*60*60*1000)}};d.embed_script("https://www.google.com/jsapi?callback=gloader_ready")}else{l(k)}}},ipinfodb_location:function(k){return function(m){var l=d.get_obj(j.location_cookie);if(l&&l.source==="ipinfodb"){m(l)}f.ipinfocb=function(n){if(n.statusCode==="OK"){n.source="ipinfodb";d.set_cookie(j.location_cookie,d.package_obj(n),j.location_cookie*60*60*1000);m(n)}else{if(j.gapi_location){return b.gapi_location()(m)}else{m({error:true,source:"ipinfodb",message:n.statusMessage})}}};d.embed_script("http://api.ipinfodb.com/v3/ip-city/?key="+k+"&format=json&callback=ipinfocb")}}};var d={parse_url:function(p){var k=h.createElement("a"),o={};k.href=p;query_str=k.search.substr(1);if(query_str!=""){var n=query_str.split("&"),l=0,m=n.length,q;for(;l<m;l++){q=n[l].split("=");if(q.length===2){o[q[0]]=decodeURI(q[1])}}}return{host:k.host,path:k.pathname,protocol:k.protocol,port:k.port===""?80:k.port,search:k.search,query:o}},set_cookie:function(m,n,k,l){if(!m){return null}if(!l){var l={}}if(n===null||n===undefined){k=-1}if(k){l.expires=(new Date().getTime())+k}return(h.cookie=[encodeURIComponent(m),"=",encodeURIComponent(String(n)),l.expires?"; expires="+new Date(l.expires).toUTCString():"","; path="+(l.path?l.path:"/"),l.domain?"; domain="+l.domain:"",(f.location&&f.location.protocol==="https:")?"; secure":""].join(""))},get_cookie:function(l,k){return(k=new RegExp("(?:^|; )"+encodeURIComponent(l)+"=([^;]*)").exec(h.cookie))?decodeURIComponent(k[1]):null},embed_script:function(k){var l=h.createElement("script");l.type="text/javascript";l.src=k;h.getElementsByTagName("body")[0].appendChild(l)},package_obj:function(l){if(!l){return}l.version=c;var k=i.stringify(l);delete l.version;return k},get_obj:function(m){var l;try{l=i.parse(d.get_cookie(m))}catch(k){}if(l&&l.version==c){delete l.version;return l}}};var i={parse:(f.JSON&&f.JSON.parse)||function(k){if(typeof k!=="string"||!k){return null}return(new Function("return "+k))()},stringify:(f.JSON&&f.JSON.stringify)||function(o){var q=typeof o;if(q!=="object"||o===null){if(q==="string"){return'"'+o+'"'}}else{var n,m,p=[],l=(o&&o.constructor===Array);for(n in o){m=o[n];q=typeof m;if(q==="string"){m='"'+m+'"'}else{if(q==="object"&&m!==null){m=this.stringify(m)}}p.push((l?"":'"'+n+'":')+m)}return(l?"[":"{")+p.join(",")+(l?"]":"}")}}};g()});if(typeof(window.exports)==="undefined"){session_fetch(window,document,navigator)}else{window.exports.session=session_fetch};