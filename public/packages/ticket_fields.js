!function(d){d.fn.tabby=function(f){var g=d.extend({},d.fn.tabby.defaults,f);var h=d.fn.tabby.pressed;return this.each(function(){$this=d(this);var i=d.meta?d.extend({},g,$this.data()):g;$this.bind("keydown",function(k){var j=d.fn.tabby.catch_kc(k);if(16==j){h.shft=true}if(17==j){h.ctrl=true;setTimeout("jQuery.fn.tabby.pressed.ctrl = false;",1000)}if(18==j){h.alt=true;setTimeout("jQuery.fn.tabby.pressed.alt = false;",1000)}if(9==j&&!h.ctrl&&!h.alt){k.preventDefault;h.last=j;setTimeout("jQuery.fn.tabby.pressed.last = null;",0);e(d(k.target).get(0),h.shft,i);return false}}).bind("keyup",function(j){if(16==d.fn.tabby.catch_kc(j)){h.shft=false}}).bind("blur",function(j){if(9==h.last){d(j.target).one("focus",function(k){h.last=null}).get(0).focus()}})})};d.fn.tabby.catch_kc=function(f){return f.keyCode?f.keyCode:f.charCode?f.charCode:f.which};d.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function b(f){if(window.console&&window.console.log){window.console.log("textarea count: "+f.size())}}function e(i,h,g){var f=i.scrollTop;if(i.setSelectionRange){a(i,h,g)}else{if(document.selection){c(i,h,g)}}i.scrollTop=f}d.fn.tabby.defaults={tabString:String.fromCharCode(9)};function a(j,f,u){var t=j.selectionStart;var r=j.selectionEnd;if(t==r){if(f){if("\t"==j.value.substring(t-u.tabString.length,t)){j.value=j.value.substring(0,t-u.tabString.length)+j.value.substring(t);j.focus();j.setSelectionRange(t-u.tabString.length,t-u.tabString.length)}else{if("\t"==j.value.substring(t,t+u.tabString.length)){j.value=j.value.substring(0,t)+j.value.substring(t+u.tabString.length);j.focus();j.setSelectionRange(t,t)}}}else{j.value=j.value.substring(0,t)+u.tabString+j.value.substring(t);j.focus();j.setSelectionRange(t+u.tabString.length,t+u.tabString.length)}}else{var v=j.value.split("\n");var s=new Array();var l=0;var h=0;var g=false;for(var n in v){h=l+v[n].length;s.push({start:l,end:h,selected:(l<=t&&h>t)||(h>=r&&l<r)||(l>t&&h<r)});l=h+1}var k=0;for(var n in s){if(s[n].selected){var q=s[n].start+k;if(f&&u.tabString==j.value.substring(q,q+u.tabString.length)){j.value=j.value.substring(0,q)+j.value.substring(q+u.tabString.length);k-=u.tabString.length}else{if(!f){j.value=j.value.substring(0,q)+u.tabString+j.value.substring(q);k+=u.tabString.length}}}}j.focus();var p=t+((k>0)?u.tabString.length:(k<0)?-u.tabString.length:0);var m=r+k;j.setSelectionRange(p,m)}}function c(q,w,f){var p=document.selection.createRange();if(q==p.parentElement()){if(""==p.text){if(w){var l=p.getBookmark();p.moveStart("character",-f.tabString.length);if(f.tabString==p.text){p.text=""}else{p.moveToBookmark(l);p.moveEnd("character",f.tabString.length);if(f.tabString==p.text){p.text=""}}p.collapse(true);p.select()}else{p.text=f.tabString;p.collapse(false);p.select()}}else{var k=p.text;var n=k.length;var u=k.split("\r\n");var z=document.body.createTextRange();z.moveToElementText(q);z.setEndPoint("EndToStart",p);var m=z.text;var x=m.split("\r\n");var r=m.length;var y=document.body.createTextRange();y.moveToElementText(q);y.setEndPoint("StartToEnd",p);var v=y.text;var g=document.body.createTextRange();g.moveToElementText(q);g.setEndPoint("StartToEnd",z);var s=g.text;var h=d(q).html();d("#r3").text(r+" + "+n+" + "+v.length+" = "+h.length);if((r+s.length)<h.length){x.push("");r+=2;if(w&&f.tabString==u[0].substring(0,f.tabString.length)){u[0]=u[0].substring(f.tabString.length)}else{if(!w){u[0]=f.tabString+u[0]}}}else{if(w&&f.tabString==x[x.length-1].substring(0,f.tabString.length)){x[x.length-1]=x[x.length-1].substring(f.tabString.length)}else{if(!w){x[x.length-1]=f.tabString+x[x.length-1]}}}for(var t=1;t<u.length;t++){if(w&&f.tabString==u[t].substring(0,f.tabString.length)){u[t]=u[t].substring(f.tabString.length)}else{if(!w){u[t]=f.tabString+u[t]}}}if(1==x.length&&0==r){if(w&&f.tabString==u[0].substring(0,f.tabString.length)){u[0]=u[0].substring(f.tabString.length)}else{if(!w){u[0]=f.tabString+u[0]}}}if((r+n+v.length)<h.length){u.push("");n+=2}z.text=x.join("\r\n");p.text=u.join("\r\n");var j=document.body.createTextRange();j.moveToElementText(q);if(0<r){j.setEndPoint("StartToEnd",z)}else{j.setEndPoint("StartToStart",z)}j.setEndPoint("EndToEnd",p);j.select()}}}}(window.jQuery||window.ender);var $t=Class.create({initialize:function(a){this.id=a||"0";this.children=$H()},set:function(a,b){this.children.set(a,b)},get:function(a){return(a!="...")?this.children.get(a):""}});var NestedField=Class.create({initialize:function(a){this._blank="...";this.tree=new $H();this.readData(a)},readData:function(a){delete this.tree;this.tree=new $H();this.third_level=this.second_level=false;if(typeof a=="string"){this.parseString(a)}else{if(typeof a=="object"){this.parseObject(a)}}},removeTests:function(a){return a.replace(/[\t\r]/g,"").strip()},testChar:function(a){return/[\t\r]/g.test(a)},parseObject:function(a){_self=this;a.each(function(b){_self.tree.set(b[0],new $t(b[1]));if(!b[2]){return}b[2].each(function(c){_self.tree.get(b[0]).set(c[0],new $t(c[1]));_self.setSecondPresent();if(!c[2]){return}c[2].each(function(d){_self.tree.get(b[0]).get(c[0]).set(d[0],new $t(d[1]));_self.setThirdPresent()})})})},parseString:function(a){_self=this,_category="",_subcategory="",_item="",_caseoption="";a.split("\n").each(function(b){try{_caseoption=(_self.testChar(b[0]))?((_self.testChar(b[1]))?2:1):0;b=_self.removeTests(b);if(b==""){return}switch(_caseoption){case 0:_self.tree.set(b,new $t());_category=b;break;case 1:_self.tree.get(_category).set(b,new $t());_subcategory=b;_self.setSecondPresent();break;case 2:_self.tree.get(_category).get(_subcategory).set(b,new $t());_self.setThirdPresent();break}}catch(c){}})},setThirdPresent:function(){this.third_level=true},setSecondPresent:function(){this.second_level=true},getCategory:function(){_categories=[];this.tree.each(function(a){_categories.push("<option value="+a.value.id+">"+a.key+"</option>")});return _categories.join()},getCategoryEscaped:function(){_categories=[];this.tree.each(function(a){_categories.push("<option value="+escapeHtml(a.value.id)+">"+escapeHtml(a.key)+"</option>")});return _categories.join()},getSubcategory:function(a){_subcategories=[];if(this.tree.get(a)&&this.tree.get(a).children){this.tree.get(a).children.each(function(b){_subcategories.push("<option value="+b.value.id+">"+b.key+"</option>")})}if(!_subcategories.first()){_subcategories=["<option value='0'>"+this._blank+"</option>"]}return _subcategories.join()},getSubcategoryEscaped:function(a){_subcategories=[];if(this.tree.get(a)&&this.tree.get(a).children){this.tree.get(a).children.each(function(b){_subcategories.push("<option value="+escapeHtml(b.value.id)+">"+escapeHtml(b.key)+"</option>")})}if(!_subcategories.first()){_subcategories=["<option value='0'>"+this._blank+"</option>"]}return _subcategories.join()},getItems:function(a,b){_items=[];console.log("category_key: "+a);console.log("subcategory_key: "+b);if(this.tree.get(a)){if(this.tree.get(a).get(b).children){this.tree.get(a).get(b).children.each(function(c){_items.push("<option value="+c.value.id+">"+c.key+"</option>")})}}console.log("ITEMS: "+_items);return(_items.first())?_items.join():false},getItemsEscaped:function(a,b){_items=[];console.log("category_key: "+a);console.log("subcategory_key: "+b);if(this.tree.get(a)){if(this.tree.get(a).get(b).children){this.tree.get(a).get(b).children.each(function(c){_items.push("<option value="+escapeHtml(c.value.id)+">"+escapeHtml(c.key)+"</option>")})}}console.log("ITEMS: "+_items);return(_items.first())?_items.join():false},getCategoryList:function(){_categories=[];this.tree.each(function(a){_categories.push(a.key)});return _categories},getSubcategoryList:function(a){return((a&&a!="-1")?this.tree.get(a).children:$H())||$H()},getItemsList:function(a,b){return((b&&b!="-1"&&this.tree.get(a))?this.tree.get(a).get(b).children:$H())||$H()},toString:function(){_self=this,_treeString="";_self.tree.each(function(a){_treeString+=unescapeHtml(a.key)+"\n";a.value.children.each(function(b){_treeString+="\t"+unescapeHtml(b.key)+"\n";b.value.children.each(function(c){_treeString+="\t\t"+unescapeHtml(c.key)+"\n"})})});return _treeString},toArray:function(){_self=this,_category_array=[];_self.tree.each(function(a){var b=[];a.value.children.each(function(d){var c=[];d.value.children.each(function(e){c.push([escapeHtml(e.key),escapeHtml(e.value.id)])});b.push((c.size())?[escapeHtml(d.key),escapeHtml(d.value.id),c]:[escapeHtml(d.key),(d.value.id)])});_category_array.push((b.size())?[escapeHtml(a.key),escapeHtml(a.value.id),b]:[escapeHtml(a.key),escapeHtml(a.value.id)])});return _category_array}});(function(a){ticket_fields_modified=false;a(document).ready(b);function b(){var l=tf_settings,c=null,r=null,y=null,p=true,g=new NestedField(""),e=null,B="div#CustomFieldsDialog";a.validator.addMethod("nestedTree",function(G,F,H){_condition=true;if(e.field_type=="nested_field"){g.readData(G);_condition=g.second_level}return _condition},"You need atleast one category & sub-category");a.validator.addMethod("uniqueNames",function(G,F,H){_condition=true;levels=[1,2,3];if(e.field_type=="nested_field"){current_level=a(F).data("level");levels.each(function(I){if(current_level==I||!_condition){return}_condition=(a("#agentlevel"+I+"label").val().strip().toLowerCase()!=a(F).val().strip().toLowerCase())})}return _condition},"Agent label should not be same as other two levels");var D={field_type:jQuery(B+' input[name|="customtype"]'),label:jQuery(B+' input[name|="customlabel"], #agentlevel1label'),label_in_portal:jQuery(B+' input[name|="customlabel_in_portal"], #customerslabel'),description:jQuery(B+' input[name|="customdesc"]'),active:jQuery(B+' input[name|="customactive"]'),required:jQuery(B+' input[name|="agentrequired"]'),required_for_closure:jQuery(B+' input[name|="agentclosure"]'),visible_in_portal:jQuery(B+' input[name|="customervisible"]'),editable_in_portal:jQuery(B+' input[name|="customereditable"]'),required_in_portal:jQuery(B+' input[name|="customerrequired"]'),choices:jQuery(B+' div[name|="customchoices"]'),portalcc:jQuery(B+' input[name|="portalcc"]'),portalcc_to:jQuery(B+' input[name|="portalcc_to"]'),};var C=$H({type:"text",dom_type:"text",field_type:"",label:tf_lang.untitled,label_in_portal:"",description:"",field_type:"custom",active:true,required:false,required_for_closure:false,visible_in_portal:true,editable_in_portal:true,required_in_portal:false,id:null,choices:[],levels:[],portalcc:false,portalcc_to:"all",action:"create"});a(document).keyup(function(F){if(F.keyCode==27){a("#cancel-button").trigger("click")}});a("input[rel=status-companion]").live({keyup:function(F){if(a(this).data("companionEmpty")){a(this).parent().parent().find("input[name=customer_display_name]").val(this.value)}},focus:function(F){_entity=a(this).parent().parent().find("input[name=customer_display_name]");a(this).data("companionEmpty",(_entity&&_entity.val().strip()===""))}});a("#nestedTextarea").bind("focusin",function(F){jQuery(this).prop("rows",18)}).tabby();a("#nestedDoneEdit").click(function(F){F.preventDefault();g.readData(a("#nestedTextarea").val());a("#nestedTextarea").trigger("blur");a("#nest-category").html(g.getCategoryEscaped()).trigger("change");setTimeout(s,200)});a("#nest-category").change(function(F){a("#nest-subcategory").html(g.getSubcategoryEscaped(a(this).children("option:selected").text())).trigger("change")});a("#nest-subcategory").change(function(F){a("#nest-item").html(g.getItemsEscaped(a("#nest-category option:selected").text(),a(this).children("option:selected").text()))});a("#nested-edit-button").click(function(F){F.preventDefault();h()});function h(){a("#nestedTextarea-error").hide();a("#nestedEdit").slideDown();a("#nested-selectboxs").slideUp()}function s(){if(!a("#nestedTextarea").hasClass("error")){a("#nestedEdit").slideUp();a("#nested-selectboxs").slideDown()}}a("#portalcc_id").click(function(F){a("#cc_to_option").toggle()});function o(H,F){var K=F||jQuery("<li />");K.empty();var G=jQuery("<label />").append(H.label);var J=jQuery("<div />");var I="";switch(H.dom_type){case"requester":H.type="text";break;case"dropdown_blank":H.type="dropdown";break;case"html_paragraph":H.type="paragraph";break;default:H.type=H.dom_type}switch(H.dom_type){case"text":case"number":J.append('<input type="text" '+I+' disabled="true" />');K.append(G);break;case"requester":J.append('<input type="text" '+I+' disabled="true" />');J.append('<span>&nbsp;<a href="#" class="underline">Add cc</a></span>');K.append(G);break;case"checkbox":J.append('<input type="checkbox" disabled="true" '+I+" />"+H.label);break;case"dropdown":case"dropdown_blank":if(H.field_type=="nested_field"){g=new NestedField(H.choices);category=a("<select disabled='disabled' />").append(g.getCategory());K.append(G).append(category)}else{if(H.field_type=="default_status"){H.choices.each(function(L){J.append("<option value="+L.status_id+">"+escapeHtml(L.name)+"</option>")})}else{a(H.choices).each(function(M,L){J.append("<option "+L[1]+">"+L[0]+"</option>")})}J.wrapInner("<select "+I+" disabled='true' />");K.append(G)}break;case"paragraph":case"html_paragraph":J.append('<textarea disabled="true"'+I+"></textarea>");K.append(G);break}K.addClass((H.field_type=="nested_field")?"nestedfield":H.dom_type).append(J);a(J).prepend("<span class='overlay-field' />");if(H.action){ticket_fields_modified=true}K.data("raw",H);return K}function j(F,H){var G=C.toObject();G.field_type=H;G.dom_type=F;if(H=="nested_field"){text="category 1 \n\tsubcategory 1\n\t\titem 1\n\t\titem 2\n\tsubcategory 2\n\t\titem 1\n\t\titem 2\n\tsubcategory 3\ncategory 2 \n\tsubcategory 1\n\t\titem 1\n\t\titem 2\n";G.choices=text;G.levels=[{level:2},{level:3}]}else{if(H=="custom_dropdown"){G.choices=[[tf_lang.first_choice,0],[tf_lang.second_choice,0]]}}return G}function u(){var F=$A();jQuery("#custom_form li").each(function(G,I){var H=a(I).data("raw");delete H.portalcc;delete H.portalcc_to;delete H.dom_type;delete H.level_three_present;F.push(H)});return F}function z(F){a(F).each(function(H,G){var I=o(G);a("#custom_form").append(I)})}z(l);a("#custom_fields li").draggable({connectToSortable:"#custom_form",helper:"clone",stack:"#custom_fields li",revert:"invalid"});a("#custom_form").sortable({revert:true,start:function(F,G){w()},stop:function(F,G){if(G.item.data("fresh")){field_label=G.item.text();type=G.item.data("type");field_type=G.item.data("fieldType");if(type){showFieldDialog(o(j(type,field_type),G.item))}ticket_fields_modified=true}}}).droppable();a(".customchoices").sortable({items:"fieldset",handle:".sort_handle",stop:function(F){A()}});if(a.browser.msie){a(".ui-custom-form li").hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")})}a("#close_button, #cancel-button").click(function(F){if(a(r).data("fresh")){a(r).remove()}x()});function t(F){if(F.checked){a("#"+F.getAttribute("toggle_ele")).children("label").removeClass("disabled").children("input:checkbox").attr("disabled",false)}else{a("#"+F.getAttribute("toggle_ele")).find("label").addClass("disabled").children("input:checkbox").prop("checked",false).prop("disabled",true)}}a("#nestedConfig").find("input:checkbox").bind("change",function(F){t(this)});function d(H,I){I=I||D.choices;H=H||["",0];var G=a("<input type='text' />").val(unescapeHtml(H[0])).attr("data_id",H[1]).change(function(){a("#ChoiceListValidation").next("label").hide()});var F=a("<span class='dropchoice' />").append(G);a("<fieldset />").append("<span class='sort_handle' />").append('<img class="deleteChoice" src="/images/delete.png" />').append(F).appendTo(I)}function n(F){_template=a("#statusTemplate").template();F=F||[{status_id:0,name:"",customer_display_name:"",stop_sla_timer:false}];F.each(function(G){a.tmpl(_template,G).appendTo((G.deleted)?"#statuschoicesdeleted":"#statuschoices")})}function k(){var F=[];a.each(a("#statuschoices fieldset"),function(G,I){var H=$H();a.each(a(I).find("input"),function(K,J){_value=J.value;if(J.type=="checkbox"){_value=(a(J).prop("checked"))}if(J.name=="status_id"){_value=parseInt(J.value)}if(J.name=="customer_display_name"){_value=J.value||a(J).parent().parent().find("input[name=name]").val()}H.set(J.name,_value)});F.push(H.toObject())});return F}function q(F){var G=$A();F.find("fieldset").each(function(I){var H=["",0],J=a(this).find("span.dropchoice input");H[0]=escapeHtml(J.val());H[1]=J.attr("data_id");if(a.trim(H[0])!==""){G.push(H)}});return G}jQuery("#DropFieldChoices .deleteChoice").live("click",function(){if(jQuery(this).parent().siblings().size()!==0){jQuery(this).parent().remove();A()}});jQuery("#statuschoices .deleteChoice").live("click",function(){if(jQuery(this).hasClass("disabled")){return}jQuery(this).parent().hide().find("input[name=deleted]").prop("checked",true)});jQuery("#addchoice").live("click",function(){d()});jQuery("#addstatus").live("click",function(){n()});function A(){var F=$H(a(r).data("raw"));F.set("choices",q(D.choices));i(F,"edit");o(F.toObject(),a(r))}function x(){jQuery("#CustomFieldsDialog").css({visibility:"hidden"});jQuery("#nestedTextarea").prop("rows",6);a("#SaveForm").prop("disabled",false);p=true}function i(G,F){switch(F){case"edit":if(G.get("action")!="create"){G.set("action",F)}break}}function m(F){try{a("#TicketProperties").find(":input").each(function(){switch(this.type){case"text":case"textarea":a(this).val("");break}});a("#ChoiceListValidation").next("label").hide();a(r).removeClass("active");r=F;y={label:a(F).find("label")};a(F).addClass("active");e=a(F).data("raw");D.field_type.val(e.type);D.label.val(unescapeHtml(e.label));D.label_in_portal.val(unescapeHtml(e.label_in_portal));D.description.val(e.description);a("div#CustomFieldsDialog label.overlabel").overlabel();D.choices.empty();a("#nestedContainer").hide();a("#nested-selectboxs").hide();a("#nestedEdit").hide();a("#StatusFieldChoices").hide();a("#statuschoices").empty();if(e.field_type=="default_requester"){E(F)}if(e.field_type=="nested_field"){a("#nestedContainer").show();a("#NestedFieldLabels").show();a("#nested-selectboxs").show();g.readData(e.choices);a("#nestedTextarea").val(g.toString());a("#nest-category").html(g.getCategory()).trigger("change");e.levels.each(function(H){H.label?a("#agentlevel"+H.level+"label").val(unescapeHtml(H.label)):a("#agentlevel"+H.level+"label").val(H.label);H.label_in_portal?a("#customerslevel"+H.level+"label").val(unescapeHtml(H.label_in_portal)):a("#customerslevel"+H.level+"label").val(H.label_in_portal)})}else{if(e.field_type=="default_status"){a("#StatusFieldChoices").show();n(e.choices)}else{e.choices.each(function(H){d(H,D.choices)})}}a("#NestedFieldLabels").toggle(e.field_type=="nested_field");a("#FieldLabels").toggle(e.field_type!="nested_field");D.required.attr("checked",e.required);D.required_for_closure.attr("checked",e.required_for_closure);D.visible_in_portal.attr("checked",e.visible_in_portal);t(D.visible_in_portal.get(0));D.editable_in_portal.attr("checked",e.editable_in_portal);t(D.editable_in_portal.get(0));D.required_in_portal.attr("checked",e.required_in_portal);a("#DropFieldChoices").hide();a("#AgentMandatory").hide();a("#CustomerConditions").hide();a("#req_field_options").show();a("#agent_cc_field").show();if(e.field_type!="default_requester"){a("#AgentMandatory").show();a("#CustomerConditions").show();a("#req_field_options").hide();a("#agent_cc_field").hide()}if(/^default/.test(e.field_type)){D.label.attr("disabled",true);D.label.addClass("disabled");a("#DeleteField").hide()}else{a("#DeleteField").show();D.label.attr("disabled",false);D.label.removeClass("disabled")}switch(e.field_type){case"custom_dropdown":case"default_ticket_type":a("#DropFieldChoices").show();break}}catch(G){}}function E(F){e=a(F).data("raw");a.each(e.field_options,(function(G,H){switch(G){case"portalcc":D.portalcc.attr("checked",H);if(H){a("#cc_to_option").show()}break;case"portalcc_to":D.portalcc_to.filter("[value="+H+"]").attr("checked",true);break}}))}function w(){if(r!==null){var H=$H(a(r).data("raw")),G=H.get("field_type");H.set("label",escapeHtml(D.label.val()));H.set("label_in_portal",escapeHtml(D.label_in_portal.val()));H.set("description",D.description.val());H.set("required",D.required.prop("checked"));H.set("required_for_closure",D.required_for_closure.prop("checked"));H.set("visible_in_portal",D.visible_in_portal.prop("checked"));H.set("editable_in_portal",D.editable_in_portal.prop("checked"));H.set("required_in_portal",D.required_in_portal.prop("checked"));if(G=="default_requester"){var F={portalcc:D.portalcc.prop("checked"),portalcc_to:D.portalcc_to.filter(":checked").val(),};H.set("field_options",F);H.set("required",true);H.set("required_for_closure",false);H.set("visible_in_portal",true);H.set("editable_in_portal",true);H.set("required_in_portal",true)}if(G=="nested_field"){f(H);H.set("label",escapeHtml(a("#agentlevel1label").val()));H.set("label_in_portal",escapeHtml(a("#customerslabel").val()));H.set("choices",g.toArray())}else{if(G=="default_status"){H.set("choices",k())}else{H.set("choices",q(D.choices))}}i(H,"edit");o(H.toObject(),a(r));a(r).data("fresh",false)}}function f(F){levels=F.get("levels");action=(F.get("level_three_present"))?((g.third_level)?"edit":"delete"):"create";if(levels.size()<2){levels.push({level:3})}if(!F.get("level_three_present")&&!g.third_level){levels.pop()}F.set("levels",levels.map(function(G){return{label:escapeHtml(a("#agentlevel"+G.level+"label").val()),label_in_portal:escapeHtml(a("#customerslevel"+G.level+"label").val()),description:"",level:G.level,id:(G.id||null),position:1,type:"dropdown",action:(G.level==3)?action:"edit"}}))}a("#TicketProperties").submit(function(){return false}).validate({submitHandler:function(){w();x()},rules:{choicelist:{required:{depends:function(F){a("#ChoiceListValidation").val("");if(a("#DropFieldChoices").css("display")=="block"){choiceValues="";a.each(a("#DropFieldChoices").find("input"),function(G,H){choiceValues+=H.value});return(a.trim(choiceValues)=="")}else{return false}}}},customlabel:{required:{depends:function(F){return(a("#FieldLabels").css("display")!="none")}}},customlabel_in_portal:{required:{depends:function(F){return(a("#FieldLabels").css("display")!="none")}}},agentlabel:{required:{depends:function(F){return(a("#NestedFieldLabels").css("display")!="none")}},uniqueNames:true},customerslabel:{required:{depends:function(F){return(a("#NestedFieldLabels").css("display")!="none")}}},agentlevel2label:{required:{depends:function(F){return(a("#NestedFieldLabels").css("display")!="none")}},uniqueNames:true},customerslevel2label:{required:{depends:function(F){return(a("#NestedFieldLabels").css("display")!="none")}}},agentlevel3label:{required:{depends:function(F){return((a("#NestedFieldLabels").css("display")!="none")&&g.third_level)}},uniqueNames:true},customerslevel3label:{required:{depends:function(F){return((a("#NestedFieldLabels").css("display")!="none")&&g.third_level)}}},nestedTextarea:{required:{depends:function(F){return(a("#NestedFieldLabels").css("display")!="none")}},nestedTree:true}},messages:{choicelist:tf_lang.no_choice_message,agentlevel3label:{required:"Label required for 3rd level items"},customerslevel3label:{required:"Label required for 3rd level items"}},onkeyup:false,onclick:false});a("#CustomFieldsDialog input").live("change",function(){var F=$H(a(r).data("raw"));switch(this.name){case"choice":F.set("choices",q(D.choices));break;case"customlabel":field_label=a.trim(this.value);if(field_label===""){field_label=tf_lang.untitled}F.set("label",field_label);F.set("label_in_portal",field_label);this.value=field_label;break;case"customlabel_in_portal":F.set("label_in_portal",this.value);break;case"customdesc":F.set("description",this.value);break;case"agentrequired":F.set("required",a(this).attr("checked"));break;case"agentclosure":F.set("required_for_closure",a(this).attr("checked"));break;case"customervisible":F.set("visible_in_portal",a(this).attr("checked"));if(F.get("visible_in_portal")===false){F.set("editable_in_portal",false);F.set("required_in_portal",false)}break;case"customereditable":F.set("editable_in_portal",a(this).attr("checked"));if(F.get("editable_in_portal")===false){F.set("required_in_portal",false)}break;case"customerrequired":F.set("required_in_portal",a(this).attr("checked"));break}i(F,"edit")});var v=function(G){if(confirm(tf_lang.confirm_delete)){var F=a(G).data("raw");if(F.id===""||F.id===null){a(G).remove()}else{F.action="delete";a(G).hide()}x()}};a("#DeleteField").live("click",function(F){v(r)});a("#CustomFieldsDialog").draggable();showFieldDialog=function(F){m(F);offset=a(F).offset();offset.left+=(a(F).width()-50);offset.top-=50;a("#SaveForm").prop("disabled",true);a("#CustomFieldsDialog").css("top",jQuery(document).scrollTop()+"px");if(p){a("#CustomFieldsDialog").show().css("visibility","visible");p=false}};a("#custom_form li").live("click",function(F){showFieldDialog(this)});a("#SaveForm").click(function(G){G.preventDefault();var F=u();a("#field_values").val(F.toJSON());this.value=a(this).data("commit");a(this).prop("disabled",true);a("#Updateform").trigger("submit")})}})(jQuery);