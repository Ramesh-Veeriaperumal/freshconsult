<%= javascript_include_tag "harvest" %>

<div id="harvest_widget">
	<div id="content">Harvest widget</div>
</div>
<script type="text/javascript">
		ObjectFactory.create(HarvestWidget, {
			id: 20141601,
			domain: 'hirickross.harvestapp.com',
			ssl_enabled: true,
			display_id: 2,
			ticket_id: 2323,
			isEmpty: false
		});
</script>




(function(a){a.idleTimer=function(l,d){var e=false,h=true,j=30000,m="mousemove keydown DOMMouseScroll mousewheel mousedown";d=d||document;var g=function(p){if(typeof p=="number"){p=undefined;}var o=a.data(p||d,"idleTimerObj");o.idle=!o.idle;o.olddate=+new Date;var n=jQuery.Event(a.data(d,"idleTimer",o.idle?"idle":"active")+".idleTimer");n.stopPropagation();a(d).trigger(n);},k=function(n){var o=a.data(n,"idleTimerObj");o.enabled=false;clearTimeout(o.tId);a(n).unbind(".idleTimer");},c=function(){var n=a.data(this,"idleTimerObj");clearTimeout(n.tId);if(n.enabled){if(n.idle){g(this);}n.tId=setTimeout(g,n.timeout);}};var f=a.data(d,"idleTimerObj")||new function(){};f.olddate=f.olddate||+new Date;if(typeof l=="number"){j=l;}else{if(l==="destroy"){k(d);return this;}else{if(l==="getElapsedTime"){return(+new Date)-f.olddate;}}}a(d).bind(a.trim((m+" ").split(" ").join(".idleTimer ")),c);f.idle=e;f.enabled=h;f.timeout=j;f.tId=setTimeout(g,f.timeout);a.data(d,"idleTimer","active");a.data(d,"idleTimerObj",f);};a.fn.idleTimer=function(c){this[0]&&a.idleTimer(c,this[0]);return this;};})(jQuery);(function(c){var a=function(){var d=function(){};d.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(h,g,f,j){if(!j){this.context=g;this.buffer=[];}if(!this.includes("",h)){if(j){return h;}else{this.send(h);return;}}h=this.render_pragmas(h);var e=this.render_section(h,g,f);if(j){return this.render_tags(e,g,f,j);}this.render_tags(e,g,f,j);},send:function(e){if(e!==""){this.buffer.push(e);}},render_pragmas:function(e){if(!this.includes("%",e)){return e;}var g=this;var f=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag,"g");return e.replace(f,function(k,h,j){if(!g.pragmas_implemented[h]){throw ({message:"This implementation of mustache doesn't understand the '"+h+"' pragma"});}g.pragmas[h]={};if(j){var l=j.split("=");g.pragmas[h][l[0]]=l[1];}return"";});},render_partial:function(e,g,f){e=this.trim(e);if(!f||f[e]===undefined){throw ({message:"unknown_partial '"+e+"'"});}if(typeof(g[e])!="object"){return this.render(f[e],g,f,true);}return this.render(f[e],g[e],f,true);},render_section:function(g,f,e){if(!this.includes("#",g)&&!this.includes("^",g)){return g;}var j=this;var h=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return g.replace(h,function(l,m,k,n){var o=j.find(k,f);if(m=="^"){if(!o||j.is_array(o)&&o.length===0){return j.render(n,f,e,true);}else{return"";}}else{if(m=="#"){if(j.is_array(o)){return j.map(o,function(p){return j.render(n,j.create_context(p),e,true);}).join("");}else{if(j.is_object(o)){return j.render(n,j.create_context(o),e,true);}else{if(typeof o==="function"){return o.call(f,n,function(p){return j.render(p,f,e,true);});}else{if(o){return j.render(n,f,e,true);}else{return"";}}}}}}});},render_tags:function(n,e,g,j){var h=this;var m=function(){return new RegExp(h.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+h.ctag+"+","g");};var k=m();var l=function(r,p,q){switch(p){case"!":return"";case"=":h.set_delimiters(q);k=m();return"";case">":return h.render_partial(q,e,g);case"{":return h.find(q,e);default:return h.escape(h.find(q,e));}};var o=n.split("\n");for(var f=0;f<o.length;f++){o[f]=o[f].replace(k,l,this);if(!j){this.send(o[f]);}}if(j){return o.join("\n");}},set_delimiters:function(f){var e=f.split(" ");this.otag=this.escape_regex(e[0]);this.ctag=this.escape_regex(e[1]);},escape_regex:function(f){if(!arguments.callee.sRE){var e=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+e.join("|\\")+")","g");}return f.replace(arguments.callee.sRE,"\\$1");},find:function(f,g){f=this.trim(f);function e(j){return j===false||j===0||j;}var h;if(e(g[f])){h=g[f];}else{if(e(this.context[f])){h=this.context[f];}}if(typeof h==="function"){return h.apply(g);}if(h!==undefined){return h;}return"";},includes:function(f,e){return e.indexOf(this.otag+f)!=-1;},escape:function(e){e=String(e===null?"":e);return e.replace(/&(?!\w+;)|["'<>\\]/g,function(f){switch(f){case"&":return"&amp;";case"\\":return"\\\\";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return f;}});},create_context:function(f){if(this.is_object(f)){return f;}else{var g=".";if(this.pragmas["IMPLICIT-ITERATOR"]){g=this.pragmas["IMPLICIT-ITERATOR"].iterator;}var e={};e[g]=f;return e;}},is_object:function(e){return e&&typeof e=="object";},is_array:function(e){return Object.prototype.toString.call(e)==="[object Array]";},trim:function(e){return e.replace(/^\s*|\s*$/g,"");},map:function(j,g){if(typeof j.map=="function"){return j.map(g);}else{var h=[];var e=j.length;for(var f=0;f<e;f++){h.push(g(j[f]));}return h;}}};return({name:"mustache.js",version:"0.3.1-dev",to_html:function(g,e,f,j){var h=new d();if(j){h.send=j;}h.render(g,e,f);if(!j){return h.buffer.join("\n");}}});}();c.mustache=function(f,d,e){return a.to_html(f,d,e);};})(jQuery);(function(a){jQuery.fn.observe_field=function(c,d){c=c*1000;return this.each(function(){var j=a(this);var h=j.val();var e=function(){var k=j.val();if(h!=k){h=k;j.map(d);}};var g=function(){if(f){clearInterval(f);f=setInterval(e,c);}};e();var f=setInterval(e,c);j.bind("keyup click mousemove",g);});};})(jQuery);(function(c){function a(d){this.input=d;d.data(a.DATA_ATTRIBUTE,this);if(d.attr("type")=="password"){this.handlePassword();}c(d[0].form).submit(function(){if(d.hasClass("placeholder")){d.val("");}});}a.DATA_ATTRIBUTE="jquery.placeholder";a.NATIVE_SUPPORT=!!("placeholder" in document.createElement("input"));a.prototype={show:function(f){if(this.input.val()===""||(f&&this.valueIsPlaceholder())){if(this.isPassword){try{this.input[0].setAttribute("type","text");}catch(d){this.input.before(this.fakePassword.show()).hide();}}this.input.val(this.input.attr("placeholder"));this.input.addClass("placeholder");}},hide:function(){if(this.valueIsPlaceholder()&&this.input.hasClass("placeholder")){this.input.removeClass("placeholder");this.input.val("");if(this.isPassword){try{this.input[0].setAttribute("type","password");}catch(d){}this.input.show();this.input[0].focus();}}},valueIsPlaceholder:function(){return this.input[0].value==this.input.attr("placeholder");},handlePassword:function(){var d=this.input;d.attr("realType","password");this.isPassword=true;if(c.browser.msie&&d[0].outerHTML){var e=d[0].outerHTML.replace(/type=(['"])?password\1/gi,"type=$1text$1");this.fakePassword=c(e).val(d.attr("placeholder")).addClass("placeholder").focus(function(){d.trigger("focus");c(this).hide();});}}};c.fn.placeholder=function(){return a.NATIVE_SUPPORT?this:this.each(function(){var d=c(this);var e=new a(d);e.show(true);d.focus(function(){e.hide();});d.blur(function(){e.show(false);});if(c.browser.msie){c(window).load(function(){if(d.val()){d.removeClass("placeholder");}e.show(true);});d.focus(function(){if(c(this).val()===""){var f=this.createTextRange();f.collapse(true);f.moveStart("character",0);f.select();}});}});};c.fn.resetPlaceholder=function(){return a.NATIVE_SUPPORT?this:this.each(function(){var d=c(this).data(a.DATA_ATTRIBUTE);if(d){d.hide();d.show();}});};})(jQuery);jQuery.extend({queryParameters:function(){var e=[],d;var a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var c=0;c<a.length;c++){d=a[c].split("=");d[1]=decodeURIComponent((d[1]||"").replace(/\+/g," "));e.push(d[0]);e[d[0]]=d[1];}return e;}});(function(e){e.timeago=function(h){if(h instanceof Date){return a(h);}else{if(typeof h=="string"){return a(e.timeago.parse(h));}else{return a(e.timeago.datetime(h));}}};var g=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:60000,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(n){var o=this.settings.strings;var k=o.prefixAgo;var s=o.suffixAgo;if(this.settings.allowFuture){if(n<0){k=o.prefixFromNow;s=o.suffixFromNow;}n=Math.abs(n);}var q=n/1000;var h=q/60;var p=h/60;var r=p/24;var l=r/365;function j(u,w){var v=e.isFunction(u)?u(w,n):u;var y=(o.numbers&&o.numbers[w])||w;return v.replace(/%d/i,y);}var m=q<45&&j(o.seconds,Math.round(q))||q<90&&j(o.minute,1)||h<45&&j(o.minutes,Math.round(h))||h<90&&j(o.hour,1)||p<24&&j(o.hours,Math.round(p))||p<48&&j(o.day,1)||r<30&&j(o.days,Math.floor(r))||r<60&&j(o.month,1)||r<365&&j(o.months,Math.floor(r/30))||l<2&&j(o.year,1)||j(o.years,Math.floor(l));return e.trim([k,m,s].join(" "));},parse:function(j){var h=e.trim(j);h=h.replace(/\.\d\d\d+/,"");h=h.replace(/-/,"/").replace(/-/,"/");h=h.replace(/T/," ").replace(/Z/," UTC");h=h.replace(/([\+-]\d\d)\:?(\d\d)/," $1$2");return new Date(h);},datetime:function(j){var k=e(j).get(0).tagName.toLowerCase()=="time";var h=k?e(j).attr("datetime"):e(j).attr("title");return g.parse(h);}});e.fn.timeago=function(){var j=this;j.each(d);var h=g.settings;if(h.refreshMillis>0){setInterval(function(){j.each(d);},h.refreshMillis);}return j;};function d(){var h=c(this);if(!isNaN(h.datetime)){e(this).text(a(h.datetime));}return this;}function c(h){h=e(h);if(!h.data("timeago")){h.data("timeago",{datetime:g.datetime(h)});var j=e.trim(h.text());if(j.length>0){h.attr("title",j);}}return h.data("timeago");}function a(h){return g.inWords(f(h));}function f(h){return(new Date().getTime()-h.getTime());}document.createElement("abbr");document.createElement("time");})(jQuery);jQuery(function(a){a.datepicker.regional.af={closeText:"Selekteer",prevText:"Vorige",nextText:"Volgende",currentText:"Vandag",monthNames:["Januarie","Februarie","Maart","April","Mei","Junie","Julie","Augustus","September","Oktober","November","Desember"],monthNamesShort:["Jan","Feb","Mrt","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Des"],dayNames:["Sondag","Maandag","Dinsdag","Woensdag","Donderdag","Vrydag","Saterdag"],dayNamesShort:["Son","Maa","Din","Woe","Don","Vry","Sat"],dayNamesMin:["So","Ma","Di","Wo","Do","Vr","Sa"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.af);});jQuery(function(a){a.datepicker.regional.ar={closeText:"إغلاق",prevText:"&#x3c;السابق",nextText:"التالي&#x3e;",currentText:"اليوم",monthNames:["كانون الثاني","شباط","آذار","نيسان","آذار","حزيران","تموز","آب","أيلول","تشرين الأول","تشرين الثاني","كانون الأول"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["السبت","الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة"],dayNamesShort:["سبت","أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة"],dayNamesMin:["سبت","أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة"],weekHeader:"أسبوع",dateFormat:"dd/mm/yy",firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.ar);});jQuery(function(a){a.datepicker.regional.az={closeText:"Bağla",prevText:"&#x3c;Geri",nextText:"İrəli&#x3e;",currentText:"Bugün",monthNames:["Yanvar","Fevral","Mart","Aprel","May","İyun","İyul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"],monthNamesShort:["Yan","Fev","Mar","Apr","May","İyun","İyul","Avq","Sen","Okt","Noy","Dek"],dayNames:["Bazar","Bazar ertəsi","Çərşənbə axşamı","Çərşənbə","Cümə axşamı","Cümə","Şənbə"],dayNamesShort:["B","Be","Ça","Ç","Ca","C","Ş"],dayNamesMin:["B","B","Ç","С","Ç","C","Ş"],weekHeader:"Hf",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.az);});jQuery(function(a){a.datepicker.regional.bg={closeText:"затвори",prevText:"&#x3c;назад",nextText:"напред&#x3e;",nextBigText:"&#x3e;&#x3e;",currentText:"днес",monthNames:["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"],monthNamesShort:["Яну","Фев","Мар","Апр","Май","Юни","Юли","Авг","Сеп","Окт","Нов","Дек"],dayNames:["Неделя","Понеделник","Вторник","Сряда","Четвъртък","Петък","Събота"],dayNamesShort:["Нед","Пон","Вто","Сря","Чет","Пет","Съб"],dayNamesMin:["Не","По","Вт","Ср","Че","Пе","Съ"],weekHeader:"Wk",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.bg);});jQuery(function(a){a.datepicker.regional.bs={closeText:"Zatvori",prevText:"&#x3c;",nextText:"&#x3e;",currentText:"Danas",monthNames:["Januar","Februar","Mart","April","Maj","Juni","Juli","August","Septembar","Oktobar","Novembar","Decembar"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNames:["Nedelja","Ponedeljak","Utorak","Srijeda","Četvrtak","Petak","Subota"],dayNamesShort:["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],dayNamesMin:["Ne","Po","Ut","Sr","Če","Pe","Su"],weekHeader:"Wk",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.bs);});jQuery(function(a){a.datepicker.regional.ca={closeText:"Tancar",prevText:"&#x3c;Ant",nextText:"Seg&#x3e;",currentText:"Avui",monthNames:["Gener","Febrer","Mar&ccedil;","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"],monthNamesShort:["Gen","Feb","Mar","Abr","Mai","Jun","Jul","Ago","Set","Oct","Nov","Des"],dayNames:["Diumenge","Dilluns","Dimarts","Dimecres","Dijous","Divendres","Dissabte"],dayNamesShort:["Dug","Dln","Dmt","Dmc","Djs","Dvn","Dsb"],dayNamesMin:["Dg","Dl","Dt","Dc","Dj","Dv","Ds"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.ca);});jQuery(function(a){a.datepicker.regional.cs={closeText:"Zavřít",prevText:"&#x3c;Dříve",nextText:"Později&#x3e;",currentText:"Nyní",monthNames:["leden","únor","březen","duben","květen","červen","červenec","srpen","září","říjen","listopad","prosinec"],monthNamesShort:["led","úno","bře","dub","kvě","čer","čvc","srp","zář","říj","lis","pro"],dayNames:["neděle","pondělí","úterý","středa","čtvrtek","pátek","sobota"],dayNamesShort:["ne","po","út","st","čt","pá","so"],dayNamesMin:["ne","po","út","st","čt","pá","so"],weekHeader:"Týd",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.cs);});jQuery(function(a){a.datepicker.regional.da={closeText:"Luk",prevText:"&#x3c;Forrige",nextText:"Næste&#x3e;",currentText:"Idag",monthNames:["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNames:["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"],dayNamesShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],dayNamesMin:["Sø","Ma","Ti","On","To","Fr","Lø"],weekHeader:"Uge",dateFormat:"dd-mm-yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.da);});jQuery(function(a){a.datepicker.regional.de={closeText:"schließen",prevText:"&#x3c;zurück",nextText:"Vor&#x3e;",currentText:"heute",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],weekHeader:"Wo",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.de);});jQuery(function(a){a.datepicker.regional.el={closeText:"Κλείσιμο",prevText:"Προηγούμενος",nextText:"Επόμενος",currentText:"Τρέχων Μήνας",monthNames:["Ιανουάριος","Φεβρουάριος","Μάρτιος","Απρίλιος","Μάιος","Ιούνιος","Ιούλιος","Αύγουστος","Σεπτέμβριος","Οκτώβριος","Νοέμβριος","Δεκέμβριος"],monthNamesShort:["Ιαν","Φεβ","Μαρ","Απρ","Μαι","Ιουν","Ιουλ","Αυγ","Σεπ","Οκτ","Νοε","Δεκ"],dayNames:["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"],dayNamesShort:["Κυρ","Δευ","Τρι","Τετ","Πεμ","Παρ","Σαβ"],dayNamesMin:["Κυ","Δε","Τρ","Τε","Πε","Πα","Σα"],weekHeader:"Εβδ",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.el);});jQuery(function(a){a.datepicker.regional["en-GB"]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional["en-GB"]);});jQuery(function(a){a.datepicker.regional.eo={closeText:"Fermi",prevText:"&lt;Anta",nextText:"Sekv&gt;",currentText:"Nuna",monthNames:["Januaro","Februaro","Marto","Aprilo","Majo","Junio","Julio","Aŭgusto","Septembro","Oktobro","Novembro","Decembro"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aŭg","Sep","Okt","Nov","Dec"],dayNames:["Dimanĉo","Lundo","Mardo","Merkredo","Ĵaŭdo","Vendredo","Sabato"],dayNamesShort:["Dim","Lun","Mar","Mer","Ĵaŭ","Ven","Sab"],dayNamesMin:["Di","Lu","Ma","Me","Ĵa","Ve","Sa"],weekHeader:"Sb",dateFormat:"dd/mm/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.eo);});jQuery(function(a){a.datepicker.regional.es={closeText:"Cerrar",prevText:"&#x3c;Ant",nextText:"Sig&#x3e;",currentText:"Hoy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Mi&eacute;rcoles","Jueves","Viernes","S&aacute;bado"],dayNamesShort:["Dom","Lun","Mar","Mi&eacute;","Juv","Vie","S&aacute;b"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","S&aacute;"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.es);});jQuery(function(a){a.datepicker.regional.et={closeText:"Sulge",prevText:"Eelnev",nextText:"Järgnev",currentText:"Täna",monthNames:["Jaanuar","Veebruar","Märts","Aprill","Mai","Juuni","Juuli","August","September","Oktoober","November","Detsember"],monthNamesShort:["Jaan","Veebr","Märts","Apr","Mai","Juuni","Juuli","Aug","Sept","Okt","Nov","Dets"],dayNames:["Pühapäev","Esmaspäev","Teisipäev","Kolmapäev","Neljapäev","Reede","Laupäev"],dayNamesShort:["Pühap","Esmasp","Teisip","Kolmap","Neljap","Reede","Laup"],dayNamesMin:["P","E","T","K","N","R","L"],weekHeader:"Sm",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.et);});jQuery(function(a){a.datepicker.regional.eu={closeText:"Egina",prevText:"&#x3c;Aur",nextText:"Hur&#x3e;",currentText:"Gaur",monthNames:["Urtarrila","Otsaila","Martxoa","Apirila","Maiatza","Ekaina","Uztaila","Abuztua","Iraila","Urria","Azaroa","Abendua"],monthNamesShort:["Urt","Ots","Mar","Api","Mai","Eka","Uzt","Abu","Ira","Urr","Aza","Abe"],dayNames:["Igandea","Astelehena","Asteartea","Asteazkena","Osteguna","Ostirala","Larunbata"],dayNamesShort:["Iga","Ast","Ast","Ast","Ost","Ost","Lar"],dayNamesMin:["Ig","As","As","As","Os","Os","La"],weekHeader:"Wk",dateFormat:"yy/mm/dd",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.eu);});jQuery(function(a){a.datepicker.regional.fa={closeText:"بستن",prevText:"&#x3c;قبلي",nextText:"بعدي&#x3e;",currentText:"امروز",monthNames:["فروردين","ارديبهشت","خرداد","تير","مرداد","شهريور","مهر","آبان","آذر","دي","بهمن","اسفند"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["يکشنبه","دوشنبه","سهشنبه","چهارشنبه","پنجشنبه","جمعه","شنبه"],dayNamesShort:["ي","د","س","چ","پ","ج","ش"],dayNamesMin:["ي","د","س","چ","پ","ج","ش"],weekHeader:"هف",dateFormat:"yy/mm/dd",firstDay:6,isRTL:true,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.fa);});jQuery(function(a){a.datepicker.regional.fi={closeText:"Sulje",prevText:"&laquo;Edellinen",nextText:"Seuraava&raquo;",currentText:"T&auml;n&auml;&auml;n",monthNames:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kes&auml;kuu","Hein&auml;kuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],monthNamesShort:["Tammi","Helmi","Maalis","Huhti","Touko","Kes&auml;","Hein&auml;","Elo","Syys","Loka","Marras","Joulu"],dayNamesShort:["Su","Ma","Ti","Ke","To","Pe","Su"],dayNames:["Sunnuntai","Maanantai","Tiistai","Keskiviikko","Torstai","Perjantai","Lauantai"],dayNamesMin:["Su","Ma","Ti","Ke","To","Pe","La"],weekHeader:"Vk",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.fi);});jQuery(function(a){a.datepicker.regional.fo={closeText:"Lat aftur",prevText:"&#x3c;Fyrra",nextText:"Næsta&#x3e;",currentText:"Í dag",monthNames:["Januar","Februar","Mars","Apríl","Mei","Juni","Juli","August","September","Oktober","November","Desember"],monthNamesShort:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Des"],dayNames:["Sunnudagur","Mánadagur","Týsdagur","Mikudagur","Hósdagur","Fríggjadagur","Leyardagur"],dayNamesShort:["Sun","Mán","Týs","Mik","Hós","Frí","Ley"],dayNamesMin:["Su","Má","Tý","Mi","Hó","Fr","Le"],weekHeader:"Vk",dateFormat:"dd-mm-yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.fo);});jQuery(function(a){a.datepicker.regional["fr-CH"]={closeText:"Fermer",prevText:"&#x3c;Pr�c",nextText:"Suiv&#x3e;",currentText:"Courant",monthNames:["Janvier","F�vrier","Mars","Avril","Mai","Juin","Juillet","Ao�t","Septembre","Octobre","Novembre","D�cembre"],monthNamesShort:["Jan","F�v","Mar","Avr","Mai","Jun","Jul","Ao�","Sep","Oct","Nov","D�c"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional["fr-CH"]);});jQuery(function(a){a.datepicker.regional.fr={closeText:"Fermer",prevText:"&#x3c;Préc",nextText:"Suiv&#x3e;",currentText:"Courant",monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.fr);});jQuery(function(a){a.datepicker.regional.he={closeText:"סגור",prevText:"&#x3c;הקודם",nextText:"הבא&#x3e;",currentText:"היום",monthNames:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],dayNamesShort:["א'","ב'","ג'","ד'","ה'","ו'","שבת"],dayNamesMin:["א'","ב'","ג'","ד'","ה'","ו'","שבת"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.he);});jQuery(function(a){a.datepicker.regional.hr={closeText:"Zatvori",prevText:"&#x3c;",nextText:"&#x3e;",currentText:"Danas",monthNames:["Siječanj","Veljača","Ožujak","Travanj","Svibanj","Lipanj","Srpanj","Kolovoz","Rujan","Listopad","Studeni","Prosinac"],monthNamesShort:["Sij","Velj","Ožu","Tra","Svi","Lip","Srp","Kol","Ruj","Lis","Stu","Pro"],dayNames:["Nedjelja","Ponedjeljak","Utorak","Srijeda","Četvrtak","Petak","Subota"],dayNamesShort:["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],dayNamesMin:["Ne","Po","Ut","Sr","Če","Pe","Su"],weekHeader:"Tje",dateFormat:"dd.mm.yy.",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.hr);});jQuery(function(a){a.datepicker.regional.hu={closeText:"bezárás",prevText:"&laquo;&nbsp;vissza",nextText:"előre&nbsp;&raquo;",currentText:"ma",monthNames:["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"],monthNamesShort:["Jan","Feb","Már","Ápr","Máj","Jún","Júl","Aug","Szep","Okt","Nov","Dec"],dayNames:["Vasárnap","Hétfö","Kedd","Szerda","Csütörtök","Péntek","Szombat"],dayNamesShort:["Vas","Hét","Ked","Sze","Csü","Pén","Szo"],dayNamesMin:["V","H","K","Sze","Cs","P","Szo"],weekHeader:"Hé",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.hu);});jQuery(function(a){a.datepicker.regional.hy={closeText:"Փակել",prevText:"&#x3c;Նախ.",nextText:"Հաջ.&#x3e;",currentText:"Այսօր",monthNames:["Հունվար","Փետրվար","Մարտ","Ապրիլ","Մայիս","Հունիս","Հուլիս","Օգոստոս","Սեպտեմբեր","Հոկտեմբեր","Նոյեմբեր","Դեկտեմբեր"],monthNamesShort:["Հունվ","Փետր","Մարտ","Ապր","Մայիս","Հունիս","Հուլ","Օգս","Սեպ","Հոկ","Նոյ","Դեկ"],dayNames:["կիրակի","եկուշաբթի","երեքշաբթի","չորեքշաբթի","հինգշաբթի","ուրբաթ","շաբաթ"],dayNamesShort:["կիր","երկ","երք","չրք","հնգ","ուրբ","շբթ"],dayNamesMin:["կիր","երկ","երք","չրք","հնգ","ուրբ","շբթ"],weekHeader:"ՇԲՏ",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.hy);});jQuery(function(a){a.datepicker.regional.id={closeText:"Tutup",prevText:"&#x3c;mundur",nextText:"maju&#x3e;",currentText:"hari ini",monthNames:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","Nopember","Desember"],monthNamesShort:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agus","Sep","Okt","Nop","Des"],dayNames:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],dayNamesShort:["Min","Sen","Sel","Rab","kam","Jum","Sab"],dayNamesMin:["Mg","Sn","Sl","Rb","Km","jm","Sb"],weekHeader:"Mg",dateFormat:"dd/mm/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.id);});jQuery(function(a){a.datepicker.regional.is={closeText:"Loka",prevText:"&#x3c; Fyrri",nextText:"N&aelig;sti &#x3e;",currentText:"&Iacute; dag",monthNames:["Jan&uacute;ar","Febr&uacute;ar","Mars","Apr&iacute;l","Ma&iacute","J&uacute;n&iacute;","J&uacute;l&iacute;","&Aacute;g&uacute;st","September","Okt&oacute;ber","N&oacute;vember","Desember"],monthNamesShort:["Jan","Feb","Mar","Apr","Ma&iacute;","J&uacute;n","J&uacute;l","&Aacute;g&uacute;","Sep","Okt","N&oacute;v","Des"],dayNames:["Sunnudagur","M&aacute;nudagur","&THORN;ri&eth;judagur","Mi&eth;vikudagur","Fimmtudagur","F&ouml;studagur","Laugardagur"],dayNamesShort:["Sun","M&aacute;n","&THORN;ri","Mi&eth;","Fim","F&ouml;s","Lau"],dayNamesMin:["Su","M&aacute;","&THORN;r","Mi","Fi","F&ouml;","La"],weekHeader:"Vika",dateFormat:"dd/mm/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.is);});jQuery(function(a){a.datepicker.regional.it={closeText:"Chiudi",prevText:"&#x3c;Prec",nextText:"Succ&#x3e;",currentText:"Oggi",monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Luned&#236","Marted&#236","Mercoled&#236","Gioved&#236","Venerd&#236","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayNamesMin:["Do","Lu","Ma","Me","Gi","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.it);});jQuery(function(a){a.datepicker.regional.ja={closeText:"閉じる",prevText:"&#x3c;前",nextText:"次&#x3e;",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],dayNamesShort:["日","月","火","水","木","金","土"],dayNamesMin:["日","月","火","水","木","金","土"],weekHeader:"週",dateFormat:"yy/mm/dd",firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:"年"};a.datepicker.setDefaults(a.datepicker.regional.ja);});jQuery(function(a){a.datepicker.regional.ko={closeText:"닫기",prevText:"이전달",nextText:"다음달",currentText:"오늘",monthNames:["1월(JAN)","2월(FEB)","3월(MAR)","4월(APR)","5월(MAY)","6월(JUN)","7월(JUL)","8월(AUG)","9월(SEP)","10월(OCT)","11월(NOV)","12월(DEC)"],monthNamesShort:["1월(JAN)","2월(FEB)","3월(MAR)","4월(APR)","5월(MAY)","6월(JUN)","7월(JUL)","8월(AUG)","9월(SEP)","10월(OCT)","11월(NOV)","12월(DEC)"],dayNames:["일","월","화","수","목","금","토"],dayNamesShort:["일","월","화","수","목","금","토"],dayNamesMin:["일","월","화","수","목","금","토"],weekHeader:"Wk",dateFormat:"yy-mm-dd",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:"년"};a.datepicker.setDefaults(a.datepicker.regional.ko);});jQuery(function(a){a.datepicker.regional.lt={closeText:"Uždaryti",prevText:"&#x3c;Atgal",nextText:"Pirmyn&#x3e;",currentText:"Šiandien",monthNames:["Sausis","Vasaris","Kovas","Balandis","Gegužė","Birželis","Liepa","Rugpjūtis","Rugsėjis","Spalis","Lapkritis","Gruodis"],monthNamesShort:["Sau","Vas","Kov","Bal","Geg","Bir","Lie","Rugp","Rugs","Spa","Lap","Gru"],dayNames:["sekmadienis","pirmadienis","antradienis","trečiadienis","ketvirtadienis","penktadienis","šeštadienis"],dayNamesShort:["sek","pir","ant","tre","ket","pen","šeš"],dayNamesMin:["Se","Pr","An","Tr","Ke","Pe","Še"],weekHeader:"Wk",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.lt);});jQuery(function(a){a.datepicker.regional.lv={closeText:"Aizvērt",prevText:"Iepr",nextText:"Nāka",currentText:"Šodien",monthNames:["Janvāris","Februāris","Marts","Aprīlis","Maijs","Jūnijs","Jūlijs","Augusts","Septembris","Oktobris","Novembris","Decembris"],monthNamesShort:["Jan","Feb","Mar","Apr","Mai","Jūn","Jūl","Aug","Sep","Okt","Nov","Dec"],dayNames:["svētdiena","pirmdiena","otrdiena","trešdiena","ceturtdiena","piektdiena","sestdiena"],dayNamesShort:["svt","prm","otr","tre","ctr","pkt","sst"],dayNamesMin:["Sv","Pr","Ot","Tr","Ct","Pk","Ss"],weekHeader:"Nav",dateFormat:"dd-mm-yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.lv);});jQuery(function(a){a.datepicker.regional.ms={closeText:"Tutup",prevText:"&#x3c;Sebelum",nextText:"Selepas&#x3e;",currentText:"hari ini",monthNames:["Januari","Februari","Mac","April","Mei","Jun","Julai","Ogos","September","Oktober","November","Disember"],monthNamesShort:["Jan","Feb","Mac","Apr","Mei","Jun","Jul","Ogo","Sep","Okt","Nov","Dis"],dayNames:["Ahad","Isnin","Selasa","Rabu","Khamis","Jumaat","Sabtu"],dayNamesShort:["Aha","Isn","Sel","Rab","kha","Jum","Sab"],dayNamesMin:["Ah","Is","Se","Ra","Kh","Ju","Sa"],weekHeader:"Mg",dateFormat:"dd/mm/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.ms);});jQuery(function(a){a.datepicker.regional.nl={closeText:"Sluiten",prevText:"←",nextText:"→",currentText:"Vandaag",monthNames:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],monthNamesShort:["jan","feb","maa","apr","mei","jun","jul","aug","sep","okt","nov","dec"],dayNames:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],dayNamesShort:["zon","maa","din","woe","don","vri","zat"],dayNamesMin:["zo","ma","di","wo","do","vr","za"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.nl);});jQuery(function(a){a.datepicker.regional.no={closeText:"Lukk",prevText:"&laquo;Forrige",nextText:"Neste&raquo;",currentText:"I dag",monthNames:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],monthNamesShort:["Jan","Feb","Mar","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Des"],dayNamesShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],dayNames:["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"],dayNamesMin:["Sø","Ma","Ti","On","To","Fr","Lø"],weekHeader:"Uke",dateFormat:"yy-mm-dd",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.no);});jQuery(function(a){a.datepicker.regional.pl={closeText:"Zamknij",prevText:"&#x3c;Poprzedni",nextText:"Następny&#x3e;",currentText:"Dziś",monthNames:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],monthNamesShort:["Sty","Lu","Mar","Kw","Maj","Cze","Lip","Sie","Wrz","Pa","Lis","Gru"],dayNames:["Niedziela","Poniedzialek","Wtorek","Środa","Czwartek","Piątek","Sobota"],dayNamesShort:["Nie","Pn","Wt","Śr","Czw","Pt","So"],dayNamesMin:["N","Pn","Wt","Śr","Cz","Pt","So"],weekHeader:"Tydz",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.pl);});jQuery(function(a){a.datepicker.regional["pt-BR"]={closeText:"Fechar",prevText:"&#x3c;Anterior",nextText:"Pr&oacute;ximo&#x3e;",currentText:"Hoje",monthNames:["Janeiro","Fevereiro","Mar&ccedil;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Ter&ccedil;a-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sabado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],dayNamesMin:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional["pt-BR"]);});jQuery(function(a){a.datepicker.regional.ro={closeText:"Închide",prevText:"&laquo; Luna precedentă",nextText:"Luna următoare &raquo;",currentText:"Azi",monthNames:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],monthNamesShort:["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Duminică","Luni","Marţi","Miercuri","Joi","Vineri","Sâmbătă"],dayNamesShort:["Dum","Lun","Mar","Mie","Joi","Vin","Sâm"],dayNamesMin:["Du","Lu","Ma","Mi","Jo","Vi","Sâ"],weekHeader:"Săpt",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.ro);});jQuery(function(a){a.datepicker.regional.ru={closeText:"Закрыть",prevText:"&#x3c;Пред",nextText:"След&#x3e;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.ru);});jQuery(function(a){a.datepicker.regional.sk={closeText:"Zavrieť",prevText:"&#x3c;Predchádzajúci",nextText:"Nasledujúci&#x3e;",currentText:"Dnes",monthNames:["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Máj","Jún","Júl","Aug","Sep","Okt","Nov","Dec"],dayNames:["Nedel'a","Pondelok","Utorok","Streda","Štvrtok","Piatok","Sobota"],dayNamesShort:["Ned","Pon","Uto","Str","Štv","Pia","Sob"],dayNamesMin:["Ne","Po","Ut","St","Št","Pia","So"],weekHeader:"Ty",dateFormat:"dd.mm.yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.sk);});jQuery(function(a){a.datepicker.regional.sl={closeText:"Zapri",prevText:"&lt;Prej&#x161;nji",nextText:"Naslednji&gt;",currentText:"Trenutni",monthNames:["Januar","Februar","Marec","April","Maj","Junij","Julij","Avgust","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Avg","Sep","Okt","Nov","Dec"],dayNames:["Nedelja","Ponedeljek","Torek","Sreda","&#x10C;etrtek","Petek","Sobota"],dayNamesShort:["Ned","Pon","Tor","Sre","&#x10C;et","Pet","Sob"],dayNamesMin:["Ne","Po","To","Sr","&#x10C;e","Pe","So"],weekHeader:"Teden",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.sl);});jQuery(function(a){a.datepicker.regional.sq={closeText:"mbylle",prevText:"&#x3c;mbrapa",nextText:"Përpara&#x3e;",currentText:"sot",monthNames:["Janar","Shkurt","Mars","Prill","Maj","Qershor","Korrik","Gusht","Shtator","Tetor","Nëntor","Dhjetor"],monthNamesShort:["Jan","Shk","Mar","Pri","Maj","Qer","Kor","Gus","Sht","Tet","Nën","Dhj"],dayNames:["E Diel","E Hënë","E Martë","E Mërkurë","E Enjte","E Premte","E Shtune"],dayNamesShort:["Di","Hë","Ma","Më","En","Pr","Sh"],dayNamesMin:["Di","Hë","Ma","Më","En","Pr","Sh"],weekHeader:"Ja",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.sq);});jQuery(function(a){a.datepicker.regional["sr-SR"]={closeText:"Zatvori",prevText:"&#x3c;",nextText:"&#x3e;",currentText:"Danas",monthNames:["Januar","Februar","Mart","April","Maj","Jun","Jul","Avgust","Septembar","Oktobar","Novembar","Decembar"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Avg","Sep","Okt","Nov","Dec"],dayNames:["Nedelja","Ponedeljak","Utorak","Sreda","Četvrtak","Petak","Subota"],dayNamesShort:["Ned","Pon","Uto","Sre","Čet","Pet","Sub"],dayNamesMin:["Ne","Po","Ut","Sr","Če","Pe","Su"],weekHeader:"Sed",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional["sr-SR"]);});jQuery(function(a){a.datepicker.regional.sr={closeText:"Затвори",prevText:"&#x3c;",nextText:"&#x3e;",currentText:"Данас",monthNames:["Јануар","Фебруар","Март","Април","Мај","Јун","Јул","Август","Септембар","Октобар","Новембар","Децембар"],monthNamesShort:["Јан","Феб","Мар","Апр","Мај","Јун","Јул","Авг","Сеп","Окт","Нов","Дец"],dayNames:["Недеља","Понедељак","Уторак","Среда","Четвртак","Петак","Субота"],dayNamesShort:["Нед","Пон","Уто","Сре","Чет","Пет","Суб"],dayNamesMin:["Не","По","Ут","Ср","Че","Пе","Су"],weekHeader:"Сед",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.sr);});jQuery(function(a){a.datepicker.regional.sv={closeText:"Stäng",prevText:"&laquo;Förra",nextText:"Nästa&raquo;",currentText:"Idag",monthNames:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNamesShort:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],dayNames:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],weekHeader:"Ve",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.sv);});jQuery(function(a){a.datepicker.regional.ta={closeText:"மூடு",prevText:"முன்னையது",nextText:"அடுத்தது",currentText:"இன்று",monthNames:["தை","மாசி","பங்குனி","சித்திரை","வைகாசி","ஆனி","ஆடி","ஆவணி","புரட்டாசி","ஐப்பசி","கார்த்திகை","மார்கழி"],monthNamesShort:["தை","மாசி","பங்","சித்","வைகா","ஆனி","ஆடி","ஆவ","புர","ஐப்","கார்","மார்"],dayNames:["ஞாயிற்றுக்கிழமை","திங்கட்கிழமை","செவ்வாய்க்கிழமை","புதன்கிழமை","வியாழக்கிழமை","வெள்ளிக்கிழமை","சனிக்கிழமை"],dayNamesShort:["ஞாயிறு","திங்கள்","செவ்வாய்","புதன்","வியாழன்","வெள்ளி","சனி"],dayNamesMin:["ஞா","தி","செ","பு","வி","வெ","ச"],weekHeader:"Не",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.ta);});jQuery(function(a){a.datepicker.regional.th={closeText:"ปิด",prevText:"&laquo;&nbsp;ย้อน",nextText:"ถัดไป&nbsp;&raquo;",currentText:"วันนี้",monthNames:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฏาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],monthNamesShort:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],dayNames:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"],dayNamesShort:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],dayNamesMin:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.th);});jQuery(function(a){a.datepicker.regional.tr={closeText:"kapat",prevText:"&#x3c;geri",nextText:"ileri&#x3e",currentText:"bugün",monthNames:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],monthNamesShort:["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"],dayNames:["Pazar","Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi"],dayNamesShort:["Pz","Pt","Sa","Ça","Pe","Cu","Ct"],dayNamesMin:["Pz","Pt","Sa","Ça","Pe","Cu","Ct"],weekHeader:"Hf",dateFormat:"dd.mm.yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.tr);});jQuery(function(a){a.datepicker.regional.uk={closeText:"Закрити",prevText:"&#x3c;",nextText:"&#x3e;",currentText:"Сьогодні",monthNames:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],monthNamesShort:["Січ","Лют","Бер","Кві","Тра","Чер","Лип","Сер","Вер","Жов","Лис","Гру"],dayNames:["неділя","понеділок","вівторок","середа","четвер","п’ятниця","субота"],dayNamesShort:["нед","пнд","вів","срд","чтв","птн","сбт"],dayNamesMin:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.uk);});jQuery(function(a){a.datepicker.regional.vi={closeText:"Đóng",prevText:"&#x3c;Trước",nextText:"Tiếp&#x3e;",currentText:"Hôm nay",monthNames:["Tháng Một","Tháng Hai","Tháng Ba","Tháng Tư","Tháng Năm","Tháng Sáu","Tháng Bảy","Tháng Tám","Tháng Chín","Tháng Mười","Tháng Mười Một","Tháng Mười Hai"],monthNamesShort:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],dayNames:["Chủ Nhật","Thứ Hai","Thứ Ba","Thứ Tư","Thứ Năm","Thứ Sáu","Thứ Bảy"],dayNamesShort:["CN","T2","T3","T4","T5","T6","T7"],dayNamesMin:["CN","T2","T3","T4","T5","T6","T7"],weekHeader:"Tu",dateFormat:"dd/mm/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};a.datepicker.setDefaults(a.datepicker.regional.vi);});jQuery(function(a){a.datepicker.regional["zh-CN"]={closeText:"关闭",prevText:"&#x3c;上月",nextText:"下月&#x3e;",currentText:"今天",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:"年"};a.datepicker.setDefaults(a.datepicker.regional["zh-CN"]);});jQuery(function(a){a.datepicker.regional["zh-HK"]={closeText:"關閉",prevText:"&#x3c;上月",nextText:"下月&#x3e;",currentText:"今天",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",dateFormat:"dd-mm-yy",firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:"年"};a.datepicker.setDefaults(a.datepicker.regional["zh-HK"]);});jQuery(function(a){a.datepicker.regional["zh-TW"]={closeText:"關閉",prevText:"&#x3c;上月",nextText:"下月&#x3e;",currentText:"今天",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",dateFormat:"yy/mm/dd",firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:"年"};a.datepicker.setDefaults(a.datepicker.regional["zh-TW"]);});(function(c){var a=0;c.widget("ui.tooltip",{options:{tooltipClass:null,items:"[title]",content:function(){return c(this).attr("title");},position:{my:"right top",at:"right center"}},_create:function(){var d=c.proxy(this.open,this);this.element.bind("mouseover",d).bind("focusin",d);},enable:function(){this.options.disabled=false;},disable:function(){this.options.disabled=true;},open:function(f){var g=c(f&&f.target||this.element).closest(this.options.items);if(!g.length){return;}var d=this;if(!g.data("tooltip-title")){g.data("tooltip-title",g.attr("title"));}var e=this.options.content.call(g[0],function(h){setTimeout(function(){if(g.attr("aria-describedby")!==undefined){d._open(f,g,h);}},13);});if(e){d._open(f,g,e);}},_open:function(e,g,d){if(!d){return;}g.attr("title","");if(this.options.disabled){return;}if(this._isOpen){return;}var f=this._find(g);if(!f.length){f=this._tooltip();g.attr("aria-describedby",f.attr("id"));}f.find(".ui-tooltip-content").html(d);f.position(c.extend({of:g},this.options.position)).hide();f.stop(true);f.show();this._trigger("open",e);this._isOpen=true;var h=c.proxy(this.close,this);g.bind("mouseleave",h).bind("blur",h).bind("click",h);},close:function(d){var f=c(d&&d.currentTarget||this.element);f.attr("title",f.data("tooltip-title"));if(this.options.disabled){return;}var e=this._find(f);f.removeAttr("aria-describedby");e.stop(true);e.hide().remove();f.unbind("mouseleave.tooltip blur.tooltip");this._trigger("close",d);this._isOpen=false;},_tooltip:function(){var d=c("<div></div>").attr("id","ui-tooltip-"+a++).attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content");if(this.options.tooltipClass){d.addClass(this.options.tooltipClass);}c("<div></div>").addClass("ui-tooltip-content").appendTo(d);d.appendTo(document.body);return d;},_find:function(d){var e=d.attr("aria-describedby");return e?c(document.getElementById(e)):c();}});c.ui.tooltip.version="@VERSION";})(jQuery);if(!this.JSON){this.JSON={};}(function(){function f(n){return n<10?"0"+n:n;}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");};}}());(function(a){Sammy.ActiveTemplate=function(f){var e=function(l,k,h){var j=h||l.attr("data-target");var g=this.render(l,k).replace(j);g.then(function(){c(this.$element().find(j),this);}.bind(this));return g;};var c=function(g,j){var h=g.find("*[data-bind]");h.each(function(l,o){var k=a(o).attr("data-bind");var m=k.split(" ")[0];var n=k.split(" ")[1];a(o).bind(m,function(p){j.trigger(n,{element:a(o),domEvent:p});});});};var d=function(l,k,h){var j=h||l.attr("data-target");var g=this.renderEach(l,k).replace(j);g.then(function(){c(this.$element().find(j),this);}.bind(this));return g;};f.helper("renderTemplate",e);f.helper("renderCollectionTemplate",d);f.helper("bindDOMEvents",c);};})(jQuery);(function(a){Sammy=Sammy||{};Sammy.FlashHash=function(){this.now={};};Sammy.FlashHash.prototype={toHTML:function(){result=this._renderUL();this.clear();return result;},clear:function(){this._clearHash(this);this._clearHash(this.now);},_onRedirect:function(){this._clearHash(this.now);},_clearHash:function(d){var c;for(c in d){if(c!=="now"&&d.hasOwnProperty(c)){d[c]=undefined;}}},_renderUL:function(){return'<ul class="flash">'+this._renderLIs(this)+this._renderLIs(this.now)+"</ul>";},_renderLIs:function(e){var c="",d;for(d in e){if(e[d]&&d!=="now"&&e.hasOwnProperty(d)){c=c+'<li class="'+d+'">'+e[d]+"</li>";}}return c;}};Sammy.Flash=function(c){c.flash=new Sammy.FlashHash();c.helper("flash",function(d,e){if(arguments.length===0){return this.app.flash;}else{if(arguments.length===2){this.app.flash[d]=e;}}return this.app.flash[d];});c.helper("flashNow",function(d,e){if(arguments.length===0){return this.app.flash.now;}else{if(arguments.length===2){this.app.flash.now[d]=e;}}return this.app.flash.now[d];});c.bind("redirect",function(){this.app.flash._onRedirect();});};})(jQuery);(function(a){Sammy.Mustache=function(e,c){var d=function(g,h,f){h=a.extend({},this,h);f=a.extend({},h.partials,f);return a.mustache(g,h,f);};if(!c){c="mustache";}e.helper(c,d);};})(jQuery);(function(a){Sammy=Sammy||{};Sammy.PathLocationProxy=function(c){this.app=c;};Sammy.PathLocationProxy.prototype={bind:function(){},unbind:function(){},getLocation:function(){return[window.location.pathname,window.location.search].join("");},setLocation:function(c){return window.location=c;}};})(jQuery);var Base64=(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var c={encode:function(f){var d="";var n,l,j;var m,k,h,g;var e=0;do{n=f.charCodeAt(e++);l=f.charCodeAt(e++);j=f.charCodeAt(e++);m=n>>2;k=((n&3)<<4)|(l>>4);h=((l&15)<<2)|(j>>6);g=j&63;if(isNaN(l)){h=g=64;}else{if(isNaN(j)){g=64;}}d=d+a.charAt(m)+a.charAt(k)+a.charAt(h)+a.charAt(g);}while(e<f.length);return d;},decode:function(f){var d="";var n,l,j;var m,k,h,g;var e=0;f=f.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{m=a.indexOf(f.charAt(e++));k=a.indexOf(f.charAt(e++));h=a.indexOf(f.charAt(e++));g=a.indexOf(f.charAt(e++));n=(m<<2)|(k>>4);l=((k&15)<<4)|(h>>2);j=((h&3)<<6)|g;d=d+String.fromCharCode(n);if(h!=64){d=d+String.fromCharCode(l);}if(g!=64){d=d+String.fromCharCode(j);}}while(e<f.length);return d;}};return c;})();if(!Function.prototype.bind){Function.prototype.bind=function(c){var a=this;return function(){return a.apply(c,arguments);};};}if(!Function.prototype.prependArg){Function.prototype.prependArg=function(a){var c=this;return function(){var e=[a];for(var d=0;d<arguments.length;d++){e.push(arguments[d]);}return c.apply(this,e);};};}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){var a=this.length;var d=Number(arguments[1])||0;d=(d<0)?Math.ceil(d):Math.floor(d);if(d<0){d+=a;}for(;d<a;d++){if(d in this&&this[d]===c){return d;}}return -1;};}(function(g){var f;function d(j,h){return new f.Builder(j,h);}function a(h){return new f.Builder("message",h);}function e(h){return new f.Builder("iq",h);}function c(h){return new f.Builder("presence",h);}f={VERSION:"@VERSION@",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(h,j){f.NS[h]=j;},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(l,m,k){var j,h;for(j=0;j<l.childNodes.length;j++){h=l.childNodes[j];if(h.nodeType==f.ElementType.NORMAL&&(!m||this.isTagEqual(h,m))){k(h);}}},isTagEqual:function(j,h){return j.tagName.toLowerCase()==h.toLowerCase();},_xmlGenerator:null,_makeGenerator:function(){var h;if(window.ActiveXObject){h=new ActiveXObject("Microsoft.XMLDOM");h.appendChild(h.createElement("strophe"));}else{h=document.implementation.createDocument("jabber:client","strophe",null);}return h;},xmlElement:function(l){if(!l){return null;}var n=null;if(!f._xmlGenerator){f._xmlGenerator=f._makeGenerator();}n=f._xmlGenerator.createElement(l);var h,m,j;for(h=1;h<arguments.length;h++){if(!arguments[h]){continue;}if(typeof(arguments[h])=="string"||typeof(arguments[h])=="number"){n.appendChild(f.xmlTextNode(arguments[h]));}else{if(typeof(arguments[h])=="object"&&typeof(arguments[h].sort)=="function"){for(m=0;m<arguments[h].length;m++){if(typeof(arguments[h][m])=="object"&&typeof(arguments[h][m].sort)=="function"){n.setAttribute(arguments[h][m][0],arguments[h][m][1]);}}}else{if(typeof(arguments[h])=="object"){for(j in arguments[h]){if(arguments[h].hasOwnProperty(j)){n.setAttribute(j,arguments[h][j]);}}}}}}return n;},xmlescape:function(h){h=h.replace(/\&/g,"&amp;");h=h.replace(/</g,"&lt;");h=h.replace(/>/g,"&gt;");return h;},xmlTextNode:function(h){h=f.xmlescape(h);if(!f._xmlGenerator){f._xmlGenerator=f._makeGenerator();}return f._xmlGenerator.createTextNode(h);},getText:function(j){if(!j){return null;}var k="";if(j.childNodes.length===0&&j.nodeType==f.ElementType.TEXT){k+=j.nodeValue;}for(var h=0;h<j.childNodes.length;h++){if(j.childNodes[h].nodeType==f.ElementType.TEXT){k+=j.childNodes[h].nodeValue;}}return k;},copyElement:function(k){var h,j;if(k.nodeType==f.ElementType.NORMAL){j=f.xmlElement(k.tagName);for(h=0;h<k.attributes.length;h++){j.setAttribute(k.attributes[h].nodeName.toLowerCase(),k.attributes[h].value);}for(h=0;h<k.childNodes.length;h++){j.appendChild(f.copyElement(k.childNodes[h]));}}else{if(k.nodeType==f.ElementType.TEXT){j=f.xmlTextNode(k.nodeValue);}}return j;},escapeNode:function(h){return h.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40");},unescapeNode:function(h){return h.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\");},getNodeFromJid:function(h){if(h.indexOf("@")<0){return null;}return h.split("@")[0];},getDomainFromJid:function(h){var j=f.getBareJidFromJid(h);if(j.indexOf("@")<0){return j;}else{var k=j.split("@");k.splice(0,1);return k.join("@");}},getResourceFromJid:function(h){var j=h.split("/");if(j.length<2){return null;}j.splice(0,1);return j.join("/");},getBareJidFromJid:function(h){return h.split("/")[0];},log:function(j,h){return;},debug:function(h){this.log(this.LogLevel.DEBUG,h);},info:function(h){this.log(this.LogLevel.INFO,h);},warn:function(h){this.log(this.LogLevel.WARN,h);},error:function(h){this.log(this.LogLevel.ERROR,h);},fatal:function(h){this.log(this.LogLevel.FATAL,h);},serialize:function(k){var h;if(!k){return null;}if(typeof(k.tree)==="function"){k=k.tree();}var m=k.nodeName;var j,l;if(k.getAttribute("_realname")){m=k.getAttribute("_realname");}h="<"+m;for(j=0;j<k.attributes.length;j++){if(k.attributes[j].nodeName!="_realname"){h+=" "+k.attributes[j].nodeName.toLowerCase()+"='"+k.attributes[j].value.replace("&","&amp;").replace("'","&apos;").replace("<","&lt;")+"'";}}if(k.childNodes.length>0){h+=">";for(j=0;j<k.childNodes.length;j++){l=k.childNodes[j];if(l.nodeType==f.ElementType.NORMAL){h+=f.serialize(l);}else{if(l.nodeType==f.ElementType.TEXT){h+=l.nodeValue;}}}h+="</"+m+">";}else{h+="/>";}return h;},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(h,j){f._connectionPlugins[h]=j;}};f.Builder=function(j,h){if(j=="presence"||j=="message"||j=="iq"){if(h&&!h.xmlns){h.xmlns=f.NS.CLIENT;}else{if(!h){h={xmlns:f.NS.CLIENT};}}}this.nodeTree=f.xmlElement(j,h);this.node=this.nodeTree;};f.Builder.prototype={tree:function(){return this.nodeTree;},toString:function(){return f.serialize(this.nodeTree);},up:function(){this.node=this.node.parentNode;return this;},attrs:function(j){for(var h in j){if(j.hasOwnProperty(h)){this.node.setAttribute(h,j[h]);}}return this;},c:function(j,h){var k=f.xmlElement(j,h);this.node.appendChild(k);this.node=k;return this;},cnode:function(h){this.node.appendChild(h);this.node=h;return this;},t:function(h){var j=f.xmlTextNode(h);this.node.appendChild(j);return this;}};f.Handler=function(m,l,j,k,o,n,h){this.handler=m;this.ns=l;this.name=j;this.type=k;this.id=o;this.options=h||{matchbare:false};if(!this.options.matchBare){this.options.matchBare=false;}if(this.options.matchBare){this.from=f.getBareJidFromJid(n);}else{this.from=n;}this.user=true;};f.Handler.prototype={isMatch:function(j){var l;var k=null;if(this.options.matchBare){k=f.getBareJidFromJid(j.getAttribute("from"));}else{k=j.getAttribute("from");}l=false;if(!this.ns){l=true;}else{var h=this;f.forEachChild(j,null,function(m){if(m.getAttribute("xmlns")==h.ns){l=true;}});l=l||j.getAttribute("xmlns")==this.ns;}if(l&&(!this.name||f.isTagEqual(j,this.name))&&(!this.type||j.getAttribute("type")===this.type)&&(!this.id||j.getAttribute("id")===this.id)&&(!this.from||k===this.from)){return true;}return false;},run:function(j){var h=null;try{h=this.handler(j);}catch(k){if(k.sourceURL){f.fatal("error: "+this.handler+" "+k.sourceURL+":"+k.line+" - "+k.name+": "+k.message);}else{if(k.fileName){if(typeof(console)!="undefined"){console.trace();console.error(this.handler," - error - ",k,k.message);}f.fatal("error: "+this.handler+" "+k.fileName+":"+k.lineNumber+" - "+k.name+": "+k.message);}else{f.fatal("error: "+this.handler);}}throw k;}return h;},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}";}};f.TimedHandler=function(j,h){this.period=j;this.handler=h;this.lastCalled=new Date().getTime();this.user=true;};f.TimedHandler.prototype={run:function(){this.lastCalled=new Date().getTime();return this.handler();},reset:function(){this.lastCalled=new Date().getTime();},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}";}};f.Request=function(k,j,h,l){this.id=++f._requestId;this.xmlData=k;this.data=f.serialize(k);this.origFunc=j;this.func=j;this.rid=h;this.date=NaN;this.sends=l||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date){return 0;}var m=new Date();return(m-this.date)/1000;};this.timeDead=function(){if(!this.dead){return 0;}var m=new Date();return(m-this.dead)/1000;};this.xhr=this._newXHR();};f.Request.prototype={getResponse:function(){var h=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){h=this.xhr.responseXML.documentElement;if(h.tagName=="parsererror"){f.error("invalid response received");f.error("responseText: "+this.xhr.responseText);f.error("responseXML: "+f.serialize(this.xhr.responseXML));throw"parsererror";}}else{if(this.xhr.responseText){f.error("invalid response received");f.error("responseText: "+this.xhr.responseText);f.error("responseXML: "+f.serialize(this.xhr.responseXML));}}return h;},_newXHR:function(){var h=null;if(window.XMLHttpRequest){h=new XMLHttpRequest();if(h.overrideMimeType){h.overrideMimeType("text/xml");}}else{if(window.ActiveXObject){h=new ActiveXObject("Microsoft.XMLHTTP");}}h.onreadystatechange=this.func.prependArg(this);return h;}};f.Connection=function(h){this.service=h;this.jid="";this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._idleTimeout=null;this._disconnectTimeout=null;this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this.paused=false;this.hold=1;this.wait=60;this.window=5;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*10000);this._sasl_success_handler=null;this._sasl_failure_handler=null;this._sasl_challenge_handler=null;this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var j in f._connectionPlugins){if(f._connectionPlugins.hasOwnProperty(j)){var m=f._connectionPlugins[j];var l=function(){};l.prototype=m;this[j]=new l();this[j].init(this);}}};f.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this._requests=[];this._uniqueId=Math.round(Math.random()*10000);},pause:function(){this.paused=true;},resume:function(){this.paused=false;},getUniqueId:function(h){if(typeof(h)=="string"||typeof(h)=="number"){return ++this._uniqueId+":"+h;}else{return ++this._uniqueId+"";}},connect:function(j,k,n,m,l){this.jid=j;this.pass=k;this.connect_callback=n;this.disconnecting=false;this.connected=false;this.authenticated=false;this.errors=0;this.wait=m||this.wait;this.hold=l||this.hold;this.domain=f.getDomainFromJid(this.jid);var h=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":f.NS.BOSH});this._changeConnectStatus(f.Status.CONNECTING,null);this._requests.push(new f.Request(h.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),h.tree().getAttribute("rid")));this._throttledRequestHandler();},attach:function(k,h,l,o,n,m,j){this.jid=k;this.sid=h;this.rid=l;this.connect_callback=o;this.domain=f.getDomainFromJid(this.jid);this.authenticated=true;this.connected=true;this.wait=n||this.wait;this.hold=m||this.hold;this.wind=j||this.wind;this._changeConnectStatus(f.Status.ATTACHED,null);},xmlInput:function(h){return;},xmlOutput:function(h){return;},rawInput:function(h){return;},rawOutput:function(h){return;},send:function(j){if(j===null){return;}if(typeof(j.sort)==="function"){for(var h=0;h<j.length;h++){this._queueData(j[h]);}}else{if(typeof(j.tree)==="function"){this._queueData(j.tree());}else{this._queueData(j);}}this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100);},flush:function(){clearTimeout(this._idleTimeout);this._onIdle();},sendIQ:function(l,p,h,m){var n=null;var k=this;if(typeof(l.tree)==="function"){l=l.tree();}var o=l.getAttribute("id");if(!o){o=this.getUniqueId("sendIQ");l.setAttribute("id",o);}var j=this.addHandler(function(r){if(n){k.deleteTimedHandler(n);}var q=r.getAttribute("type");if(q==="result"){if(p){p(r);}}else{if(q==="error"){if(h){h(r);}}else{throw {name:"StropheError",message:"Got bad IQ type of "+q};}}},null,"iq",null,o);if(m){n=this.addTimedHandler(m,function(){k.deleteHandler(j);if(h){h(null);}return false;});}this.send(l);return o;},_queueData:function(h){if(h===null||!h.tagName||!h.childNodes){throw {name:"StropheError",message:"Cannot queue non-DOMElement."};}this._data.push(h);},_sendRestart:function(){this._data.push("restart");this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100);},addTimedHandler:function(k,j){var h=new f.TimedHandler(k,j);this.addTimeds.push(h);return h;},deleteTimedHandler:function(h){this.removeTimeds.push(h);},addHandler:function(n,m,k,l,p,o,j){var h=new f.Handler(n,m,k,l,p,o,j);this.addHandlers.push(h);return h;},deleteHandler:function(h){this.removeHandlers.push(h);},disconnect:function(h){this._changeConnectStatus(f.Status.DISCONNECTING,h);f.info("Disconnect was called because: "+h);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(500,this._onDisconnectTimeout.bind(this));this._sendTerminate();}},_changeConnectStatus:function(h,o){for(var j in f._connectionPlugins){if(f._connectionPlugins.hasOwnProperty(j)){var m=this[j];if(m.statusChanged){try{m.statusChanged(h,o);}catch(l){f.error(""+j+" plugin caused an exception changing status: "+l);}}}}if(this.connect_callback){try{this.connect_callback(h,o);}catch(n){f.error("User connection callback caused an exception: "+n);}}},_buildBody:function(){var h=d("body",{rid:this.rid++,xmlns:f.NS.HTTPBIND});if(this.sid!==null){h.attrs({sid:this.sid});}return h;},_removeRequest:function(j){f.debug("removing request");var h;for(h=this._requests.length-1;h>=0;h--){if(j==this._requests[h]){this._requests.splice(h,1);}}j.xhr.onreadystatechange=function(){};this._throttledRequestHandler();},_restartRequest:function(h){var j=this._requests[h];if(j.dead===null){j.dead=new Date();}this._processRequest(h);},_processRequest:function(k){var p=this._requests[k];var s=-1;try{if(p.xhr.readyState==4){s=p.xhr.status;}}catch(n){f.error("caught an error in _requests["+k+"], reqStatus: "+s);}if(typeof(s)=="undefined"){s=-1;}var j=p.age();var h=(!isNaN(j)&&j>Math.floor(f.TIMEOUT*this.wait));var l=(p.dead!==null&&p.timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait));var r=(p.xhr.readyState==4&&(s<1||s>=500));if(h||l||r){if(l){f.error("Request "+this._requests[k].id+" timed out (secondary), restarting");}p.abort=true;p.xhr.abort();p.xhr.onreadystatechange=function(){};this._requests[k]=new f.Request(p.xmlData,p.origFunc,p.rid,p.sends);p=this._requests[k];}if(p.xhr.readyState===0){f.debug("request id "+p.id+"."+p.sends+" posting");p.date=new Date();try{p.xhr.open("POST",this.service,true);}catch(o){f.error("XHR open failed.");if(!this.connected){this._changeConnectStatus(f.Status.CONNFAIL,"bad-service");}this.disconnect();return;}var q=function(){var u=this.rid-p.rid;if(u<=this.window){p.xhr.send(p.data);}else{f.error("Dropping request: "+p.rid+". Exceeds connection rid: "+this.rid+" by "+u);this._removeRequest(p);}}.bind(this);if(p.sends>1){var m=Math.pow(p.sends,3)*1000;setTimeout(q,m);}else{q();}p.sends++;this.xmlOutput(p.xmlData);this.rawOutput(p.data);}else{f.debug("_processRequest: "+(k===0?"first":"second")+" request has readyState of "+p.xhr.readyState);}},_throttledRequestHandler:function(){if(!this._requests){f.debug("_throttledRequestHandler called with undefined requests");}else{f.debug("_throttledRequestHandler called with "+this._requests.length+" requests");}if(!this._requests||this._requests.length===0){return;}if(this._requests.length>0){this._processRequest(0);}if(this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window-1){this._processRequest(1);}},_onRequestStateChange:function(l,k){f.debug("request id "+k.id+"."+k.sends+" state changed to "+k.xhr.readyState);if(k.abort){k.abort=false;return;}var j;if(k.xhr.readyState==4){j=0;try{j=k.xhr.status;}catch(m){}if(typeof(j)=="undefined"){j=0;}if(this.disconnecting){if(j>=400){this._hitError(j);return;}}var h=(this._requests[0]==k);var n=(this._requests[1]==k);if((j>0&&j<500)||k.sends>5){this._removeRequest(k);f.debug("request id "+k.id+" should now be removed");}if(j==200){if(n||(h&&this._requests.length>0&&this._requests[0].age()>Math.floor(f.SECONDARY_TIMEOUT*this.wait))){this._restartRequest(0);}f.debug("request id "+k.id+"."+k.sends+" got 200");l(k);this.errors=0;}else{f.error("request id "+k.id+"."+k.sends+" error "+j+" happened");if(j===0||(j>=400&&j<600)||j>=12000){this._hitError(j);if(j>=400&&j<500){this._changeConnectStatus(f.Status.DISCONNECTING,null);this._doDisconnect();}}}if(!((j>0&&j<10000)||k.sends>5)){this._throttledRequestHandler();}}},_hitError:function(h){this.errors++;f.warn("request errored, status: "+h+", number of errors: "+this.errors);if(this.errors>4){this._onDisconnectTimeout();}},_doDisconnect:function(){f.info("_doDisconnect was called");this.authenticated=false;this.disconnecting=false;this.sid=null;this.streamId=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(f.Status.DISCONNECTED,null);this.connected=false;}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];},_dataRecv:function(p){var h;try{h=p.getResponse();}catch(n){if(n!="parsererror"){throw n;}this.disconnect("strophe-parsererror");}if(h===null){return;}this.xmlInput(h);this.rawInput(f.serialize(h));var m,k;while(this.removeHandlers.length>0){k=this.removeHandlers.pop();m=this.handlers.indexOf(k);if(m>=0){this.handlers.splice(m,1);}}while(this.addHandlers.length>0){this.handlers.push(this.addHandlers.pop());}if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect();return;}var j=h.getAttribute("type");var o,l;if(j!==null&&j=="terminate"){o=h.getAttribute("condition");l=h.getElementsByTagName("conflict");if(o!==null){if(o=="remote-stream-error"&&l.length>0){o="conflict";}this._changeConnectStatus(f.Status.CONNFAIL,o);}else{this._changeConnectStatus(f.Status.CONNFAIL,"unknown");}this.disconnect();return;}var q=this;f.forEachChild(h,null,function(v){var s,u;u=q.handlers;q.handlers=[];for(s=0;s<u.length;s++){var r=u[s];if(r.isMatch(v)&&(q.authenticated||!r.user)){if(r.run(v)){q.handlers.push(r);}}else{q.handlers.push(r);}}});},_sendTerminate:function(){f.info("_sendTerminate was called");var h=this._buildBody().attrs({type:"terminate"});if(this.authenticated){h.c("presence",{xmlns:f.NS.CLIENT,type:"unavailable"});}this.disconnecting=true;var j=new f.Request(h.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),h.tree().getAttribute("rid"));this._requests.push(j);this._throttledRequestHandler();},_connect_cb:function(y){f.info("_connect_cb was called");this.connected=true;var j=y.getResponse();if(!j){return;}this.xmlInput(j);this.rawInput(f.serialize(j));var n=j.getAttribute("type");var w,p;if(n!==null&&n=="terminate"){w=j.getAttribute("condition");p=j.getElementsByTagName("conflict");if(w!==null){if(w=="remote-stream-error"&&p.length>0){w="conflict";}this._changeConnectStatus(f.Status.CONNFAIL,w);}else{this._changeConnectStatus(f.Status.CONNFAIL,"unknown");}return;}if(!this.sid){this.sid=j.getAttribute("sid");}if(!this.stream_id){this.stream_id=j.getAttribute("authid");}var k=j.getAttribute("requests");if(k){this.window=k;}var h=j.getAttribute("hold");if(h){this.hold=h;}var r=j.getAttribute("wait");if(r){this.wait=r;}var z=false;var m=false;var v=false;var A=j.getElementsByTagName("mechanism");var o,u,q,l;if(A.length>0){for(o=0;o<A.length;o++){u=f.getText(A[o]);if(u=="DIGEST-MD5"){m=true;}else{if(u=="PLAIN"){z=true;}else{if(u=="ANONYMOUS"){v=true;}}}}}else{var s=this._buildBody();this._requests.push(new f.Request(s.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),s.tree().getAttribute("rid")));this._throttledRequestHandler();return;}if(f.getNodeFromJid(this.jid)===null&&v){this._changeConnectStatus(f.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(d("auth",{xmlns:f.NS.SASL,mechanism:"ANONYMOUS"}).tree());}else{if(f.getNodeFromJid(this.jid)===null){this._changeConnectStatus(f.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");this.disconnect();}else{if(m){this._changeConnectStatus(f.Status.AUTHENTICATING,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(d("auth",{xmlns:f.NS.SASL,mechanism:"DIGEST-MD5"}).tree());}else{if(z){q=f.getBareJidFromJid(this.jid);q=q+"\u0000";q=q+f.getNodeFromJid(this.jid);q=q+"\u0000";q=q+this.pass;this._changeConnectStatus(f.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);l=Base64.encode(q);this.send(d("auth",{xmlns:f.NS.SASL,mechanism:"PLAIN"}).t(l).tree());}else{this._changeConnectStatus(f.Status.AUTHENTICATING,null);this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send(e({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).tree());}}}}},_sasl_challenge1_cb:function(m){var j=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;var s=Base64.decode(f.getText(m));var u=MD5.hexdigest(Math.random()*1234567890);var p="";var v=null;var q="";var h="";var o;this.deleteHandler(this._sasl_failure_handler);while(s.match(j)){o=s.match(j);s=s.replace(o[0],"");o[2]=o[2].replace(/^"(.+)"$/,"$1");switch(o[1]){case"realm":p=o[2];break;case"nonce":q=o[2];break;case"qop":h=o[2];break;case"host":v=o[2];break;}}var n="xmpp/"+this.domain;if(v!==null){n=n+"/"+v;}var l=MD5.hash(f.getNodeFromJid(this.jid)+":"+p+":"+this.pass)+":"+q+":"+u;var k="AUTHENTICATE:"+n;var r="";r+="username="+this._quote(f.getNodeFromJid(this.jid))+",";r+="realm="+this._quote(p)+",";r+="nonce="+this._quote(q)+",";r+="cnonce="+this._quote(u)+",";r+='nc="00000001",';r+='qop="auth",';r+="digest-uri="+this._quote(n)+",";r+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(l)+":"+q+":00000001:"+u+":auth:"+MD5.hexdigest(k)))+",";r+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(d("response",{xmlns:f.NS.SASL}).t(Base64.encode(r)).tree());return false;},_quote:function(h){return'"'+h.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"';},_sasl_challenge2_cb:function(h){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(d("response",{xmlns:f.NS.SASL}).tree());return false;},_auth1_cb:function(h){var j=e({type:"set",id:"_auth_2"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!f.getResourceFromJid(this.jid)){this.jid=f.getBareJidFromJid(this.jid)+"/strophe";}j.up().c("resource",{}).t(f.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(j.tree());return false;},_sasl_success_cb:function(h){f.info("SASL authentication succeeded.");this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null;}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);this._sendRestart();return false;},_sasl_auth1_cb:function(j){var h,l;for(h=0;h<j.childNodes.length;h++){l=j.childNodes[h];if(l.nodeName=="bind"){this.do_bind=true;}if(l.nodeName=="session"){this.do_session=true;}}if(!this.do_bind){this._changeConnectStatus(f.Status.AUTHFAIL,null);return false;}else{this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var k=f.getResourceFromJid(this.jid);if(k){this.send(e({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).c("resource",{}).t(k).tree());}else{this.send(e({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).tree());}}return false;},_sasl_bind_cb:function(h){if(h.getAttribute("type")=="error"){f.info("SASL binding failed.");this._changeConnectStatus(f.Status.AUTHFAIL,null);return false;}var k=h.getElementsByTagName("bind");var j;if(k.length>0){j=k[0].getElementsByTagName("jid");if(j.length>0){this.jid=f.getText(j[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send(e({type:"set",id:"_session_auth_2"}).c("session",{xmlns:f.NS.SESSION}).tree());}else{this.authenticated=true;this._changeConnectStatus(f.Status.CONNECTED,null);}}}else{f.info("SASL binding failed.");this._changeConnectStatus(f.Status.AUTHFAIL,null);return false;}},_sasl_session_cb:function(h){if(h.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(f.Status.CONNECTED,null);}else{if(h.getAttribute("type")=="error"){f.info("Session creation failed.");this._changeConnectStatus(f.Status.AUTHFAIL,null);return false;}}return false;},_sasl_failure_cb:function(h){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null;}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null;}this._changeConnectStatus(f.Status.AUTHFAIL,null);return false;},_auth2_cb:function(h){if(h.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(f.Status.CONNECTED,null);}else{if(h.getAttribute("type")=="error"){this._changeConnectStatus(f.Status.AUTHFAIL,null);this.disconnect();}}return false;},_addSysTimedHandler:function(k,j){var h=new f.TimedHandler(k,j);h.user=false;this.addTimeds.push(h);return h;},_addSysHandler:function(m,l,j,k,n){var h=new f.Handler(m,l,j,k,n);h.user=false;this.addHandlers.push(h);return h;},_onDisconnectTimeout:function(){f.info("_onDisconnectTimeout was called");var h;while(this._requests.length>0){h=this._requests.pop();h.abort=true;h.xhr.abort();h.xhr.onreadystatechange=function(){};}this._doDisconnect();return false;},_onIdle:function(){var k,m,o,l;while(this.removeTimeds.length>0){m=this.removeTimeds.pop();k=this.timedHandlers.indexOf(m);if(k>=0){this.timedHandlers.splice(k,1);}}while(this.addTimeds.length>0){this.timedHandlers.push(this.addTimeds.pop());}var j=new Date().getTime();l=[];for(k=0;k<this.timedHandlers.length;k++){m=this.timedHandlers[k];if(this.authenticated||!m.user){o=m.lastCalled+m.period;if(o-j<=0){if(m.run()){l.push(m);}}else{l.push(m);}}}this.timedHandlers=l;var h,n;if(this.authenticated&&this._requests.length===0&&this._data.length===0&&!this.disconnecting){f.info("no requests during idle cycle, sending blank request");this._data.push(null);}if(this._requests.length<2&&this._data.length>0&&!this.paused){h=this._buildBody();for(k=0;k<this._data.length;k++){if(this._data[k]!==null){if(this._data[k]==="restart"){h.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":f.NS.BOSH});}else{h.cnode(this._data[k]).up();}}}delete this._data;this._data=[];this._requests.push(new f.Request(h.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),h.tree().getAttribute("rid")));this._processRequest(this._requests.length-1);}if(this._requests.length>0){n=this._requests[0].age();if(this._requests[0].dead!==null){if(this._requests[0].timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait)){this._throttledRequestHandler();}}if(n>Math.floor(f.TIMEOUT*this.wait)){f.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(f.TIMEOUT*this.wait)+" seconds since last activity");this._throttledRequestHandler();}}clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100);}};if(g){g(f,d,a,e,c);}})(function(){window.Strophe=arguments[0];window.$build=arguments[1];window.$msg=arguments[2];window.$iq=arguments[3];window.$pres=arguments[4];});var MD5=(function(){var q=0;var a="";var n=8;var l=function(u,z){var w=(u&65535)+(z&65535);var v=(u>>16)+(z>>16)+(w>>16);return(v<<16)|(w&65535);};var p=function(u,v){return(u<<v)|(u>>>(32-v));};var c=function(y){var w=[];var u=(1<<n)-1;for(var v=0;v<y.length*n;v+=n){w[v>>5]|=(y.charCodeAt(v/n)&u)<<(v%32);}return w;};var h=function(w){var y="";var u=(1<<n)-1;for(var v=0;v<w.length*32;v+=n){y+=String.fromCharCode((w[v>>5]>>>(v%32))&u);}return y;};var s=function(w){var v=q?"0123456789ABCDEF":"0123456789abcdef";var y="";for(var u=0;u<w.length*4;u++){y+=v.charAt((w[u>>2]>>((u%4)*8+4))&15)+v.charAt((w[u>>2]>>((u%4)*8))&15);}return y;};var r=function(y){var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var A="";var z,u;for(var v=0;v<y.length*4;v+=3){z=(((y[v>>2]>>8*(v%4))&255)<<16)|(((y[v+1>>2]>>8*((v+1)%4))&255)<<8)|((y[v+2>>2]>>8*((v+2)%4))&255);for(u=0;u<4;u++){if(v*8+u*6>y.length*32){A+=a;}else{A+=w.charAt((z>>6*(3-u))&63);}}}return A;};var e=function(A,w,v,u,z,y){return l(p(l(l(w,A),l(u,y)),z),v);};var m=function(w,v,B,A,u,z,y){return e((v&B)|((~v)&A),w,v,u,z,y);};var d=function(w,v,B,A,u,z,y){return e((v&A)|(B&(~A)),w,v,u,z,y);};var o=function(w,v,B,A,u,z,y){return e(v^B^A,w,v,u,z,y);};var k=function(w,v,B,A,u,z,y){return e(B^(v|(~A)),w,v,u,z,y);};var g=function(F,A){F[A>>5]|=128<<((A)%32);F[(((A+64)>>>9)<<4)+14]=A;var E=1732584193;var D=-271733879;var C=-1732584194;var B=271733878;var z,y,w,u;for(var v=0;v<F.length;v+=16){z=E;y=D;w=C;u=B;E=m(E,D,C,B,F[v+0],7,-680876936);B=m(B,E,D,C,F[v+1],12,-389564586);C=m(C,B,E,D,F[v+2],17,606105819);D=m(D,C,B,E,F[v+3],22,-1044525330);E=m(E,D,C,B,F[v+4],7,-176418897);B=m(B,E,D,C,F[v+5],12,1200080426);C=m(C,B,E,D,F[v+6],17,-1473231341);D=m(D,C,B,E,F[v+7],22,-45705983);E=m(E,D,C,B,F[v+8],7,1770035416);B=m(B,E,D,C,F[v+9],12,-1958414417);C=m(C,B,E,D,F[v+10],17,-42063);D=m(D,C,B,E,F[v+11],22,-1990404162);E=m(E,D,C,B,F[v+12],7,1804603682);B=m(B,E,D,C,F[v+13],12,-40341101);C=m(C,B,E,D,F[v+14],17,-1502002290);D=m(D,C,B,E,F[v+15],22,1236535329);E=d(E,D,C,B,F[v+1],5,-165796510);B=d(B,E,D,C,F[v+6],9,-1069501632);C=d(C,B,E,D,F[v+11],14,643717713);D=d(D,C,B,E,F[v+0],20,-373897302);E=d(E,D,C,B,F[v+5],5,-701558691);B=d(B,E,D,C,F[v+10],9,38016083);C=d(C,B,E,D,F[v+15],14,-660478335);D=d(D,C,B,E,F[v+4],20,-405537848);E=d(E,D,C,B,F[v+9],5,568446438);B=d(B,E,D,C,F[v+14],9,-1019803690);C=d(C,B,E,D,F[v+3],14,-187363961);D=d(D,C,B,E,F[v+8],20,1163531501);E=d(E,D,C,B,F[v+13],5,-1444681467);B=d(B,E,D,C,F[v+2],9,-51403784);C=d(C,B,E,D,F[v+7],14,1735328473);D=d(D,C,B,E,F[v+12],20,-1926607734);E=o(E,D,C,B,F[v+5],4,-378558);B=o(B,E,D,C,F[v+8],11,-2022574463);C=o(C,B,E,D,F[v+11],16,1839030562);D=o(D,C,B,E,F[v+14],23,-35309556);E=o(E,D,C,B,F[v+1],4,-1530992060);B=o(B,E,D,C,F[v+4],11,1272893353);C=o(C,B,E,D,F[v+7],16,-155497632);D=o(D,C,B,E,F[v+10],23,-1094730640);E=o(E,D,C,B,F[v+13],4,681279174);B=o(B,E,D,C,F[v+0],11,-358537222);C=o(C,B,E,D,F[v+3],16,-722521979);D=o(D,C,B,E,F[v+6],23,76029189);E=o(E,D,C,B,F[v+9],4,-640364487);B=o(B,E,D,C,F[v+12],11,-421815835);C=o(C,B,E,D,F[v+15],16,530742520);D=o(D,C,B,E,F[v+2],23,-995338651);E=k(E,D,C,B,F[v+0],6,-198630844);B=k(B,E,D,C,F[v+7],10,1126891415);C=k(C,B,E,D,F[v+14],15,-1416354905);D=k(D,C,B,E,F[v+5],21,-57434055);E=k(E,D,C,B,F[v+12],6,1700485571);B=k(B,E,D,C,F[v+3],10,-1894986606);C=k(C,B,E,D,F[v+10],15,-1051523);D=k(D,C,B,E,F[v+1],21,-2054922799);E=k(E,D,C,B,F[v+8],6,1873313359);B=k(B,E,D,C,F[v+15],10,-30611744);C=k(C,B,E,D,F[v+6],15,-1560198380);D=k(D,C,B,E,F[v+13],21,1309151649);E=k(E,D,C,B,F[v+4],6,-145523070);B=k(B,E,D,C,F[v+11],10,-1120210379);C=k(C,B,E,D,F[v+2],15,718787259);D=k(D,C,B,E,F[v+9],21,-343485551);E=l(E,z);D=l(D,y);C=l(C,w);B=l(B,u);}return[E,D,C,B];};var f=function(w,A){var z=c(w);if(z.length>16){z=g(z,w.length*n);}var u=new Array(16),y=new Array(16);for(var v=0;v<16;v++){u[v]=z[v]^909522486;y[v]=z[v]^1549556828;}var B=g(u.concat(c(A)),512+A.length*n);return g(y.concat(B),512+128);};var j={hexdigest:function(u){return s(g(c(u),u.length*n));},b64digest:function(u){return r(g(c(u),u.length*n));},hash:function(u){return h(g(c(u),u.length*n));},hmac_hexdigest:function(u,v){return s(f(u,v));},hmac_b64digest:function(u,v){return r(f(u,v));},hmac_hash:function(u,v){return h(f(u,v));},test:function(){return MD5.hexdigest("abc")==="900150983cd24fb0d6963f7d28e17f72";}};return j;})();Strophe.addConnectionPlugin("pubsub",{_connection:null,init:function(a){this._connection=a;Strophe.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub");Strophe.addNamespace("PUBSUB_SUBSCRIBE_OPTIONS",Strophe.NS.PUBSUB+"#subscribe_options");Strophe.addNamespace("PUBSUB_ERRORS",Strophe.NS.PUBSUB+"#errors");Strophe.addNamespace("PUBSUB_EVENT",Strophe.NS.PUBSUB+"#event");Strophe.addNamespace("PUBSUB_OWNER",Strophe.NS.PUBSUB+"#owner");Strophe.addNamespace("PUBSUB_AUTO_CREATE",Strophe.NS.PUBSUB+"#auto-create");Strophe.addNamespace("PUBSUB_PUBLISH_OPTIONS",Strophe.NS.PUBSUB+"#publish-options");Strophe.addNamespace("PUBSUB_NODE_CONFIG",Strophe.NS.PUBSUB+"#node_config");Strophe.addNamespace("PUBSUB_CREATE_AND_CONFIGURE",Strophe.NS.PUBSUB+"#create-and-configure");Strophe.addNamespace("PUBSUB_SUBSCRIBE_AUTHORIZATION",Strophe.NS.PUBSUB+"#subscribe_authorization");Strophe.addNamespace("PUBSUB_GET_PENDING",Strophe.NS.PUBSUB+"#get-pending");Strophe.addNamespace("PUBSUB_MANAGE_SUBSCRIPTIONS",Strophe.NS.PUBSUB+"#manage-subscriptions");Strophe.addNamespace("PUBSUB_META_DATA",Strophe.NS.PUBSUB+"#meta-data");},createNode:function(a,j,d,p,e){var f=this._connection.getUniqueId("pubsubcreatenode");var h=$iq({from:a,to:j,type:"set",id:f});var n=Strophe.xmlElement("configure",[]);var l=Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]);var k=Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]);var m=Strophe.xmlElement("value",[]);var o=Strophe.xmlTextNode(Strophe.NS.PUBSUB+"#node_config");m.appendChild(o);k.appendChild(m);l.appendChild(k);for(var g in p){var c=p[g];l.appendChild(c);}if(p.length&&p.length!=0){n.appendChild(l);}h.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("create",{node:d}).up().cnode(n);this._connection.addHandler(e,null,"iq",null,f,null);this._connection.send(h.tree());return f;},subscribe:function(d,k,f,q,c,g){var p=this._connection.getUniqueId("subscribenode");var h=Strophe.xmlElement("options",[]);var m=Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]);var l=Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]);var n=Strophe.xmlElement("value",[]);var o=Strophe.xmlTextNode(Strophe.NS.PUBSUB_SUBSCRIBE_OPTIONS);n.appendChild(o);l.appendChild(n);m.appendChild(l);var a=$iq({from:d,to:k,type:"set",id:p});if(q&&q.length&&q.length!==0){for(var j=0;j<q.length;j++){var e=q[j];m.appendChild(e);}h.appendChild(m);a.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("subscribe",{node:f,jid:d}).up().cnode(h);}else{a.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("subscribe",{node:f,jid:d});}this._connection.addHandler(g,null,"iq",null,p,null);this._connection.addHandler(c,null,"message",null,null,null);this._connection.send(a.tree());return p;},unsubscribe:function(d,a,f,g){var c=this._connection.getUniqueId("unsubscribenode");var e=$iq({from:d,to:a,type:"set",id:c});e.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("unsubscribe",{node:f,jid:d});this._connection.addHandler(g,null,"iq",null,c,null);this._connection.send(e.tree());return c;},publish:function(d,j,e,k,f){var c=this._connection.getUniqueId("publishnode");var a=Strophe.xmlElement("publish",[["node",e],["jid",d]]);for(var h in k){var n=Strophe.xmlElement("item",[]);var l=Strophe.xmlElement("entry",[]);var m=Strophe.xmlTextNode(k[h]);l.appendChild(m);n.appendChild(l);a.appendChild(n);}var g=$iq({from:d,to:j,type:"set",id:c});g.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).cnode(a);this._connection.addHandler(f,null,"iq",null,c,null);this._connection.send(g.tree());return c;},items:function(c,a,e,f,g){var d=$iq({from:c,to:a,type:"get"});d.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("items",{node:e});return this._connection.sendIQ(d.tree(),f,g);}});(function(){var y=this;var u=y._;var c={};var k=Array.prototype,F=Object.prototype,H=Function.prototype;var v=k.slice,A=k.unshift,z=F.toString,q=F.hasOwnProperty;var o=k.forEach,j=k.map,D=k.reduce,f=k.reduceRight,n=k.filter,a=k.every,C=k.some,w=k.indexOf,g=k.lastIndexOf,d=Array.isArray,E=Object.keys,l=H.bind;var G=function(I){return new h(I);};if(typeof module!=="undefined"&&module.exports){module.exports=G;G._=G;}else{y._=G;}G.VERSION="1.1.5";var e=G.each=G.forEach=function(N,M,L){if(N==null){return;}if(o&&N.forEach===o){N.forEach(M,L);}else{if(G.isNumber(N.length)){for(var K=0,I=N.length;K<I;K++){if(M.call(L,N[K],K,N)===c){return;}}}else{for(var J in N){if(q.call(N,J)){if(M.call(L,N[J],J,N)===c){return;}}}}}};G.map=function(L,K,J){var I=[];if(L==null){return I;}if(j&&L.map===j){return L.map(K,J);}e(L,function(O,M,N){I[I.length]=K.call(J,O,M,N);});return I;};G.reduce=G.foldl=G.inject=function(M,L,I,K){var J=I!==void 0;if(M==null){M=[];}if(D&&M.reduce===D){if(K){L=G.bind(L,K);}return J?M.reduce(L,I):M.reduce(L);}e(M,function(P,N,O){if(!J&&N===0){I=P;J=true;}else{I=L.call(K,I,P,N,O);}});if(!J){throw new TypeError("Reduce of empty array with no initial value");}return I;};G.reduceRight=G.foldr=function(L,K,I,J){if(L==null){L=[];}if(f&&L.reduceRight===f){if(J){K=G.bind(K,J);}return I!==void 0?L.reduceRight(K,I):L.reduceRight(K);}var M=(G.isArray(L)?L.slice():G.toArray(L)).reverse();return G.reduce(M,K,I,J);};G.find=G.detect=function(L,K,J){var I;r(L,function(O,M,N){if(K.call(J,O,M,N)){I=O;return true;}});return I;};G.filter=G.select=function(L,K,J){var I=[];if(L==null){return I;}if(n&&L.filter===n){return L.filter(K,J);}e(L,function(O,M,N){if(K.call(J,O,M,N)){I[I.length]=O;}});return I;};G.reject=function(L,K,J){var I=[];if(L==null){return I;}e(L,function(O,M,N){if(!K.call(J,O,M,N)){I[I.length]=O;}});return I;};G.every=G.all=function(L,K,J){K=K||G.identity;var I=true;if(L==null){return I;}if(a&&L.every===a){return L.every(K,J);}e(L,function(O,M,N){if(!(I=I&&K.call(J,O,M,N))){return c;}});return I;};var r=G.some=G.any=function(L,K,J){K=K||G.identity;var I=false;if(L==null){return I;}if(C&&L.some===C){return L.some(K,J);}e(L,function(O,M,N){if(I=K.call(J,O,M,N)){return c;}});return I;};G.include=G.contains=function(K,J){var I=false;if(K==null){return I;}if(w&&K.indexOf===w){return K.indexOf(J)!=-1;}r(K,function(L){if(I=L===J){return true;}});return I;};G.invoke=function(J,K){var I=v.call(arguments,2);return G.map(J,function(L){return(K?L[K]:L).apply(L,I);});};G.pluck=function(J,I){return G.map(J,function(K){return K[I];});};G.max=function(L,K,J){if(!K&&G.isArray(L)){return Math.max.apply(Math,L);}var I={computed:-Infinity};e(L,function(P,M,O){var N=K?K.call(J,P,M,O):P;N>=I.computed&&(I={value:P,computed:N});});return I.value;};G.min=function(L,K,J){if(!K&&G.isArray(L)){return Math.min.apply(Math,L);}var I={computed:Infinity};e(L,function(P,M,O){var N=K?K.call(J,P,M,O):P;N<I.computed&&(I={value:P,computed:N});});return I.value;};G.sortBy=function(K,J,I){return G.pluck(G.map(K,function(N,L,M){return{value:N,criteria:J.call(I,N,L,M)};}).sort(function(O,N){var M=O.criteria,L=N.criteria;return M<L?-1:M>L?1:0;}),"value");};G.sortedIndex=function(N,M,K){K=K||G.identity;var I=0,L=N.length;while(I<L){var J=(I+L)>>1;K(N[J])<K(M)?I=J+1:L=J;}return I;};G.toArray=function(I){if(!I){return[];}if(I.toArray){return I.toArray();}if(G.isArray(I)){return I;}if(G.isArguments(I)){return v.call(I);}return G.values(I);};G.size=function(I){return G.toArray(I).length;};G.first=G.head=function(K,J,I){return(J!=null)&&!I?v.call(K,0,J):K[0];};G.rest=G.tail=function(K,I,J){return v.call(K,(I==null)||J?1:I);};G.last=function(I){return I[I.length-1];};G.compact=function(I){return G.filter(I,function(J){return !!J;});};G.flatten=function(I){return G.reduce(I,function(J,K){if(G.isArray(K)){return J.concat(G.flatten(K));}J[J.length]=K;return J;},[]);};G.without=function(J){var I=v.call(arguments,1);return G.filter(J,function(K){return !G.include(I,K);});};G.uniq=G.unique=function(J,I){return G.reduce(J,function(K,M,L){if(0==L||(I===true?G.last(K)!=M:!G.include(K,M))){K[K.length]=M;}return K;},[]);};G.intersect=function(J){var I=v.call(arguments,1);return G.filter(G.uniq(J),function(K){return G.every(I,function(L){return G.indexOf(L,K)>=0;});});};G.zip=function(){var I=v.call(arguments);var L=G.max(G.pluck(I,"length"));var K=new Array(L);for(var J=0;J<L;J++){K[J]=G.pluck(I,""+J);}return K;};G.indexOf=function(M,K,L){if(M==null){return -1;}var J,I;if(L){J=G.sortedIndex(M,K);return M[J]===K?J:-1;}if(w&&M.indexOf===w){return M.indexOf(K);}for(J=0,I=M.length;J<I;J++){if(M[J]===K){return J;}}return -1;};G.lastIndexOf=function(K,J){if(K==null){return -1;}if(g&&K.lastIndexOf===g){return K.lastIndexOf(J);}var I=K.length;while(I--){if(K[I]===J){return I;}}return -1;};G.range=function(N,L,M){if(arguments.length<=1){L=N||0;N=0;}M=arguments[2]||1;var J=Math.max(Math.ceil((L-N)/M),0);var I=0;var K=new Array(J);while(I<J){K[I++]=N;N+=M;}return K;};G.bind=function(J,K){if(l&&J.bind===l){return J.bind.apply(J,v.call(arguments,1));}var I=v.call(arguments,2);return function(){return J.apply(K,I.concat(v.call(arguments)));};};G.bindAll=function(J){var I=v.call(arguments,1);if(I.length==0){I=G.functions(J);}e(I,function(K){J[K]=G.bind(J[K],J);});return J;};G.memoize=function(K,J){var I={};J=J||G.identity;return function(){var L=J.apply(this,arguments);return q.call(I,L)?I[L]:(I[L]=K.apply(this,arguments));};};G.delay=function(J,K){var I=v.call(arguments,2);return setTimeout(function(){return J.apply(J,I);},K);};G.defer=function(I){return G.delay.apply(G,[I,1].concat(v.call(arguments,1)));};var B=function(J,L,I){var K;return function(){var N=this,M=arguments;var O=function(){K=null;J.apply(N,M);};if(I){clearTimeout(K);}if(I||!K){K=setTimeout(O,L);}};};G.throttle=function(I,J){return B(I,J,false);};G.debounce=function(I,J){return B(I,J,true);};G.once=function(K){var I=false,J;return function(){if(I){return J;}I=true;return J=K.apply(this,arguments);};};G.wrap=function(I,J){return function(){var K=[I].concat(v.call(arguments));return J.apply(this,K);};};G.compose=function(){var I=v.call(arguments);return function(){var J=v.call(arguments);for(var K=I.length-1;K>=0;K--){J=[I[K].apply(this,J)];}return J[0];};};G.keys=E||function(K){if(K!==Object(K)){throw new TypeError("Invalid object");}var J=[];for(var I in K){if(q.call(K,I)){J[J.length]=I;}}return J;};G.values=function(I){return G.map(I,G.identity);};G.functions=G.methods=function(I){return G.filter(G.keys(I),function(J){return G.isFunction(I[J]);}).sort();};G.extend=function(I){e(v.call(arguments,1),function(J){for(var K in J){I[K]=J[K];}});return I;};G.defaults=function(I){e(v.call(arguments,1),function(J){for(var K in J){if(I[K]==null){I[K]=J[K];}}});return I;};G.clone=function(I){return G.isArray(I)?I.slice():G.extend({},I);};G.tap=function(J,I){I(J);return J;};G.isEqual=function(J,I){if(J===I){return true;}var M=typeof(J),O=typeof(I);if(M!=O){return false;}if(J==I){return true;}if((!J&&I)||(J&&!I)){return false;}if(J._chain){J=J._wrapped;}if(I._chain){I=I._wrapped;}if(J.isEqual){return J.isEqual(I);}if(G.isDate(J)&&G.isDate(I)){return J.getTime()===I.getTime();}if(G.isNaN(J)&&G.isNaN(I)){return false;}if(G.isRegExp(J)&&G.isRegExp(I)){return J.source===I.source&&J.global===I.global&&J.ignoreCase===I.ignoreCase&&J.multiline===I.multiline;}if(M!=="object"){return false;}if(J.length&&(J.length!==I.length)){return false;}var K=G.keys(J),N=G.keys(I);if(K.length!=N.length){return false;}for(var L in J){if(!(L in I)||!G.isEqual(J[L],I[L])){return false;}}return true;};G.isEmpty=function(J){if(G.isArray(J)||G.isString(J)){return J.length===0;}for(var I in J){if(q.call(J,I)){return false;}}return true;};G.isElement=function(I){return !!(I&&I.nodeType==1);};G.isArray=d||function(I){return z.call(I)==="[object Array]";};G.isArguments=function(I){return !!(I&&q.call(I,"callee"));};G.isFunction=function(I){return !!(I&&I.constructor&&I.call&&I.apply);};G.isString=function(I){return !!(I===""||(I&&I.charCodeAt&&I.substr));};G.isNumber=function(I){return !!(I===0||(I&&I.toExponential&&I.toFixed));};G.isNaN=function(I){return I!==I;};G.isBoolean=function(I){return I===true||I===false;};G.isDate=function(I){return !!(I&&I.getTimezoneOffset&&I.setUTCFullYear);};G.isRegExp=function(I){return !!(I&&I.test&&I.exec&&(I.ignoreCase||I.ignoreCase===false));};G.isNull=function(I){return I===null;};G.isUndefined=function(I){return I===void 0;};G.noConflict=function(){y._=u;return this;};G.identity=function(I){return I;};G.times=function(L,K,J){for(var I=0;I<L;I++){K.call(J,I);}};G.mixin=function(I){e(G.functions(I),function(J){s(J,G[J]=I[J]);});};var m=0;G.uniqueId=function(I){var J=m++;return I?I+J:J;};G.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};G.template=function(L,K){var M=G.templateSettings;var I="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+L.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(M.interpolate,function(N,O){return"',"+O.replace(/\\'/g,"'")+",'";}).replace(M.evaluate||null,function(N,O){return"');"+O.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('";}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";var J=new Function("obj",I);return K?J(K):J;};var h=function(I){this._wrapped=I;};G.prototype=h.prototype;var p=function(J,I){return I?G(J).chain():J;};var s=function(I,J){h.prototype[I]=function(){var K=v.call(arguments);A.call(K,this._wrapped);return p(J.apply(G,K),this._chain);};};G.mixin(G);e(["pop","push","reverse","shift","sort","splice","unshift"],function(I){var J=k[I];h.prototype[I]=function(){J.apply(this._wrapped,arguments);return p(this._wrapped,this._chain);};});e(["concat","join","slice"],function(I){var J=k[I];h.prototype[I]=function(){return p(J.apply(this._wrapped,arguments),this._chain);};});h.prototype.chain=function(){this._chain=true;return this;};h.prototype.value=function(){return this._wrapped;};})();var Cookie={set:function(e,f,c){var a="";if(c!==undefined){var g=new Date();g.setTime(g.getTime()+(86400000*parseFloat(c)));a="; expires="+g.toGMTString();}return(document.cookie=escape(e)+"="+escape(f||"")+a+"; path=/");},get:function(a){var c=document.cookie.match(new RegExp("(^|;)\\s*"+escape(a)+"=([^;\\s]*)"));return(c?unescape(c[2]):null);},erase:function(a){var c=Cookie.get(a)||true;Cookie.set(a,"",-1);return c;},accept:function(){if(typeof navigator.cookieEnabled=="boolean"){return navigator.cookieEnabled;}Cookie.set("_test","1");return(Cookie.erase("_test")==="1");}};
var Account=Class.create({initialize:function(a){if(a.lastTrialDay){a.lastTrialDay=new Date(a.lastTrialDay);}else{delete a.daysLeftInTrial;}_.extend(this,a);},hasFeature:function(a){return _(this.features).contains(a);}});
var User=Class.create({initialize:function(a){a.passwordExpiresAt=new Date(a.passwordExpiresAt);switch(a.role){case User.roles.endUser:this.isAnonymous=a.id==null;this.isEndUser=true;this.isAgent=false;this.isAdmin=false;break;case User.roles.admin:this.isAnonymous=false;this.isEndUser=false;this.isAgent=true;this.isAdmin=true;break;case User.roles.agent:this.isAnonymous=false;this.isEndUser=false;this.isAgent=true;this.isAdmin=false;break;}_.extend(this,a);this.canViewOrganization=this.organization!=null&&(!this.isEndUser||a.restriction===User.restrictions.organization||this.organization.isShared);},isPasswordExpiring:function(){var a=(new Date()).valueOf();var c=5*24*60*60*1000;return(this.passwordExpiresAt>a)&&(this.passwordExpiresAt<a+c);},isTagged:function(a){return _(this.tags).contains(a);}});User.roles={endUser:0,admin:2,agent:4};User.restrictions={none:0,groups:1,organization:2,assigned:3,requested:4};
var Organization=Class.create({initialize:function(a){_.extend(this,a);}});var currentUser=null;var currentAccount=null;var $j=jQuery.noConflict();var $z=(function(){var a={};var c=function(d){if(typeof(a[d])==="object"){var e=function(){};e.prototype=a[d];return(new e());}};c.defModule=function(d,e){if(typeof(a[d])!=="object"){a[d]=e;}};c.initializeModules=function(d){$j(document).ready(function(e){$j(d).each(function(g,f){if(typeof(a[f[0]])==="object"&&typeof(a[f[0]].initialize)==="function"){var j=function(){this.initialize.apply(this,f[1]);delete this["initialize"];};j.prototype=a[f[0]];var h=new j();}});});};return(c);})();var Zendesk=$z;jQuery.fn.truncateViaFade=function(){this.each(function(){var a=$j(this);a.css("display","block");if(a.css("position")!="absolute"){a.css("position","relative");}a.append($j('<span class="faded_truncation"></span>').css("height",a.height()));});};var arrayEquals=function(d,c){if(d.length!=c.length){return false;}for(var e=d.length;--e>=0;){if((d[e] instanceof Date)&&(c[e] instanceof Date)){if(!dateEquals(d[e],c[e])){return false;}}else{if(d[e]!==c[e]){return false;}}}return true;};var dateEquals=function(d,c){return(d instanceof Date)&&(c instanceof Date)&&(d>=c)&&(d<=c);};(function(d,c){if(!c.Zendesk){c.Zendesk={};}var a=c.Zendesk;if(!!a.NS){return;}var e=Array.prototype.slice;function f(j,g){if(g.length>0){var h=g.pop();if(d.isFunction(h)){h.apply(j,g);}else{if(!!h){throw new Error(h+" is not a function");}}}}a.NS=function(g){var l=g.split("."),k=a,h;for(h=0;h<l.length;h++){var j=l[h];if(typeof(k[j])==="undefined"){k[j]={};}k=k[j];}f(k,e.call(arguments,1,arguments.length));return k;};a.NS.extend=function(g,h){d.extend(a.NS(g),h);};}(this.jQuery,this));Zendesk.NS("UI",this.jQuery,function(a){this.NestedMenu=function(c){this._menu=a(c);var d=this;this.initialize=function(){a(document).bind("click",function(f){if(a(f.target).parents().index(d._menu)<0){d.collapse();}});var e=d._menu.find("li:eq(0)");e.click(function(){e.find("> ul").show();});d._menu.find("ul > li").each(function(h,f){var g=a(f);g.mouseover(function(){Zendesk.UI.NestedMenu.close_submenu(g);g.parent().data("selection",a(f));g.find("> ul").show();});});return d;};this.collapse=function(){d._menu.find("li").each(function(f,e){a(e).find("ul").hide();});return d;};};this.NestedMenu.close_submenu=function(d){var c=d.parent().data("selection");if(c){a(c).find("> ul").hide();}};});jQuery(function(h){var f=h("#ticket_assignee_id");var g=f.data("bulk-update");var a=h("#ticket_group_id");if(!f.exists()||!f.data("do-dynamic-filtering")){a.change(function(){window.assignee_select(h(this).val());});return;}var d={};function e(j){if(d[j]){return new h.Deferred().resolve(d[j]);}else{return h.getJSON(f.data("refresh-url"),{group_id:j}).done(function(k){d[j]=k;});}}function c(k){var j=f.val();if(g){f.html('<option value="-1">- No change -</option><option value="">-</option>');}else{f.html("<option></option>");}_(k).each(function(l){f.append("<option value='"+l.id+"'>"+l.name+"</option>");});f.val(j).change();}a.change(function(){e(a.val()).done(c);}).change();window.assignee_select=function(k,j){k=k||a.val();return e(k).done(c).done(function(){((j!=null)&&(j!=undefined))&&j!==f.val()&&f.val(j).change();a.add(f).blur();});};window.assignee_select(null,f.data("value"));});(function(a){Zendesk.Sound=function(c,d){this.id=c;this.url=d;};Zendesk.Sound.prototype={load:function(d){var c={autoLoad:true,autoPlay:false};c=_(c).extend({id:"sound_"+this.id,url:this.url,onload:_(function(){if(_.isFunction(d)){d(this);}}).bind(this)});Zendesk.Sound.initializeSoundManager(_(function(){this.sound=window.soundManager.createSound(c);if(this.sound.loaded){c.onload.call(this);}}).bind(this));},play:function(d){if(this.loaded()){return this.sound.play(d);}else{var c=this;this.load(function(){c.play(d);});return false;}},pause:function(){return this.sound.pause();},seekTo:function(c){return this.sound.setPosition(c);},duration:function(){return this.sound.duration;},loaded:function(){return this.sound&&this.sound.loaded;},position:function(){return this.sound.position;},playState:function(){return this.sound.playState;},volume:function(c){if(!_.isUndefined(c)){this.sound.setVolume(c);}return this.sound.volume;}};Zendesk.Sound.soundManagerLoaded=false;Zendesk.Sound.soundManagerLoading=false;Zendesk.Sound.initializeSoundManager=function(c){if(Zendesk.Sound.soundManagerLoaded){return c();}else{if(!Zendesk.Sound.soundManagerLoading){window.soundManager=new SoundManager("/media/voice/soundmanager");window.soundManager.beginDelayedInit();Zendesk.Sound.soundManagerLoading=true;}}window.soundManager.onready(function(){Zendesk.Sound.soundManagerLoaded=true;return c();});};}(this.jQuery));this.SM2_DEFER=true;(function(d){function c(f){var h=Math.ceil(f/1000);var g=Math.floor(h/60);h=h%60;if(h<10){h="0"+h;}if(g<10){g="0"+g;}return g+":"+h;}var e=_([[3,0],[7,20],[12,40],[17,60],[22,80],[27,100]]);function a(g){var f=g.pageX;for(var h=g.target;h;h=h.offsetParent){f-=h.offsetLeft;}return(e.find(function(j){return f<=j[0];})||[])[1];}Zendesk.AudioPlayer=function(g,f){this.sound=g;this.playerElement=f;this.seekbar=this.playerElement.find(".seekbar");this.timeRemaining=this.playerElement.find(".time_remaining");this.playButton=this.playerElement.find(".play");this.volumeButton=this.playerElement.find(".volume");this.seeking=false;};Zendesk.AudioPlayer.prototype={init:function(){this.soundObj=this.sound.sound;this.soundObj._player=this;var f=this;if(this.sound.playState()!==0){this.playButton.addClass("playing");}this.playButton.click(function(){f.playButton.toggleClass("playing");if(f.playButton.attr("data-state")==="paused"){f.playButton.attr("data-state","playing");f.play();}else{f.playButton.attr("data-state","paused");f.pause();}});this.volumeButton.click(function(g){f.updateVolume(a(g));});this.seekbar.slider({value:0,step:50,max:this.sound.duration(),slide:function(h,g){f.seeking=true;},change:function(h,g){if(h.originalEvent){f.sound.seekTo(g.value);f.updateTimeRemaining();}f.seeking=false;}});this.updateTimeRemaining();return this;},play:function(){this.sound.play({whileplaying:this.timeUpdate,onfinish:this.finishedPlaying});},pause:function(){this.sound.pause();},timeUpdate:function(){var f=this._player;if(f.seeking){return;}f.seekbar.slider("value",f.sound.position());f.updateTimeRemaining();},finishedPlaying:function(){var f=this._player;f.seekbar.slider("value",0);f.playButton.attr("data-state","paused");f.playButton.removeClass("playing");f.sound.seekTo(0);f.pause();f.updateTimeRemaining();},updateTimeRemaining:function(){this.timeRemaining.html(c(this.sound.duration()-this.sound.position()));},updateVolume:function(f){if(f!==null){this.sound.volume(f);this.volumeButton.removeClass("v0 v20 v40 v60 v80 v100").addClass("v"+f);}}};}(this.jQuery));(function(a){a.widget("ui.floating_menu",{options:{menuText:I18n.t("txt.users.show.actions")},_create:function(){var c;a.extend(this.options,{menuText:a(this.element).attr("data-menu-text")});a(this.element).wrap(a("<div>").addClass("floating_menu_ui inactive"));c=a("<span>",{html:this.options.menuText}).addClass("floating_menu_action");c.insertBefore(this.element);this.menu=this.element.parent(".floating_menu_ui");c.bind("mouseover",a.proxy(this.show,this));this.menu.bind("mouseleave",a.proxy(this.hide,this));},show:function(c){this.menu.removeClass("inactive");},hide:function(c){this.menu.addClass("inactive");}});}(this.jQuery));$j(function(){$j(".floating_menu").floating_menu();});Zendesk.Identity=function(c,a){this.singleIdentityLimit=["facebook"];this.unverifieds=["email","unverified_email","google"];this.primaries=["email","google"];this.externalIdentities=["facebook","twitter"];this.identityType=a.identity_type;this.id=a.id;this.isVerified=a.is_verified;this.isPrimary=false;this.isExternalIdentity=_(this.externalIdentities).include(this.identityType);this.listElmId=("#"+a.identity_type+"_identity_list");this.elmId=(a.identity_type+"_identity_"+a.id);this.removeUrl="/users/"+c+(a.identity_type==="unverified_email"?"/unverified_email_addresses/":"/user_identities/")+a.id+".json";if(_(this.primaries).include(a.identity_type)){this.primaryUrl="/users/"+c+"/user_identities/"+a.id+"/make_primary.json";}switch(a.identity_type){case"twitter":this.name="@"+a.screen_name;break;case"facebook":this.name=a.name;break;default:this.isPrimary=(a.priority==1);this.name=a.value;}};Zendesk.Identity.prototype.isUnverified=function(){return(_(this.unverifieds).include(this.identityType)&&!this.isVerified);};Zendesk.Identity.prototype.isPrimaryCandidate=function(){return(_(this.primaries).include(this.identityType)&&this.isVerified);};Zendesk.IdentitiesManager=function(d,c){var a=function(f){var e=$j.parseJSON($j("#all_user_identities").html())||[];var g=$j.parseJSON($j("#unverified_email_addresses").html())||[];return $j.merge(e,g).map(function(h){return new Zendesk.Identity(f,h);});};this.registerOnUpdate(c);this.identities=a(d);};Zendesk.IdentitiesManager.prototype.find=function(a){return _(this.identities).find(function(c){return c.elmId==a;});};Zendesk.IdentitiesManager.prototype.remove=function(a,c){if(typeof a=="undefined"){return $j.deferred().reject("No identity provided to be removed");}return $j.ajax({url:a.removeUrl,type:"DELETE"}).done($j.proxy(function(){this.identities=_(this.identities).without(a).compact();this.onUpdate();},this));};Zendesk.IdentitiesManager.prototype.registerOnUpdate=function(a){if(typeof a==="function"){this.onUpdate=a;}};Zendesk.IdentitiesManager.prototype.makePrimary=function(a){if(typeof a.primaryUrl=="undefined"){return $j.deferred().reject("The identity type "+a.identityType+" cannot be primary");}return $j.ajax({url:a.primaryUrl,type:"POST"}).done($j.proxy(function(){this.primary().isPrimary=false;a.isPrimary=true;},this));};Zendesk.IdentitiesManager.prototype.empty=function(){return this.identities.length===0;};Zendesk.IdentitiesManager.prototype.limitToSingleIdentity=function(a){return _(this.singleIdentityLimit).include(a.identityType);};Zendesk.IdentitiesManager.prototype.allPrimaryCandidates=function(){return _(this.identities).select(function(a){return a.isPrimaryCandidate();});};Zendesk.IdentitiesManager.prototype.primary=function(){return _(this.identities).detect(function(a){return a.isPrimary;});};(function(e,c){function d(f){return f&&f.length&&f.prop&&/^form$/i.test(f.prop("tagName"));}var a=c.__sdr;e.fn.extend({instrumentTracking:function(){var f=function(){e(this).trackEvent();};return e(this).each(function(g,h){h=e(h);d(h)?h.submit(f):h.click(f);});},trackEvent:function(g,f){e(this).trackZendeskEvent(g,f).trackToTangoEvent(g,f);},trackZendeskEvent:function(g,f){g=g||e(this).closest("[data-metric-activity]").attr("data-metric-activity");f=f||e(this).closest("[data-metric-module]").attr("data-metric-module");if(g&&f){Zendesk.Instrumentation.track(g,f);}return e(this);},trackToTangoEvent:function(g,f){g=g||e(this).closest("[data-tracking-activity]").attr("data-tracking-activity");f=f||e(this).closest("[data-tracking-module]").attr("data-tracking-module");if(g&&f){Zendesk.Instrumentation.ToTango.track(g,f);}return e(this);}});Zendesk.NS.extend("Instrumentation",{BROWSER_MAP:{Chrome:navigator.userAgent.match(/Chrome/),Safari:(navigator.vendor||"").match(/Apple/),Firefox:navigator.userAgent.match(/Firefox/),IE:navigator.userAgent.match(/MSIE/)},currentBrowser:function(){return _(Zendesk.Instrumentation.BROWSER_MAP).find(function(f,g){if(g){return f;}}).first();},track:function(g,f){return;},ToTango:{track:function(g,f){if(c.currentAccount&&c.currentAccount.isInTrial){this.tracker.track([f,g].join(": "),"Trial",{o:c.currentAccount.subdomain,ofid:c.currentAccount.id},c.currentUser.id);}},tracker:{track:function(){},identify:function(){}},load:function(){if(Zendesk.ToTangoID){try{this.tracker=new a(Zendesk.ToTangoID);}catch(f){}}},PLATFORM_MAP:_([[/mac/i,"Mac"],[/win/i,"Windows"],[/palm/i,"PalmOS"],[/(unix|linux)/i,"Unix"],[/blackberry/i,"Blackberry"]]),trackOperatingSystem:function(){}}});e(function(){Zendesk.Instrumentation.ToTango.load();e(".tracked").instrumentTracking();});}(this.jQuery,this));(function(a){a.fn.extend({exists:function(){return this.length>0;}});}(this.jQuery));Zendesk.JobStatus=function(c,a){this.statusUrl=c;this.id=c.match(/.*\/job_statuses\/(.*)/)[1];this.options=_.extend({title:"",interval:1000},a);_.bindAll(this);this.createFlashNotice();this.updateProgress();};Zendesk.JobStatus.prototype={createFlashNotice:function(){if(!this.flash){this.flash=$j('<div id="notice" class="processing"><span class="progress"/> <span>'+this.options.title+" </span></div>");$j("#flash_messages div").hide();$j("#flash_messages").append($j('<div id="flash" class="background"></div>').append(this.flash));$j(document).scrollTop($j("#flash_messages").position().top);}return this.flash;},updateProgress:function(){var a=this;$j.getJSON(this.statusUrl,function(d){d.job=a;if(d.status!=="completed"){if(d.total){a.flash.find(".progress").html(""+d.progress+" / "+d.total);}setTimeout(a.updateProgress,a.options.interval);}else{var c=a.options.renderResult(d);a.flash.find(".progress").html(c.title);a.flash.append(c.body);a.flash.removeClass("processing");a.flash.addClass("done_processing");}});}};(function(a){Zendesk.Pager=function(e,d,c){this.container=e;this.nextLink=c;this.prevLink=d;this.pages=a(e).find(".page");this.currentPage=0;this.prevLink.css("visibility","hidden");if(this.pages.length<2){this.nextLink.css("visibility","hidden");}};Zendesk.Pager.prototype={paginate:function(d){this.showPage(this.currentPage);var c=this;a(this.prevLink).click(function(f){if(c.currentPage>0){c.nextLink.css("visibility","visible");c.currentPage=c.currentPage-1;c.showPage(c.currentPage);if(c.currentPage===0){c.prevLink.css("visibility","hidden");}}if(f){f.preventDefault();}});a(this.nextLink).click(function(f){if(c.currentPage<c.pages.length-1){c.prevLink.css("visibility","visible");c.currentPage=c.currentPage+1;c.showPage(c.currentPage);if(c.currentPage===c.pages.length-1){c.nextLink.css("visibility","hidden");}}if(f){f.preventDefault();}});if(_.isFunction(d)){d();}},showPage:function(c){_(this.pages).each(function(d,e){if(e===c){a(d).show();}else{a(d).hide();}});}};}(this.jQuery));(function(e,d,f,a){function c(g){this.duration=g;this.jobs=[];}c.prototype={id:null,duration:null,jobs:null,start:function(){if(!this.id){this._work();this.id=d(this._work.bind(this),this.duration);}},stop:function(){if(this.id){f(this.id);this.id=null;}},_work:function(){e.each(this.jobs,function(g,h){h();});}};a.PeriodicWorker=c;}(window.jQuery,window.setInterval,window.clearTimeout,window));Zendesk.NS("Utils");Zendesk.Utils.Poller=function(e,g,f,a,d,c){this.wait=g;this.maxWait=f;this.ajaxOptions={url:e.url,method:e.method||"get",data:e.data};this.successCallback=a;this.errorCallback=d;this.timeoutCallback=c;this.periodicWorker=new PeriodicWorker(g);this.waited=-g;};Zendesk.Utils.Poller.prototype={start:function(){this.periodicWorker.jobs=[this._poll.bind(this)];this.periodicWorker.start();},stop:function(){this.periodicWorker.stop();},_poll:function(){this.waited=this.waited+this.wait;if(this.waited>this.maxWait){this.stop();if(this.timeoutCallback){this.timeoutCallback();}return;}$j.ajax({type:this.ajaxOptions.method,url:this.ajaxOptions.url,data:this.ajaxOptions.data,success:function(a){if(!this.successCallback||!this.successCallback(a)){this.stop();}}.bind(this),error:function(a){if(!this.errorCallback||!this.errorCallback(a)){this.stop();}}.bind(this)});}};var LARGE_SELECT_LENGTH=70;jQuery.fn.extend({autocompleteFromSelectIfLarge:function(a){var c=LARGE_SELECT_LENGTH;jQuery(this).each(function(e,d){if(jQuery("option",d).length>c){jQuery(d).autocompleteFromSelect(a);}});}});jQuery.widget("ui.autocompleteFromSelect",{options:{tabIndex:null,placeholder:null,maxResults:15,combobox:true},_create:function(){var j=this,f=this.element.hide(),d=f.children(":selected"),h=d.val()?d.text():null,c=this.options.tabIndex||f.attr("tabindex"),g=this.options.placeholder||f.attr("placeholder"),k=f.attr("data-no-matches-message")||"Sorry, no results found.";f.wrap("<span />");var e=jQuery("<input type='text' />").addClass("ui-widget ui-widget-content").focus(function(){jQuery(this).select();}).mouseup(function(l){l.preventDefault();}).autocomplete({delay:0,minLength:0,source:function(p,m){var r=new RegExp(jQuery.ui.autocomplete.escapeRegex(p.term),"i");var o=f.children("option:enabled").map(function(){var u=jQuery(this).text(),s=jQuery(this).attr("data-email");if(s){u=u+" "+s;}if(this.value&&(!p.term||r.test(u))){return{label:u.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+jQuery.ui.autocomplete.escapeRegex(p.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:u,option:this};}});if(o.length===0){o=[{label:k,value:null,option:null,disabled:true}];}if(j.options.maxResults&&o.length>j.options.maxResults){var l=o.length-j.options.maxResults;var n=""+(l)+" other result";if(l>1){n+="s";}n+=". Try refining your search.";var q={label:n,value:null,option:null,disabled:true};o=o.slice(0,j.options.maxResults);o.push(q);}m(o);},select:function(l,m){if(m.item&&!m.item.disabled){m.item.option.selected=true;j._trigger("selected",l,{item:m.item.option});e.data("searching",false);}},change:function(m,n){if(!n.item){var o=new RegExp("^"+jQuery.ui.autocomplete.escapeRegex(jQuery(this).val())+"$","i"),l=false;f.children("option:enabled").each(function(){if(this.value.match(o)||jQuery(this).text().match(o)){this.selected=l=true;return false;}});if(!l){jQuery(this).val("");f.val("");return false;}}},close:function(l,m){e.data("searching",false);},search:function(l,m){e.data("searching",true);}});e.data("autocomplete")._renderItem=function(l,m){return jQuery("<li></li>").data("item.autocomplete",m).append("<a>"+m.label+"</a>").appendTo(l);};if(c){e.attr("tabindex",c);}if(g){e.attr("placeholder",g);}if(h){e.val(h);}e.insertBefore(f);if(j.options.combobox){var a=jQuery("<input type='button' class='ui-widget combobox-button' value='▼' />").click(function(){if(e.autocomplete("widget").is(":visible")){e.autocomplete("close");}else{e.autocomplete("search","");e.focus();}});e.addClass("combobox").after(a);}f.removeAttr("tabindex").change(function(){var l=jQuery(":selected",this);if(l.length&&!e.data("searching")){e.val(l.text()).change();}else{if(e.data("searching")){e.autocomplete("search",e.val());}}});}});(function(c,g,d,a){var f="script.search_results_data",j=function(k){};if(a&&a.warn){j=d.bind(a.warn,a);}function h(k){var l=k.find(f).last();if(!l.exists()){j("Paginator received search results with no script.search_results_data element");return{};}var m={};try{m=JSON.parse(l.html());}catch(n){}return m;}var e=function(k){if(k==null){throw"Cannot paginate results for empty containerSelector";}this.$container=g(k);d.bindAll(this,"onMoreClicked","onMoreRetrieved");this.resetPage().bindMoreButton();};e.parseNextPageFrom=function(k){return h(k).nextPage;};e.prototype={resetPage:function(){this.nextPage=2;return this;},onMoreClicked:function(){var k=this.moreButton().attr("href");this.spinner().show();g.ajax(k,{page:this.nextPage}).done(this.onMoreRetrieved);return false;},onMoreRetrieved:function(k){this.spinner().hide();this.removeCurrentMoreButton().appendNewResults(k).applySearchResultData(k).bindMoreButton();},spinner:function(){return this.$container.find(".progress");},removeCurrentMoreButton:function(){this.$container.find(".show_more_bar").remove();return this;},moreButton:function(){return this.$container.find(".show_more_bar a");},bindMoreButton:function(){this.moreButton().click(this.onMoreClicked);return this;},appendNewResults:function(k){this.$container.append(k);return this;},applySearchResultData:function(){this.nextPage=e.parseNextPageFrom(this.$container);this.$container.find(f).remove();if(this.nextPage==null){this.removeCurrentMoreButton();}return this;}};g.fn.paginateResults=function(l){var k=g(this);if(k.data("resultsPaginator")!=null){return;}k.data("resultsPaginator",new e(this,l));return k;};g(function(){g(".paginates_with_more").paginateResults();});c.ResultsPaginator=e;}(this.Zendesk,this.jQuery,this._,this.console));(function(c){function a(){var e=c(this).find("[value="+c(this).val()+"]");var d=e.data("select-interaction")||c(this).data("default-interaction");if(d instanceof Function){d=[d];}if(d instanceof Array){c(d).each($j.proxy(function(f,g){if(g instanceof Function){g.call(this);}},this));}}c.fn.extend({selectInteraction:function(d){if(c(this).prop("nodeName").toLowerCase()!=="select"||typeof d==="undefined"){return c(this);}if(d["default-interaction"]){c(this).data("default-interaction",d["default-interaction"]);}c(this).change(a);return c(this).find("option").each(function(e,f){f=c(f);var g=f.val();if(d[g]){f.data("select-interaction",d[g]);}}).change();}});}(window.jQuery));(function(d){var a={emptyTargetText:"Drop items here",emptyTargetClass:null,items:"> :not(.emptyTarget)"};function e(f,g){d("li.emptyTarget",this).hide();}function c(f,g){var h=d("li:not(.emptyTarget)",this);if(g&&g.item){h=h.not(g.item);}if(h.length===0){d("li.emptyTarget",this).show();}}d.fn.sortableWithEmptyTarget=function(g){g=d.extend({},a,g||{});var h=g.emptyTargetText,f=["emptyTarget",g.emptyTargetClass].join(" ");delete g.emptyTargetText;delete g.emptyTargetClass;d(this).each(function(){var j=d(this);d('<li class="'+f+'">'+h+"</li>").toggle(j.find("li").length===0).appendTo(j);j.sortable(g).bind("sortover",d.proxy(e,j)).sortable("option","connectWith").bind("sortover",d.proxy(c,j));});};}(this.jQuery));(function(c,a){Zendesk.StatEvent=function(e,f){var d="/stat_event/";d+=e+"/";c.ajax({url:d,type:"GET",data:f,success:function(){}});};}(this.jQuery,this));(function(a){a.Storage={isSupported:function(){try{return"localStorage" in window&&window.localStorage!==null;}catch(c){return false;}},handle:function(){return window.localStorage;}};}(Zendesk));(function(a){Zendesk.SwitchBoard=function(){this.subscribers={};if(Zendesk.Storage.isSupported()){this.localStorage=Zendesk.Storage.handle();}else{this.localStorage=Zendesk.SwitchBoard.fakeStorage;}this.pollingStorage={};};Zendesk.SwitchBoard.fakeStorage={setItem:function(){},getItem:function(){return null;}};Zendesk.SwitchBoard.channelName=function(c){return c+"."+Zendesk.currentUser.id;};Zendesk.SwitchBoard.prototype={init:function(){Zendesk.Pubsub.connect(function(){});},subscribe:function(e,f){var c=this._channelName(e);this.log("Subscribe",c);var d=this;return Zendesk.Pubsub.wait(function(){Zendesk.Pubsub.subscribe(c,function(g){d.log("Received",c,JSON.stringify(g));f(g.msg);});});},publish:function(f,e){var c=this._channelName(f);this.log("Published",c,JSON.stringify(e));var d=this;return Zendesk.Pubsub.wait(function(){Zendesk.Pubsub.Node.publish(c,d._message(e));});},_channelName:function(c){return"msg:"+c;},_message:function(c){return{__switchboard_ts:(new Date()).getTime(),msg:c};},log:function(){if(Zendesk.SwitchBoard.debug&&window.console&&window.console.log){var c=Array.prototype.slice.call(arguments);c.unshift("[Zendesk.SwitchBoard]");console.log(c);}}};if(!window.console){window.console={log:function(){},error:function(){}};}}(jQuery));Zendesk.NS.extend("Text",{autoLink:function(a){return a.replace(/\b(https?:\/\/[^\s"]+)\b/g,'<a href="$1" target="_blank">$1</a>');}});(function(d){function c(){var e;if(d(this).attr("data-toggles")){e=d(d(this).attr("data-toggles"));if(d(this).is(":checked")){e.slideDown();}else{e.slideUp();}}if(d(this).is(":checked")&&d(this).attr("data-toggles-show")){e=d(d(this).attr("data-toggles-show"));e.slideDown();}if(d(this).is(":checked")&&d(this).attr("data-toggles-hide")){e=d(d(this).attr("data-toggles-hide"));e.slideUp();}}function a(){d(d(this).attr("data-toggles")).toggle();}d.fn.extend({isToggler:function(){return d(this).filter("[data-toggles],[data-toggles-show],[data-toggles-hide]").each(function(e,g){g=d(g);var f=g.attr("type");if(f==="checkbox"||f==="radio"){g.change(c);}else{g.click(a);}});}});d(function(){d("#contentwrapper [data-toggles], #contentwrapper [data-toggles-show], #contentwrapper [data-toggles-hide]").isToggler().change();});}(window.jQuery));(function(e,c){function a(h){e("#contentcolumn").html('<iframe src="'+h+'" width="100%" height="500px"></iframe>');}function g(h){var j=e("<a />").html(h.text).attr("href",h.href);if(h.target){j.attr("target",h.target);}if(h.iframe){j.click(function(){a(h.href);return false;});}return j;}function f(j){j=j||{};if(!j.text){throw ("Property 'text' is required for creating a navigation element");}var h=e("<li />");if(j.href){h.html(g(j));}else{h.html(e("<span />").html(j.text));}return h;}function d(h){this.element=f(h);this.element.addClass("main clazz");this.element.find("a,span").addClass("tab");this.element.append('<ul class="menu-drop" />');}d.prototype={addElement:function(h){this.element.find("ul").append(f(h));return this;}};c.NS.extend("TopNav",{Section:d,addSection:function(h){var j=new d(h);j.element.appendTo("#top-menu ul.agent-tabs");return j;}});}(window.jQuery,window.Zendesk));(function(a){var c=function(e,d){return a.reduce(e,function(g,h){var f=a(g).last();if(f.length>=d){g.push([h]);}else{f.push(h);}return g;},[[]]);};a.mixin({split:c});}(window._));Zendesk.NS("Xmpp.Identity");Zendesk.Xmpp.identity=null;Zendesk.Xmpp.Identity=function(a){jQuery.extend(this,a);if(this.hasDefaultAnonymousId()){this.anonymousId=this.generateAnonymousId();this.name=this.anonymousId;this.roomJid=this.replaceDefaultAnonymousId(this.roomJid);this.userId=this.replaceDefaultAnonymousId(this.userId);}};Zendesk.Xmpp.Identity.randomPool=[new Date().getTime(),Math.random(),jQuery(window).height,jQuery(window).width];Zendesk.Xmpp.Identity.prototype={defaultAnonymousId:"anonymous_id",userId:null,password:null,name:null,email:null,chatAlertNode:null,jid:function(){return this.userId;},hasDefaultAnonymousId:function(){return this.userId.indexOf(this.defaultAnonymousId)!==-1;},generateAnonymousId:function(){Zendesk.Xmpp.Identity.randomPool.push(new Date().getTime());return"anonymous_"+MD5.hexdigest(Zendesk.Xmpp.Identity.randomPool.join("--"));},replaceDefaultAnonymousId:function(c){var d=new RegExp(this.defaultAnonymousId);var a=this;return c.replace(d,function(){return a.anonymousId;});}};Zendesk.NS("Xmpp.Client");Zendesk.Xmpp.identity=null;Zendesk.Xmpp.boshService="/http-bind/";Zendesk.Xmpp.Client._instance=null;Zendesk.Xmpp.Client=function(a){this.retryCount=0;this.identity=a;this._connectCallbacks=[];};Zendesk.Xmpp.Client.connect=function(c,a){if(Zendesk.Xmpp.Client._instance==null){Zendesk.Xmpp.Client._instance=new Zendesk.Xmpp.Client(Zendesk.Xmpp.identity);Zendesk.Xmpp.Client._instance.connect(c,a);}else{Zendesk.Xmpp.Client._instance._addConnectCallback(c);}};Zendesk.Xmpp.Client.prototype={identity:null,connection:null,status:null,boshService:Zendesk.Xmpp.boshService,_connectCallbacks:null,connect:function(d,a){var c=this;this.enabled=true;if(typeof(a)!="undefined"){this.boshService=a;}this.connection=new Strophe.Connection(this.boshService);if(d){this._addConnectCallback(d);}this.connection.connect(this.identity.jid(),this.identity.password,this.onConnect.bind(this));},disconnect:function(){this.connection.disconnect();},onConnect:function(a,c){this.status=a;if(this.status==Strophe.Status.CONNECTED){this.retryCount=0;this.connection.send($pres());for(var d=0;d<this._connectCallbacks.length;d++){this._connectCallbacks[d](this);}}else{if(this.status==Strophe.Status.AUTHFAIL){if(this.onConnectFailCallback){this.onConnectFailCallback();}}else{if(this.status==Strophe.Status.DISCONNECTED){setTimeout(this._onDisconnect.bind(this),500);}}}return true;},_addConnectCallback:function(a){this._connectCallbacks.push(a);if(this.status==Strophe.Status.CONNECTED){a(this);}},_onDisconnect:function(){if(this.enabled){var a=Math.pow(this.retryCount,3)*100;if(a>0){setTimeout(this.connect.bind(this),a);}else{this.connect();}++this.retryCount;}}};Zendesk.NS("API",function(){function a(c){return c.css("color","green");}this.Macro=function(d){this.macro_id=d;var c=this;this._ticketTransforms={comment:function(g,j){var h=g.comment.value;var e=$j("#comment_value",j);if(h&&e&&(e.val()!=h)){e.val(e.val()+h);a(e);}h=g.comment.is_public;var f=$j("#comment_is_public",j);if(h){if(h=="true"){$j("#comment_type",j).attr("class","say public");f.attr("checked",true);}else{$j("#comment_type",j).attr("class","say private");f.attr("checked",false);}}},current_tags:function(e,f){if(typeof(ticketTagField)=="undefined"){return;}ticketTagField.clear();c._addTags(e.current_tags);},remove_tags:function(e,f){c._addRemoveTagsInput(e.remove_tags,f);},_default:function(h,f,j){var e=h.split("#")[0];var g=null;if(e.match(/ticket_fields_/)){g=$j("#"+e,j);c._applyToCustomField(g,f[h]);}else{g=$j("#ticket_"+e,j);if(g){set_selected_for_select($("ticket_"+e),f[h]);a(g);}}}};this._applyToCustomField=function(e,f){if(e.is("input:checkbox")){e.prop("checked",f);return;}if(e.is("select")){if(f===true){f="1";}if(f===false){f="0";}}e.val(f).change();};this._addTags=function(e){_(e.split(" ")).each(function(f){if(f.length>0){ticketTagField.addEntry(f);}});};this._addRemoveTagsInput=function(e,g){$j("#ticket_remove_tags",g).val(e);var f=_(e.split(" ")).map(function(h){return"<span class='tag'>"+h+"</span>";});$j("#ticket_remove_tags_message",g).html("Removing tags: "+f.join("")).show();};this._fillTicketForm=function(f,l){var h=f.group_id,k=f.assignee_id;delete f.group_id;delete f.assignee_id;var g=_(f).keys();if(h||k){h&&$j("#ticket_group_id").val(h);assignee_select(h,k).done(function(){a($j("#ticket_group_id, #ticket_assignee_id"));});}for(var j=0,e=g.length;j<e;j++){if(this._ticketTransforms[g[j]]){this._ticketTransforms[g[j]](f,l);}else{this._ticketTransforms._default(g[j],f,l);}}$j("#macro_applied").val(this.macro_id);};};this.Macro.prototype={evaluate:function(e){var c=this;var f={};if(e.ticketForm){f=_($j(e.ticketForm).serializeArray()).select(function(g){return g.name!="_method";});}var d;if(e.ticketID!==null){d="/api/v1/macros/"+this.macro_id+"/apply.json?ticket_id="+e.ticketID;}else{d="/api/v1/macros/"+this.macro_id+"/apply.json";}$j.ajax({url:d,type:"post",data:$j.param(f),dataType:"json",success:function(g,j,h){if(e.successCallback){e.successCallback(g);}},error:function(g,h){if(e.errorCallback){e.errorCallback(h,g.responseText);}}});},applyToTicket:function(e,d,f){var c=this;this.evaluate({ticketID:e,ticketForm:d,successCallback:function(g){c._fillTicketForm(g,d);var h=$j("textarea#comment_value").val();$j("textarea#comment_value").val("").focus().val(h);$(document).fire("macro:applied");$j(document).trigger("applied.macro.zendesk",g);if(f){f(g);}}});}};$j(document).bind("applied.macro.zendesk",function(d,c){Zendesk.Instrumentation.ToTango.track("Applied","Macro");});});Zendesk.NS("API",this.jQuery,function(a){this.TicketForm=function(c){this.ticketForm=a(c);};this.TicketForm.prototype={createTicket:function(d,c,e){a.ajax({url:"/tickets.json",dataType:"text",type:"POST",data:this.mergeIntoDefaults(d),success:function(g,h,f){c(g,h,f);},error:function(f,h,g){e(f,h,g);}});},mergeIntoDefaults:function(c){var d=this.formDefaults();d.each(function(f){var e=f.name;c.each(function(g){if(typeof(g[e])!="undefined"){f.value=g[e];}});});return a.param(d);},formDefaults:function(){return this.ticketForm.serializeArray();}};});if(typeof(Element)!=="undefined"){Element.Methods.originalGetStyle=Element.Methods.getStyle;Element.addMethods({getStyle:function(a,c){try{return Element.Methods.originalGetStyle(a,c);}catch(d){return"static";}}});}if(Prototype&&Prototype.Browser&&Prototype.Browser.IE&&Effect){Effect.Fade=Effect.BlindUp=Effect.SlideUp=function(a){return $(a).hide();};Effect.Appear=Effect.BlindDown=Effect.SlideDown=function(a){return $(a).show();};}if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}deconcept.SWFObject=function(o,d,p,f,l,m,j,g,e,n){if(!document.getElementById){return;}this.DETECT_KEY=n?n:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(o){this.setAttribute("swf",o);}if(d){this.setAttribute("id",d);}if(p){this.setAttribute("width",p);}if(f){this.setAttribute("height",f);}if(l){this.setAttribute("version",new deconcept.PlayerVersion(l.toString().split(".")));}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}if(m){this.addParam("bgcolor",m);}var a=j?j:"high";this.addParam("quality",a);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var k=(g)?g:window.location;this.setAttribute("xiRedirectUrl",k);this.setAttribute("redirectUrl","");if(e){this.setAttribute("redirectUrl",e);}};deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"expressinstall.swf":a;this.setAttribute("useExpressInstall",true);},setAttribute:function(a,c){this.attributes[a]=c;},getAttribute:function(a){return this.attributes[a];},addParam:function(c,a){this.params[c]=a;},getParams:function(){return this.params;},addVariable:function(c,a){this.variables[c]=a;},getVariable:function(a){return this.variables[a];},getVariables:function(){return this.variables;},getVariablePairs:function(){var d=new Array();var c;var a=this.getVariables();for(c in a){d[d.length]=c+"="+a[c];}return d;},getSWFHTML:function(){var c="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}c='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';c+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var g=this.getParams();for(var f in g){c+=[f]+'="'+g[f]+'" ';}var e=this.getVariablePairs().join("&");if(e.length>0){c+='flashvars="'+e+'"';}c+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}c='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';c+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var d=this.getParams();for(var f in d){c+='<param name="'+f+'" value="'+d[f]+'" />';}var a=this.getVariablePairs().join("&");if(a.length>0){c+='<param name="flashvars" value="'+a+'" />';}c+="</object>";}return c;},write:function(c){if(this.getAttribute("useExpressInstall")){var a=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(a)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",encodeURIComponent(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var d=(typeof c=="string")?document.getElementById(c):c;d.innerHTML=this.getSWFHTML();if(!(navigator.plugins&&navigator.mimeTypes.length)){window[this.getAttribute("id")]=document.getElementById(this.getAttribute("id"));}return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var g=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var a=navigator.plugins["Shockwave Flash"];if(a&&a.description){g=new deconcept.PlayerVersion(a.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var c=1;var d=3;while(c){try{d++;c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+d);g=new deconcept.PlayerVersion([d,0,0]);}catch(f){c=null;}}}else{try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(f){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");g=new deconcept.PlayerVersion([6,0,21]);c.AllowScriptAccess="always";}catch(f){if(g.major==6){return g;}}try{c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(f){}}if(c!=null){g=new deconcept.PlayerVersion(c.GetVariable("$version").split(" ")[1].split(","));}}}return g;};deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major){return false;}if(this.major>a.major){return true;}if(this.minor<a.minor){return false;}if(this.minor>a.minor){return true;}if(this.rev<a.rev){return false;}return true;};deconcept.util={getRequestParameter:function(d){var e=document.location.search||document.location.hash;if(d==null){return e;}if(e){var c=e.substring(1).split("&");for(var a=0;a<c.length;a++){if(c[a].substring(0,c[a].indexOf("="))==d){return c[a].substring((c[a].indexOf("=")+1));}}}return"";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var c=document.getElementsByTagName("OBJECT");for(var d=c.length-1;d>=0;d--){c[d].style.display="none";for(var a in c[d]){if(typeof c[d][a]=="function"){c[d][a]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(a){return document.all[a];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;(function(){Autocompleter.MultiValue.addMethods({beforeFormSubmit:function(){this.addNewValueFromSearchField(this.searchField);}});function c(d){Event.stopObserving(d.searchField,"blur");$j(document.body).bind("click",function(g){var j=$j(d.searchField),f=$j(d.choicesHolder),h=f.is(":visible"),e=f.find(g.target).length===0&&j.add(f).filter(g.target).length===0;if(h&&e){d.hide();}});}var a=Autocompleter.MultiValue.prototype.initialize;Autocompleter.MultiValue.prototype.initialize=function(){a.apply(this,arguments);c(this);};Autocompleter.MultiValue.prototype.hide=function(){var d=this;d.stopIndicator();setTimeout(function(){$j(d.choicesHolder).hide();},5);};}());if(typeof Prototype=="undefined"){alert("CalendarDateSelect Error: Prototype could not be found. Please make sure that your application's layout includes prototype.js (.g. <%= javascript_include_tag :defaults %>) *before* it includes calendar_date_select.js (.g. <%= calendar_date_select_includes %>).");}if(Prototype.Version<"1.6"){alert("Prototype 1.6.0 is required. If using earlier version of prototype, please use calendar_date_select version 1.8.3");}Element.addMethods({purgeChildren:function(a){$A(a.childNodes).each(function(c){$(c).remove();});},build:function(c,e,a,d){var f=Element.buildAndAppend(e,a,d);c.appendChild(f);return f;}});Element.buildAndAppend=function(d,a,c){var f=$(document.createElement(d));$H(a).each(function(e){f[e.key]=e.value;});if(c){f.setStyle(c);}return f;};nil=null;Date.one_day=24*60*60*1000;Date.weekdays=$w("S M T W T F S");Date.first_day_of_week=0;Date.months=$w("January February March April May June July August September October November December");Date.padded2=function(a){var c=parseInt(a,10);if(a<10){c="0"+c;}return c;};Date.prototype.getPaddedMinutes=function(){return Date.padded2(this.getMinutes());};Date.prototype.getAMPMHour=function(){var a=this.getHours();return(a==0)?12:(a>12?a-12:a);};Date.prototype.getAMPM=function(){return(this.getHours()<12)?"AM":"PM";};Date.prototype.stripTime=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate());};Date.prototype.daysDistance=function(a){return Math.round((a-this)/Date.one_day);};Date.prototype.toFormattedString=function(c){var a,d;d=Date.months[this.getMonth()]+" "+this.getDate()+", "+this.getFullYear();if(c){a=this.getHours();d+=" "+this.getAMPMHour()+":"+this.getPaddedMinutes()+" "+this.getAMPM();}return d;};Date.parseFormattedString=function(a){return new Date(a);};Math.floor_to_interval=function(c,a){return Math.floor(c/a)*a;};window.f_height=function(){return([window.innerHeight?window.innerHeight:null,document.documentElement?document.documentElement.clientHeight:null,document.body?document.body.clientHeight:null].select(function(a){return a>0;}).first()||0);};window.f_scrollTop=function(){return([window.pageYOffset?window.pageYOffset:null,document.documentElement?document.documentElement.scrollTop:null,document.body?document.body.scrollTop:null].select(function(a){return a>0;}).first()||0);};_translations={OK:"OK",Now:"Now",Today:"Today",Clear:"Clear"};SelectBox=Class.create();SelectBox.prototype={initialize:function(e,c,d,a){this.element=$(e).build("select",d,a);this.populate(c);},populate:function(a){this.element.purgeChildren();var c=this;$A(a).each(function(d){if(typeof(d)!="object"){d=[d,d];}c.element.build("option",{value:d[1],innerHTML:d[0]});});},setValue:function(c){var d=this.element;var a=false;$R(0,d.options.length-1).each(function(e){if(d.options[e].value==c.toString()){d.selectedIndex=e;a=true;}});return a;},getValue:function(){return $F(this.element);}};CalendarDateSelect=Class.create();CalendarDateSelect.prototype={initialize:function(c,a){this.target_element=$(c);if(!this.target_element){alert("Target element "+c+" not found!");return false;}if(this.target_element.tagName!="INPUT"){this.target_element=this.target_element.down("INPUT");}this.target_element.calendar_date_select=this;this.last_click_at=0;this.options=$H({embedded:false,popup:nil,time:false,buttons:true,clear_button:true,year_range:10,close_on_click:nil,minute_interval:5,popup_by:this.target_element,month_year:"dropdowns",onchange:this.target_element.onchange,valid_date_check:nil}).merge(a||{});this.use_time=this.options.get("time");this.parseDate();this.callback("before_show");this.initCalendarDiv();if(!this.options.get("embedded")){this.positionCalendarDiv();Event.observe(document,"mousedown",this.closeIfClickedOut_handler=this.closeIfClickedOut.bindAsEventListener(this));Event.observe(document,"keypress",this.keyPress_handler=this.keyPress.bindAsEventListener(this));}this.callback("after_show");},positionCalendarDiv:function(){var o=false;var k=this.calendar_div.cumulativeOffset(),m=k[0],j=k[1],d=this.calendar_div.getDimensions(),p=d.height,c=d.width;var n=window.f_scrollTop(),e=window.f_height();var q=$(this.options.get("popup_by")).cumulativeOffset(),g=q[1],r=q[0],h=$(this.options.get("popup_by")).getDimensions().height,l=g+h;if(((l+p)>(n+e))&&(l-p>n)){o=true;}var a=r.toString()+"px",f=(o?(g-p):(g+h)).toString()+"px";this.calendar_div.style.left=a;this.calendar_div.style.top=f;this.calendar_div.setStyle({visibility:""});if(navigator.appName=="Microsoft Internet Explorer"){this.iframe=$(document.body).build("iframe",{src:"javascript:false",className:"ie6_blocker"},{left:a,top:f,height:p.toString()+"px",width:c.toString()+"px",border:"0px"});}},initCalendarDiv:function(){if(this.options.get("embedded")){var parent=this.target_element.parentNode;var style={};}else{var parent=document.body;var style={position:"absolute",visibility:"hidden",left:0,top:0};}this.calendar_div=$(parent).build("div",{className:"calendar_date_select"},style);var that=this;$w("top header body buttons footer bottom").each(function(name){eval("var "+name+"_div = that."+name+"_div = that.calendar_div.build('div', { className: 'cds_"+name+"' }, { clear: 'left'} ); ");});this.initHeaderDiv();this.initButtonsDiv();this.initCalendarGrid();this.updateFooter("&#160;");this.refresh();this.setUseTime(this.use_time);},initHeaderDiv:function(){var a=this.header_div;this.close_button=a.build("a",{innerHTML:"x",href:"#",onclick:function(){this.close();return false;}.bindAsEventListener(this),className:"close"});this.next_month_button=a.build("a",{innerHTML:"&gt;",href:"#",onclick:function(){this.navMonth(this.date.getMonth()+1);return false;}.bindAsEventListener(this),className:"next"});this.prev_month_button=a.build("a",{innerHTML:"&lt;",href:"#",onclick:function(){this.navMonth(this.date.getMonth()-1);return false;}.bindAsEventListener(this),className:"prev"});if(this.options.get("month_year")=="dropdowns"){this.month_select=new SelectBox(a,$R(0,11).map(function(c){return[Date.months[c],c];}),{className:"month",onchange:function(){this.navMonth(this.month_select.getValue());}.bindAsEventListener(this)});this.year_select=new SelectBox(a,[],{className:"year",onchange:function(){this.navYear(this.year_select.getValue());}.bindAsEventListener(this)});this.populateYearRange();}else{this.month_year_label=a.build("span");}},initCalendarGrid:function(){var a=this.body_div;this.calendar_day_grid=[];var h=a.build("table",{cellPadding:"0px",cellSpacing:"0px",width:"100%"});var c=h.build("thead").build("tr");Date.weekdays.each(function(j){c.build("th",{innerHTML:j});});var f=h.build("tbody");var d=0,e;for(var g=0;g<42;g++){e=(g+Date.first_day_of_week)%7;if(g%7==0){days_row=f.build("tr",{className:"row_"+d++});}(this.calendar_day_grid[g]=days_row.build("td",{calendar_date_select:this,onmouseover:function(){this.calendar_date_select.dayHover(this);},onmouseout:function(){this.calendar_date_select.dayHoverOut(this);},onclick:function(){this.calendar_date_select.updateSelectedDate(this,true);},className:(e==0)||(e==6)?" weekend":""},{cursor:"pointer"})).build("div");this.calendar_day_grid[g];}},initButtonsDiv:function(){var e=this.buttons_div;if(this.options.get("time")){var c=$A(this.options.get("time")=="mixed"?[[" - ",""]]:[]);e.build("span",{innerHTML:"@",className:"at_sign"});var a=new Date();this.hour_select=new SelectBox(e,c.concat($R(0,23).map(function(f){a.setHours(f);return $A([a.getAMPMHour()+" "+a.getAMPM(),f]);})),{calendar_date_select:this,onchange:function(){this.calendar_date_select.updateSelectedDate({hour:this.value});},className:"hour"});e.build("span",{innerHTML:":",className:"seperator"});var d=this;this.minute_select=new SelectBox(e,c.concat($R(0,59).select(function(f){return(f%d.options.get("minute_interval")==0);}).map(function(f){return $A([Date.padded2(f),f]);})),{calendar_date_select:this,onchange:function(){this.calendar_date_select.updateSelectedDate({minute:this.value});},className:"minute"});}else{if(!this.options.get("buttons")){e.remove();}}if(this.options.get("buttons")){e.build("span",{innerHTML:"&#160;"});if(this.options.get("time")=="mixed"||!this.options.get("time")){b=e.build("a",{innerHTML:_translations.Today,href:"#",onclick:function(){this.today(false);return false;}.bindAsEventListener(this)});}if(this.options.get("time")=="mixed"){e.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"});}if(this.options.get("time")){b=e.build("a",{innerHTML:_translations.Now,href:"#",onclick:function(){this.today(true);return false;}.bindAsEventListener(this)});}if(!this.options.get("embedded")&&!this.closeOnClick()){e.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"});e.build("a",{innerHTML:_translations.OK,href:"#",onclick:function(){this.close();return false;}.bindAsEventListener(this)});}if(this.options.get("clear_button")){e.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"});e.build("a",{innerHTML:_translations.Clear,href:"#",onclick:function(){this.clearDate();if(!this.options.get("embedded")){this.close();}return false;}.bindAsEventListener(this)});}}},refresh:function(){this.refreshMonthYear();this.refreshCalendarGrid();this.setSelectedClass();this.updateFooter();},refreshCalendarGrid:function(){this.beginning_date=new Date(this.date).stripTime();this.beginning_date.setDate(1);this.beginning_date.setHours(12);var c=this.beginning_date.getDay();if(c<3){c+=7;}this.beginning_date.setDate(1-c+Date.first_day_of_week);var e=new Date(this.beginning_date);var a=new Date().stripTime();var d=this.date.getMonth();vdc=this.options.get("valid_date_check");for(var f=0;f<42;f++){day=e.getDate();month=e.getMonth();cell=this.calendar_day_grid[f];Element.remove(cell.childNodes[0]);div=cell.build("div",{innerHTML:day});if(month!=d){div.className="other";}cell.day=day;cell.month=month;cell.year=e.getFullYear();if(vdc){if(vdc(e.stripTime())){cell.removeClassName("disabled");}else{cell.addClassName("disabled");}}e.setDate(day+1);}if(this.today_cell){this.today_cell.removeClassName("today");}if($R(0,41).include(days_until=this.beginning_date.stripTime().daysDistance(a))){this.today_cell=this.calendar_day_grid[days_until];this.today_cell.addClassName("today");}},refreshMonthYear:function(){var a=this.date.getMonth();var d=this.date.getFullYear();if(this.options.get("month_year")=="dropdowns"){this.month_select.setValue(a,false);var c=this.year_select.element;if(this.flexibleYearRange()&&(!(this.year_select.setValue(d,false))||c.selectedIndex<=1||c.selectedIndex>=c.options.length-2)){this.populateYearRange();}this.year_select.setValue(d);}else{this.month_year_label.update(Date.months[a]+" "+d.toString());}},populateYearRange:function(){this.year_select.populate(this.yearRange().toArray());},yearRange:function(){if(!this.flexibleYearRange()){return $R(this.options.get("year_range")[0],this.options.get("year_range")[1]);}var a=this.date.getFullYear();return $R(a-this.options.get("year_range"),a+this.options.get("year_range"));},flexibleYearRange:function(){return(typeof(this.options.get("year_range"))=="number");},validYear:function(a){if(this.flexibleYearRange()){return true;}else{return this.yearRange().include(a);}},dayHover:function(a){var c=new Date(this.selected_date);c.setFullYear(a.year,a.month,a.day);this.updateFooter(c.toFormattedString(this.use_time));},dayHoverOut:function(a){this.updateFooter();},clearSelectedClass:function(){if(this.selected_cell){this.selected_cell.removeClassName("selected");}},setSelectedClass:function(){if(!this.selection_made){return;}this.clearSelectedClass();if($R(0,42).include(days_until=this.beginning_date.stripTime().daysDistance(this.selected_date.stripTime()))){this.selected_cell=this.calendar_day_grid[days_until];this.selected_cell.addClassName("selected");}},reparse:function(){this.parseDate();this.refresh();},dateString:function(){return(this.selection_made)?this.selected_date.toFormattedString(this.use_time):"&#160;";},parseDate:function(){var c=$F(this.target_element).strip();var a=this.options.get("default_time");this.selection_made=(c!=""||a);this.date=c==""?NaN:Date.parseFormattedString(this.options.get("date")||c);if(isNaN(this.date)&&!a){this.date=new Date();}else{if(isNaN(this.date)&&a){this.date=(Object.prototype.toString.apply(a)==="[object Function]")?a():a;}}if(!this.validYear(this.date.getFullYear())){this.date.setYear((this.date.getFullYear()<this.yearRange().start)?this.yearRange().start:this.yearRange().end);}this.selected_date=new Date(this.date);this.use_time=/[0-9]:[0-9]{2}/.exec(c)?true:false;this.date.setDate(1);},updateFooter:function(a){if(!a){a=this.dateString();}this.footer_div.purgeChildren();this.footer_div.build("span",{innerHTML:a});},clearDate:function(){if((this.target_element.disabled||this.target_element.readOnly)&&this.options.get("popup")!="force"){return false;}var a=this.target_element.value;this.target_element.value="";this.clearSelectedClass();this.updateFooter("&#160;");if(a!=this.target_element.value){this.callback("onchange");}},updateSelectedDate:function(c,a){var f=$H(c);if((this.target_element.disabled||this.target_element.readOnly)&&this.options.get("popup")!="force"){return false;}if(f.get("day")){var e=this.selected_date,d=this.options.get("valid_date_check");e.setFullYear(f.get("year"),f.get("month"),f.get("day"));if(d&&!d(e.stripTime())){return false;}this.selected_date=e;this.selection_made=true;}if(!isNaN(f.get("hour"))){this.selected_date.setHours(f.get("hour"));}if(!isNaN(f.get("minute"))){this.selected_date.setMinutes(Math.floor_to_interval(f.get("minute"),this.options.get("minute_interval")));}if(f.get("hour")===""||f.get("minute")===""){this.setUseTime(false);}else{if(!isNaN(f.get("hour"))||!isNaN(f.get("minute"))){this.setUseTime(true);}}this.updateFooter();this.setSelectedClass();if(this.selection_made){this.updateValue();}if(this.closeOnClick()){this.close();}if(a&&!this.options.get("embedded")){if((new Date()-this.last_click_at)<333){this.close();}this.last_click_at=new Date();}},closeOnClick:function(){if(this.options.get("embedded")){return false;}if(this.options.get("close_on_click")===nil){return(this.options.get("time"))?false:true;}else{return(this.options.get("close_on_click"));}},navMonth:function(a){(target_date=new Date(this.date)).setMonth(a);return(this.navTo(target_date));},navYear:function(a){(target_date=new Date(this.date)).setYear(a);return(this.navTo(target_date));},navTo:function(a){if(!this.validYear(a.getFullYear())){return false;}this.date=a;this.date.setDate(1);this.refresh();this.callback("after_navigate",this.date);return true;},setUseTime:function(c){this.use_time=this.options.get("time")&&(this.options.get("time")=="mixed"?c:true);if(this.use_time&&this.selected_date){var d=Math.floor_to_interval(this.selected_date.getMinutes(),this.options.get("minute_interval"));var a=this.selected_date.getHours();this.hour_select.setValue(a);this.minute_select.setValue(d);}else{if(this.options.get("time")=="mixed"){this.hour_select.setValue("");this.minute_select.setValue("");}}},updateValue:function(){var a=this.target_element.value;this.target_element.value=this.dateString();if(a!=this.target_element.value){this.callback("onchange");}},today:function(a){var e=new Date();this.date=new Date();var c=$H({day:e.getDate(),month:e.getMonth(),year:e.getFullYear(),hour:e.getHours(),minute:e.getMinutes()});if(!a){c=c.merge({hour:"",minute:""});}this.updateSelectedDate(c,true);this.refresh();},close:function(){if(this.closed){return false;}this.callback("before_close");this.target_element.calendar_date_select=nil;Event.stopObserving(document,"mousedown",this.closeIfClickedOut_handler);Event.stopObserving(document,"keypress",this.keyPress_handler);this.calendar_div.remove();this.closed=true;if(this.iframe){this.iframe.remove();}if(this.target_element.type!="hidden"&&!this.target_element.disabled){this.target_element.focus();}this.callback("after_close");},closeIfClickedOut:function(a){if(!$(Event.element(a)).descendantOf(this.calendar_div)){this.close();}},keyPress:function(a){if(a.keyCode==Event.KEY_ESC){this.close();}},callback:function(a,c){if(this.options.get(a)){this.options.get(a).bind(this.target_element)(c);}}};var zd={jsInitializers:[],jsData:{}};$j(document).ready(function(){$j("a.colorbox").live("click",function(){var a=$j(this).attr("data-colorbox-force-photo")?true:false;$j.colorbox({href:$j(this).attr("href"),photo:a});return false;});$j("[data-learn-more-block]").click(function(){$j(this).hide();$j($j(this).attr("data-learn-more-block")).slideDown();return false;});});var standard_blind_options={duration:"0.25"};var items={};function render_per_type(){if($j("#ticket_ticket_type_id").length){if($j("#ticket_linked_id").length){set_visibility("#ticket_link",($j("#ticket_ticket_type_id").val()==="2"));}if($j("#ticket_date").length){set_visibility("#ticket_date",($j("#ticket_ticket_type_id").val()==="4"));}}}function hideNavigationLinks(){$j("#top-menu li").hide();$j("#top-right").hide();$j("#add_widget_button").hide();document.observe("widgets:load",function(){$j("#add_widget_button").hide();});}function assignee_select(d,c){var a=$j("#ticket_assignee_id");a.html($j("<option>"));if(!a.exists()||d===""||typeof d=="undefined"){return $j.when();}var d=Number(d),e,f;if(d>=0){e=_(window.groups).find(function(g){return $j.when(g.id===d);});f=_(e.users);_(window.agents).select(function(g){return $j.when(f.contains(g.id));}).each(function(g){a.append($j("<option />").val(""+g.id).html(""+g.name).prop("selected",g.id===Number(c)));});}else{a.get(0).selectedIndex=0;a.prop("enabled",false);}a.change().blur();return $j.when([]);}function update_properties(c){var a=$j("#ticket_group_id");if(a.exists()&&$j.trim(a.val())!==""&&$j.trim($j("#ticket_assignee_id").val())===""){assignee_select(a.val(),c);}render_per_type();return true;}function highlightAgents(){$j("#facebook-list li.choice").each(function(c,a){a=$j(a);var d=a.attr("choice_id");if(_(agents).any(function(e){return e.id===Number(d);})){a.addClass("agent");}});$j("#facebook-list ul.multi_value_field").first().bind("DOMNodeInserted",highlightAgents);}function set_visibility(a,c){if(c){$j(a).show();}else{$j(a).hide();}}function toggle_visibility(){alert("toggle_visibility is deprecated. Use jQuery(selector).toggle()");var a=[];for(var c=0;c<arguments.length;++c){a+="#"+arguments[c];}$j(a.join(", ")).toggle();}function toggle_comment(){$j("#comment_full, #comment_partial, #comment_up, #comment_down").toggle();return false;}function toggleFilter(a){$j("#options").hide();toggle_visibility(a);return false;}function submitUpload(){var a=$j.trim($j("#attachment_content").val());if(a!==""){$j("#uploadform").submit();$j("#uploadinput").hide();$j("#uploadbar").show();}}function notifyOnError(a){alert("Failed to upload file '"+a+"', verify the path");resetView();}var attachmentLists=[];function registerAttachmentList(a,c){if(c==null){attachmentLists[a]=$j(".attach_item").length;}else{attachmentLists[a]=c;}}function deleteFromAttachmentList(a,c){$j("#"+c).remove();attachmentLists[a]=attachmentLists[a]-1;if(attachmentLists[a]<=0){$j("#"+a).hide();delete attachmentLists[a];}}function showFlash(a,c){var c=(typeof c=="undefined")?"notice":c;var d=$j("<div>",{id:c,html:a});$j("#flash").html(d);new Effect.Highlight("flash",{duration:2});}function clearFlash(){$j("#flash").html("");}function pictureDeleted(a){$j("#cancel-block-"+a).hide();if(a==="header_logo"){$j("#sub_setting_website_url").hide();}selectPicture(a);}function selectPicture(a){$j("#image-block-"+a).hide();$j("#upload-block-"+a).show();$j("#ignore-upload-"+a).val(0);}function resetPicture(a){$j("#upload-block-"+a).hide();$j("#image-block-"+a).show();$j("#ignore-upload-"+a).val(1);}function checkTicketDelete(){if($j("#submit_type").val()==="delete"){alert("Warning - selecting this option will delete the ticket when you click submit. Deleted tickets cannot be recovered.");}}function check_ticket_sentiment(a){sentiment={negative:false};if(!$j(a).attr("sentiment_check")){return sentiment;}if(!$j("#comment_is_public").is(":checked")){return sentiment;}$j.ajax({async:false,url:"/sentiment/is_negative",dataType:"json",data:{text:$j(a).val()},timeout:800,success:function(c){sentiment=c;}});return sentiment;}function note_sentiment_misclassification(a,c){success=false;$j.ajax({url:"/sentiment/note_misclassification",dataType:"json",data:{text:$j(a).val(),is_negative:c},success:function(d){success=true;}});return success;}function check_ticket(a){ticket_sentiment=check_ticket_sentiment("#comment_value");if(ticket_sentiment.negative){if(!$j("#sentimentWarning")[0]){$j("#submit_form").before('<div id="sentimentWarning">This ticket might come across as too negative, particularly the phrase <i>'+ticket_sentiment.intense_sentence+"</i> - Do you want to continue?</div>");$j("#sentimentWarning").slideDown(200);$j("#submit-button").attr("value","Continue");$j("#comment_type textarea").focus(function(){$j("#submit-button").attr("value","Submit");$j("#sentimentWarning").remove();});return false;}else{note_sentiment_misclassification("#comment_value",ticket_sentiment.negative);}}if(IncidentsWarning.getInstance().isShowingWarning()){return false;}$("submit-button").value="Submitting...";$("submit-button").disabled=true;if(typeof(collaboratorList)!="undefined"){collaboratorList.update();}if($F("submit_type")!="merge"&&$("edit_requester").style.display=="none"){$("edit_requester").remove();}return true;}function copySubmitType(){$("ticket-chat").submit_type.value=$("submit_form").submit_type.value;}function submitTicketForm(){if(check_ticket()){copySubmitType();if($F("submit_type")=="merge"){new TicketMergeWizard();}else{if(typeof(ticketTagField)!="undefined"){ticketTagField.beforeFormSubmit();}Zendesk.Instrumentation.ToTango.track("Save","Ticket");$j(document).trigger("ticket.submit.zendesk");$("ticket-chat").submit();}}}function submitBulkUpdateForm(){if(fetch_tickets_to_bulk_update()){if($j("#submit_type").val()==="merge"){new TicketMergeWizard();}else{if($j("#ticket_ticket_type_id").val()!=="4"){$j("#ticket_date").remove();}$j("#ticket-chat").submit();}}}function copySolvedState(){if($("submit_form").solved_true){$("ticketform").ticket_force_status_change.value=$("submit_form").solved_true.checked;}}function submitRequestForm(){$("ticketform").submit();}function submitAttachForm(a){if($j("#uploads_attribute").length){$j("#token").val($j("#uploads_attribute").val());}$j("#submit-button").val(a);$j("#submit-button").prop("disabled",true);$j("#attach_form").submit();$j("#attach_link").hide();$j("#uploading_message").show();}function set_selected_for_select(a,c){jQuery(a).val(c).change();}function autotag_ticket(a){var c=$j(a).val();if($j.trim(c)!==""&&ticketTagField&&ticketTagField.selectedEntries().length===0){new Ajax.Request("/tags/autotag",{parameters:{text:c,target:"ticketTagField"}});}}function comment_tip(c,e,a){var d="<div class='title clearfix'>"+e+"</div><div class='content clearfix'>"+a+"</div>";$j("#"+c).addClass("has-tooltip").tooltip({tooltipClass:"zd_comment",items:".has-tooltip",position:{my:"left top",at:"center bottom",offset:"50px 10px"},content:function(){return d;}}).unbind("focusin");}function stv(e,f,d,c,a){$j('.field-tagger[data-field-id="'+d+'"]').ticketTagger("val",e);return false;}function reverseTruncate(a,c){return a.split("").reverse().join("").truncate(c).split("").reverse().join("");}function apply_macro(d,c){if(d!==""){if(typeof(ticket_id)==="undefined"){this_id="0";}else{this_id=ticket_id;}var f=jQuery("#ticket-chat");if(jQuery("#tickets_to_bulk_update",f).length>0){new Zendesk.API.Macro(d).applyToTicket(null,f);}else{new Zendesk.API.Macro(d).applyToTicket(this_id,f);}var g=(c)?c:window.event;Event.stop(g);var a=g.findElement();selection_feedback(a);return(false);}}var hide_macro_li=function(a){Zendesk.UI.NestedMenu.close_submenu($j(a));};var TopicForm={editNewTitle:function(a){$j("#new_topic").html((a.value.length>5)?a.value:"New Topic");}};var LoginForm={checkLogin:function(a){if(a.value.match(/^https?:\/\//)){$j("#password_fields").hide();}else{$j("#password_fields").show();}}};function showOrHideBulkForm(){fetch_tickets_to_bulk_update();if($j.trim($j("#tickets_to_bulk_update").val())===""){$j("#bulk-update").hide();}else{$j("#bulk-update").show();}}function fetch_tickets_to_bulk_update(){var a=_($j("input.tickets_to_bulk_update")).select(function(c){return c.checked;}).map(function(c){return $j(c).val();}).join(",");$j("#tickets_to_bulk_update").val(a);return true;}function select_all_tickets_for_bulk_update(c){var a=c.checked;if($j("#bulk-update").length){a?$j("#bulk-update").show():$j("#bulk-update").hide();$j("input.tickets_to_bulk_update").each(function(d){$j(this).prop("checked",a);});}}var rgb_css_to_hex=function(c){var a="#";c.match(/\d+/g).each(function(d){a+=Number(d).toColorPart();});return(a);};function hsv2hex(c){var a=YAHOO.util.Color.hsv2rgb(c[0],c[1],c[2]);return YAHOO.util.Color.rgb2hex(a[0],a[1],a[2]);}function calculateColors(){var a,c,d;if(fncIsValidColor(a=$j("#branding_header_color").val())&&fncIsValidColor($j("#branding_page_background_color").val())&&fncIsValidColor($j("#branding_sidebox_color").val())){rgb=YAHOO.util.Color.hex2rgb(a);if(!YAHOO.util.Color.isValidRGB(rgb)){return;}c=YAHOO.util.Color.rgb2hsv(rgb[0],rgb[1],rgb[2]);d=c[0]*1.03;if(d>1){d=1;}$j("#branding_tab_background_color").val(hsv2hex([d,c[1]*0.87,c[2]*0.83]));d=c[2]*1.02;if(d>1){d=1;}$j("#branding_tab_hover_color").val(hsv2hex([c[0],c[1]*0.62,d]));if($j("#branding_tab_hover_color").val()==="FFFFFF"){$j("#branding_tab_hover_color").val("E8E8E8");}$j("#branding_text_color").val((c[2]>0.85)?"2A2A2A":"FFFFFF");return true;}else{alert("You have not entered a valid hex color");return false;}}function fncIsValidColor(c){var a=/^#?[0-9a-f]{3,6}$/i;return a.test(c);}Ordering={SetOrder:function(a){$j(a).hide();$j(a+"_sort").sortable({axis:"y"}).show();},cancelOrdering:function(d){var e=$j(d+"_sort");$j(d).show();e.hide().sortable("destroy");var a=function(g,f){var h="data-zendesk-original-position";return($j(g).attr(h)<$j(f).attr(h))?-1:($j(g).attr(h)>$j(f).attr(h))?1:0;};var c=$j("ul li.item.sortable",e).sort(function(g,f){return a(g,f);});$j("ul li.item.sortable",e).remove();$j("ul",e).prepend(c);}};function textarea_resize(){var e=this;var d=e.value.split("\n");var c=1;for(x=0;x<d.length;x++){if(d[x].length>=e.cols){c+=Math.floor(d[x].length/e.cols);}}c+=d.length;if(c>e.rows){e.rows=c;}}function time_ago_in_words(a){return distance_of_time_in_words(new Date(),new Date(a));}function i18n_time_ago_in_words(a){return i18n_distance_of_time_in_words(new Date(),new Date(a));}function distance_of_time_in_words(j,h){var g=((j-h)/1000);var e=Math.floor(g/60);if(e<=0){return"less than a minute";}if(e===1){return"a minute";}if(e<45){return e+" minutes";}if(e<90){return"1 hour";}var d=Math.round(e/60);if(e<1439){return d+" hours";}if(e<2879){return"1 day";}var c=Math.round(e/1440);if(e<43199){return c+" days";}if(e<86399){return"1 month";}var a=Math.round(e/43200);if(e<525960){return a+" months";}if(e<1051920){return"1 year";}var f=Math.round(e/525960);return"over "+f+" years";}var ObjectFactory=Class.create({});ObjectFactory.instances=new Hash();ObjectFactory.create=function(c,a){instance=new c(a);ObjectFactory.instances.set(a.id,instance);return instance;};ObjectFactory.get=function(a){return ObjectFactory.instances.get(a);};ObjectFactory.remove=function(a){return ObjectFactory.instances.unset(a);};document.getUrlParameter=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var d=new RegExp("[\\?&]"+a+"=([^&#]*)");var c=d.exec(window.location.href);return c?unescape(c[1]):null;};function addCommas(c){c+="";var a=/(\d+)(\d{3})/;while(a.test(c)){c=c.replace(a,"$1,$2");}return c;}function showSortingForForumType(a){set_visibility("#div_ordering",(a==1));}$(document).observe("dom:loaded",function(){jQuery("ul.drop-list").each(function(a,c){new Zendesk.UI.NestedMenu(jQuery(c)).initialize();});if(!window.XMLHttpRequest){startList();}});function createRef(a,c){return function(){c.apply(a,arguments);};}function category_set(e,d,c,a){var f=e.down("ul");if(f){f.style.display=d;}}var selection_feedback=function(a){new Effect.Highlight(a,{queue:"end",beforeStart:function(){a.store("selection_feedback.style",a.readAttribute("style"));a.setStyle({color:a.getStyle("background-color")});},startcolor:rgb_css_to_hex(a.getStyle("color")),duration:0.2,afterFinish:function(){a.writeAttribute("style",a.retrieve("selection_feedback.style")||"");}});new Effect.Fade(a.up("ul.first-drop"),{queue:"end",duration:0.3,afterFinish:hide_macro_li(a)});};var what_is_category=function(){$$("a.category-description-link")[0].observe("click",function(){$$("div.category-description")[0].toggle();});};var category_top_right_edit=function(g){var d=$(g).down("div.category-top-right");var f=$(g).down("ul.edit_options");var c=function(){d.removeClassName("inactive");f.removeClassName("inactive");};var e=function(){f.addClassName("inactive");d.addClassName("inactive");};$(g).down("span.edit_this").observe("mouseover",c);$(g).down("div.category-top-right").observe("mouseleave",e);var a=function(h){new Effect.Highlight(h,{queue:"end",beforeStart:function(){h.store("selection_feedback.style",h.readAttribute("style"));h.setStyle({color:h.getStyle("background-color")});},startcolor:rgb_css_to_hex(h.getStyle("color")),duration:0.2,afterFinish:function(){h.writeAttribute("style",h.retrieve("selection_feedback.style")||"");e();}});};f.childElements("li").each(function(h){h.childElements("a").each(function(j){j.observe("click",function(k){a(h);});});});};var make_categorized_forums_draggable=function(c){var d=function(e){e.each(function(f,g){var h=f%2===0;$j(g).toggleClass("left",h).toggleClass("right",!h);});};var a=$j("#"+c);a.find("div.column").each(function(e,f){$j(f).data("position",e);});$j("#"+c).parent().find(".category-header > .category-top-right > ul.edit_options > li.reorder_forums > a").click(function(){a.addClass("reordering").find("> div.reorder > a").show().end().sortable({items:"div.column"}).bind("sortchange",function(e,f){d(a.find("div.column").not(f.item));}).bind("sortupdate",function(e,f){a.data("changed",true);d(a.find("div.column"));});return false;});a.find("> div.column a").click(function(){if(a.hasClass("reordering")){return false;}});a.find("> div.reorder > a").click(function(){a.removeClass("reordering").sortable("destroy");if(a.data("changed")){a.find("> div.column").each(function(f,e){e=$j(e);if(e.data("original_position")!==f){$j.ajax(e.data("forum_path"),{type:"POST",data:{_method:"put","forum[position]":f,authenticity_token:currentUser.authenticityToken}});e.data("original_position",f);}});a.data("changed",false);}return false;});};var add_category_reordering=function(){var d=$j("div.buttons-right > div.reorder > a").first();var c=$j("#sortedlist");var a=c.closest("div.frame.columns");c.children().each(function(e,f){$j(f).data("original_position",e);});d.click(function(f){var e=d.data("reorder_text");if(typeof(e)==="string"){d.html(e).data("reorder_text",undefined);a.removeClass("reordering");c.sortable("destroy");if(c.data("changed")){c.children().each(function(g,j){j=$j(j);var l=j.data("item_id"),h=$j("#category_header_"+l),k=$j("#category_"+l);a.append(h).append(k);if(g!==j.data("original_position")){$j.ajax(k.data("category_path"),{type:"POST",data:{_method:"put","category[position]":g}});j.data("original_position",g);}});c.data("changed",false);}}else{d.data("reorder_text",d.html()).html(d.data("done_text"));a.addClass("reordering");c.sortable({items:".sortable"}).bind("sortupdate",function(){c.data("changed",true);});}});};var submit_sortable_list=function(g,f,c,a){var d=$j("#"+g+"_reorder_done_link");var e=d.prop("href");c=$j("#"+c);c.find("> li.sortable.item").each(function(h,j){$j(j).data("real_element",$j("#"+g+" div.item")[h]);});$j("#"+g+"_reorder_done_link").click(function(h){h.preventDefault();var j=c.find("> li.sortable").get().reverse();_(j).each(function(l,k){l=$j(l);var m=$j(l.data("real_element"));m.prependTo(m.parent()).toggleClass("nobottom",k===0);l.data("zendesk-original-position",(j.length-k-1));});$j("#"+f).hide();$j("#"+g).show();$j.ajax(a,{type:"POST",data:c.sortable("serialize",{key:c.prop("id")+"[]"})}).success(function(){window.location.replace(e);});});};function startList(){iterate_startList($("green"));if(document.getElementById("gray")){iterate_startList($("gray"));}}function iterate_startList(d){var c;if(!d){return;}for(var a=0;a<d.childNodes.length;a++){c=d.childNodes[a];if(c.nodeName=="LI"){c.onmouseover=function(){this.className+=" over";if(this.childNodes[2]&&this.childNodes[2].nodeName=="UL"){ie6_show_iframe_mask(this.childNodes[2]);}};c.onmouseout=function(){this.className=this.className.replace(" over","");ie6_hide_iframe_mask(this.childNodes[2]);};}}}function ie6_show_iframe_mask(a){if(a){a.style.display="block";}var c=document.createElement("iframe");if(document.location.protocol=="https:"){c.src="//0";}else{if(window.opera!="undefined"){c.src="";}else{c.src="javascript:false";}}c.id="mIframe";c.scrolling="no";c.frameBorder="0";c.style.top=-1;c.style.left=-1;c.style.width=a.offsetWidth+"px";c.style.height=a.offsetHeight+"px";c.style.zIndex=-1;c.style.filter="alpha(opacity=0)";a.insertBefore(c,a.childNodes[0]);c.style.position="absolute";}function ie6_hide_iframe_mask(c){if(c){c.style.display="none";}var a=document.getElementById("mIframe");if(a){a.style.display="none";}}var ticket_id;if(!Zendesk){var Zendesk={};}Zendesk.resources=[];Zendesk.Resource=Class.create();Zendesk.Resource.prototype={initialize:function(a){this.options=a||{};this.options.user=a.user||Cookie.get(this.options.anchor+"_user");this.options.pass=a.pass||Cookie.get(this.options.anchor+"_pass");this.content_anchor=$$("#"+this.options.anchor+" #content")[0];this.title_anchor=$$("#"+this.options.anchor+" #title")[0];Ajax.Responders.register({onException:function(c,d){alert("Exception:\n\n"+d);}});if(this.options.title){this.title_anchor.innerHTML=this.options.title;}this.render();},submit_credentials:function(a){this.options.user=a.username.value;this.options.pass=a.password.value;if(this.options.user.blank()&&this.options.pass.blank()){alert("Please provide both a username and a password");}else{Cookie.set(this.options.anchor+"_user",this.options.user);Cookie.set(this.options.anchor+"_pass",this.options.pass);this.render();}},logout:function(){var a=this.options;Cookie.erase(a.anchor+"_user");Cookie.erase(a.anchor+"_pass");this.options.user=this.options.pass=null;this.render();},submit_data:function(c){var d=this;var a=Form.serialize(c);a+="&domain="+d.options.domain+"&use_ssl="+d.options.use_ssl;if(ticket_id){a+="&ticket_id="+ticket_id;}if(a.indexOf("media_type=")===0){var e=d.options.media_type||"application/xml";a+="&media_type="+e;}new Ajax.Request("/proxy.js",{asynchronous:true,evalScripts:true,parameters:a,requestHeaders:{Authorization:"Basic "+Base64.encode(d.options.user+":"+d.options.pass)},onSuccess:function(f){d.resource_write_success(f,d);enable_submit(c);},onFailure:function(f){d.resource_failure(f,d);enable_submit(c);}});disable_submit(c);},render:function(){var c=this;var a=c.options;if(a.login_content!=null&&!(a.user&&a.pass)){c.content_anchor.innerHTML=a.login_content();}else{c.content_anchor.innerHTML=a.application_content();a.application_resources.each(function(d){c.request(d);});}},request:function(a){var c=this;if(a.resource==null){if(a.on_success!=null){a.on_success();}}else{var d=a.media_type||"application/json";new Ajax.Request("/proxy.js",{method:"get",parameters:{domain:c.options.domain,use_ssl:c.options.use_ssl,resource:a.resource,media_type:d,cache_gets:c.options.cache_gets},requestHeaders:{Authorization:"Basic "+Base64.encode(c.options.user+":"+c.options.pass)},onSuccess:function(e){c.resource_read_success(e,c,a);},onFailure:function(e){c.resource_failure(e,c);}});}},resource_failure:function(c,a){if(c.status==401){a.options.user=null;a.options.pass=null;Cookie.erase(a.options.anchor+"_user");Cookie.erase(a.options.anchor+"_pass");if(a.content_anchor.innerHTML!=a.options.login_content()){alert("Username and password are not correct. Please re-enter.");}a.render();}else{alert(c.responseJSON.error);}},resource_read_success:function(d,c,a){if(a!=null&&a.on_success!=null){a.on_success(d.responseJSON);}},resource_write_success:function(f,e){var d=f.request&&f.request.parameters;var a;if(d&&d.event_reference&&d.event_log&&!d.ticket_id.blank()){var c=e.getLoggableAttributes(e,f.responseJSON.response,d.event_log);c.location=f.getHeader("location")||"";a=e.buildAudit(d,c);}if(a!=null){new Ajax.Request("/events/create.js",{contentType:"application/json",postBody:$H(a).toJSON(),method:"post",asynchronous:true,onSuccess:function(g){},onFailure:function(g){alert("Failed to register event: "+g.responseJSON.error);}});}},buildAudit:function(c,a){return{ticket_id:c.ticket_id,reference:c.event_reference,via_id:14,resource_attributes:a};},getLoggableAttributes:function(f,g,c){var e=c.split(",");var a={};var d;_(e).each(function(h){h=h.strip();if(d=f._deepSearch(g,h)){a[h]=d;}});return a;},_deepSearch:function(a,e){var d;if(d=a[e]||a[e.toLowerCase()]){return d;}else{var c;for(key in a){if(a.hasOwnProperty(key)){c=a[key];if(typeof(c)==="object"){if(d=this._deepSearch(c,e)){return d;}}}}}}};function enable_submit(a){a.submit.value=a.submit.getAttribute("originalValue");a.enable();a.reset();}function disable_submit(a){a.submit.setAttribute("originalValue",a.submit.value);a.disable();a.submit.value="Submitting...";}var InputTracking={trackedElements:[],enabled:true,trackElement:function(a){if(!InputTracking.trackedElements.include(this)){if(typeof(this.value)==="undefined"){this.originalValue=this.innerHTML;}else{this.originalValue=this.value;}InputTracking.trackedElements.push(this);Event.stopObserving(this,"keydown",InputTracking.trackElement);}},disable:function(a){InputTracking.enabled=false;return true;},fixSubmit:function(d,a){var c=d[a];if(Object.isString(c)){d[a]="InputTracking.disable() && "+c;}else{if(Object.isFunction(c)){d.onsubmitWithoutInputTracking=c;d[a]=function(f){return InputTracking.disable()&&d.onsubmitWithoutInputTracking();};}else{d[a]=InputTracking.disable;}}}};var CountrySelectField=Class.create({initialize:function(a){this.element=a;this.container=new Element("div",{className:"country_select_field"});this.closedView=new Element("div",{className:"closed"});this.container.insert(this.closedView);this.openedView=new Element("div",{className:"opened",style:"display: none;"}).update("<ul/>");this.container.insert(this.openedView);this.renderOpenedView();this.updateOpenedView();this.updateClosedView();this.element.hide();this.element.insert({after:this.container});this.closedView.observe("click",this.toggle.bind(this));},renderOpenedView:function(){var c=this.openedView.down("ul");c.update();var a;this.element.select("option").each(function(d){a=new Element("li",{country:d.value});this.renderOption(a,d);c.insert(a);a.observe("click",this.clickOption.bindAsEventListener(this));},this);},updateOpenedView:function(){this.openedView.select("li.selected").each(function(c){c.removeClassName("selected");});var a=this.element.down("option[value="+this.element.getValue()+"]");this.openedView.down("li[country="+a.value+"]").addClassName("selected");},updateClosedView:function(){var a=this.element.down("option[value="+this.element.getValue()+"]");this.renderOption(this.closedView,a);},renderOption:function(a,c){a.update();a.insert(new Element("img",{src:"/images/flags/"+c.value+".gif"}));a.insert(" "+c.innerHTML);},open:function(){this.openedView.show();this.element.focus();},close:function(){this.openedView.hide();},toggle:function(){this.openedView.toggle();this.element.focus();},clickOption:function(a){this.element.down("option[value="+a.findElement("li").getAttribute("country").toLowerCase()+"]").selected=true;this.updateOpenedView();this.updateClosedView();this.close();}});var CheckboxMultiSelect=Class.create({initialize:function(a){this.element=a;this.container=new Element("div",{className:"checkbox_multi_select"});this.render();Element.replace(this.element,this.container);},render:function(){var c;var a;this.element.select("option").each(function(f){a=new Element("input",{type:"checkbox",value:f.value,name:this.element.name,id:this.element.identify()+"_"+f.value});a.checked=f.selected;c=new Element("div");c.insert(a);c.insert(new Element("label",{"for":a.id}).update(f.innerHTML));if(a.id!="account_allowed_translation_locale_ids_1"){var e=a.id.split("_");var d="/i18n/translations/"+e[5];c.insert(new Element("a",{className:"colorbox",href:d}).update("(more info)"));}this.container.insert(c);},this);}});var DelayedRuleCounts=Class.create(Hash,{initialize:function($super,a){$super();this.ticket_show_empty_views=a.ticket_show_empty_views||false;this.delay=5;this.pubsub=a.pubsub||false;},requestUpdate:function(a){var c={};_.each($$("span.r_count[data-fresh=false]"),function(d){c["rule_ids["+d.readAttribute("data-rule-id")+"]"]=d.readAttribute("data-cache-key");});new Ajax.Request("/rules/count",{parameters:{"rule_ids[]":a},onSuccess:this.updateUiFromResponse.bind(this)});},updateUiFromJson:function(c){var a=this.get(c.ruleId)||{};a.value=c.value;a.fresh=a.fresh||c.fresh;this.set(c.ruleId,a);this.updateUiForRule(c.ruleId);},updateUiFromResponse:function(a){a.responseJSON.each(this.updateUiFromJson,this);var c=this.values().all(function(d){return d.fresh;});if(!c){if(!this.pubsub){this.update(this.delay);this.delay=this.delay*1.5;}else{this.subscribe.bind(this).delay(5);}}},updateNow:function(){this.update();},subscribe:function(){var c=$$("span.r_count").map(function(d){return d.readAttribute("data-cache-key");});if(c.length>0){Zendesk.Xmpp.identity=new Zendesk.Xmpp.Identity(this.pubsub);var a=this;Zendesk.Pubsub.Xmpp.JSONWrapper.connect(function(){_.each(c,function(d){Zendesk.Pubsub.Xmpp.JSONWrapper.subscribe(d,a.updateUiFromJson.bind(a),{includeDelayed:true});});});}},update:function(a){var c=$$("span.r_count[data-fresh=false]").map(function(d){return d.readAttribute("data-rule-id");});c=c.uniq();if(c.length>0){if(a){this.requestUpdate.bind(this).delay(a,c);}else{this.requestUpdate(c);}}},updateUiForRule:function(c){var e=this.get(c);var d=$$("span.r_count[data-rule-id="+c+"]");for(var a=0;a<d.length;a++){var f=d[a];f.update("("+e.value+")");f.writeAttribute("data-fresh",e.fresh?"true":"false");if(e.fresh){if(e.value==0){f.up("a").addClassName("empty");if(!this.ticket_show_empty_views){f.up("li").slideUp();}}else{f.up("a").removeClassName("empty");}}}},updateUi:function(){this.keys().each(this.updateUiForRule,this);}});Event.observe(document,"dom:loaded",function(){$$("textarea").each(function(a){Event.observe(a,"keydown",InputTracking.trackElement);});$$("form").each(function(a){InputTracking.fixSubmit(a,"onsubmit");});$$("form input[type=button]").each(function(a){InputTracking.fixSubmit(a,"onclick");});$$("select.country_select_field").each(function(a){new CountrySelectField(a);});$$("select.checkbox_multi_select").each(function(a){new CheckboxMultiSelect(a);});});$j(function(){$j("input[placeholder], textarea[placeholder]").placeholder();});window.onbeforeunload=function(){if(InputTracking.enabled){for(var c=0;c<InputTracking.trackedElements.length;c++){var a;if(typeof(InputTracking.trackedElements[c].value)==="undefined"){a=InputTracking.trackedElements[c].innerHTML;}else{a=InputTracking.trackedElements[c].value;}if(a!==InputTracking.trackedElements[c].originalValue){return"You have entered some text on this page. If you choose to proceed you will lose your changes.";}}}};document.observe("dom:loaded",function(){if(window.fluid){document.body.insert("<div id='notifications' style='display:none'></div>");new Ajax.PeriodicalUpdater("notifications","/notifications/status",{asynchronous:false,method:"get",frequency:120,decay:10,requestHeaders:{Accept:"application/json"},onSuccess:function(c){var a=c.responseText.evalJSON();if(a.count!=null&&a.count>0){window.fluid.dockBadge=a.count;}if(a.message!=null){window.fluid.showGrowlNotification({title:"Zendesk update",description:a.message.toString(),priority:1,sticky:false,identifier:"Zendesk "+Math.random()*10000});}}});}});Autocompleter.lookupUser=function(e,a,f){var c=e?"/people/users/multivalue_autocomplete":"/people/users/autocomplete";var d={name:a,rand:(new Date()).getTime()};new Ajax.Request(c,{parameters:d,onSuccess:function(g){f(g.responseJSON);}});};Autocompleter.UserCache=new Autocompleter.Cache(Autocompleter.lookupUser.curry(false));Autocompleter.cachedLookupUser=Autocompleter.UserCache.lookup.bind(Autocompleter.UserCache);Autocompleter.MultiUserCache=new Autocompleter.Cache(Autocompleter.lookupUser.curry(true));Autocompleter.cachedLookupMultiUser=Autocompleter.MultiUserCache.lookup.bind(Autocompleter.MultiUserCache);Autocompleter.lookupTag=function(a,c){new Ajax.Request("/tags/autocomplete",{parameters:{name:a,rand:(new Date()).getTime()},onSuccess:function(d){c(d.responseJSON);}});};Autocompleter.TagCache=new Autocompleter.Cache(Autocompleter.lookupTag);Autocompleter.cachedLookupTag=Autocompleter.TagCache.lookup.bind(Autocompleter.TagCache);Autocompleter.lookupAccount=function(a,c){new Ajax.Request("/monitor/children/lookup",{parameters:{query:a,rand:(new Date()).getTime()},onSuccess:function(d){c(d.responseJSON);}});};Autocompleter.AccountCache=new Autocompleter.Cache(Autocompleter.lookupAccount,{choices:50});Autocompleter.cachedLookupAccount=Autocompleter.AccountCache.lookup.bind(Autocompleter.AccountCache);Autocompleter.lookupOrganization=function(a,c){new Ajax.Request("/organizations/autocomplete",{parameters:{name:a,rand:(new Date()).getTime()},onSuccess:function(d){c(d.responseJSON);}});};Autocompleter.OrganizationCache=new Autocompleter.Cache(Autocompleter.lookupOrganization);Autocompleter.cachedLookupOrganization=Autocompleter.OrganizationCache.lookup.bind(Autocompleter.OrganizationCache);var ZdCreditCard={submitCreditCardForm:function(){$("credit-card-error").hide();if(ZdCreditCard.validate()){ZdCreditCard.serializeExpiry();$j("#transparent-redirect").submit();$("submit-credit-card").disabled=true;$("submit-credit-card").value="Please wait...";}else{$("credit-card-error").show();}return false;},validate:function(){var d=$F("country");var c=$F("state");var a=$F("zip");if(a.blank()||d.blank()||a.blank()){return false;}if(d=="prompt"){return false;}if(d=="US"){if(c=="prompt"){return false;}}return true;},resetCreditCardForm:function(){var d=$("submit-credit-card");var a=$$("input#submit-credit-card.trial")[0];var c=$("terms_agree");d.disabled=false;if(a){a.value="Begin my subscription";d.disabled=true;c.observe("click",function(e){if(c.checked===true){d.disabled=false;}else{if(c.checked===false){d.disabled=true;}}});}else{d.value="Submit Credit Card";}},showCvvHelper:function(){$j.colorbox({href:"/account/subscription/cvv"});},serializeExpiry:function(){var c=$F("expiry_month");var a=$F("expiry_year");$("ccexp").value=c+""+a;},preloadImages:function(){image=new Image();image.src="/images/find-the-cvv.png";},toggleStateSelect:function(){if($("country").value=="US"){$("state-select-row").show();$("state").disabled=false;}else{$("state-select-row").hide();$("state").disabled=true;}}};var ZendeskSearchCursor=Class.create({initialize:function(a){this.pages=new Object();this.pages.length=a.pageCount+1;this.currentPageIndex=a.pageIndex;}});var ZendeskSearcher=Class.create({initialize:function(a){self.latestQuery=null;this.options=a;if(typeof(this.options.per_page)=="undefined"){this.options.per_page=3;}},executeSearch:function(c,a){this.latestQuery=c;new Ajax.Request("/suggestions/search.json",{requestHeaders:{Accept:"application/json"},method:"get",parameters:{query:c,per_page:this.options.per_page,page:a},onSuccess:function(e){var d=e.responseText.evalJSON();this.results=d.results;this.results.each(function(f){f.titleNoFormatting=f.title;f.content=f.body;f.url="/entries/"+f.id;});this.cursor=new ZendeskSearchCursor({pageCount:d.pages,pageIndex:d.page});this.callbackMethod();}.bind(this),onFailure:function(){$("topic_suggestions").update(new Element("h2").update(this.options.noResults));$("topic_suggestions").removeClassName("loading");}.bind(this)});},execute:function(a){return this.executeSearch(a,1);},gotoPage:function(a){if(this.latestQuery){return this.executeSearch(this.latestQuery,a);}else{return false;}},setSearchCompleteCallback:function(a,d,c){this.callbackScope=a;this.callbackMethod=d.bind(a);}});
var HomePageSearch=Class.create({initialize:function(a){this.options=a;var c=new Element("a").update(this.options.more);this.more=new Element("li",{id:"more_suggestions"}).update(c);this.showMore=a.showMore;},searchComplete:function(){$("suggestion_submit").enable();$("topic_suggestions").removeClassName("loading");Try.these(this.more.remove);if(!this.searcher.cursor||this.searcher.cursor.currentPageIndex==0){$("topic_suggestions").update("");}if(this.searcher.results&&this.searcher.results.length>0){var a=$("suggestions");if(!a){a=new Element("ul",{id:"suggestions"});$("topic_suggestions").insert(a);}this.searcher.results.each(function(c){var f=c.titleNoFormatting.gsub(/.* :: /,"");var e=new Element("a",{href:c.url}).update(f);var d=new Element("li",{className:"suggestion"});d.insert(new Element("h3").update(e));d.insert(new Element("div").update(c.content.stripTags().truncate(160)));this.insert(d);},a);if(this.searcher.cursor&&this.searcher.cursor.currentPageIndex<this.searcher.cursor.pages.length-1){a.insert(this.more);}}else{if(this.options.emptyResultRedirect){window.location=this.options.emptyResultRedirect+escape($F("suggestions_query"));return false;}else{$("topic_suggestions").insert(new Element("h2").update(this.options.noResults));}}},onSubmit:function(){$("suggestion_submit").disable();$("topic_suggestions").update();$("topic_suggestions").addClassName("loading");this.searcher.execute($F("suggestions_query"));return false;},onShowMore:function(){this.more.remove();$("topic_suggestions").addClassName("loading");this.searcher.gotoPage(this.searcher.cursor.currentPageIndex+1);return false;},setup:function(){this.searcher=new ZendeskSearcher(this.options);this.searcher.setSearchCompleteCallback(this,this.searchComplete,null);$("suggest_form").onsubmit=this.onSubmit.bind(this);if(this.options.moreLink){this.more.observe("click",function(){window.location=this.options.moreLink+escape($F("suggestions_query"));}.bind(this));}else{this.more.observe("click",this.onShowMore.bind(this));}}});Zendesk.NS("Tickets.Table",this.jQuery,function(e){var c=this;var d={};function g(h){return h.attr("data-zd-account-id")+","+h.attr("data-zd-ticket-nice-id");}function a(h){h.find("td.description").hover(function(){e(this).closest("tr[title]").each(function(j,k){e(k).attr("data-title",e(k).attr("title")).removeAttr("title");});},function(){e(this).closest("tr[data-title]").each(function(j,k){e(k).attr("title",e(k).attr("data-title")).removeAttr("data-title");});});}function f(h){h.find("tbody tr[data-zd-ticket-nice-id][data-zd-account-id]").each(function(){var l=e(this);var j=g(l);var k=d[j];if(k){l.find("td:first-child").addClass("beingViewed");l.attr("title",k);}});}this.getAndApplyViewingStatuses=function(h){e.ajax({url:"/api/v1/tickets/viewing_statuses.json",type:"GET",data:{ticket_ids:h},success:function(l,m,j){d={};l.each(function(n){var o=""+currentAccount.id+","+n.ticket_nice_id;if(n.others_viewing.length==1){d[o]=n.others_viewing[0]+" is viewing this ticket.";}else{if(n.others_viewing.length>1){d[o]=""+n.others_viewing.length+" agents are viewing this ticket.";}}});var k=e("table.tickets");f(k);a(k);}});};this.linkifyRows=function(h){h.find("tbody tr").each(function(){var j=e(this).attr("data-href");if(!j||!j.length){return;}e(this).click(function(k){if(!k){return;}if(e(k.target).attr("href")===j){return;}if(k.ctrlKey||k.metaKey){window.open(j,"_blank").blur();window.focus();}else{window.location.href=j;}});});};this.applyViewStatusToTooltip=function(h){h=e(h);var n=h.attr("aria-describedby");if(!n){return;}var k=e("#"+n);if(k.length===0){return;}if(k.find(".otherViewers").length>0){return;}var m=h.closest("tr[data-zd-account-id][data-zd-ticket-nice-id]");if(m.length===0){return;}var j=g(m);var l=d[j];if(!l){return;}k.find(".title").prepend('<span class="otherViewers">'+l+"</span>");};});Prototype.Browser.Mac=navigator.userAgent.toLowerCase().indexOf("mac")!=-1;
var Widget=Class.create({initialize:function(a){this.id=a.id;this.locationId=a.locationId;this.isEmpty=a.isEmpty;this.sendInvitationMail=a.sendInvitationMail;if(Prototype.Browser.Mac){if(this._closeButton()){this._closeButton().addClassName("mac_widget_close_button");}}if(this.isEmpty){this.containingElement().hide();}},containingElement:function(){return $("widget_"+this.id);},show:function(){this.containingElement().blindDown({duration:0.2});},hide:function(a){this.containingElement().blindUp({duration:0.2,afterFinish:a});},destroy:function(){this.containingElement().remove();},_closeButton:function(){return this.containingElement().down(".widget_close_button");},_editButton:function(){return this.containingElement().down(".widget_edit_button");},showControls:function(){if(this.isEmpty){this.containingElement().show();}this._closeButton().appear({duration:0.3});if(this._editButton()){this._editButton().appear({duration:0.3});}this.containingElement().addClassName("widget_edit_mode");},hideControls:function(){this._closeButton().fade({duration:0.2});if(this._editButton()){this._editButton().fade({duration:0.3});}this.containingElement().removeClassName("widget_edit_mode");if(this.isEmpty){this.containingElement().hide();}}});Object.extend(Widget,{asyncInsertion:function(c){var a=$("widget_fixed");c&&c.each&&c.each(function(d){if(d.location<0&&a){a.insert({before:d.inner_html});}else{$("sidebar").insert({bottom:d.inner_html});}});Widget.redraw();Widget.fireLoadEvents.delay(0.1);},redraw:function(){var a=$("add_widget_select_widget");if(Widget.hasVisibleWidgets()||(a&&a.visible())){$("container").removeClassName("full_width");}else{$("container").addClassName("full_width");}},hasVisibleWidgets:function(){return $$("#sidebar .draggable").any(function(a){return a.visible();});},pendingWidgets:new Array(),registeredWidgets:new Array(),register:function(c,a){Widget.pendingWidgets.push([c,a||{}]);},activateWidgets:function(){var a;while(a=Widget.pendingWidgets.shift()){Widget.registeredWidgets.push(ObjectFactory.create(a[0],a[1]));}}});Widget.ScriptLoadingQueue=Class.create({initialize:function($super){this.QUEUED=10;this.LOADING=20;this.LOADED=30;this.queue=new Array();this.running=false;},setExternalScriptState:function(d,c){var a=this.queue.find(function(f){return f.src==d;});if(a.state<c){switch(c){case this.LOADING:a.loadingStartTime=new Date().getTime();break;case this.LOADED:a.loadingEndTime=new Date().getTime();break;}a.state=c;}},loading:function(){return this.queue.find(function(a){return a.state==this.LOADING;},this);},isDone:function(){return this.queue.all(function(a){return a.state==this.LOADED;},this);},next:function(){return this.queue.find(function(a){return a.state==this.QUEUED;},this);},push:function(a,c){if(!this.include(a)){this.queue.push({src:a,state:this.QUEUED,options:c||{},loadingStartTime:null,loadingEndTime:null});}},include:function(a){return this.queue.any(function(c){return c.src==a;});},loadScripts:function(f){if(this.isDone()){this.running=false;if(f){f();}}else{this.running=true;if(this.loading()){}else{var d=this.next();this.setExternalScriptState(d.src,this.LOADING);var e=$H({type:"text/javascript",charset:"utf-8"}).merge(d.options);var a=new Element("script");a.src=d.src;e.each(function(g){a.setAttribute(g.key,g.value);});var c=document.getElementsByTagName("head")[0];if(!c){c=document.body.parentNode.appendChild(new Element("head"));}a.onload=this.setExternalScriptState.curry(d.src,this.LOADED).bind(this);a.onreadystatechange=function(){if(this.readyState=="loaded"||this.readyState=="complete"){this.onload();}}.bind(a);c.appendChild(a);}this.loadScripts.bind(this).delay(0.1,f);}}});Widget.scriptLoadingQueue=new Widget.ScriptLoadingQueue();Object.extend(Widget,{require:Widget.scriptLoadingQueue.push.bind(Widget.scriptLoadingQueue),require_old:function(f,c){var e=$H({type:"text/javascript",charset:"utf-8"}).merge(c);var a=new Element("script");a.src=f;e.each(function(g){a.setAttribute(g.key,g.value);});var d=document.getElementsByTagName("head")[0];if(!d){d=document.body.parentNode.appendChild(new Element("head"));}d.appendChild(a);},fireLoadEvents:function(){Widget.activateWidgets();Widget.scriptLoadingQueue.loadScripts(document.fire.curry("widgets:load").bind(document));}});
var ReportWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.output=a.output;this.graphs=a.graphs;this.pointer=0;},displayGraph:function(){if($(this.output)==null){return;}this.pointer=this.pointer%this.graphs.length;$(this.output).src=this.graphs[this.pointer];},next:function(){this.pointer=this.pointer+1;this.displayGraph();},start:function(){this.displayGraph();}});
var TextWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.output=a.output;this.texts=a.texts;this.delay=a.delay;this.pointer=0;this.callout=null;},displayText:function(a,c){if($(c)==null){return;}if(a<0){a=this.texts.length-1;}else{a=a%this.texts.length;}this.pointer=a;$(c).hide();$(c).update(this.texts[a]);$(c).appear({duration:1.5});if(this.texts.length>1){this.callout=this.displayText.bind(this).delay(this.delay,a+1,c);}},next:function(){window.clearTimeout(this.callout);this.displayText(this.pointer+1,this.output);},prev:function(){window.clearTimeout(this.callout);this.displayText(this.pointer-1,this.output);},start:function(){if(this.texts.length>0){this.displayText(this.pointer,this.output);}}});
var TopPerformersWidget=Class.create(Widget,{initialize:function($super,c){$super(c);var e=$$(".top_performers_list");var f=e.length>1;$$(".top_performers_list .toggle").each(function(g){if(f){g.show();}else{g.hide();}g.observe("click",function(){e.each(function(h){h.toggle();if(h.visible()){$j.cookie("top-performers-widget-current",h.id);}});});});var a=$j.cookie("top-performers-widget-current");var d=null;if(a){d=$$("#"+a+".top_performers_list")[0];}else{d=e[0];}d.show();$j.cookie("top-performers-widget-current",d.id);}});
var CustomWidget=Class.create(Widget,{});
var BuddhaMachineWidget=Class.create(Widget,{});
var CampfireWidget=Class.create(Widget,{});
var OrganizationWidget=Class.create(Widget,{});
var EmbedWidget=Class.create(Widget,{});
var RelatedEntriesWidget=Class.create(Widget,{});
var MoreLikeThisWidget=Class.create(Widget,{});
var TopForumEntriesWidget=Class.create(Widget,{});
var UserSentimentWidget=Class.create(Widget,{});
var TicketSentimentWidget=Class.create(Widget,{});
var ViewsWidget=Class.create(Widget,{initialize:function($super,a){$super(a);if(typeof(ruleCounts)!="undefined"){ruleCounts.updateUi();}}});
var GetSatisfactionWidget=Class.create(Widget,{});
var IfbyphoneWidget=Class.create(Widget,{});
var ConstantContactWidget=Class.create(Widget,{});
var ForumsWidget=Class.create(Widget,{initialize:function($super,a){$super(a);var d=document.getUrlParameter("forum_id");if(d){set_selected_for_select($("forum_id"),d);}var c=document.getUrlParameter("query");if(c&&($("query").value=="")){$("query").value=c;}}});
var HighriseWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.highrise_domain=a.domain;this.use_ssl=a.use_ssl;this.initial_name=a.name;this.ticket_id=a.ticket_id;this.ticket_nice_id=a.ticket_nice_id;if(this.ticket_nice_id==undefined){this.ticket_nice_id=this.ticket_id;}this.highrise_resource=new Zendesk.Resource({anchor:"widget_"+this.id,domain:this.highrise_domain,use_ssl:this.use_ssl||"false",user:a.username,pass:"X",login_content:this.login.bind(this),application_content:this.application.bind(this),application_resources:[{resource:null,on_success:this.application.bind(this)}]});},login:function(){return'<form onsubmit="ObjectFactory.get('+this.id+').highrise_resource.submit_credentials(this); return false;" class="form"><label>Enter your highrise token</label><input type="text" class="text" id="username"/><input type="hidden" id="password" value="X"/><input type="submit" value="Login" id="submit" style="float:left"></form>';},application:function(){return'<div id="highrise-lookup-updating"><form id="lookup-form" onsubmit="disable_submit($(\'lookup-form\')); ObjectFactory.get('+this.id+').lookup(); return false;"><input type="text" class="text" style="margin-bottom:5px;" id="h_lookup" value="'+(this.initial_name||"")+'"/><input type="submit" id="submit" value="Lookup user"/></form></div><div id="highrise-lookup-result" style="display:none;"></div>';},lookup:function(){hName=$F("h_lookup").split(" ");if(hName.length>1){name=hName.first()+" "+hName.last();}else{name=hName.first();}if(name.blank()){alert("Please enter a name");enable_submit($("lookup-form"));}resource="people/search.js?term="+encodeURI(name);this.highrise_resource.request({resource:resource,on_success:this.render_highrise_lookup_result.bind(this)});},lookup_id:function(a){person=this.people.detect(function(c){return c.id==a;});result=this.format_person_data(person);$("highrise-lookup-result").update(result);},people:null,render_highrise_lookup_result:function(a){this.people=a.people;if(typeof(this.people)!="undefined"){if(this.people.length>1){result="<h5>"+this.people.length+" matching people found in Highrise. Click on a person for more information</h5>";result+=this.people.collect(function(c){return('<span class="link" onclick="ObjectFactory.get('+this.id+").lookup_id("+c.id+')">'+(c.first_name==null?"":c.first_name)+" "+(c.last_name==null?"":c.last_name)+"</span>");}.bind(this)).join("<br/>");result+='<br/><br/><a href="javascript:ObjectFactory.get('+this.id+').reset_form();">New search</a>';}else{result=this.format_person_data(this.people.first());}$j("#highrise-lookup-updating, #highrise-lookup-result").toggle();$("highrise-lookup-result").update(result);}else{alert("No match found in Highrise");enable_submit($("lookup-form"));}},format_person_data:function(a){host="http"+(this.use_ssl?"s":"")+"://"+this.highrise_domain;result='<h5 style="font-size:16px"><a href="'+host+"/people/"+a.id+'" target="_new">'+(a.first_name==null?"":a.first_name)+" "+(a.last_name==null?"":a.last_name)+"</a></h5>";if(a.title){result+='<p class="minimum">'+a.title+"</p>";}if(a.background){result+='<h5>Background</h5><p class="minimum">'+a.background+"</p>";}if(a.contact_data.phone_numbers){items=a.contact_data.phone_numbers.collect(function(c){return(c.number+' <span class="sub">'+c.location.toLowerCase()+"</span>");}).join("<br/>");if(items){result+='<h5>Phone</h5><p class="minimum">'+items+"</p>";}}if(a.contact_data.email_addresses){items=a.contact_data.email_addresses.collect(function(c){return'<a href="mailto:'+c.address+'">'+c.address+'</a> <span class="sub">'+c.location.toLowerCase()+"</span>";}).join("<br/>");if(items){result+='<h5>Email</h5><p class="minimum">'+items+"</p>";}}if(a.contact_data.web_addresses){items=a.contact_data.web_addresses.collect(function(c){return'<a href="'+c.url+'" target="_new">'+c.url+'</a> <span class="sub">'+c.location.toLowerCase()+"</span>";}).join("<br/>");if(items){result+='<h5>Web</h5><p class="minimum">'+items+"</p>";}}if(a.contact_data.instant_messengers){items=a.contact_data.instant_messengers.collect(function(c){return c.address+' <span class="sub">'+c.protocol+", "+c.location.toLowerCase()+"</span>";}).join("<br/>");if(items){result+='<h5>IM</h5><p class="minimum">'+items+"</p>";}}result+="<h5>Add a note to this person in Highrise</h5>";result+="<form onsubmit=\"if (this['note[body]'].value=='') {alert('Please enter a note'); return false;}; ObjectFactory.get("+this.id+").add_ticket_to_note(this); ObjectFactory.get("+this.id+').highrise_resource.submit_data(this); return false;" class="form"><textarea name="note[body]"></textarea><input type="hidden" name="note[subject-id]" value="'+a.id+'"/><input type="hidden" name="note[subject-type]" value="Person"/><input type="hidden" name="pluck_param" value="note"><input type="hidden" name="resource" value="notes"><input type="hidden" name="media_type" value="application/xml"><input type="hidden" name="event_reference" value="Highrise requester note"><input type="hidden" name="event_log" value="Body"><input type="submit" value="Submit" id="submit"> <a href="javascript:ObjectFactory.get('+this.id+').reset_form();">Lookup user</a></form>';return result;},reset_form:function(){enable_submit($("lookup-form"));$j("#highrise-lookup-result, #highrise-lookup-updating").toggle();},add_ticket_to_note:function(a){if(ticket_id){a["note[body]"].value+=" (Zendesk ticket #"+this.ticket_nice_id+")";}}});
var SalesforceHelper=Class.create();SalesforceHelper.SOAP_LOGIN=new Template('<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"> <SOAP-ENV:Body> <login xmlns="urn:enterprise.soap.sforce.com"> <username xsi:type="xsd:string">#{username}</username> <password xsi:type="xsd:string">#{password}</password> </login> </SOAP-ENV:Body></SOAP-ENV:Envelope>');SalesforceHelper.SOAP_QUERY=new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <SessionHeader xmlns="urn:enterprise.soap.sforce.com"> <sessionId>#{session}</sessionId> </SessionHeader> </soap:Header> <soap:Body> <query xmlns="urn:enterprise.soap.sforce.com"> <queryString>#{query}</queryString> </query> </soap:Body></soap:Envelope>');SalesforceHelper.SELECT=new Template("SELECT department, email, fax, firstname, homephone, lastname, mailingcity, mailingcountry, mailingpostalcode, mailingstreet, mobilephone, name, othercity, othercountry, otherphone, otherpostalcode, otherstate, otherstreet, phone, salutation, title FROM contact WHERE email LIKE '%#{search}%' OR name LIKE '%#{search}%'");SalesforceHelper.LOGIN_URL="/proxy/direct.xml?url=https://www.salesforce.com/services/Soap/c/13.0&body=";SalesforceHelper.QUERY_URL=new Template("/proxy/direct.xml?url=#{serverUrl}&body=#{xml}");SalesforceHelper.SESSION_MATCH=new RegExp("/.*<sessionId>(.*)</sessionId>.*/");SalesforceHelper.SERVER_MATCH=new RegExp("/.*<serverUrl>(.*)</serverUrl>.*/");SalesforceHelper.authorizationUrl=function(c,a){return this.LOGIN_URL+escape(this.SOAP_LOGIN.evaluate({username:c,password:a}));};SalesforceHelper.getNodeValue=function(a,d){if(Prototype.Browser.WebKit){d=d.replace("sf:","");}var c=a.getElementsByTagName(d);if(c==null||c.length==0){return null;}return c[0].childNodes[0].nodeValue;};SalesforceHelper.getNodeString=function(a,d){var c=this.getNodeValue(a,d);if(c==null){return"";}else{return c;}};SalesforceHelper.getErrorCode=function(a){return this.getNodeValue(a,"faultcode");};SalesforceHelper.getRecords=function(a){var c=a.getElementsByTagName("records");if(c==null){return new Array();}return c;};SalesforceHelper.renderLine=function(a,f,e){var c="";for(var d=0;d<f.length;d++){c+=this.getNodeString(a,f[d]);if(c!=""){c+=" ";}}if(c!=""){return e.evaluate({output:c});}else{return"";}};SalesforceHelper.renderRecord=function(d){var a="";a+=this.renderLine(d,["sf:Salutation","sf:FirstName","sf:LastName"],new Template("<h5 style='font-size: 16px;'>#{output}</h5>"));a+=this.renderLine(d,["sf:Title"],new Template("<p class='minimum'>#{output}</p>"));a+=this.renderLine(d,["sf:Department"],new Template("<p class='minimum'>#{output}</p>"));var e="";e+=this.renderLine(d,["sf:Phone"],new Template("<p class='minimum'>#{output}</p>"));e+=this.renderLine(d,["sf:MobilePhone"],new Template("<p class='minimum'>#{output}<span class='sub'>mobile</span></p>"));if(e!=""){a+="<h5>Phone</h5>";a+=e;}a+=this.renderLine(d,["sf:Email"],new Template("<p class='minimum'><a href='mailto:#{output}'>#{output}</a></p>"));var c=this.renderLine(d,["sf:MailingStreet"],new Template("#{output}")).replace(",","<br />");if(c!=""){subaddress=this.renderLine(d,["sf:MailingPostalCode","sf:MailingCity"],new Template("#{output} "));if(subaddress!=""){c+="<br /> "+subaddress;}c+=this.renderLine(d,["sf:MailingCountry"],new Template("<br />#{output}"));}a+=c;return a;};SalesforceHelper.buildQueryUrl=function(g,a,c){var f=this.SELECT.evaluate({search:c});var e=this.SOAP_QUERY.evaluate({query:f,session:g});var d=this.QUERY_URL.evaluate({serverUrl:a,xml:escape(e)});return d;};
var SalesforceWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.username=a.username;this.password=a.password;this.destination=a.destination;this.formInstance=null;},disableForm:function(){this.formInstance.button.value="Looking...";this.formInstance.button.disabled=true;},enableForm:function(){this.formInstance.button.value="Lookup user";this.formInstance.button.disabled=false;},lookup:function(a){this.formInstance=a;this.disableForm();var c=SalesforceHelper.authorizationUrl(this.username,this.password);new Ajax.Request(c,{method:"post",requestHeaders:{Accept:"application/xml",SOAPAction:"login"},onSuccess:function(d){this.executeAuthorizedQuery(d.responseXML);}.bind(this),onFailure:function(){alert("Salesforce login failed. Try again in a short moment.");this.enableForm();}.bind(this)});},executeAuthorizedQuery:function(f){var e=SalesforceHelper.getNodeValue(f,"sessionId");var a=SalesforceHelper.getNodeValue(f,"serverUrl");if(e!=null&&a!=null){var c=SalesforceHelper.buildQueryUrl(e,a,this.formInstance.email.value);new Ajax.Request(c,{method:"post",requestHeaders:{Accept:"application/xml",SOAPAction:"query"},onSuccess:function(g){this.displayResult(g.responseXML);}.bind(this),onFailure:function(){alert("Salesforce query failed.");this.enableForm();}.bind(this)});}else{var d=SalesforceHelper.getNodeValue(f,"faultcode");if(d=="sf:LOGIN_MUST_USE_SECURITY_TOKEN"){alert("Salesforce login failed - Salesforce network access needs configuration.");}else{if(d=="sf:API_DISABLED_FOR_ORG"){alert("Salesforce login failed - Your Salesforce edition does not support API access.");}else{alert("Salesforce login failed. Failed to find server or session. Code: "+d);}}this.enableForm();}},displayResult:function(e){var c=SalesforceHelper.getRecords(e);if(c.length==0){alert("No match found in Salesforce.");this.enableForm();return;}var a="";for(var d=0;d<c.length;d++){a+=SalesforceHelper.renderRecord(c[d]);}a+="<br />";$(this.destination).update(a);this.enableForm();}});
var JiraHelper={GET_SESSION:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="#{url}rpc/soap/jirasoapservice-v2" xmlns:types="#{url}rpc/soap/jirasoapservice-v2/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <q1:login xmlns:q1="http://soap.rpc.jira.atlassian.com"> <in0 xsi:type="xsd:string">#{username}</in0> <in1 xsi:type="xsd:string"><![CDATA[#{password}]]></in1> </q1:login> </soap:Body></soap:Envelope>'),GET_PROJECTS:new Template('<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"> <SOAP-ENV:Body> <m:getProjectsNoSchemes xmlns:m="#{url}rpc/soap/jirasoapservice-v2"> <in0 xsi:type="xsd:string">#{sessionId}</in0> </m:getProjectsNoSchemes> </SOAP-ENV:Body></SOAP-ENV:Envelope>'),GET_ASSIGNEES:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="#{url}rpc/soap/agilossoapservice-v1" xmlns:types="#{url}rpc/soap/agilossoapservice-v1/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <q1:getAssignableUsers xmlns:q1="#{url}"> <in0 xsi:type="xsd:string">#{sessionId}</in0> <in1 xsi:type="xsd:string">#{projectKey}</in1> </q1:getAssignableUsers> </soap:Body></soap:Envelope>'),GET_ISSUE_TYPES2:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="#{url}rpc/soap/jirasoapservice-v2" xmlns:types="#{url}rpc/soap/jirasoapservice-v2/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <q1:getIssueTypesForProject xmlns:q1="http://soap.rpc.jira.atlassian.com"> <in0 xsi:type="xsd:string">#{sessionId}</in0> <in1 xsi:type="xsd:string">#{projectId}</in1> </q1:getIssueTypesForProject></soap:Body></soap:Envelope>'),GET_ISSUE_TYPES:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="#{url}rpc/soap/jirasoapservice-v2" xmlns:types="#{url}rpc/soap/jirasoapservice-v2/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><q1:getIssueTypesForProject xmlns:q1="http://soap.rpc.jira.atlassian.com"><in0 xsi:type="xsd:string">#{sessionId}</in0><in1 xsi:type="xsd:string">#{projectId}</in1></q1:getIssueTypesForProject></soap:Body></soap:Envelope>'),SUBMIT_ISSUE:new Template('<?xml version="1.0" encoding="ISO-8859-1"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="#{url}rpc/soap/jirasoapservice-v2" xmlns:types="#{url}rpc/soap/jirasoapservice-v2/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <q1:createIssue xmlns:q1="http://soap.rpc.jira.atlassian.com"> <in0 xsi:type="xsd:string">#{sessionId}</in0> <in1 href="#id1" /> </q1:createIssue> <q2:RemoteIssue id="id1" xsi:type="q2:RemoteIssue" xmlns:q2="http://beans.soap.rpc.jira.atlassian.com"> <id xsi:nil="true" /> <affectsVersions xsi:nil="true" /> <assignee xsi:type="xsd:string">#{assignee}</assignee> <attachmentNames xsi:nil="true" /> <components xsi:nil="true" /> <created xsi:nil="true" /> <customFieldValues xsi:nil="true" /> <description>#{description}</description> <duedate xsi:nil="true" /> <environment xsi:nil="true" /> <fixVersions xsi:nil="true" /> <key xsi:nil="true" /> <priority xsi:nil="true" /> <project xsi:type="xsd:string">#{projectKey}</project> <reporter xsi:nil="true" /> <resolution xsi:nil="true" /> <status xsi:nil="true" /> <summary xsi:type="xsd:string">#{summary}</summary> <type xsi:type="xsd:string">#{type}</type> <updated xsi:nil="true" /> <votes xsi:nil="true" /> <customFieldValues href="#id2" /> </q2:RemoteIssue> <soapenc:Array id="id2" xmlns:q3="http://beans.soap.rpc.jira.atlassian.com" soapenc:arrayType="q3:RemoteCustomFieldValue[1]"> <Item href="#id3" /> </soapenc:Array> <q4:RemoteCustomFieldValue id="id3" xsi:type="q4:RemoteCustomFieldValue" xmlns:q4="http://beans.soap.rpc.jira.atlassian.com"> <customfieldId xsi:type="xsd:string">customfield_#{customFieldId}</customfieldId> <key xsi:nil="true" /> <values href="#id4" /> </q4:RemoteCustomFieldValue> <soapenc:Array id="id4" soapenc:arrayType="xsd:string[1]"> <Item>#{ticketId}</Item> </soapenc:Array> </soap:Body></soap:Envelope>'),SUBMIT_FORM:new Template('<form class="form" id="jira-form-#{widgetId}"> Submit this ticket as a new issue <label>Project</label><select name="projectId" id="jiraProjectSelector" class="jiraProjectSelector" onchange="ObjectFactory.get(#{widgetId}).projectsSelector(this.options[this.selectedIndex].value)"></select> <label>Type</label><select name="typeId" id="jiraTypeSelector" class="jiraTypeSelector"></select> <label>Assignee ID</label><select name="jiraAssigneeSelector" class="jiraAssigneeSelector" id="jiraAssigneeSelector"></select> <label></label><input type="button" value="Submit" id="submit" class="jiraSubmit" onclick="ObjectFactory.get(#{widgetId}).submitIssue($(\'jiraForm-#{widgetId}\'));return false;"></form>'),JIRA_TAG:new Template("<ticket><additional-tags>jira</additional-tags></ticket>"),JIRA_ISSUE_EXTERNAL_LINK:new Template("<external-link><type>JiraIssue</type><issue-id>#{issueId}</issue-id></external-link>"),NOTICE:new Template('This ticket is related to the following issue in JIRA:<br /><br /><b><a href="#{url}/browse/#{issueId}" target=_blank>#{issueId}</a></b><br />&nbsp;'),MISSING_TICKET:new Template("Only available when viewing tickets.<br />&nbsp;"),getSessionRequest:function(d,c,a){return escape(this.GET_SESSION.evaluate({username:d,password:c,url:a}));},getProjectsRequest:function(c,a){return escape(this.GET_PROJECTS.evaluate({sessionId:c,url:a}));},getProjectsAssigneeRequest:function(d,c,a){return escape(this.GET_ASSIGNEES.evaluate({sessionId:d,url:c,projectKey:a}));},getProjectsIssueTypesRequest:function(d,c,a){return escape(this.GET_ISSUE_TYPES.evaluate({sessionId:d,url:c,projectId:a}));},getSubmitRequest:function(e,c,f,h,a,g,k,d,j){return escape(this.SUBMIT_ISSUE.evaluate({sessionId:e,url:c,assignee:f,projectKey:a,type:h,summary:XmlHelper.encodeString(g),description:XmlHelper.encodeString(k),ticketId:d,customFieldId:j}));},getSubmitForm:function(a){return(this.SUBMIT_FORM.evaluate({widgetId:a}));},getInJiraNotice:function(a,c){return(this.NOTICE.evaluate({url:a,issueId:c}));},getMissingTicketMessage:function(){return(this.MISSING_TICKET.evaluate({}));},setIssueIdRequest:function(a){return this.JIRA_ISSUE_EXTERNAL_LINK.evaluate({issueId:a});},setJiraTagRequest:function(){return this.JIRA_TAG.evaluate();},PROXY_URL1:new Template("/proxy/direct?log=1&url=#{url}rpc/soap/jirasoapservice-v2&json=1"),PROXY_URL2:new Template("/proxy/direct?log=1&url=#{url}rpc/soap/agilossoapservice-v1?"),getProxyUrl:function(c,a){return escape(this.PROXY_URL1.evaluate({url:c,body:a}));},getProxyUrl2:function(c,a){return escape(this.PROXY_URL2.evaluate({url:c,body:a}));},getSessionUrl:function(d,c,a){doc=JiraHelper.getSessionRequest(d,c,a);a=JiraHelper.getProxyUrl(a,doc);return a;},getNodeValue:function(a,c){if(Prototype.Browser.WebKit){c=c.replace("sf:","");}node=a.getElementsByTagName(c);if(node==null||node.length==0){return null;}return node[0].childNodes[0].nodeValue;},getNodeString:function(a,c){value=this.getNodeValue(a,c);if(value==null){return"";}else{return value;}},getRecords:function(a,d,c){results=a.getElementsByTagName(c);if(results.length==0){results=a.getElementsByTagName(d+":"+c);}if(results==null){return new Array();}return results;},populateProjects:function(d,f){var c=[];var a=[];if($("jiraProjectSelector").options.length==0){var e=$A(XmlHelper.getRecords(f,"","multiRef"));e.each(function(g){a.push(new JiraProject(g));});a.sort(function(h,g){return h.name.toLowerCase()<g.name.toLowerCase()?-1:1;});projectSelector=d.down("select.jiraProjectSelector");projectSelector.appendChild(new Element("option"));a.each(function(h){var g=new Element("option");g.value=h.key;g.innerHTML=h.name;projectSelector.appendChild(g);c[h.key]=h.id;});}return c;},populateProjectIssueTypes:function(c,e){var a=[];var d=$A(XmlHelper.getRecords(e,"","multiRef"));d.each(function(f){a.push(new JiraType(f));});a.sort(function(g,f){return g.name.toLowerCase()<f.name.toLowerCase()?-1:1;});typeSelector=c.down("select.jiraTypeSelector");typeSelector.update("");typeSelector.appendChild(new Element("option"));a.each(function(g){var f=new Element("option");f.value=g.id;f.innerHTML=g.name;typeSelector.appendChild(f);});},populateAssignees:function(c,e){var a=[];var d=$A(XmlHelper.getRecords(e,"","multiRef"));d.each(function(f){a.push(new JiraAsignee(f));});a.sort(function(g,f){return g.name.toLowerCase()<f.name.toLowerCase()?-1:1;});asigneeSelector=c.down("select.jiraAssigneeSelector");asigneeSelector.update("");asigneeSelector.appendChild(new Element("option"));a.each(function(g){var f=new Element("option");f.value=g.name;f.innerHTML=g.fullName;asigneeSelector.appendChild(f);});}};var XmlHelper={getTextContentByKey:function(a,c){if(Prototype.Browser.IE){return a.getElementsByTagName(c)[0].childNodes[0].nodeValue;}return a.getElementsByTagName(c)[0].textContent;},encodeString:function(c){var a=c;a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/'/g,"&apos;");a=a.replace(/"/g,"&quot;");return a;},getRecords:function(a,d,c){results=a.getElementsByTagName(c);if(results.length==0){results=a.getElementsByTagName(d+":"+c);}if(results==null){return new Array();}return results;}};
var JiraProject=Class.create({initialize:function(a){this.key=XmlHelper.getTextContentByKey(a,"key");this.id=XmlHelper.getTextContentByKey(a,"id");this.name=XmlHelper.encodeString(XmlHelper.getTextContentByKey(a,"name"));}});
var JiraType=Class.create({initialize:function(a){this.id=XmlHelper.getTextContentByKey(a,"id");this.name=XmlHelper.encodeString(XmlHelper.getTextContentByKey(a,"name"));}});
var JiraAsignee=Class.create({initialize:function(a){this.name=XmlHelper.encodeString(XmlHelper.getTextContentByKey(a,"name"));this.fullName=XmlHelper.encodeString(XmlHelper.getTextContentByKey(a,"fullname"));}});
var JiraWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.url=a.url;this.username=a.username;this.password=a.password;this.formInstance=null;this.ticketId=a.ticketId;this.issueId=null;this.externalId=a.externalId;this.customFieldId=a.customFieldId;this.widgetId=a.id;this.subject=a.subject;this.description=a.description;this.projectIds=null;this.contentRoot=this.containingElement().down("div.jiraContent"+this.widgetId);if(!this.url.endsWith("/")){this.url+="/";}this.start();},start:function(){if(this.ticketId){var a=this;$j.ajax({type:"get",url:"/tickets/"+this.ticketId+"/external_links.json",success:function(d){var c;if(c=_(d).find(function(e){return e.external_link_type==="JiraIssue";})){a.issueId=c.external_link["issue_id"]||this.externalId;a.contentRoot.update(JiraHelper.getInJiraNotice(a.url,a.issueId));}else{a.contentRoot.update(JiraHelper.getSubmitForm(a.id));a.proxyUrl=JiraHelper.PROXY_URL1.evaluate({url:a.url});a.proxyUrl2=JiraHelper.PROXY_URL2.evaluate({url:a.url});a.getSession();}}});}else{this.contentRoot.update(JiraHelper.getMissingTicketMessage());}},getSession:function(){var a="body="+JiraHelper.getSessionRequest(this.username,this.password,this.url);new Ajax.Request(this.proxyUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:"login"},onSuccess:function(c){this.extractSessionID(c.responseXML);}.bind(this),onFailure:function(){alert("Failed");}.bind(this)});},extractSessionID:function(c){var a=JiraHelper.getRecords(c,"ns1","loginResponse");if(a.length==1){this.sessionId=JiraHelper.getNodeString(a[0],"loginReturn");this.getProjects();}else{alert("Login failed");}},getProjects:function(){var a="body="+JiraHelper.getProjectsRequest(this.sessionId,this.url);new Ajax.Request(this.proxyUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:"login"},onSuccess:function(c){this.projectIds=JiraHelper.populateProjects(this.contentRoot,c.responseXML);}.bind(this),onFailure:function(){alert("Failed to get projects");}.bind(this)});},projectsSelector:function(a){var c="body="+JiraHelper.getProjectsAssigneeRequest(this.sessionId,this.url,a);new Ajax.Request(this.proxyUrl2,{method:"post",postBody:c,requestHeaders:{Accept:"application/xml",SOAPAction:"0"},onSuccess:function(d){JiraHelper.populateAssignees(this.contentRoot,d.responseXML);}.bind(this),onFailure:function(){alert("Failed to get projects");}.bind(this)});c="body="+JiraHelper.getProjectsIssueTypesRequest(this.sessionId,this.url,this.projectIds[a]);new Ajax.Request(this.proxyUrl,{method:"post",postBody:c,requestHeaders:{Accept:"application/xml",SOAPAction:"login"},onSuccess:function(d){JiraHelper.populateProjectIssueTypes(this.contentRoot,d.responseXML);}.bind(this),onFailure:function(){alert("Failed to get projects");}.bind(this)});},submitIssue:function(c){var a="/tickets/"+this.ticketId+".xml";new Ajax.Request(a,{method:"get",requestHeaders:{Accept:"application/xml"},onSuccess:function(e){var d=XmlHelper.getTextContentByKey(e.responseXML,"subject");this.submitIssue2(d,this.description);}.bind(this),onFailure:function(){alert("Failed to submit issue.");}.bind(this)});return false;},submitIssue2:function(c,d){var a=c;if(a==""){a="Ticket #"+this.ticketId;}var e="body="+JiraHelper.getSubmitRequest(this.sessionId,this.url,this.contentRoot.down("select.jiraAssigneeSelector").getValue(),this.contentRoot.down("select.jiraTypeSelector").getValue(),this.contentRoot.down("select.jiraProjectSelector").getValue(),a,d,this.ticketId,this.customFieldId);new Ajax.Request(this.proxyUrl,{method:"post",postBody:e,requestHeaders:{Accept:"application/xml",SOAPAction:"login"},onSuccess:function(f){this.setIssueId(f.responseXML);this.setJiraTag();this.addTag("jira");}.bind(this),onFailure:function(){alert("Failed to submit issue.");}.bind(this)});return false;},addTag:function(a){if(typeof(ticketTagField)!="undefined"){ticketTagField.addEntry("jira","jira");}},setIssueId:function(g){var d=JiraHelper.getRecords(g,"","multiRef");if(d.length>0){var e=XmlHelper.getTextContentByKey(d[0],"key");var f=JiraHelper.setIssueIdRequest(e);var c="/tickets/"+this.ticketId+"/external_links.xml?";new Ajax.Request(c,{contentType:"application/xml",method:"post",encoding:"",postBody:f,onSuccess:function(h){this.contentRoot.update(JiraHelper.getInJiraNotice(this.url,e));}.bind(this),onFailure:function(){alert("Failed to set JIRA issue ID.");}});}else{var a=XmlHelper.getTextContentByKey(g,"faultstring");alert("Failed to retrieve JIRA issue key.\n\n("+a+")");}},setJiraTag:function(d){var c=JiraHelper.setJiraTagRequest();var a="/tickets/"+this.ticketId+".xml?_method=put";new Ajax.Request(a,{contentType:"application/xml",method:"put",encoding:"",postBody:c,onFailure:function(){alert("Failed to set JIRA tag.");}});}});var TactileHelper={PROXY_URL:new Template("/proxy/direct?log=1&url=#{url}"),QUERYSTRING_PEOPLE:new Template("people/?api_token=#{apiToken}&email=#{email}"),QUERYSTRING_CONTACTMETHODS:new Template("people/contact_methods/?api_token=#{apiToken}&id=#{id}"),QUERYSTRING_PERSON:new Template("people/view/?api_token=#{apiToken}&id=#{id}"),getQueryURL:function(a){return TactileHelper.PROXY_URL.evaluate({url:a});},getPeopleQueryString:function(a,c){return TactileHelper.QUERYSTRING_PEOPLE.evaluate({apiToken:a,email:c});},getContactMethodsQueryString:function(a,c){return TactileHelper.QUERYSTRING_CONTACTMETHODS.evaluate({apiToken:a,id:c});},getPersonQueryString:function(a,c){return TactileHelper.QUERYSTRING_PERSON.evaluate({apiToken:a,id:c});},renderLine:function(c,e){var a="";for(var d=0;d<c.length;d++){if(c[d]>""){if(a!=""){a+=" ";}a+=c[d];}}return a>""?e.evaluate({output:a}):"";},renderRecord:function(e,a){var f="";var d="";var c="";var g=new Template("#{output}<br />");f+=this.renderLine([e.title,e.name],new Template("<h5 style='font-size: 16px;'>#{output}</h5>"));d+=this.renderLine([e.jobtitle],g);d+=this.renderLine([e.organisation],g);f+=this.renderLine([d],new Template('<p class="minimum">#{output}</p>'));c+=this.renderLine([e.street1],g);c+=this.renderLine([e.street2],g);c+=this.renderLine([e.street3],g);c+=this.renderLine([e.town],g);c+=this.renderLine([e.county],g);c+=this.renderLine([e.postcode],g);c+=this.renderLine([e.country],g);f+=this.renderLine([c],new Template('<p class="minimum">#{output}</p>'));f+=this.renderContactMethods(a,"T","Telephone");f+=this.renderContactMethods(a,"M","Mobile");f+=this.renderContactMethods(a,"E","Email");f+=this.renderLine([e.description],new Template("<h5>Description</h5>#{output}<br />"));return f+"<br />";},renderContactMethods:function(a,g,d){var c="";var f=new Template('#{value} <span class="sub">#{name}</span><br />');for(var e=0;e<a.contact_methods.length;e++){var h=a.contact_methods[e];if(h.type==g){c+=f.evaluate({value:h.contact,name:h.name});}}return c>""?"<h5>"+d+"</h5>"+c:"";},renderList:function(c,d){var a="";a="<h5>"+c.length+" matching people found in TactileCRM. Click on a person for more information</h5>";a+=c.collect(function(e){return('<span class="link" onclick="ObjectFactory.get('+d+").lookupPerson("+e.id+')">'+e.name+"</span>");}.bind(this)).join("<br/>")+"<br />&nbsp;";return a;}};
var TactileWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.widgetId=a.id;this.url=a.url;this.apiToken=a.apiToken;this.formInstance=null;this.contentRoot=this.containingElement().down("div.tactileContent"+this.widgetId);if(!this.url.endsWith("/")){this.url+="/";}},lookup:function(a){var d=a.down("input.email").value;var c=TactileHelper.getQueryURL(this.url)+escape(TactileHelper.getPeopleQueryString(this.apiToken,d));new Ajax.Request(c,{method:"get",encoding:"",onSuccess:function(e){this.showList(e.responseText.evalJSON());}.bind(this),onFailure:function(){alert("Failed to lookup.");}.bind(this)});return false;},showList:function(a){if(a.status=="error"){alert("Error: Unable to login to TactileCRM");return false;}if(a.people.length==0){alert("No match found in TactileCRM");}else{if(a.people.length>1){this.contentRoot.update(TactileHelper.renderList(a.people,this.id));}else{this.lookupPerson(a.people[0].id);}}},lookupPerson:function(c){var a=TactileHelper.getQueryURL(this.url)+escape(TactileHelper.getPersonQueryString(this.apiToken,c));new Ajax.Request(a,{method:"get",encoding:"",onSuccess:function(d){this.result1=d.responseText.evalJSON();this.lookupContactMethods(c);}.bind(this),onFailure:function(){alert("Failed to lookup.");}.bind(this)});},lookupContactMethods:function(c){var a=TactileHelper.getQueryURL(this.url)+escape(TactileHelper.getContactMethodsQueryString(this.apiToken,c));new Ajax.Request(a,{method:"get",encoding:"",onSuccess:function(d){this.result2=d.responseText.evalJSON();this.show();}.bind(this),onFailure:function(){alert("Failed to lookup.");}.bind(this)});},show:function(){var a=TactileHelper.renderRecord(this.result1.person,this.result2);this.contentRoot.update(a);}});var PagloHelper={SEARCH_FORM:new Template('<div class="asset"></div><div class="software"></div><form class="form" id="paglo-form-#{widgetId}"> <label>Search</label><input type="text" name="token" id="token" value="#{name}"/ > <br/><input type="submit" id="submit" value="Search" onclick="ObjectFactory.get(#{widgetId}).doSearch($(\'paglo-form-#{widgetId}\').token.value);return false;"></form>'),getSearchForm:function(c,a){return PagloHelper.SEARCH_FORM.evaluate({widgetId:c,name:a});},QUERY:new Template("select nvl(system/dns_name, first(interface/inet/ip_address)) as name, first(interface/inet/ip_address) as ip_address from /network/device where system/dns_name like '%#{token}%' or interface/inet/ip_address = '#{token}%' or wmi/win32_computersystem/username = '#{token}' or wmi/win32_computersystem/username like '%#{token2}' order by 1 limit 10"),getQuery:function(a){return PagloHelper.QUERY.evaluate({token:a,token2:"\\"+a});},SOFTWARE_QUERY:new Template("select Name, Version from /network/device[system/dns_name = '#{name}']/wmi/win32_product order by 1,2"),getSoftwareQuery:function(a){return PagloHelper.SOFTWARE_QUERY.evaluate({name:a});},URL:new Template("/proxy/direct?url=https://api.gotomanage.com/api&contenttype=application/x-www-form-urlencoded&body=#{body}"),getURL:function(a){return PagloHelper.URL.evaluate({body:escape(a)});},doc:new Template("method=paglo.query&v=1.0&api_key=#{apiKey}&query=#{query}"),getDoc:function(c,a){return PagloHelper.doc.evaluate({apiKey:c,query:a});},ITEM:new Template('<span class="link" onClick="ObjectFactory.get(#{widgetId}).#{functionName}(\'#{name}\')">#{name}</span><br />'),renderItem:function(a,d,c){return PagloHelper.ITEM.evaluate({name:a,functionName:d,widgetId:c});},LIST_TEMPLATE:new Template("<b>#{title}</b><br /><br />#{content}"),getList:function(c,a){return PagloHelper.LIST_TEMPLATE.evaluate({title:c,content:a});},SOFTWARE_SELECTION:new Template('<b>Select software package:</b><br /><select id="paglo_software" class="software" onChange="ObjectFactory.get(#{widgetId}).selectSoftware(this.options[this.selectedIndex].value)"></select>'),getSoftwareSelection:function(a){return PagloHelper.SOFTWARE_SELECTION.evaluate({widgetId:a});},ASSET:new Template("select system/dns_name, interface/inet/ip_address, nvl(system_profile/spsoftwaredatatype/os_version, os/version, wmi/win32_operatingsystem/caption || ' ' || wmi/win32_operatingsystem/csdversion) as os, nvl(system/class, system/computed_class) as class, nvl(system/vendor, wmi/win32_computersystemproduct/vendor, system/computed_vendor) as vendor, nvl(system/model, wmi/win32_computersystemproduct/name, system/computed_model) as model, nvl(wmi/win32_computersystem/username, system_profile/spsoftwaredatatype/user_name) as username from /network/device where system/(dns_name = '#{name}')"),getAssetQuery:function(a){return PagloHelper.ASSET.evaluate({name:a});},ASSET_INFO_SECTION:new Template("<b>#{title}:</b><br /> #{value}<br /><br />"),getAssetInfoSection:function(c,a){return(a!=""?PagloHelper.ASSET_INFO_SECTION.evaluate({title:c,value:a}):"");},ASSET_HEADER:new Template('<a href="https://app.paglo.com/app/inventory/lookup?key=system/dns_name&value=#{name}" target="_new"><img src="/images/widgets/paglo/asset.png" />&nbsp;&nbsp;<b>#{name}</b></a> <br /><br />'),getAssetHeader:function(a){return PagloHelper.ASSET_HEADER.evaluate({name:a});},getAssetInfo:function(c,d){var a="";var f=new RegExp("\\S");for(var e=0;e<c.length;e++){if(c[e].attributes.length>0&&c[e].childNodes.length>0){if(c[e].getAttribute("name")==d&&c[e].firstChild.nodeValue.match(f)){a+=(a!=""?"<br />":"")+c[e].firstChild.nodeValue;}}}return a;},renderAssetInfo:function(d){var c="";var a=XmlHelper.getRecords(d,"","value");c+=PagloHelper.getAssetHeader(PagloHelper.getAssetInfo(a,"system/dns_name"));c+=PagloHelper.getAssetInfoSection("Class",PagloHelper.getAssetInfo(a,"class"));c+=PagloHelper.getAssetInfoSection("Vendor",PagloHelper.getAssetInfo(a,"vendor"));c+=PagloHelper.getAssetInfoSection("Model",PagloHelper.getAssetInfo(a,"model"));c+=PagloHelper.getAssetInfoSection("Operating system",PagloHelper.getAssetInfo(a,"os"));c+=PagloHelper.getAssetInfoSection("Username",PagloHelper.getAssetInfo(a,"username"));c+=PagloHelper.getAssetInfoSection("Network",PagloHelper.getAssetInfo(a,"interface/inet/ip_address"));return c;}};
var PagloWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.apiKey=a.apikey;this.formInstance=null;this.widgetId=a.id;this.isEmpty=a.isEmpty;this.hardwareFieldId=a.hardwareFieldId;this.softwareFieldId=a.softwareFieldId;this.externalId=a.externalId;this.email=a.email;this.contentRoot=this.containingElement().down("div.paglo-content");this.startup();},startup:function(){if(!($("ticket_fields_"+this.hardwareFieldId)&&$("ticket_fields_"+this.softwareFieldId))){this.contentRoot.update("Not a ticket, or missing custom fields.");return;}this.contentRoot.update(PagloHelper.getSearchForm(this.widgetId,""));var c=$("ticket_fields_"+this.hardwareFieldId).value;if(c){this.getAsset(c);}else{c=(c?c:this.externalId);if(!c&&this.email){var d=/(\S*)@\S*/;var a=d.exec(this.email);if(a.length>1){c=a[1];}}if(c){this.doSearch(c);}}this.contentRoot.down("form").token.value=c;},doSearch:function(c){var d=PagloHelper.getQuery(c);var e=PagloHelper.getDoc(this.apiKey,d);var a=PagloHelper.getURL(e);this.contentRoot.down("div.asset").update("Searching...");this.contentRoot.down("div.software").update("");new Ajax.Request(a,{method:"post",requestHeaders:{Accept:"application/xml"},onSuccess:function(f){this.showResults(f.responseXML);}.bind(this),onFailure:function(){alert("Failed");}});},showResults:function(g){var e="";var d=XmlHelper.getRecords(g,"","tree");if(d.length>0){for(var h=0;h<d.length;h++){var a=new Array();var c=XmlHelper.getRecords(d[h],"","value");for(var f=0;f<c.length;f++){a[c[f].getAttribute("name")]=c[f].firstChild.nodeValue;}if(a.name){e+=PagloHelper.renderItem(a.name,"selectAsset",this.widgetId);}}this.contentRoot.down("div.asset").update(PagloHelper.getList("Select hardware asset:",e));this.contentRoot.down("div.software").update("");}else{this.contentRoot.down("div.asset").update("Nothing found");}},selectAsset:function(a){if(a!=""){$("ticket_fields_"+this.hardwareFieldId).value=a;$("ticket_fields_"+this.softwareFieldId).value="";this.getAsset(a);this.getSoftware(a);}},getSoftware:function(c){var d=PagloHelper.getSoftwareQuery(c);var e=PagloHelper.getDoc(this.apiKey,d);var a=PagloHelper.getURL(e);new Ajax.Request(a,{method:"post",requestHeaders:{Accept:"application/xml"},onSuccess:function(f){this.showSoftware(f.responseXML);}.bind(this),onFailure:function(){alert("Failed");}});},showSoftware:function(f){var d="";var j;var c=XmlHelper.getRecords(f,"","tree");if(c.length>0){this.contentRoot.down("div.software").update(PagloHelper.getSoftwareSelection(this.widgetId));j=this.contentRoot.down("select.software");j.appendChild(new Element("option"));for(var g=0;g<c.length;g++){var a=XmlHelper.getRecords(c[g],"","value");for(var e=0;e<a.length;e++){if(a[e].getAttribute("name")=="Name"){var h=new Element("option");h.value=a[e].firstChild.nodeValue;h.innerHTML=h.value;j.appendChild(h);}}}}else{this.contentRoot.down("div.software").update("");}},selectSoftware:function(a){$("ticket_fields_"+this.softwareFieldId).value=a;},getAsset:function(c){var d=PagloHelper.getAssetQuery(c);var e=PagloHelper.getDoc(this.apiKey,d);var a=PagloHelper.getURL(e);this.contentRoot.down("div.asset").update("Retrieving info...");new Ajax.Request(a,{method:"post",requestHeaders:{Accept:"application/xml"},onSuccess:function(f){this.contentRoot.down("div.asset").update(PagloHelper.renderAssetInfo(f.responseXML));}.bind(this),onFailure:function(){alert("Failed");}});}});var ContactologyHelper={GET_ACTIVE_LISTS:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://soapserver.emailcampaigns.net/1.1/" xmlns:types="http://soapserver.emailcampaigns.net/1.1/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <tns:GetActiveLists> <sortDir xsi:type="xsd:string">U</sortDir> <sortID xsi:type="xsd:string">Name</sortID> <startRecord xsi:type="xsd:int">0</startRecord> <pageSize xsi:type="xsd:int">0</pageSize> </tns:GetActiveLists> </soap:Body></soap:Envelope>'),GET_CONTACT_SUBSCRIPTIONS:new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://soapserver.emailcampaigns.net/1.1/" xmlns:types="http://soapserver.emailcampaigns.net/1.1/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <tns:GetContactSubscriptions> <email xsi:type="xsd:string">#{email}</email> </tns:GetContactSubscriptions> </soap:Body></soap:Envelope>'),SUBSCRIBE_TO_LIST:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://soapserver.emailcampaigns.net/1.1/" xmlns:types="http://soapserver.emailcampaigns.net/1.1/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <tns:SubscribeToList> <email xsi:type="xsd:string">#{email}</email> <listId xsi:type="xsd:int">#{id}</listId> </tns:SubscribeToList> </soap:Body></soap:Envelope>'),UNSUBSCRIBE_FROM_LIST:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://soapserver.emailcampaigns.net/1.1/" xmlns:types="http://soapserver.emailcampaigns.net/1.1/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <tns:UnsubscribeFromList> <email xsi:type="xsd:string">#{email}</email> <listId xsi:type="xsd:int">#{id}</listId> </tns:UnsubscribeFromList> </soap:Body></soap:Envelope>'),GET_CONTACT:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://soapserver.emailcampaigns.net/1.1/" xmlns:types="http://soapserver.emailcampaigns.net/1.1/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <tns:GetContactByEmail> <emailAddress xsi:type="xsd:string">#{email}</emailAddress> </tns:GetContactByEmail> </soap:Body></soap:Envelope>'),REACTIVATE:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://soapserver.emailcampaigns.net/1.1/" xmlns:types="http://soapserver.emailcampaigns.net/1.1/encodedTypes" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"> <tns:UpdateContact> <addressId xsi:type="xsd:int">#{id}</addressId> <emailAddress xsi:type="xsd:string" /> <status xsi:type="xsd:int">0</status> </tns:UpdateContact> </soap:Body></soap:Envelope>'),PROXY_URL:new Template("/proxy/direct?log=1&url=http://soapserver.emailcampaigns.net/1.1/index.php"),SOAP_ACTION:new Template("http://soapserver.emailcampaigns.net/1.1/index.php/#{action}"),getActiveListsRequest:function(){return ContactologyHelper.GET_ACTIVE_LISTS.evaluate({});},getContactSubscriptionsRequest:function(a){return ContactologyHelper.GET_CONTACT_SUBSCRIPTIONS.evaluate({email:a});},getSubscribeToListRequest:function(a,c){return ContactologyHelper.SUBSCRIBE_TO_LIST.evaluate({email:a,id:c});},getGetContactRequest:function(a){return ContactologyHelper.GET_CONTACT.evaluate({email:a});},getReactivateRequest:function(a){return ContactologyHelper.REACTIVATE.evaluate({id:a});},getUnsubscribeFromListRequest:function(a,c){return ContactologyHelper.UNSUBSCRIBE_FROM_LIST.evaluate({email:a,id:c});},getProxyURL:function(){return this.PROXY_URL.evaluate();},getSOAPAction:function(a){return this.SOAP_ACTION.evaluate({action:a});},STATUS_SECTION:new Template('<b>Status:</b><div class="contact_status">#{status}</div><br />'),LIST_SECTION:new Template("<b>#{header}</b><br />#{items}<br />"),LIST_ELEMENT:new Template('<input type="checkbox" style="vertical-align: top;" value="#{id}" #{checked} #{disabled} onClick="ObjectFactory.get(#{widgetId}).changeSubscription(this);"> #{name} <span class="sub">#{status}</span><br />'),REACTIVATE_LINK:new Template('<a href="javascript:ObjectFactory.get(#{widgetId}).reactivate();">Click to reactivate</a><br/><br/>'),renderView:function(h,a,f){var c="";var g=true;var d=XmlHelper.getRecords(h,"","item");if(a){e="NEW";}else{var e=ContactologyHelper.getStatus(h);g=(e=="GLOBALY_UNSUBSCRIBED"||e=="GLOBALLY_UNSUBSCRIBED"||e=="BOUNCED"||e=="DELETED")?false:true;}c+=ContactologyHelper.renderStatus(e,a);if(e=="BOUNCED"){c+=ContactologyHelper.REACTIVATE_LINK.evaluate({widgetId:f});}c+=ContactologyHelper.renderListsByType(d,"INTERNAL","Internal",a,f,g);c+=ContactologyHelper.renderListsByType(d,"PUBLIC","Public",a,f,g);c+=ContactologyHelper.renderListsByType(d,"PRIVATE","Private",a,f,g);return c;},renderListsByType:function(g,m,o,l,j,k){var d="";for(var h=0;h<g.length;h++){if(XmlHelper.getTextContentByKey(g[h],l?"type_label":"type").toUpperCase()==m){var a=XmlHelper.getTextContentByKey(g[h],l?"list_name":"name");var c=XmlHelper.getTextContentByKey(g[h],l?"list_id":"id");var f=l?"NONE":XmlHelper.getTextContentByKey(g[h],"subscription_status");var n="";var e="";if(f=="SUBSCRIBED"||f=="AWAITING_CONFIRMATION"){n="checked";}if(f=="AWAITING_CONFIRMATION"){e="pending";}d+=ContactologyHelper.LIST_ELEMENT.evaluate({name:a,id:c,checked:n,widgetId:j,status:e,disabled:(k?"":"DISABLED")});}}if(d>""){return ContactologyHelper.LIST_SECTION.evaluate({header:o,items:d});}else{return"";}},renderStatus:function(c,a){if(a){return ContactologyHelper.STATUS_SECTION.evaluate({status:"NEW"});}return ContactologyHelper.STATUS_SECTION.evaluate({status:c});},getStatus:function(d){var c=d.getElementsByTagName("return")[0];var a=XmlHelper.getTextContentByKey(c,"contact_status");return a;},errorFree:function(a){var c=a.getElementsByTagName("faultstring");return(c.length>0?false:true);}};
var ContactologyWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.widgetId=a.id;this.username=a.username;this.password=a.password;this.email=a.email;this.formInstance=null;this.contentRoot=this.containingElement().down("div.contactology-content"+this.widgetId);this.lastChange=null;this.contactId=null;this.startup();},startup:function(){if(this.email==null){this.contentRoot.update("No requester found");}else{this.getSubscriptions();}},getSubscriptions:function(d){var c="body="+ContactologyHelper.getContactSubscriptionsRequest(this.email);var a=ContactologyHelper.getProxyURL();new Ajax.Request(a,{method:"post",encoding:"",postBody:c,requestHeaders:{SOAPAction:ContactologyHelper.getSOAPAction("GetContactSubscriptions"),Authorization:"Basic "+Base64.encode(this.username+":"+this.password)},onSuccess:function(e){if(XmlHelper.getRecords(e.responseXML,"SOAP-ENV","Fault").length>0){this.getActiveLists();}else{if(d==this.lastChange){this.contentRoot.update(ContactologyHelper.renderView(e.responseXML,false,this.widgetId));}}}.bind(this),onFailure:function(){alert("Failed to lookup.");}.bind(this)});},getActiveLists:function(){var c="body="+ContactologyHelper.getActiveListsRequest();var a=ContactologyHelper.getProxyURL();new Ajax.Request(a,{method:"post",encoding:"",postBody:c,requestHeaders:{SOAPAction:ContactologyHelper.getSOAPAction("GetActiveLists"),Authorization:"Basic "+Base64.encode(this.username+":"+this.password)},onSuccess:function(d){this.contentRoot.update(ContactologyHelper.renderView(d.responseXML,true,this.widgetId));}.bind(this),onFailure:function(){alert("Failed to lookup.");}.bind(this)});},changeSubscription:function(d){var f="";var e="";var c=d.checked;d.disabled=true;this.lastChange=d.value;if(c){f="body="+ContactologyHelper.SUBSCRIBE_TO_LIST.evaluate({email:this.email,id:d.value});e="SubscribeToList";}else{f="body="+ContactologyHelper.UNSUBSCRIBE_FROM_LIST.evaluate({email:this.email,id:d.value});e="UnsubscribeFromList";}var a=ContactologyHelper.getProxyURL();this.showStatus("UPDATING...");new Ajax.Request(a,{method:"post",encoding:"",postBody:f,requestHeaders:{SOAPAction:ContactologyHelper.getSOAPAction(e),Authorization:"Basic "+Base64.encode(this.username+":"+this.password)},onSuccess:function(g){if(ContactologyHelper.errorFree(g.responseXML)){if(XmlHelper.getTextContentByKey(g.responseXML,"return")!=1){}if(this.lastChange==d.value){this.getSubscriptions(d.value);}}else{this.changeFailed(d,c);return;}}.bind(this),onFailure:function(){alert("Failure!");this.changeFailed(d,c);}.bind(this)});},reactivate:function(){var a="body="+ContactologyHelper.getGetContactRequest(this.email);this.showStatus("UPDATING...");new Ajax.Request(ContactologyHelper.getProxyURL(),{method:"post",encoding:"",postBody:a,requestHeaders:{SOAPAction:ContactologyHelper.getSOAPAction("GetContactByEmail"),Authorization:"Basic "+Base64.encode(this.username+":"+this.password)},onSuccess:function(f){var c=f.responseXML.getElementsByTagName("return")[0];var e=XmlHelper.getTextContentByKey(c,"ID");var d="body="+ContactologyHelper.getReactivateRequest(e);new Ajax.Request(ContactologyHelper.getProxyURL(),{method:"post",encoding:"",postBody:d,requestHeaders:{SOAPAction:ContactologyHelper.getSOAPAction("UpdateContact"),Authorization:"Basic "+Base64.encode(this.username+":"+this.password)},onSuccess:function(g){this.lastChange=null;this.getSubscriptions(null);}.bind(this),onFailure:function(){this.refreshStatus();alert("Failed to reactivate");}.bind(this)});}.bind(this),onFailure:function(){this.showStatus("UNKNOWN");alert("Failed to reactivate");}.bind(this)});},showStatus:function(a){this.containingElement().down("div.contact_status").update(a);},refreshStatus:function(){var a="body="+ContactologyHelper.getGetContactRequest(this.email);new Ajax.Request(ContactologyHelper.getProxyURL(),{method:"post",encoding:"",postBody:a,requestHeaders:{SOAPAction:ContactologyHelper.getSOAPAction("GetContactByEmail"),Authorization:"Basic "+Base64.encode(this.username+":"+this.password)},onSuccess:function(e){var d=e.responseXML.getElementsByTagName("return")[0];var c=XmlHelper.getTextContentByKey(d,"StatusLabel");this.showStatus(c.toUpperCase());}.bind(this),onFailure:function(){this.showStatus("ERROR");}.bind(this)});},changeFailed:function(c,a){alert("Failed to change subscription.");c.checked=!a;c.disabled=false;this.refreshStatus();}});
var ScreenStepsLiveWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.widgetId=a.id;this.anchor=a.anchor;this.domainname=a.domainname;this.username=a.username;this.password=a.password;this.use_ssl=a.use_ssl;this.space_id=a.space_id;this.ticket_id=a.ticket_id;this.include_login_in_url=a.include_login_in_url;this.screenstepslive_resource=new Zendesk.Resource({anchor:this.anchor,domain:this.domainname||"",user:this.username||"",pass:this.password||"",use_ssl:this.use_ssl||"false",space_id:this.space_id||null,include_login_in_url:this.include_login_in_url||false,enable_resource_cache:"false",show_logout:false,login_content:this.application.bind(this),application_content:this.application.bind(this),application_resources:[{resource:"spaces",media_type:"application/xml",on_success:this.spaces_selector.bind(this)}]});},application:function(){text='<form id="lookup-form" onsubmit="disable_submit($(\'lookup-form\')); ObjectFactory.get('+this.id+').lookup(); return false;">';if(this.space_id==""||this.space_id==null){text+='<label style="width:50px;display:block;">Space: </label><select style="margin-bottom:5px;width:175px;" name="request[space_id]" id="screenstepslive-form-spaces"></select><br />';}else{text+='<input type="hidden" name="request[space_id]" id="screenstepslive-form-spaces" value="'+this.space_id+'">';}text+='<label style="width:50px;display:block;">Search: </label><input type="text" style="margin:5px 5px 5px 0;width:175px;" name="request[text]" id="sslive_search_text"/><br /><input type="submit" value="Submit" id="submit">';text+='</form><div id="screensteps_live_results"></div>';return text;},lookup:function(){text=$F("sslive_search_text");space_id=$F("screenstepslive-form-spaces");space_selected_index=$("screenstepslive-form-spaces").selectedIndex;resource="spaces/"+$F("screenstepslive-form-spaces")+"/searches.xml?text="+escape(text);this.screenstepslive_resource.request({resource:resource,on_success:this.search_results.bind(this)});enable_submit($("lookup-form"));if(this.space_id==null){$("screenstepslive-form-spaces").selectedIndex=space_selected_index;}$("sslive_search_text").value=text;},format_lesson_url:function(a){if(this.include_login_in_url==true){a+="?login="+this.screenstepslive_resource.options.user+"&password="+this.screenstepslive_resource.options.pass;return a;}else{return a;}},register_events:function(){var a=$$(".sslive_lesson ul.drop-list").each(function(c){document.observe("click",function(d){if(!d.findElement().descendantOf(c)){c.select(".title").each(function(e){e.style.zIndex="0";});c.select(".action-menu").each(function(e){e.style.display="none";e.style.zIndex="0";});}});c.observe("click",function(d){title_container=c.select(".title-container")[0];title=c.select(".title")[0];menu=c.select(".action-menu")[0];title.style.zIndex="26";menu.style.display="block";menu.style.zIndex="25";});});},render_lesson_results:function(a){result="<h5>"+a.length+" matching lessons found. Click on a lesson to view it</h5>";result+="<ul>";result+=a.collect(function(c){return"<li><b>"+c.asset.title+':</b><br /><div class="sslive_lesson"><ul class="drop-list" style="position: relative"><li><div class="title-container"><span class="drop link title" id="" style="cursor:default; z-index:20">'+c.title+'</span></div><ul class="rounded-4 action-menu" style="width: 100%; margin-left:-160px;"><li class="ticket_link link" onclick="$$(\'#comment_value\')[0].value += \''+this.format_lesson_url(c.url)+'\'; this.up().style.display=\'none\'; Event.stop(event);">Copy link to ticket</li><li id="" class="window_link link" onclick="window.open(\''+this.format_lesson_url(c.url)+"', 'new'); this.up().style.display='none'; Event.stop(event);\">Open in new window</li></ul></li></ul></div>";}.bind(this)).join("</li>");result+="</ul>";return result;},search_results:function(a){result_field=$("screensteps_live_results");result_field.innerHTML="";lessons=$A(a.lessons);if(lessons.length>0){result=this.render_lesson_results(lessons);}else{result="No results";}result_field.innerHTML=result;this.register_events();},spaces_selector:function(a){if(this.space_id==""||this.space_id==null){var c=$("screenstepslive-form-spaces");c.innerHTML="";spaces=$A(a.spaces);spaces.each(function(e){var d=document.createElement("option");d.value=e.id;d.innerHTML=e.title;c.appendChild(d);});}}});
var ScreenStepsLiveTasksWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.widgetId=a.id;this.anchor=a.anchor;this.domainname=a.domainname;this.username=a.username;this.password=a.password;this.use_ssl=a.use_ssl;this.space_id=a.space_id;this.ticket_id=a.ticket_id;this.screenstepslive_tasks_resource=new Zendesk.Resource({anchor:this.anchor,domain:this.domainname||"",user:this.username||"",pass:this.password||"",use_ssl:this.use_ssl||"false",space_id:this.space_id||null,enable_resource_cache:"false",show_logout:false,login_content:this.application.bind(this),application_content:this.application.bind(this),application_resources:[{resource:"spaces/api",media_type:"application/xml",on_success:this.spaces_selector.bind(this)}]});},application:function(){text='<form id="screensteps-live-task-form" onsubmit="if (ObjectFactory.get('+this.id+").validate_sslive_form() == true) {alert('Please enter a valid value for title'); return false;}; ObjectFactory.get("+this.id+").setup_task_form(); ObjectFactory.get("+this.id+').screenstepslive_tasks_resource.submit_data(this); return false;" class="form">';if(this.space_id==""||this.space_id==null){text+='<label style="width:50px;display:block;">Space: </label><select style="margin-bottom:5px;width:175px;" name="task[space_id]" id="screenstepslive-task-form-spaces"></select><br />';}else{text+='<input type="hidden" name="task[space_id]" id="screenstepslive-task-form-spaces" value="'+this.space_id+'">';}text+='<label>Title</label><input type="text" id="task_title" style="width:175px;" name="task[title]"/><label>Description</label><textarea rows="3" id="task_description" style="width:175px;" name="task[description]"></textarea><input type="hidden" name="pluck_param" value="task"><input type="hidden" id="task_resource" name="resource" value=""><input type="hidden" name="media_type" value="application/xml"><input type="hidden" name="event_reference" value="ScreenSteps Live Task Created"><input type="hidden" name="event_log" value="Title,Description,ID"><input type="submit" value="Submit" id="submit"></form>';return text;},validate_sslive_form:function(){var a=document.getElementById("task_title").value;if(a==""||a==null){return true;}else{return false;}},setup_task_form:function(){if(this.ticket_id!=null){$("task_description").value+=("\n\n"+location.href);}$("task_resource").value="spaces/"+$F("screenstepslive-task-form-spaces")+"/tasks";return false;},spaces_selector:function(a){if(this.space_id==""||this.space_id==null){var c=$("screenstepslive-task-form-spaces");c.innerHTML="";spaces=$A(a.spaces);spaces.each(function(e){var d=document.createElement("option");d.value=e.id;d.innerHTML=e.title;c.appendChild(d);});}}});
var WidgetManagerWidget=Class.create({initialize:function(){widgetManager=this;Widget.redraw();},widgets:function(){return $j("#sidebar div.widget").not("#preview-output .widget").map(function(a,c){var d=(""+$j(c).prop("id")).replace(/^widget_/,"");return ObjectFactory.get(d);}).toArray();},show:function(){$j("#add_widget_select_widget").show();$j("#add_widget_button").hide();this.widgets().each(function(a){a.showControls();a.containingElement().title="You can drag and drop widgets to rearrange them";});$j("#widget_fixed").addClass("widget_edit_mode");$j("#sidebar").sortable({items:"div.draggable"}).bind("sortupdate",this.updateOrder);Widget.redraw();},hide:function(){$j("#add_widget_button").show();$j("#add_widget_select_widget").hide();this.widgets().each(function(a){a.hideControls();a.containingElement().title="";});$j("#widget_fixed").removeClass("widget_edit_mode");$j("#sidebar").sortable("destroy");Widget.redraw();},updateOrder:function(d,e){var c=_($j(d.target).sortable("toArray")).map(function(f){f=(""+f).replace(/^widget_/,"");return f==="fixed"?"fixed":ObjectFactory.get(f).locationId;});if(c.length>0){var a="/widgets/reorder_locations?_method=put";_(c).each(function(f){a+="&locations[]="+f;});$j.ajax(a,{type:"POST"});}},addWidgetToPage:function(d,a,c){new Ajax.Request("/widgets/"+c+"/add_to_page",{method:"post",parameters:{controller_name:d,action_name:a}});},removeWidgetFromPage:function(d,a,c){new Ajax.Request("/widgets/"+c+"/remove_from_page",{method:"delete",parameters:{controller_name:d,action_name:a}});},removeWidget:function(a){var c=ObjectFactory.get(a);c.hide(c.destroy.bind(c));ObjectFactory.remove(a);$("add_widget_"+a).show();},displayNewWidget:function(){$("widget_manager_widget").insert({before:"hello"});}});var widgetManager=null;
var BatchBookHelper=Class.create();BatchBookHelper.getNodeValue=function(a,d){var c=a.getElementsByTagName(d);if(c==null||c.length==0||c[0].childNodes.length==0){return null;}return c[0].childNodes[0].nodeValue;};BatchBookHelper.getNodeString=function(a,d){var c=this.getNodeValue(a,d);if(c==null){return"";}else{return c;}};BatchBookHelper.getArrayByTagName=function(d,a){var c=a.getElementsByTagName(d);if(c==null){return new Array();}return c;};BatchBookHelper.getRecords=BatchBookHelper.getArrayByTagName.curry("person");BatchBookHelper.getLocations=BatchBookHelper.getArrayByTagName.curry("location");
var BatchBookQuery=Class.create();BatchBookQuery.SERVER_URL=new Template("https://#{account_name}.batchbook.com/service/people.xml?email=#{email}");BatchBookQuery.PROXY_URL=new Template("/proxy/direct.xml?&url=#{server_url}");BatchBookQuery.CONTACT_URL=new Template("https://#{account_name}.batchbook.com/contacts/show/#{record_id}");BatchBookQuery.buildUrl=function(d,c){var a=this.SERVER_URL.evaluate({account_name:d,email:c});var e=this.PROXY_URL.evaluate({server_url:escape(a)});return e;};
var BatchBookWidgetView=Class.create();BatchBookWidgetView.HEADLINE_TEMPLATE=new Template('<h4 style="font-size: 16px"><a href="#{contact_url}" target="_new">#{first_name} #{last_name}</a></h4>');BatchBookWidgetView.LOCATION_TEMPLATE=new Template("<h5>#{label}</h5>#{items}");BatchBookWidgetView.LOCATION_ADDRESS_TEMPLATE=new Template('<span class="sub">#{item_label}</span><br />#{item_value}<br />');BatchBookWidgetView.LOCATION_ITEM_TEMPLATE=new Template('#{item_value} <span class="sub">#{item_label}</span><br />');BatchBookWidgetView.ADDRESS_TEMPLATE=new Template('#{street_1}</h5><p class="minimal">#{items}</p>');BatchBookWidgetView.renderLine=function(a,f,e){var c="";for(var d=0;d<f.length;d++){c+=BatchBookHelper.getNodeString(a,f[d]);if(c!=""){c+=" ";}}if(c!=""){return e.evaluate({output:c});}else{return"";}};BatchBookWidgetView.renderAddress=function(d){var j=BatchBookHelper.getNodeString(d,"street_1");var g=BatchBookHelper.getNodeString(d,"street_2");var h=BatchBookHelper.getNodeString(d,"city");var f=BatchBookHelper.getNodeString(d,"state");var e=BatchBookHelper.getNodeString(d,"postal_code");var k=BatchBookHelper.getNodeString(d,"country");var c="";if(j!=""){c+=j+"<br />";}if(g!=""){c+=g+"<br />";}if(h!=""){c+=h;if(f!=""||e!=""){c+=", ";}}if(f!=""||e!=""){c+=f;if(e!=""){c+=" ";}}if(h!=""||f!=""||e!=""){c+=e+"<br />";}if(k!=""){c+=k;}return c;};BatchBookWidgetView.renderRecord=function(h,q){var u="";var o=BatchBookHelper.getNodeString(h,"id");var m=BatchBookHelper.getNodeString(h,"first_name");var s=BatchBookHelper.getNodeString(h,"last_name");var r=BatchBookWidgetView.contact_url(o,q);u+=BatchBookWidgetView.HEADLINE_TEMPLATE.evaluate({contact_url:r,first_name:m,last_name:s});u+=this.renderLine(h,["title"],new Template("<p class='minimum'>#{output}</p>"));u+=this.renderLine(h,["company"],new Template("<p class='minimum'>#{output}</p>"));var n=BatchBookHelper.getLocations(h);var k={address:"",email:"",website:"",phone:"",cell:"",fax:""};var a=["address","email","website","phone","cell","fax"];for(var g=0;g<n.length;g++){var d=n[g];var f=$j(d).find("label").text();for(var e=0;e<a.length;e++){var p=a[e];var c="";if(p=="address"){c=this.renderAddress(d);}else{c=BatchBookHelper.getNodeString(d,p);}if(c!=""){if(p=="address"){if(k[p]){k[p]+="<br />";}k[p]+=BatchBookWidgetView.LOCATION_ADDRESS_TEMPLATE.evaluate({item_label:f,item_value:c});}else{k[p]+=BatchBookWidgetView.LOCATION_ITEM_TEMPLATE.evaluate({item_label:f,item_value:c});}}}}for(var e=0;e<a.length;e++){var p=a[e];if(k[p]!=""){u+=BatchBookWidgetView.LOCATION_TEMPLATE.evaluate({label:p,items:k[p]});}}return u+"<br />";};BatchBookWidgetView.contact_url=function(c,a){return BatchBookQuery.CONTACT_URL.evaluate({record_id:c,account_name:a});};
var BatchBookWidget=Class.create(Widget,{lookup:function(c){$j("#batchbooks-widget-spinner").show();if(this.accountName!=null&&this.token!=null){var a=BatchBookQuery.buildUrl(this.accountName,c.email.value);new Ajax.Request(a,{method:"get",requestHeaders:{Authorization:"Basic "+Base64.encode(this.token+":x")},onSuccess:function(d){this.displayResult(d.responseXML);$j("#batchbooks-widget-spinner").hide();}.bind(this),onFailure:function(){$(this.contentRoot).update("<h5>Unable to search your BatchBook account at this time. Please try again later.</h5>");}.bind(this)});}else{$(this.contentRoot).update("<h5>BatchBook login failed - BatchBook account needs configuration.</h5>");}},displayResult:function(d){var c=BatchBookHelper.getRecords(d);if(c.length==0){$(this.contentRoot).update("<h5>No match found in your BatchBook account.</h5>");return;}else{var a=BatchBookWidgetView.renderRecord(c[0],this.accountName);$(this.contentRoot).update(a);}},initialize:function($super,a){$super(a);this.token=a.token;this.formInstance=null;this.widgetId=a.id;this.isEmpty=a.isEmpty;this.accountName=a.accountName;this.requesterEmail=a.requester_email;this.contentRoot=this.containingElement().down("div.batchbook-content-"+this.widgetId);}});
var CustomCalendarDateSelect=Class.create(CalendarDateSelect,{updateValue:function($super){$super();var f=this.selected_date;var a=f.getDate()<10?("0"+f.getDate()):f.getDate();var c=(f.getMonth()+1)<10?("0"+parseInt(f.getMonth()+1)):parseInt(f.getMonth()+1);var e=c+"/"+a+"/"+f.getFullYear();this.target_element.value=e;},parseDate:function($super){var a=$F(this.target_element).strip();$super();if(this.selection_made){this.selected_date.setFullYear(a.split("/")[2],parseInt(a.split("/")[0])-1,parseInt(a.split("/")[1]));this.date=this.selected_date;}}});var clarizenWidgetUnicodeConverter={convertChar2CP:function(d){var c=0;var g=0;var f="";for(var e=0;e<d.length;e++){var a=d.charCodeAt(e);if(a<0||a>65535){f+="Error "+this.dec2hex(a)+"!";}if(c!==0){if(56320<=a&&a<=57343){f+=this.dec2hex(65536+((c-55296)<<10)+(a-56320))+" ";c=0;continue;}else{f+="!erreur "+this.dec2hex(c)+"!";c=0;}}if(55296<=a&&a<=56319){c=a;}else{f+=this.dec2hex(a)+" ";}}f=f.substring(0,f.length-1);return this.convertCP2HexNCR(f);},convertCP2HexNCR:function(a){var e="";a=a.replace(/^\s+/,"");if(a.length===0){return"";}a=a.replace(/\s+/g," ");var d=a.split(" ");for(var c=0;c<d.length;c++){var f=parseInt(d[c],16);e+="&#x"+this.dec2hex(f)+";";}return(e);},dec2hex:function(a){return(a+0).toString(16).toUpperCase();}};var clarizenWidgetHelper={PARTNER_ID:"baa861be-8460-4de8-b678-56f915b6be43",SERVICE_URL:"https://api.clarizen.com/v1.0/Clarizen.svc",LOGIN_URL:"http://clarizen.com/api/IClarizen/Login",QUERY_URL:"http://clarizen.com/api/IClarizen/Query",EXECUTE_URL:"http://clarizen.com/api/IClarizen/Execute",WIDGET_ID:"clarizenWidget",IMAGE_PATH:"/images/widgets/clarizen/",PRIORITY_MAPPING:{1:"Low",2:"Medium",3:"High",4:"Critical"},GET_CLARIZEN_USER_PROFILE:new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Query xmlns="http://clarizen.com/api"> <queryExpression xmlns:q1="http://clarizen.com/api/queries" xsi:type="q1:EntityQuery"> <q1:Paging xsi:nil="true" /> <q1:Fields /> <q1:Orders xsi:nil="true" /> <q1:TypeName>User</q1:TypeName> <q1:Where xsi:type="q1:And"> <q1:Conditions> <Condition xsi:type="q1:Compare"> <q1:LeftExpression xsi:type="q1:FieldExpression"> <q1:FieldName>Email</q1:FieldName> </q1:LeftExpression> <q1:Operator>Equal</q1:Operator> <q1:RightExpression xsi:type="q1:ConstantExpression"> <q1:Value xsi:type="xsd:string">#{email}</q1:Value> </q1:RightExpression> </Condition> <Condition xsi:type="q1:Compare"> <q1:LeftExpression xsi:type="q1:FieldExpression"> <q1:FieldName>FirstName</q1:FieldName> </q1:LeftExpression> <q1:Operator>Equal</q1:Operator> <q1:RightExpression xsi:type="q1:ConstantExpression"> <q1:Value xsi:type="xsd:string">#{firstName}</q1:Value> </q1:RightExpression> </Condition> <Condition xsi:type="q1:Compare"> <q1:LeftExpression xsi:type="q1:FieldExpression"> <q1:FieldName>LastName</q1:FieldName> </q1:LeftExpression> <q1:Operator>Equal</q1:Operator> <q1:RightExpression xsi:type="q1:ConstantExpression"> <q1:Value xsi:type="xsd:string">#{lastName}</q1:Value> </q1:RightExpression> </Condition> </q1:Conditions> </q1:Where> </queryExpression> </Query> </soap:Body></soap:Envelope>'),GET_SYSTEM_SETTINGS:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Execute xmlns="http://clarizen.com/api"> <request> <BaseMessage xmlns:q1="http://clarizen.com/api/metadata" xsi:type="q1:GetSystemSettingsValuesMessage"> <q1:Settings> <string>Enable issue management</string> <string>Enable bug tracking</string> <string>Enable requests for enhancements</string> <string>Enable risk management</string> </q1:Settings> </BaseMessage> </request> </Execute> </soap:Body></soap:Envelope>'),UNLINK_ISSUE:new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Execute xmlns="http://clarizen.com/api"> <request> <BaseMessage xsi:type="UpdateMessage"> <Entity xsi:type="GenericEntity"> <Id> <TypeName>Issue</TypeName> <Value>#{IssueId}</Value> </Id> <Values> <FieldValue> <FieldName>ZdExternalId</FieldName> <Value xsi:type="xsd:string"></Value> </FieldValue> </Values> </Entity> </BaseMessage> </request> </Execute> </soap:Body> </soap:Envelope>'),GET_EXTERNAL_ID_BY_TICKET_ID:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body><Execute xmlns="http://clarizen.com/api"> <request> <BaseMessage xmlns:q1="http://clarizen.com/api/queries" xsi:type="q1:EntityQuery"> <q1:Paging xsi:nil="true" /> <q1:Fields /> <q1:Orders xsi:nil="true" /> <q1:TypeName>Issue</q1:TypeName> <q1:Where xsi:type="q1:Compare"> <q1:LeftExpression xsi:type="q1:FieldExpression"> <q1:FieldName>ZdExternalId</q1:FieldName> </q1:LeftExpression> <q1:Operator>Equal</q1:Operator> <q1:RightExpression xsi:type="q1:ConstantExpression"> <q1:Value xsi:type="xsd:string">#{ticketId}</q1:Value> </q1:RightExpression> </q1:Where> </BaseMessage> <BaseMessage xmlns:q1="http://clarizen.com/api/queries" xsi:type="q1:EntityQuery"> <q1:Paging xsi:nil="true" /> <q1:Fields /> <q1:Orders xsi:nil="true" /> <q1:TypeName>Bug</q1:TypeName> <q1:Where xsi:type="q1:Compare"> <q1:LeftExpression xsi:type="q1:FieldExpression"> <q1:FieldName>ZdExternalId</q1:FieldName> </q1:LeftExpression> <q1:Operator>Equal</q1:Operator> <q1:RightExpression xsi:type="q1:ConstantExpression"> <q1:Value xsi:type="xsd:string">#{ticketId}</q1:Value> </q1:RightExpression> </q1:Where> </BaseMessage> </request></Execute> </soap:Body></soap:Envelope>'),UPDATE_ISSUE:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Execute xmlns="http://clarizen.com/api"> <request> <BaseMessage xsi:type="LifecycleMessage"> <Ids> <EntityId> <TypeName>#{entity}</TypeName> <Value>#{issueId}</Value> </EntityId> </Ids> <Operation>#{operation}</Operation> </BaseMessage> <BaseMessage xsi:type="CreateMessage"> <Entity xsi:type="GenericEntity"> <Id> <TypeName>IssueTeamMembers</TypeName> <Value xsi:nil="true" /> </Id> <Values> <FieldValue> <FieldName>Case</FieldName> <Value xsi:type="EntityId"> <TypeName>#{entity}</TypeName> <Value>#{issueId}</Value> </Value> </FieldValue> <FieldValue> <FieldName>TeamMember</FieldName> <Value xsi:type="EntityId"> <TypeName>User</TypeName> <Value>#{creatorId}</Value> </Value> </FieldValue> </Values> </Entity> </BaseMessage> </request> </Execute> </soap:Body></soap:Envelope>'),DUE_DATE:new Template('<FieldValue> <FieldName>DueDate</FieldName> <Value xsi:type="xsd:dateTime">#{dueDate}</Value></FieldValue>'),PROJECT_ID:new Template('<FieldValue> <FieldName>PlannedFor</FieldName> <Value xsi:type="EntityId"> <TypeName>Project</TypeName> <Value>#{projectId}</Value> </Value></FieldValue>'),SUBMIT_ISSUE:new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Execute xmlns="http://clarizen.com/api"> <request> <BaseMessage xsi:type="CreateMessage"> <Entity xsi:type="GenericEntity"> <Id> <TypeName>#{entity}</TypeName> </Id> <Values> <FieldValue> <FieldName>Title</FieldName> <Value xsi:type="xsd:string">#{title}</Value> </FieldValue> <FieldValue> <FieldName>Description</FieldName> <Value xsi:type="xsd:string">#{description}</Value> </FieldValue> #{dueDateTemplate} <FieldValue> <FieldName>Severity</FieldName> <Value xsi:type="EntityId"> <TypeName>Severity</TypeName> <Value>#{severity}</Value> </Value> </FieldValue> <FieldValue> <FieldName>AssignedTo</FieldName> <Value xsi:type="EntityId"> <TypeName>User</TypeName> <Value>#{userId}</Value> </Value> </FieldValue> <FieldValue> <FieldName>Owner</FieldName> <Value xsi:type="EntityId"> <TypeName>User</TypeName> <Value>#{ownerId}</Value> </Value> </FieldValue> #{projectTemplate} <FieldValue> <FieldName>ZdExternalId</FieldName> <Value xsi:type="xsd:string">#{ticketId}</Value> </FieldValue> </Values> </Entity> </BaseMessage> </request> </Execute> </soap:Body> </soap:Envelope>'),GET_PROJECTS:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Query xmlns="http://clarizen.com/api"> <queryExpression xmlns:q1="http://clarizen.com/api/queries" xsi:type="q1:EntityQuery"> <q1:Paging xsi:nil="true" /> <q1:Fields> <string>Name</string> </q1:Fields> <q1:Orders xsi:nil="true" /> <q1:TypeName>Project</q1:TypeName> <q1:Where xsi:nil="true" /> </queryExpression> </Query> </soap:Body></soap:Envelope>'),GET_ASSIGNEES:new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Query xmlns="http://clarizen.com/api"> <queryExpression xmlns:q1="http://clarizen.com/api/queries" xsi:type="q1:EntityQuery"> <q1:Paging xsi:nil="true" /> <q1:Fields> <string>FirstName</string> <string>LastName</string> <string>Email</string> </q1:Fields> <q1:Orders> <q1:OrderBy> <q1:FieldName>DisplayName</q1:FieldName> </q1:OrderBy> </q1:Orders> <q1:TypeName>User</q1:TypeName> <q1:Where xsi:type="q1:Compare"> <q1:LeftExpression xsi:type="q1:FieldExpression"> <q1:FieldName>State</q1:FieldName> </q1:LeftExpression> <q1:Operator>NotEqual</q1:Operator> <q1:RightExpression xsi:type="q1:ConstantExpression"> <q1:Value xsi:type="EntityId"> <TypeName>State</TypeName> <Value>Deleted</Value> </q1:Value> </q1:RightExpression> </q1:Where> </queryExpression> </Query> </soap:Body></soap:Envelope>'),GET_SESSION:new Template('<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Body> <Login xmlns="http://clarizen.com/api"> <userName>#{username}</userName> <password>#{password}</password> <options xsi:type="ExtendedLoginOptions"> <ApplicationId>ClarizenClient</ApplicationId> <PartnerId>#{partnerId}</PartnerId> <ClientVersion>1.0</ClientVersion> </options> </Login> </soap:Body></soap:Envelope>'),ISSUE_INLINE_UPDATES:new Template('<div style="padding-bottom:5px; width:85px; float:left;"><strong>Issue number:</strong></div><div style="float: left;">#{sysId}</div><div style="clear:both;"></div><div><strong>Title:</strong></div><div style="padding-bottom:5px;"><span title="#{fullticketTitle}">#{ticketTitle}</span></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>State:</strong></div><div style="float: left;">#{state}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Severity:</strong></div><div style="float: left;">#{severity}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Due Date:</strong></div><div style="float: left;">#{date}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Assigned To:</strong></div><div style="float: left;">#{assignedTo}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Owner:</strong></div><div style="float: left;">#{owner}</div><div style="clear:both;"></div>#{projectTemplate}'),PROJECT_ISSUE_TEMPLATE:new Template('<div><strong>To be Resolved In:</strong></div><span title="#{fullProjectName}">#{projectName}</span>'),SEND_MAIL_TEMPLATE:new Template("<a href=\"mailto:#{mailAsigneeEmail}?subject=%20[zendesk]%20Message%20regarding%20ticket%20'#{mailTitle}'%20(#{mailTicketId})&cc=#{mailOwnerEmail}\">Send email</a>"),DISPLAY_ISSUE_FORM:new Template('<div id="issue-details" style="padding:3px;width:100%;overflow:hidden;"><div style="padding-bottom:5px; width:85px; float:left;"><strong>Issue number:</strong></div><div><div style="float: left;">#{sysId}</div><div style="clear:both;"></div><div><strong>Title:</strong></div><div style="padding-bottom:5px;"><span title="#{fullticketTitle}">#{ticketTitle}</span></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>State:</strong></div><div style="float: left;">#{state}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Severity:</strong></div><div style="float: left;">#{severity}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Due Date:</strong></div><div><div style="float: left;">#{date}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Assigned To:</strong></div><div style="float: left;">#{assignedTo}</div><div style="clear:both;"></div><div style="padding-bottom:5px; width:85px; float:left;"><strong>Owner:</strong></div><div style="float: left;">#{owner}</div><div style="clear:both;"></div>#{projectTemplate}</div><div style="text-align:center;padding-top:5px;"><!--<a onclick="clarizenWidget.unLinkIssue(false);" href="javascript:void(0);">unlink</a> |--> <a onclick="ObjectFactory.get(#{widgetId}).getIssueFromClarizen(false);" href="#">Refresh</a> | #{mailTemplate}</div></div>'),SUBMIT_FORM:new Template('<div style="display:none;"><div id="clarizen-modal-popup" class="frame" style="width:400px;margin:-15px;padding:20px;border-width:10px;"><form class="form" id="clarizen-form" style="margin-bottom:30px;"><div style="float:left;padding-right:10px;">#{logoImage}</div><div style="font-size:16px;padding-top:10px;">Create issue in Clarizen</div><div style="clear:both;"></div><div class="select" style="padding-top:5px"><label style="display:inline;padding-right:70px;">Subject:</label><input type="text" value="" size="30" id="clarizenTitle" style="width:75%;" class="clarizenTitle"/></div><div class="select" style="padding-bottom:5px;padding-top:5px;"><label style="float:left;padding-right:50px;">Description:</label><textarea rows="4" id="clarizenDescription" class="clarizenDescription" style="width:75%;" ></textarea><div style="clear:both;"></div></div><div style="padding-bottom: 5px"><div style="width:120px; float: left;"><label style="margin-top: 0px;">Clarizen priority:</label></div><div style="float:left;"><select id="clarizenSeveritySelector" class="clarizenSeveritySelector" style="width:215px;padding-left:10px;max-width:215px;"> <option value="Critical">Urgent</option> <option value="High">High</option> <option value="Low">Low</option> <option selected="selected" value="Medium">Normal</option></select></div><div style="clear:both"></div></div><div style="padding-bottom: 5px"><div style="width:120px; float: left;"><label style="margin-top: 0px;">To be resolved In:</label></div><div style="float:left;"><select id="clarizenProjectSelector" disabled class="clarizenProjectSelector" style="width:215px;padding-left:10px;max-width:215px;"></select></div><div style="clear:both"></div></div><div style="padding-bottom: 5px"><div style="width:120px; float: left;"><label style="margin-top: 0px;">Assigned To:</label></div><div style="float:left;"><select id="clarizenAssigneeSelecter" disabled class="clarizenAssigneeSelecter" style="width:215px;padding-left:10px;max-width:215px;"></select></div><div style="clear:both"></div></div><div style="width:120px; float: left;"><label style="margin-top: 0px;">Due Date:</label></div><div style="float:left;"><input type="text" value="" size="10" id="dueDate" class="dueDate" /><img alt="Calendar" class="calendar_date_select_popup_icon" onclick="new CustomCalendarDateSelect( $(this).previous(), {buttons:false, popup:\'force\', time:false, year_range:10} ); $$(\'.calendar_date_select\')[0].setStyle({\'zIndex\':\'10010\'}); " src="http://asset0.zendesk.com/images/calendar_date_select/calendar.gif?1264325148" style="border:0px; cursor:pointer;" /></div><div style="float:right;"><input type="button" value="Submit" onclick="ObjectFactory.get(#{widgetId}).submitIssueForm($(\'clarizen-form\'));" class="buttonsubmit" /><input type="button" value="Cancel" onclick="ObjectFactory.get(#{widgetId}).closeForm();" class="buttonsubmit" /></div></form></div></div>'),SHOW_AVAILABILITY_LINK:new Template('<div id="availabilityLnk" style="text-align:center;padding-top:10px;padding-bottom:10px;"> <a target="_blank" href="#">Show Availability</a></div>'),TICKET_RESOLUTION:new Template('<div class="clarizen_message">You can create a request for resolution of the ticket in Clarizen<div style="text-align:center;padding-top:10px;padding-bottom:10px;"> <a onclick="ObjectFactory.get(#{widgetId}).showForm();" href="#">Request ticket resolution</a></div></div>'),PROXY_URL:new Template("/proxy/direct?url=#{url}&log=1"),CREATE_USER:new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Execute xmlns="http://clarizen.com/api"> <request> <BaseMessage xsi:type="CreateMessage"> <Entity xsi:type="GenericEntity"> <Id> <TypeName>User</TypeName> </Id> <Values> <FieldValue> <FieldName>FirstName</FieldName> <Value xsi:type="xsd:string">#{firstName}</Value> </FieldValue> <FieldValue> <FieldName>LastName</FieldName> <Value xsi:type="xsd:string">#{lastName}</Value> </FieldValue> <FieldValue> <FieldName>Email</FieldName> <Value xsi:type="xsd:string">#{email}</Value> </FieldValue> <FieldValue> <FieldName>AllowEmails</FieldName> <Value i:type="b:boolean" xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns:b="http://www.w3.org/2001/XMLSchema">true</Value> </FieldValue> <FieldValue> <FieldName>SendInvitationMail</FieldName> <Value xsi:type="xsd:boolean">#{sendInvitationMail}</Value> </FieldValue> </Values> </Entity> </BaseMessage> </request> </Execute> </soap:Body> </soap:Envelope>'),GET_ISSUE_QUERY:new Template('<?xml version="1.0" encoding="utf-8"?> <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"> <soap:Header> <Session xmlns="http://clarizen.com/api"> <ID>#{sessionId}</ID> </Session> </soap:Header> <soap:Body> <Execute xmlns="http://clarizen.com/api"> <request> <BaseMessage xsi:type="RetrieveMessage"> <Fields> <string xmlns="http://clarizen.com/api">SYSID</string> <string xmlns="http://clarizen.com/api">DueDate</string> <string xmlns="http://clarizen.com/api">State</string> <string xmlns="http://clarizen.com/api">Severity</string> <string xmlns="http://clarizen.com/api">AssignedTo.DisplayName</string> <string xmlns="http://clarizen.com/api">Owner.DisplayName</string> <string xmlns="http://clarizen.com/api">PlannedFor.Name</string> <string xmlns="http://clarizen.com/api">Title</string> <string xmlns="http://clarizen.com/api">ZdExternalId</string> </Fields> <Id> <TypeName>#{entity}</TypeName> <Value>#{externalId}</Value> </Id> </BaseMessage> </request> </Execute> </soap:Body></soap:Envelope>'),MISSING_TICKET:new Template("Only available when viewing tickets or users.<br />&nbsp;"),PROFILE_PAGE_TEXT:new Template("<!--#{logoImage}--><div>Click Show Assignment to see user usage in Clarizen.</div>"),PROFILE_NOT_EXISTS:new Template("<div>User #{name} is not yet registered in Clarizen.</div>"),getMissingTicketMessage:function(){return(this.MISSING_TICKET.evaluate({}));},getProfileNotExistsMessage:function(a){return(this.PROFILE_NOT_EXISTS.evaluate({name:a}));},getAvailabilityLnkForProfilePage:function(a){return(this.PROFILE_PAGE_TEXT.evaluate({logoImage:this.getLogoImage()}))+this.getAvailabilityLnk(a);},getAvailabilityLnk:function(a){return this.SHOW_AVAILABILITY_LINK.evaluate({widgetId:a});},getClarizenUserProfile:function(e,c,d,a){return escape(this.GET_CLARIZEN_USER_PROFILE.evaluate({sessionId:e,email:c,firstName:d,lastName:a}));},getExternalIdByTicketRequest:function(c,a){return escape(this.GET_EXTERNAL_ID_BY_TICKET_ID.evaluate({sessionId:c,ticketId:a}));},setIssueInlineUpdates:function(g,c,h,f,d,a,e,j){return this.ISSUE_INLINE_UPDATES.evaluate({severity:g,sysId:c,ticketTitle:j,fullticketTitle:j,state:(h==="Submitted2"?"Submitted":h),stateImage:this.getStateImage(h),date:this.getFormattedDate(f),assignedTo:d,owner:a,projectTemplate:e===" - "?null:this.PROJECT_ISSUE_TEMPLATE.evaluate({fullProjectName:e,projectName:e}),path:this.IMAGE_PATH});},getDisplayIssueForm:function(h,n,k,a,e,g,c,o,l,f,m,d,j){return this.DISPLAY_ISSUE_FORM.evaluate({widgetId:h,severity:n,sysId:k,ticketTitle:l,fullticketTitle:l,state:(a==="Submitted2"?"Submitted":a),stateImage:this.getStateImage(a),date:this.getFormattedDate(e),assignedTo:g,owner:c,projectTemplate:o===" - "?null:this.PROJECT_ISSUE_TEMPLATE.evaluate({fullProjectName:o,projectName:o}),path:this.IMAGE_PATH,mailTemplate:this.SEND_MAIL_TEMPLATE.evaluate({mailTitle:f,mailTicketId:m,mailAsigneeEmail:d,mailOwnerEmail:j})});},getSystemSettings:function(a){return escape(this.GET_SYSTEM_SETTINGS.evaluate({sessionId:a}));},getProjects:function(a){return escape(this.GET_PROJECTS.evaluate({sessionId:a}));},getCreateUserRequest:function(f,c,d,a,e){return escape(this.CREATE_USER.evaluate({sessionId:f,email:c,firstName:d,lastName:a,sendInvitationMail:e}));},getSubmitForm:function(a){return(this.SUBMIT_FORM.evaluate({widgetId:a,logoImage:this.getLogoImage()}));},getProxyUrl:function(a,c){return escape(this.PROXY_URL.evaluate({url:a,soapAction:c}));},getSubmitFormRequest:function(d,h,j,k,m,f,g,l,a,e){var c=e?"Bug":"Issue";return escape(this.SUBMIT_ISSUE.evaluate({sessionId:d,title:h,description:j,dueDateTemplate:k===null?null:this.DUE_DATE.evaluate({dueDate:k}),severity:m,userId:f,ownerId:l,projectTemplate:g===""||g===null?null:this.PROJECT_ID.evaluate({projectId:g}),ticketId:a,entity:c}));},getUpdateFormRequest:function(e,d,c,a,f){return escape(this.UPDATE_ISSUE.evaluate({sessionId:e,issueId:d,operation:this.getStateValue(c),creatorId:f,entity:a?"Bug":"Issue"}));},getLinkTicketResolution:function(a){return this.TICKET_RESOLUTION.evaluate({widgetId:a});},setUnLinkIssue:function(c,a){return escape(this.UNLINK_ISSUE.evaluate({sessionId:c,IssueId:a}));},getIssueFromClarizenQuery:function(d,a,c){return escape(this.GET_ISSUE_QUERY.evaluate({sessionId:d,externalId:a,entity:c?"Bug":"Issue"}));},getAssigneeRequest:function(a){return escape(this.GET_ASSIGNEES.evaluate({sessionId:a}));},getSessionRequest:function(d,a,c){return escape(this.GET_SESSION.evaluate({username:d,password:a,partnerId:c}));},getLogoImage:function(){return'<img title="Clarizen Logo" alt="Clarizen Logo" src="'+this.IMAGE_PATH+'logo.jpg"/>';},getLoadingImage:function(){return'<img title="Indicator" alt="Indicator" src="'+this.IMAGE_PATH+'indicator.gif"/>';},getStateValue:function(a){switch(a){case 1:return"Open";case 2:return"Reject";case 3:return"MarkResolved";default:return null;}},getSeverityImage:function(a){switch(a){case"High":return'<img height="16" style="display:inline;" title="High" alt="High" src="'+this.IMAGE_PATH+'High.jpg"/>';case"Low":return'<img height="16" style="display:inline;" title="Low" alt="Low" src="'+this.IMAGE_PATH+'Low.jpg"/>';case"Critical":return'<img height="16" style="display:inline;" title="Critical" alt="Critical" src="'+this.IMAGE_PATH+'Critical.jpg"/>';default:return"";}},getStateImage:function(a){switch(a){case"Submitted":case"Submitted2":return'<img height="16" style="display:inline;" title="Submitted" alt="Submitted" src="'+this.IMAGE_PATH+'Submitted.jpg"/>';case"Opened":return'<img height="16" style="display:inline;" title="Opened" alt="Opened" src="'+this.IMAGE_PATH+'Opened.jpg"/>';case"In Work":return'<img height="16" style="display:inline;" title="In Work" alt="In Work" src="'+this.IMAGE_PATH+'Inwork.jpg"/>';case"Resolved":return'<img height="16" style="display:inline;" title="Resolved" alt="Resolved" src="'+this.IMAGE_PATH+'Resolved.jpg"/>';case"Duplicated":return'<img height="16" style="display:inline;" title="Duplicated" alt="Duplicated" src="'+this.IMAGE_PATH+'Duplicated.jpg"/>';case"Not Reproducible":return'<img height="16" style="display:inline;" title="Not Reproducible" alt="Not Reproducible" src="'+this.IMAGE_PATH+'Notreproducible.jpg"/>';case"Rejected":return'<img height="16" style="display:inline;" title="Rejected" alt="Rejected" src="'+this.IMAGE_PATH+'Rejected.jpg"/>';case"Deferred":return'<img height="16" style="display:inline;" title="Deferred" alt="Deferred" src="'+this.IMAGE_PATH+'Deferred.jpg"/>';case"Closed":return'<img height="16" style="display:inline;" title="Closed" alt="Closed" src="'+this.IMAGE_PATH+'Closed.jpg"/>';default:return"";}},convertDateToXSD:function(c){var f=new Date();var j=c.split("/");var a=f.getHours()<10?("0"+f.getHours()):f.getHours();var h=f.getSeconds()<10?("0"+f.getSeconds()):f.getSeconds();var e=f.getMinutes()<10?("0"+f.getMinutes()):f.getMinutes();var g=-f.getTimezoneOffset()/60;g=(g<0?"&#45;":"&#43;")+(Math.abs(g)<10?"0":"")+Math.abs(g);return j[2]+"-"+j[0]+"-"+j[1]+"T12:00:00"+g+":00";},getFormattedDate:function(c){if(c.split("T").length===1){return c;}var j=c.split("T")[0].split("-");var e=c.split("T")[1].split(":");var f=new Date();var h=-f.getTimezoneOffset()/60;var k=new Date(j[0],j[1]-1,j[2],parseInt(e[0]),0,0);k.setHours(k.getHours()+h+7);var a=k.getDate()<10?("0"+k.getDate()):k.getDate();var g=(k.getMonth()+1)<10?("0"+parseInt(k.getMonth()+1)):parseInt(k.getMonth()+1);return g+"/"+a+"/"+k.getFullYear();},fixTitle:function(a){return a.length>20?a.substr(0,20)+"...":a;},fixProjectName:function(a){return a.length>14?a.substr(0,14)+"...":a;},getValue:function(c,f,d){d=d||null;var e=$j(c).find("FieldName:contains("+f+")");var a=e.siblings("Value");if(d&&a.filter(function(){return jQuery(this).attr("i:type")=="GenericEntity";}).length>0){return this.getValue(a,d);}else{if(a.filter(":not(:empty)")){return a.text();}}return" - ";},getTextContentByKey:function(a,c){var d=a.getElementsByTagName(c);if(typeof d==="undefined"||d===null||d.length===0){return null;}if(Prototype.Browser.IE){if(a.getElementsByTagName(c)[0].childNodes.length===0){return null;}return a.getElementsByTagName(c)[0].childNodes[0].nodeValue;}return a.getElementsByTagName(c)[0].textContent;},getNodeValue:function(a){if(typeof a==="undefined"||a===null){return null;}if(Prototype.Browser.IE){return a.childNodes[0].nodeValue;}return a.textContent;}};
var ClarizenWidget=Class.create(Widget,{initialize:function($super,c){$super(c);this.widgetId=c.id;this.username=c.username;this.password=c.password;this.partnerID=clarizenWidgetHelper.PARTNER_ID;this.ticketId=typeof ticket_id==="undefined"?null:ticket_id;this.externalId=this.clarizenUserIdForPopup=this.sessionId=null;this.settings={enableIssues:false,enableBugs:false};this.sendInvitationMail=c.sendInvitationMail;this.formInstance=null;this.contentRoot=this.containingElement().down("div.clarizen-content"+this.widgetId);this.oldContentRoot=this.contentRoot;this.doSelectAssignee=false;this.assigneeXml=null;this.formLoaded=false;var a=this;$j("div#availabilityLnk a").live("click",function(){if(a.clarizenUserIdForPopup){$j(this).attr("href","https://app.clarizen.com/Clarizen/Pages/Calendar/ResourceCalendarView.aspx?u="+a.clarizenUserIdForPopup);}else{alert("Clarizen user information has not been received yet, please try again later.");return false;}});this.start();},start:function(){this.proxyClarizenLoginUrl=clarizenWidgetHelper.PROXY_URL.evaluate({url:clarizenWidgetHelper.SERVICE_URL});this.proxyClarizenQueryUrl=clarizenWidgetHelper.PROXY_URL.evaluate({url:clarizenWidgetHelper.SERVICE_URL});this.proxyClarizenExecuteUrl=clarizenWidgetHelper.PROXY_URL.evaluate({url:clarizenWidgetHelper.SERVICE_URL});if(this.ticketId){this.showLoading();this.getSession(this.getExternalIdByTicketId);}else{if(this.isUserProfilePage()){this.contentRoot.insert(clarizenWidgetHelper.getLoadingImage());this.getSession(function(){this.getZendeskUserForProfilePage(document.location.toString().split("/")[4]);});}else{this.contentRoot.update(clarizenWidgetHelper.getMissingTicketMessage());}}},isBugMode:function(){return this.settings.enableBugs&&!this.settings.enableIssues;},isUserProfilePage:function(){return(/users/).test(document.location);},showLoading:function(){this.contentRoot.insert(clarizenWidgetHelper.getLoadingImage());},showInitial:function(){this.contentRoot.update(clarizenWidgetHelper.getSubmitForm(this.widgetId)+clarizenWidgetHelper.getLinkTicketResolution(this.widgetId));},failLoading:function(){$("resolutionLnk").update(clarizenWidgetHelper.getLinkTicketResolution(this.widgetId));},showForm:function(){$j.colorbox({inline:true,href:"#clarizen-modal-popup"});this.oldContentRoot=this.contentRoot;this.contentRoot=document.getElementById("clarizen-modal-popup");var a=this;$j(document).bind("cbox_cleanup",function(){a.contentRoot=a.oldContentRoot;});if(!this.formLoaded){this.getCurrentTicket();this.retrieveProjects();this.retrieveAssignees();}},closeForm:function(){$j.colorbox.close();},getSession:function(d){var d=d||null;var a=this;var c="body="+clarizenWidgetHelper.getSessionRequest(this.username,this.password,this.partnerID);new Ajax.Request(this.proxyClarizenLoginUrl,{method:"post",postBody:c,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.LOGIN_URL},onSuccess:function(e){this.extractSessionID(e.responseXML,d);}.bind(this),onFailure:function(){this.failLoading();alert("Login has Failed");}});},extractSessionID:function(d,c){success=$j(d).find("Success").text()=="true";if(success){this.sessionId=$j(d).find("SessionId").text();this.organizationId=$j(d).find("OrganizationId").text();this.userId=$j(d).find("UserId").text();if(c){c.apply(this);}}else{var a=clarizenWidgetHelper.getTextContentByKey(d,"faultstring");this.failLoading();if(a!==null&&a!==""){alert(a);}else{alert("Login has Failed");}}},checkSessionTimeOut:function(a){return clarizenWidgetHelper.getTextContentByKey(a,"faultcode")==="s:SessionTimeout";},getExternalIdByTicketId:function(){var a="body="+clarizenWidgetHelper.getExternalIdByTicketRequest(this.sessionId,this.ticketId);new Ajax.Request(this.proxyClarizenExecuteUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.EXECUTE_URL},onSuccess:function(d){if(this.checkSessionTimeOut(d.responseXML)){this.contentRoot.update("Error communicating with Clarizen.");return false;}var c=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"TypeName");if(c==="Bug"){this.settings.enableBugs=true;}this.externalId=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"Value");if(!this.externalId){this.showInitial();}else{this.getIssueFromClarizen(true);}}.bind(this),onFailure:function(){this.failLoading();alert("Failed to get Projects List");}.bind(this)});},retrieveProjects:function(){var a="body="+clarizenWidgetHelper.getProjects(this.sessionId);new Ajax.Request(this.proxyClarizenQueryUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.QUERY_URL},onSuccess:function(c){if(this.checkSessionTimeOut(c.responseXML)){this.getSession(this.retrieveProjects);return false;}this.populateProjects(this.contentRoot,c.responseXML);}.bind(this),onFailure:function(){this.failLoading();alert("Failed to get Projects List");}.bind(this)});},populateProjects:function(c,f){var g=false;var a=$j(c).find("select.clarizenProjectSelector");a.prop("disabled",false);a.html("");try{this.ProjectsList=$j(f).find("BaseEntity");g=(this.ProjectsList.length>0);}catch(d){}if(!g){$j("<option>").val("").html("").prop("selected",true).appendTo(a);return;}$j("<option>").val("").html("—select the project—").prop("selected",true).appendTo(a);this.ProjectsList.each(function(e,h){$j("<option>").val($j(h).find("Id Value").text()).html(clarizenWidgetHelper.getValue(h,"Name")).appendTo(a);});},retrieveAssignees:function(){var a="body="+clarizenWidgetHelper.getAssigneeRequest(this.sessionId);new Ajax.Request(this.proxyClarizenQueryUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.QUERY_URL},onSuccess:function(c){if(this.checkSessionTimeOut(c.responseXML)){this.getSession(this.retrieveAssignees);return false;}this.populateAssignees(this.contentRoot,c.responseXML);}.bind(this),onFailure:function(){this.failLoading();alert("Failed to get Assignee List");}.bind(this)});},populateAssignees:function(c,d){var a=$j(c).find("select.clarizenAssigneeSelecter");a.html("");$j("<option>").val("-1").html("—select an assignee—").prop("selected",true).appendTo(a);this.assigneeXml=d;this.AssigneesList=this.AssigneesList||$j(d).find("BaseEntity");this.AssigneesList.each(function(f,e){$j("<option>").val($j(e).find("Id Value").text()).html(clarizenWidgetHelper.getValue(e,"FirstName")+" "+clarizenWidgetHelper.getValue(e,"LastName")).appendTo(a);});a.prop("disabled",false);a.disabled=false;if(this.doSelectAssignee){this.selectAssignee();}else{this.doSelectAssignee=true;}},selectSeverity:function(a){$j("select.clarizenSeveritySelector").val(clarizenWidgetHelper.PRIORITY_MAPPING[parseInt(a)]||"Medium");},selectAssignee:function(){var d=null;var c=null;if(this.ZendeskTicketAssigneeEmail){this.AssigneesList=this.AssigneesList||$j(this.assigneeXml).find("BaseEntity");this.AssigneesList.each(function(j,e){var h=$j(e).find("Id Value").text();var k=clarizenWidgetHelper.getValue(e,"FirstName");var g=clarizenWidgetHelper.getValue(e,"LastName");var f=clarizenWidgetHelper.getValue(e,"Email");if(!d&&k&&g&&this.ZendeskTicketAssigneeFullname===k+" "+g){d=j+1;}if(!c&&f&&this.ZendeskTicketAssigneeEmail===f){c=j+1;}});var a=$j(this.contentRoot).find("select.clarizenAssigneeSelecter");if(c){a.selectedIndex=c;}else{if(d){a.selectedIndex=d;}}}},getCurrentTicket:function(){var a="/tickets/"+this.ticketId+".xml";new Ajax.Request(a,{method:"get",requestHeaders:{Accept:"application/xml"},onSuccess:function(c){if(this.checkSessionTimeOut(c.responseXML)){this.getSession(this.getCurrentTicket);return false;}$j("input.clarizenTitle").val(clarizenWidgetHelper.getTextContentByKey(c.responseXML,"subject"));$j("textarea.clarizenDescription").val(clarizenWidgetHelper.getTextContentByKey(c.responseXML,"description"));this.selectSeverity(clarizenWidgetHelper.getTextContentByKey(c.responseXML,"priority-id"));this.ticketRequesterId=clarizenWidgetHelper.getTextContentByKey(c.responseXML,"requester-id");this.ticketAssigneeId=clarizenWidgetHelper.getTextContentByKey(c.responseXML,"assignee-id");this.ticketStatusId=parseInt(clarizenWidgetHelper.getTextContentByKey(c.responseXML,"status-id"));this.getTicketAssignee(this.ticketAssigneeId);this.getTicketOwner(this.ticketRequesterId);}.bind(this),onFailure:function(){this.failLoading();alert("Failed to retrieve a ticket from Zendesk.");}.bind(this)});},getTicketAssignee:function(c){if(!c){return;}var a="/users/"+c+".xml";new Ajax.Request(a,{method:"get",requestHeaders:{Accept:"application/xml"},onSuccess:function(d){if(this.checkSessionTimeOut(d.responseXML)){this.getSession(function(){this.getTicketAssignee(c);});return false;}this.ZendeskTicketAssigneeEmail=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"email");this.ZendeskTicketAssigneeFullname=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"name");if(this.doSelectAssignee){this.selectAssignee();}else{this.doSelectAssignee=true;}}.bind(this),onFailure:function(){this.failLoading();alert("Failed to retrieve a Zendesk User. (3)");}.bind(this)});},getTicketOwner:function(c){var a="/users/"+c+".xml";new Ajax.Request(a,{method:"get",requestHeaders:{Accept:"application/xml"},onSuccess:function(d){if(this.checkSessionTimeOut(d.responseXML)){this.getSession(function(){this.getTicketOwner(c);});return false;}this.zendeskTicketRequesterEmail=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"email");this.zendeskTicketRequesterFullName=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"name");}.bind(this),onFailure:function(){this.failLoading();alert("Failed to retrieve a Zendesk User. (4)");}.bind(this)});},validateForm:function(){if($j("input.clarizenTitle").val()===""){alert("Subject is required");return false;}if($j("textarea.clarizenDescription").val()===""){alert("Description is required");return false;}if($j("select.clarizenAssigneeSelecter").val()==="-1"){alert("Please select an assignee");return false;}var c=$j("input.dueDate").val();if(c!==""&&!/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/.test(c)){alert("Invalid date, must be in MM/DD/YYYY format");return false;}var a=new Date();a.setFullYear(c.split("/")[2],parseInt(c.split("/")[0])-1,parseInt(c.split("/")[1]));if(a<new Date()){alert("Please select a due date in the future.");return false;}if($j("select.clarizenAssigneeSelecter").val()==="-1"&&!this.ticketAssigneeId){alert("This ticket is currently unassigned. Please select an assignee from the list");return false;}this.closeForm();return true;},submitIssueForm:function(a){if(this.validateForm()){$j("div.clarizen_message").hide();this.showLoading();this.prepareForSubmit();}},prepareForSubmit:function(){var a="body="+clarizenWidgetHelper.getSystemSettings(this.sessionId);new Ajax.Request(this.proxyClarizenExecuteUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.EXECUTE_URL},onSuccess:function(d){if(this.checkSessionTimeOut(d.responseXML)){this.getSession(this.prepareForSubmit);return false;}if(clarizenWidgetHelper.getTextContentByKey(d.responseXML,"Success")==="false"){alert("Failed to get Clarizen Settings ( "+clarizenWidgetHelper.getTextContentByKey(d.responseXML,"faultstring")+" )");}else{var c=XmlHelper.getRecords(d.responseXML,"","anyType");this.settings.enableIssues=clarizenWidgetHelper.getNodeValue(c[0])==="true"?true:false;this.settings.enableBugs=clarizenWidgetHelper.getNodeValue(c[1])==="true"?true:false;if(!this.settings.enableBugs&&!this.settings.enableIssues){this.failLoading();alert("Issues and Bugs are disabled in this organization.");}else{this.checkRequesterInClarizen();}}}.bind(this),onFailure:function(){this.failLoading();alert("Failed to get Clarizen Settings.");}.bind(this)});},checkRequesterInClarizen:function(){this.requestorId=null;if(this.zendeskTicketRequesterFullName){var a=this.zendeskTicketRequesterFullName.split(" ")[0];$j(this.AssigneesList).each(function(d,c){var e=clarizenWidgetHelper.getValue(c,"FirstName");var f=$j(c).find("Id Value").text();if(e==a&&f&&this.requestorId===null){this.requestorId=f;}});}if(this.requestorId===null){this.createUserInClarizen();}else{this.submitIssue();}},submitIssue:function(){var d=this.contentRoot.down("select.clarizenAssigneeSelecter").getValue();var a=this.contentRoot.down("input.dueDate").getValue();var c="body="+clarizenWidgetHelper.getSubmitFormRequest(this.sessionId,clarizenWidgetUnicodeConverter.convertChar2CP(this.contentRoot.down("input.clarizenTitle").getValue()),clarizenWidgetUnicodeConverter.convertChar2CP(this.contentRoot.down("textarea.clarizenDescription").getValue()),a===""?null:clarizenWidgetHelper.convertDateToXSD(a),this.contentRoot.down("select.clarizenSeveritySelector").getValue(),d,this.contentRoot.down("select.clarizenProjectSelector").getValue(),d,this.ticketId,this.isBugMode());new Ajax.Request(this.proxyClarizenExecuteUrl,{method:"post",postBody:c,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.EXECUTE_URL},onSuccess:function(e){if(this.checkSessionTimeOut(e.responseXML)){this.getSession(function(){this.submitIssue();});return false;}if(clarizenWidgetHelper.getTextContentByKey(e.responseXML,"Success")==="false"){this.failLoading();alert("An error occured. ("+clarizenWidgetHelper.getTextContentByKey(e.responseXML,"Message")+")");}else{this.externalId=clarizenWidgetHelper.getTextContentByKey(e.responseXML,"Value");if(this.ticketStatusId===0){this.getIssueFromClarizen(true);}else{this.changeIssueStatus();}}}.bind(this),onFailure:function(){this.failLoading();alert("Failed to submit issue.");}.bind(this)});},changeIssueStatus:function(){var a="body="+clarizenWidgetHelper.getUpdateFormRequest(this.sessionId,this.externalId,this.ticketStatusId,this.isBugMode(),this.requestorId);new Ajax.Request(this.proxyClarizenExecuteUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.EXECUTE_URL},onSuccess:function(c){if(this.checkSessionTimeOut(c.responseXML)){this.getSession(this.changeIssueStatus);return false;}if(clarizenWidgetHelper.getTextContentByKey(c.responseXML,"Success")==="false"){this.failLoading();alert("An error occured. ("+clarizenWidgetHelper.getTextContentByKey(c.responseXML,"Message")+")");}else{this.getIssueFromClarizen(true);}}.bind(this),onFailure:function(){this.failLoading();alert("Failed to submit issue.");}.bind(this)});},createUserInClarizen:function(){var c=this.zendeskTicketRequesterFullName.split(" ");var a="body="+clarizenWidgetHelper.getCreateUserRequest(this.sessionId,this.zendeskTicketRequesterEmail,c.length===1?c:c[0],c.length===1?c:c[1],this.sendInvitationMail);new Ajax.Request(this.proxyClarizenExecuteUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.EXECUTE_URL},onSuccess:function(d){if(this.checkSessionTimeOut(d.responseXML)){this.getSession(function(){this.createUserInClarizen();});return false;}if(clarizenWidgetHelper.getTextContentByKey(d.responseXML,"Success")==="false"){this.failLoading();alert("Failed to create User In Clarizen.\n An error occured. ("+clarizenWidgetHelper.getTextContentByKey(d.responseXML,"Message")+")");}else{this.requestorId=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"Value");this.submitIssue();}}.bind(this),onFailure:function(){this.failLoading();alert("Failed to create User In Clarizen.");}.bind(this)});},getIssueFromClarizen:function(){var a="body="+clarizenWidgetHelper.getIssueFromClarizenQuery(this.sessionId,this.externalId,this.isBugMode());this.contentRoot.update(clarizenWidgetHelper.getLoadingImage());new Ajax.Request(this.proxyClarizenExecuteUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.EXECUTE_URL},onSuccess:function(c){if(this.checkSessionTimeOut(c.responseXML)){this.getSession(function(){this.getIssueFromClarizen(insertRequired);});return false;}this.parseIssueResponse(c.responseXML);}.bind(this),onFailure:function(){if(!insertRequired){this.contentRoot.update("");}alert("Failed to get Issue From Clarizen");}.bind(this)});},parseIssueResponse:function(e){var d=clarizenWidgetHelper.getTextContentByKey(e,"Success");if(d!==null&&d!=="false"){this.IssueSysId=clarizenWidgetHelper.getValue(e,"SYSID");this.IssueDueDate=clarizenWidgetHelper.getValue(e,"DueDate");this.IssueState=$j(e).find("TypeName:contains('CaseState')").siblings("Value").text();this.IssueSeverity=$j(e).find("TypeName:contains('Severity')").siblings("Value").text();this.IssuezendeskTicketId=clarizenWidgetHelper.getValue(e,"ZdExternalId");this.IssueAssignedTo=clarizenWidgetHelper.getValue(e,"AssignedTo","DisplayName");this.IssueOwner=clarizenWidgetHelper.getValue(e,"Owner","DisplayName");this.IssueProjectName=clarizenWidgetHelper.getValue(e,"PlannedFor","Name");this.IssueTitle=clarizenWidgetHelper.getValue(e,"Title");this.getZendeskTicket(this.IssuezendeskTicketId);}else{var c=clarizenWidgetHelper.getTextContentByKey(e,"ErrorCode");if(c!==null&&c==="EntityNotFound"){$("issuePlaceHolder").update("");this.externalId=null;this.showInitial();}else{$("issue-details").update("");var a=clarizenWidgetHelper.getTextContentByKey(e,"faultstring");alert(a!==null?a:"Failed to parse Issue response");}}},getZendeskTicket:function(c){var a="/tickets/"+c+".xml";new Ajax.Request(a,{method:"get",requestHeaders:{Accept:"application/xml"},onSuccess:function(e){if(this.checkSessionTimeOut(e.responseXML)){this.getSession(function(){this.getZendeskTicket(c);});return false;}this.ZendeskUserIdAssigneeId=clarizenWidgetHelper.getTextContentByKey(e.responseXML,"assignee-id");var d=clarizenWidgetHelper.getTextContentByKey(e.responseXML,"requester-id");this.getZendeskOwner(d);}.bind(this),onFailure:function(){alert("Failed to retrieve a ticket from Zendesk.");}});},getZendeskOwner:function(c){var a="/users/"+c+".xml";new Ajax.Request(a,{method:"get",requestHeaders:{Accept:"application/xml"},onSuccess:function(d){if(this.checkSessionTimeOut(d.responseXML)){this.getSession(function(){this.getZendeskOwner(c);});return false;}this.ZendeskUserOwnerEmail=clarizenWidgetHelper.getTextContentByKey(d.responseXML,"email");if(this.ZendeskUserIdAssigneeId){this.getZendeskUserForProfilePage(this.ZendeskUserIdAssigneeId);}else{this.updateIssueDetails();}}.bind(this),onFailure:function(){alert("Failed to retrieve a Zendesk User. (1)");}});},updateIssueDetails:function(){this.contentRoot.update(clarizenWidgetHelper.getDisplayIssueForm(this.widgetId,this.IssueSeverity,this.IssueSysId,this.IssueState,this.IssueDueDate,this.IssueAssignedTo,this.IssueOwner,this.IssueProjectName,this.IssueTitle,clarizenWidgetUnicodeConverter.convertChar2CP(encodeURIComponent(this.IssueTitle)),window.ticket_id,this.ZendeskUserAssigneeEmail,this.ZendeskUserOwnerEmail)+clarizenWidgetHelper.getAvailabilityLnk(this.widgetId));},updateIssueForm:function(){this.contentRoot.update(clarizenWidgetHelper.getDisplayIssueForm(this.IssueSeverity,this.IssueSysId,this.IssueState,this.IssueDueDate,this.IssueAssignedTo,this.IssueOwner,this.IssueProjectName,this.IssueTitle)+clarizenWidgetHelper.getAvailabilityLnk(this.widgetId));},getZendeskUserForProfilePage:function(c){var a="/users/"+c+".xml";new Ajax.Request(a,{method:"get",requestHeaders:{Accept:"application/xml"},onSuccess:function(e){if(this.checkSessionTimeOut(e.responseXML)){this.getSession(function(){this.getZendeskUserForProfilePage(c);});return false;}this.ZendeskUserAssigneeEmail=clarizenWidgetHelper.getTextContentByKey(e.responseXML,"email");var d=clarizenWidgetHelper.getTextContentByKey(e.responseXML,"name").split(" ");if(d.length===1){alert("User '"+d+"' doesn't have a Last Name, cannot search user in Clarizen");}else{this.getClarizenUserProfile(this.ZendeskUserAssigneeEmail,d[0],d[1]);}if(!this.isUserProfilePage()){this.updateIssueDetails();}}.bind(this),onFailure:function(){if(this.isUserProfilePage()){this.contentRoot.update("");}alert("Failed to retrieve a Zendesk User. (2)");}.bind(this)});},getClarizenUserProfile:function(c,d,a){var e="body="+clarizenWidgetHelper.getClarizenUserProfile(this.sessionId,c,d,a);new Ajax.Request(this.proxyClarizenQueryUrl,{method:"post",postBody:e,requestHeaders:{Accept:"application/xml",SOAPAction:clarizenWidgetHelper.QUERY_URL},onSuccess:function(f){if(this.checkSessionTimeOut(f.responseXML)){this.getSession(function(){this.getClarizenUserProfile(c,d,a);});return false;}this.clarizenUserIdForPopup=clarizenWidgetHelper.getTextContentByKey(f.responseXML,"Value");if(this.isUserProfilePage()){this.contentRoot.update(this.clarizenUserIdForPopup===null?clarizenWidgetHelper.getProfileNotExistsMessage(d):clarizenWidgetHelper.getAvailabilityLnkForProfilePage(this.widgetId));}}.bind(this),onFailure:function(){if(this.isUserProfilePage()){this.contentRoot.update("");}alert("Failed to get Clarizen User Profile");}.bind(this)});}});var FreshbooksHelper={STAFF_FORM:new Template('<form class="form" id="freshbooks-form-#{widget_id}"> <label>Select user</label><select name="staff_id" id="freshbooks-form-staff-id" onchange="ObjectFactory.get(#{widget_id}).staffSelector(this.options[this.selectedIndex].value)"></select> <br/><input type="submit" disabled="disabled" id="freshbooks-submit" value="Sign in" onclick="ObjectFactory.get(#{widget_id}).saveStaffId($(\'freshbooks-form-#{widget_id}\'));return false;"></form>'),SUBMIT_FORM:new Template('<form class="form" id="freshbooks-form-#{widget_id}"> <label>Select project</label><select name="project_id" id="freshbooks-form-projects" onchange="ObjectFactory.get(#{widget_id}).projectsSelector(this.options[this.selectedIndex].value)"></select> <img src="/images/indicator2.gif" id="freshbooks-project-spinner" style="display:none;" /> <label>Select task</label><select disabled name="task_id" id="freshbooks-form-tasks" onchange="ObjectFactory.get(#{widget_id}).tasksSelector(this.options[this.selectedIndex].value)"></select> <img src="/images/indicator2.gif" id="freshbooks-task-spinner" style="display:none;" /> <label>Notes</label><textarea disabled name="freshbooks-form-notes" id="freshbooks-form-notes" wrap="virtual" style="width:190px; height: 50px;">#{default_note}</textarea> <label>Hours</label><input type="text" disabled name="freshbooks-form-hours" id="freshbooks-form-hours" style="width:50px"> <br/><input type="submit" disabled id="freshbooks-form-submit" style="margin-top: 10px;" value="Submit" onclick="ObjectFactory.get(#{widget_id}).submitTimeSpent($(\'freshbooks-form-#{widget_id}\'));return false;"> <span class="link" style="font-weight:normal;margin-left:20px;" onclick="ObjectFactory.get(#{widget_id}).logout()">(logout)</span></form>'),GET_TASKS:new Template('<?xml version="1.0" encoding="utf-8"?> <request method="task.list" > <project_id>#{project_id}</project_id> </request>'),GET_STAFF:new Template('<?xml version="1.0" encoding="utf-8"?><request method="staff.list"></request>'),POST_HOURS:new Template('<?xml version="1.0" encoding="ISO-8859-1"?><request method="time_entry.create"> <time_entry> <project_id>#{project_id}</project_id> <task_id>#{task_id}</task_id> <hours>#{hours}</hours> <notes><![CDATA[#{notes}]]></notes> <staff_id>#{staff_id}</staff_id> </time_entry></request>'),ERROR_MESSAGE:new Template("An error occured:\n\n#{error}\n\nSee https://support.zendesk.com/forums/4372 for troubleshooting\n\nor contact Freshbooks support at support@freshbooks.com"),getTasksRequest:function(a){return escape(this.GET_TASKS.evaluate({project_id:a}));},getProjectsRequest:function(c){var a=new Template('body=<?xml version="1.0" encoding="utf-8"?><request method="project.list"> <page>#{page}</page> <per_page>100</per_page></request>');return a.evaluate({page:c});},getClientsRequest:function(c){var a=new Template('body=<?xml version="1.0" encoding="utf-8"?><request method="client.list"> <page>#{page}</page> <per_page>100</per_page></request>');return a.evaluate({page:c});},postHoursRequest:function(e,f,c,d,a){return escape(this.POST_HOURS.evaluate({staff_id:e,project_id:f,task_id:c,notes:d,hours:a}));},getStaffRequest:function(){return escape(this.GET_STAFF.evaluate({}));},buildClientList:function(a){var c={};a.each(function(d){var f=$j(d).find("client_id").text();var e=$j(d).find("organization").text();c[f]=e;});return c;},populateProjects:function(d,c){var a=$j("#freshbooks-form-projects");a.text("");a.append($j("<option>"));d.each(function(h){var g=$j("<option>");var f=$j(h).find("name").text();var j=$j(h).find("client_id").text();var e=c[j];if(e){f=f+" - "+e;}g.attr("value",$j(h).find("project_id").text());g.text(f);a.append(g);});$j("#freshbooks-project-spinner").hide();},populateStaff:function(a){$("freshbooks-form-staff-id").update("");$("freshbooks-form-staff-id").appendChild(new Element("option"));for(i=0;i<a.length;i++){var c=new Element("option");c.value=FreshbooksHelper.getNodeString(a[i],"staff_id");c.innerHTML=FreshbooksHelper.getNodeString(a[i],"first_name")+" "+FreshbooksHelper.getNodeString(a[i],"last_name");$("freshbooks-form-staff-id").appendChild(c);}},populateTasks:function(a){$("freshbooks-form-tasks").update("");$("freshbooks-form-tasks").appendChild(new Element("option"));for(i=0;i<a.length;i++){var c=new Element("option");c.value=FreshbooksHelper.getNodeString(a[i],"task_id");c.innerHTML=FreshbooksHelper.getNodeString(a[i],"name");$("freshbooks-form-tasks").appendChild(c);}$j("#freshbooks-task-spinner").hide();$("freshbooks-form-tasks").enable();},getNodeValue:function(a,d){var c=a.getElementsByTagName(d);if(c==null||c.length==0){return null;}if(c[0].childNodes[0]==null){return"";}return c[0].childNodes[0].nodeValue;},getNodeString:function(a,c){return this.getNodeValue(a,c)||"";},getNodeAttribute:function(c,e,a){var d=c.getElementsByTagName(e);if(d==null||d.length==0){return null;}return d[0].getAttribute(a)||null;},getRecords:function(a,c){return a.getElementsByTagName(c)||new Array();},getCookie:function(c){if(document.cookie.length>0){var d=document.cookie.indexOf(c+"=");if(d!=-1){d=d+c.length+1;var a=document.cookie.indexOf(";",d);if(a==-1){a=document.cookie.length;}return unescape(document.cookie.substring(d,a));}}return"";},setCookie:function(c,d,a){var e=new Date();e.setDate(e.getDate()+a);document.cookie=c+"="+escape(d)+((a==null)?"":";expires="+e.toGMTString());},checkStatus:function(c){var a=FreshbooksHelper.getRecords(c,"response");if(a.length>0){var d=FreshbooksHelper.getNodeString(a[0],"error");if(d!=""){alert(FreshbooksHelper.ERROR_MESSAGE.evaluate({error:d}));return false;}}return true;}};
var FreshbooksWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.url=a.url;if(!this.url.match(/^http/)){this.url="http://"+this.url;}this.formInstance=null;this.ticket_id=a.ticket_id;this.default_note=a.default_note;this.apikey=a.apikey;this.staff_id="";this.subject=a.subject;this.contentRoot=this.containingElement().down("div.freshbooks-content");this.clients=null;this.apiUrl=this.buildApiUrl();this.setup();},setup:function(){this.staff_id=FreshbooksHelper.getCookie("freshbooks_staff_id");if(this.staff_id==""){this.contentRoot.update(FreshbooksHelper.STAFF_FORM.evaluate({widget_id:this.id}));this.loadStaff();}else{this.buildForm();}},saveApiKey:function(a){this.formInstance=a;FreshbooksHelper.setCookie("freshbooks_api_key",$("freshbooks-form-apikey").value,14);this.setup();},logout:function(){FreshbooksHelper.setCookie("freshbooks_staff_id","",180);this.staff_id="";this.setup();},buildForm:function(){var a=this.defaultNote();this.contentRoot.update(FreshbooksHelper.SUBMIT_FORM.evaluate({widget_id:this.id,default_note:a,ticket_id:this.ticket_id}));this.loadClients(1,[]);},buildApiUrl:function(){var c="/proxy/direct?&url=#{url}&timeout=10";var a=new Template(c);return a.evaluate({url:this.url});},defaultNote:function(){var c={id:this.ticket_id,title:this.subject};var a={ticket:c,ticket_id:this.ticket_id};return Zd.Util.parseTemplate(this.default_note,a);},loadStaff:function(){var a="body="+FreshbooksHelper.getStaffRequest();new Ajax.Request(this.apiUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",Authorization:"Basic "+Base64.encode(this.apikey+":x")},onSuccess:function(c){if(FreshbooksHelper.checkStatus(c.responseXML)){this.showStaff(c.responseXML);}}.bind(this),onFailure:function(){alert("Failed to retrieve Freshbooks staff list.");}});},loadClients:function(f,c){var a=FreshbooksHelper.getClientsRequest(f);var d=this;var e=Base64.encode(this.apikey+":x");$j.ajax({type:"POST",beforeSend:function(g){g.setRequestHeader("Authorization","Basic "+e);},url:this.apiUrl,data:a,success:function(g){d.handleLoadClients(c,g);}});},handleLoadClients:function(c,e){var d=parseInt($j(e).find("clients").attr("page"));var a=parseInt($j(e).find("clients").attr("pages"));$j.merge(c,$j(e).find("client"));if(d<a){this.loadClients(d+1,c);}else{this.clients=FreshbooksHelper.buildClientList(c);this.loadProjects(1,[]);}},loadProjects:function(f,e){var a=FreshbooksHelper.getProjectsRequest(f);var c=this;$j("#freshbooks-project-spinner").show();var d=Base64.encode(this.apikey+":x");$j.ajax({type:"POST",beforeSend:function(g){g.setRequestHeader("Authorization","Basic "+d);},url:this.apiUrl,data:a,success:function(g){c.handleLoadProjects(e,g);}});},handleLoadProjects:function(c,e){var d=parseInt($j(e).find("projects").attr("page"));var a=parseInt($j(e).find("projects").attr("pages"));$j.merge(c,$j(e).find("project"));if(d<a){this.loadProjects(d+1,c);}else{FreshbooksHelper.populateProjects(c,this.clients);}},projectsSelector:function(a){this.loadTasks(a);},staffSelector:function(a){if($("freshbooks-form-staff-id").value>""){$("freshbooks-submit").enable();}else{$("freshbooks-submit").disable();}},saveStaffId:function(a){FreshbooksHelper.setCookie("freshbooks_staff_id",$("freshbooks-form-staff-id").value,180);this.setup();},loadTasks:function(c){var a="body="+FreshbooksHelper.getTasksRequest(c);$j("#freshbooks-form-tasks").text("");$j("#freshbooks-task-spinner").show();new Ajax.Request(this.apiUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",Authorization:"Basic "+Base64.encode(this.apikey+":x")},onSuccess:function(d){if(FreshbooksHelper.checkStatus(d.responseXML)){this.showTasks(d.responseXML);}}.bind(this),onFailure:function(){alert("Failed");}});},tasksSelector:function(a){$("freshbooks-form-notes").enable();$("freshbooks-form-hours").enable();$("freshbooks-form-submit").enable();},showStaff:function(c){if($("freshbooks-form-staff-id").options.length==0){var a=FreshbooksHelper.getRecords(c,"member");FreshbooksHelper.populateStaff(a);}},showTasks:function(c){var a=FreshbooksHelper.getRecords(c,"task");FreshbooksHelper.populateTasks(a);},submitTimeSpent:function(c){var d=parseFloat(c["freshbooks-form-hours"].value);if(isNaN(d)){alert("Please enter a valid value for hours");return false;}var a="body="+FreshbooksHelper.postHoursRequest(this.staff_id,$("freshbooks-form-projects").value,$("freshbooks-form-tasks").value,$("freshbooks-form-notes").value,$("freshbooks-form-hours").value);new Ajax.Request(this.apiUrl,{method:"post",postBody:a,requestHeaders:{Accept:"application/xml",Authorization:"Basic "+Base64.encode(this.apikey+":x")},onSuccess:function(e){if(FreshbooksHelper.checkStatus(e.responseXML)){this.resetForm();}}.bind(this),onFailure:function(){alert("Failed");}});return false;},resetForm:function(){var a=this.defaultNote();$("freshbooks-form-hours").value="";$("freshbooks-form-notes").value=a;$("freshbooks-form-notes").focus();}});
var LogMeInWidget=Class.create(Widget,{initialize:function($super,a){$super(a);this.SSOID=a.SSOID;this.SSOpwd=a.SSOpwd;this.SSOcompid=a.SSOcompid;this.ticket_id=a.ticket_id?a.ticket_id:"";this.ticket_token=a.token?a.token:"";this.widget_id=a.widget_id;this.cookie_name="logmein_auth_"+this.widget_id;this.secret=a.secret;this.subdomain=a.subdomain;this.cfield_values=a.cfield_values;this.newTicket=a.newTicket;logmein=this;this.getLoginTicket();},isError:function(c,a){return jQuery.inArray(c,a)>=0;},setExternalLink:function(){if(this.newTicket){$j.ajax({type:"get",dataType:"html",url:"/integrations/logmein_rescue/get_token.js",success:function(a){$j("#ticket-chat").append("<input name='ticket[external_links][][type]' id='external_link_type' type='hidden' value='LogMeInRescueSession' />");$j("#ticket-chat").append("<input name='ticket[external_links][][session_id]' id='external_link_session' type='hidden' value='"+a+"' />");this.ticket_token=a;}});}},getLoginTicket:function(){$j("#loading_area").show();var a="/proxy/direct?url="+encodeURIComponent("https://secure.logmeinrescue.com/sso/getloginticket.aspx?ssoid="+this.SSOID+"&password="+this.SSOpwd+"&companyid="+this.SSOcompid);$j.ajax({type:"get",dataType:"html",url:a,success:function(d){$j("#loading_area").hide();if(d.split(":")[0]=="OK"){var c=d.substring(3);$j("span#tech_console_link").html('<br/><a href="'+c+'" target="_blank"><strong>Launch Technician Console</strong></a>');$j("#tech_console_area").show();if(!Cookie.get(this.cookie_name)){$j("#login_area").show();}else{$j("#pin_area").show();}}else{errors=d.split(":");$j("#tech_console_area").hide();if(this.isError("INVALIDSSOID",errors)){logmein.err("Your Rescue Single Sign-On ID must match your Zendesk primary email address.");}else{if(this.isError("INVALID",errors)){logmein.err("You are not authorized to login.");}else{if(this.isError("INVALIDPASSWORD",errors)){logmein.err("Invalid single sign-on password.");}else{logmein.err("Error accessing the Technician Console single sign-on link.");}}}$j("error_area").show();}}.bind(this)});},checkAuth:function(){var a,d;logmein.err(false);$j("#ticket_place").html("");$j("#pin").text("");if(Cookie.get(this.cookie_name)){this.getPIN(Cookie.get(this.cookie_name));return;}else{a=document.getElementById("logmein_username").value;d=document.getElementById("logmein_password").value;if(a==""&&d==""){logmein.err("Please enter the username and password");$j("#login_area").show();return;}}var c="/proxy/direct?url="+encodeURIComponent("https://secure.logmeinrescue.com/api/requestauthcode.aspx?email="+a+"&pwd="+d);$j.ajax({type:"get",dataType:"html",url:c,success:function(f){f=f.split(":");if(f[0]=="ERROR"||f[0]=="INVALID"){logmein.err("The username and/or password you've entered is incorrect.");return;}else{var e=f[1];Cookie.set(this.cookie_name,e,10000);$j("#login_area").hide();$j("#pin_area").show();return;}}.bind(this)});},getPIN:function(c){$j("#pin").hide();$j("#pin_placeholder").hide();$j("#pin_loader").show();fields=this.widget_id+"|"+this.ticket_id+"|"+this.ticket_token+"|"+this.subdomain+"|"+this.secret;this.setExternalLink();var a="/proxy/direct?url="+encodeURIComponent("https://secure.logmeinrescue.com/api/requestpincode.aspx?notechconsole=1&authcode="+c+"&tracking0="+fields+"&"+this.cfield_values);$j.ajax({url:a,type:"get",dataType:"html",success:function(e){$j("#pin_loader").hide();e=e.split(":");if(e[0].replace(/^\s*|\s*$|\n*/g,"")=="OKPINCODE"){$j("#pin").text(e[1]);$j("#pin").show();$j("#login_area").hide();var d="https://secure.logmeinrescue.com/Customer/Code.aspx?Code="+e[1];$j("#ticket_place").html("<a href='javascript:void(0)' onclick='logmein.comment_update(\"Click this link to launch a remote session: "+d+"\")' ><strong>&laquo;</strong> Copy to ticket</a>");logmein.err(false);$j("#submit_type").val("");}else{switch(e[0]){case"ERROR":logmein.err("There was an error trying to get the PIN, please try again or contact the admin if the problem persists.");break;case"NOTLOGGEDIN":logmein.err("Unable to login, please verify your username and password.");break;case"NOTECHCONSOLERUNNING":logmein.err("Please run the Technician Console before requesting a PIN.");break;case"OUTOFPINCODES":logmein.err("LogMeIn Rescue is out of PIN codes.");break;case"INVALID_SECRETAUTHCODE":logmein.err("The authentication code you've obtained is invalid or has expired, try logging in again.");Cookie.set(this.cookie_name,"");$j("#pin_area").hide();$j("#login_area").show();break;case"USER_IS_DELETED":logmein.err("This user has been deleted.");break;case"TECHNICIAN_NOT_EXISTS":logmein.err("This technician does not exist.");break;case"USER_DELETED_OR_DISABLED":logmein.err("This user has been deleted or disabled.");break;default:logmein.err("Error when requesting a PIN.");break;}}}.bind(this)});},err:function(a){$j("#error_area").show();a?$j("#error_area").text("Error: "+a):$j("#error_area").text("");},comment_update:function(a){old_msg=$j("#comment_value").val();$j("#comment_value").val(old_msg+" "+a);}});if(!Zd){var Zd={};}Zd.Util={parseTemplate:function(d,c){var e=this.rubyStyle(d,c);var a=this.mustacheStyle(e,c);return a;},rubyStyle:function(c,a){var d=new Template(c);return d.evaluate(a);},mustacheStyle:function(d,c){var a=/(^|.|\r|\n)(\{\{\s*([\w\\.]+)\s*\}\})/;var e=new Template(d,a);return e.evaluate(c);},pluralize:function(c,a){if(a==1){return c;}return c+"s";}};(function(c){function a(bk,be){function aq(j){return function(k){return !this._t||!this._t._a?null:j.call(this,k);};}function bl(){if(aA.debugURLParam.test(aK)){aA.debugMode=true;}}this.flashVersion=8;this.debugFlash=this.debugMode=false;this.useConsole=true;this.waitForWindowLoad=this.consoleOnly=false;this.nullURL="about:blank";this.allowPolling=true;this.useFastPolling=false;this.useMovieStar=true;this.bgColor="#ffffff";this.useHighPerformance=false;this.flashPollingInterval=null;this.flashLoadTimeout=1000;this.wmode=null;this.allowScriptAccess="always";this.useHTML5Audio=this.useFlashBlock=false;this.html5Test=/^probably$/i;this.useGlobalHTML5Audio=true;this.requireFlash=false;this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:true},mp4:{related:["aac","m4a"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:true},ogg:{type:["audio/ogg; codecs=vorbis"],required:false},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:false}};this.defaultOptions={autoLoad:false,stream:true,autoPlay:false,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onstop:null,onfailure:null,onfinish:null,onbeforefinish:null,onbeforefinishtime:5000,onbeforefinishcomplete:null,onjustbeforefinish:null,onjustbeforefinishtime:200,multiShot:true,multiShotEvents:false,position:null,pan:0,type:null,usePolicyFile:false,volume:100};this.flash9Options={isMovieStar:null,usePeakData:false,useWaveformData:false,useEQData:false,onbufferchange:null,ondataerror:null};this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null};this.version=null;this.versionNumber="V2.97a.20110306";this.movieURL=null;this.url=bk||null;this.altURL=null;this.enabled=this.swfLoaded=false;this.o=null;this.movieID="sm2-container";this.id=be||"sm2movie";this.swfCSS={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"};this.oMC=null;this.sounds={};this.soundIDs=[];this.muted=false;this.debugID="soundmanager-debug";this.debugURLParam=/([#?&])debug=1/i;this.didFlashBlock=this.specialWmodeCase=false;this.filePattern=null;this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i};this.baseMimeTypes=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i;this.netStreamMimeTypes=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i;this.netStreamTypes=["aac","flv","mov","mp4","m4v","f4v","m4a","mp4v","3gp","3g2"];this.netStreamPattern=RegExp("\\.("+this.netStreamTypes.join("|")+")(\\?.*)?$","i");this.mimePattern=this.baseMimeTypes;this.features={buffering:false,peakData:false,waveformData:false,eqData:false,movieStar:false};this.sandbox={};this.hasHTML5=null;this.html5={usingFlash:null};this.ignoreFlash=false;var a9,aA=this,a2,al=navigator.userAgent,au=c,aK=au.location.href.toString(),at=this.flashVersion,av=document,aN,aJ,ai=[],aT=false,aS=false,an=false,ag=false,bf=false,aR,am,ar,af,a0,m,aI,a7,f,a6,aB,aQ,aZ,bh,bb,aH,aU,ae,h,aG,e,aP=null,aw=null,a5,n,aY,aF,aE,g,ap,aD=false,bj=false,bg,a8,a4=null,bi,aC,ak=false,aO,ah,bd,bc,ao,a3=Array.prototype.slice,aM=false,a1,aX,aW,ax=al.match(/pre\//i),az=al.match(/(ipad|iphone|ipod)/i);al.match(/mobile/i);var aj=al.match(/msie/i),ad=al.match(/webkit/i),aL=al.match(/safari/i)&&!al.match(/chrome/i),ay=!aK.match(/usehtml5audio/i)&&!aK.match(/sm2\-ignorebadua/i)&&aL&&al.match(/OS X 10_6_(3|4|5|6)/i),ac=typeof av.hasFocus!=="undefined"?av.hasFocus():null,aV=typeof av.hasFocus==="undefined"&&aL,ab=!aV;this._use_maybe=aK.match(/sm2\-useHTML5Maybe\=1/i);this._overHTTP=av.location?av.location.protocol.match(/http/i):null;this.useAltURL=!this._overHTTP;this._global_a=null;if(az||ax){aA.useHTML5Audio=true;aA.ignoreFlash=true;if(aA.useGlobalHTML5Audio){aM=true;}}if(ax||this._use_maybe){aA.html5Test=/^(probably|maybe)$/i;}this.supported=this.ok=function(){return a4?an&&!ag:aA.useHTML5Audio&&aA.hasHTML5;};this.getMovie=function(j){return aj?au[j]:aL?a2(j)||av[j]:a2(j);};this.createSound=function(p){function j(){l=aF(l);aA.sounds[o.id]=new a9(o);aA.soundIDs.push(o.id);return aA.sounds[o.id];}var l=null,k=null,o=null;if(!an||!aA.ok()){g("soundManager.createSound(): "+a5(!an?"notReady":"notOK"));return false;}if(arguments.length===2){p={id:arguments[0],url:arguments[1]};}o=l=am(p);if(ap(o.id,true)){return aA.sounds[o.id];}if(aC(o)){k=j();k._setup_html5(o);}else{if(at>8&&aA.useMovieStar){if(o.isMovieStar===null){o.isMovieStar=o.serverURL||(o.type?o.type.match(aA.netStreamPattern):false)||o.url.match(aA.netStreamPattern)?true:false;}if(o.isMovieStar){if(o.usePeakData){o.usePeakData=false;}}}o=aE(o,"soundManager.createSound(): ");k=j();if(at===8){aA.o._createSound(o.id,o.onjustbeforefinishtime,o.loops||1,o.usePolicyFile);}else{aA.o._createSound(o.id,o.url,o.onjustbeforefinishtime,o.usePeakData,o.useWaveformData,o.useEQData,o.isMovieStar,o.isMovieStar?o.bufferTime:false,o.loops||1,o.serverURL,o.duration||null,o.autoPlay,true,o.autoLoad,o.usePolicyFile);if(!o.serverURL){k.connected=true;o.onconnect&&o.onconnect.apply(k);}}if((o.autoLoad||o.autoPlay)&&!o.serverURL){k.load(o);}}o.autoPlay&&!o.serverURL&&k.play();return k;};this.destroySound=function(o,j){if(!ap(o)){return false;}var l=aA.sounds[o],k;l._iO={};l.stop();l.unload();for(k=0;k<aA.soundIDs.length;k++){if(aA.soundIDs[k]===o){aA.soundIDs.splice(k,1);break;}}j||l.destruct(true);delete aA.sounds[o];return true;};this.load=function(k,j){if(!ap(k)){return false;}return aA.sounds[k].load(j);};this.unload=function(j){if(!ap(j)){return false;}return aA.sounds[j].unload();};this.start=this.play=function(k,j){if(!an||!aA.ok()){g("soundManager.play(): "+a5(!an?"notReady":"notOK"));return false;}if(!ap(k)){j instanceof Object||(j={url:j});if(j&&j.url){j.id=k;return aA.createSound(j).play();}else{return false;}}return aA.sounds[k].play(j);};this.setPosition=function(k,j){if(!ap(k)){return false;}return aA.sounds[k].setPosition(j);};this.stop=function(j){if(!ap(j)){return false;}return aA.sounds[j].stop();};this.stopAll=function(){for(var j in aA.sounds){aA.sounds[j] instanceof a9&&aA.sounds[j].stop();}};this.pause=function(j){if(!ap(j)){return false;}return aA.sounds[j].pause();};this.pauseAll=function(){for(var j=aA.soundIDs.length;j--;){aA.sounds[aA.soundIDs[j]].pause();}};this.resume=function(j){if(!ap(j)){return false;}return aA.sounds[j].resume();};this.resumeAll=function(){for(var j=aA.soundIDs.length;j--;){aA.sounds[aA.soundIDs[j]].resume();}};this.togglePause=function(j){if(!ap(j)){return false;}return aA.sounds[j].togglePause();};this.setPan=function(k,j){if(!ap(k)){return false;}return aA.sounds[k].setPan(j);};this.setVolume=function(k,j){if(!ap(k)){return false;}return aA.sounds[k].setVolume(j);};this.mute=function(k){var j=0;if(typeof k!=="string"){k=null;}if(k){if(!ap(k)){return false;}return aA.sounds[k].mute();}else{for(j=aA.soundIDs.length;j--;){aA.sounds[aA.soundIDs[j]].mute();}aA.muted=true;}return true;};this.muteAll=function(){aA.mute();};this.unmute=function(j){if(typeof j!=="string"){j=null;}if(j){if(!ap(j)){return false;}return aA.sounds[j].unmute();}else{for(j=aA.soundIDs.length;j--;){aA.sounds[aA.soundIDs[j]].unmute();}aA.muted=false;}return true;};this.unmuteAll=function(){aA.unmute();};this.toggleMute=function(j){if(!ap(j)){return false;}return aA.sounds[j].toggleMute();};this.getMemoryUse=function(){if(at===8){return 0;}if(aA.o){return parseInt(aA.o._getMemoryUse(),10);}};this.disable=function(k){if(typeof k==="undefined"){k=false;}if(ag){return false;}ag=true;for(var j=aA.soundIDs.length;j--;){h(aA.sounds[aA.soundIDs[j]]);}aR(k);ao.remove(au,"load",a0);return true;};this.canPlayMIME=function(k){var j;if(aA.hasHTML5){j=aO({type:k});}return !a4||j?j:k?k.match(aA.mimePattern)?true:false:null;};this.canPlayURL=function(k){var j;if(aA.hasHTML5){j=aO(k);}return !a4||j?j:k?k.match(aA.filePattern)?true:false:null;};this.canPlayLink=function(j){if(typeof j.type!=="undefined"&&j.type){if(aA.canPlayMIME(j.type)){return true;}}return aA.canPlayURL(j.href);};this.getSoundById=function(j){if(!j){throw Error("soundManager.getSoundById(): sID is null/undefined");}return aA.sounds[j];};this.onready=function(k,j){if(k&&k instanceof Function){j||(j=au);ar("onready",k,j);af();return true;}else{throw a5("needFunction","onready");}};this.ontimeout=function(k,j){if(k&&k instanceof Function){j||(j=au);ar("ontimeout",k,j);af({type:"ontimeout"});return true;}else{throw a5("needFunction","ontimeout");}};this.getMoviePercent=function(){return aA.o&&typeof aA.o.PercentLoaded!=="undefined"?aA.o.PercentLoaded():null;};this._wD=this._writeDebug=function(){return true;};this._debug=function(){};this.reboot=function(){var l,j;for(l=aA.soundIDs.length;l--;){aA.sounds[aA.soundIDs[l]].destruct();}try{if(aj){aw=aA.o.innerHTML;}aP=aA.o.parentNode.removeChild(aA.o);}catch(k){}aw=aP=null;aA.enabled=an=aD=bj=aT=aS=ag=aA.swfLoaded=false;aA.soundIDs=aA.sounds=[];aA.o=null;for(l in ai){if(ai.hasOwnProperty(l)){for(j=ai[l].length;j--;){ai[l][j].fired=false;}}}au.setTimeout(function(){aA.beginDelayedInit();},20);};this.destruct=function(){aA.disable(true);};this.beginDelayedInit=function(){bf=true;aZ();setTimeout(aB,20);aI();};this._html5_events={abort:aq(function(){}),canplay:aq(function(){this._t._onbufferchange(0);var k=!isNaN(this._t.position)?this._t.position/1000:null;this._t._html5_canplay=true;if(this._t.position&&this.currentTime!==k){try{this.currentTime=k;}catch(j){}}}),load:aq(function(){if(!this._t.loaded){this._t._onbufferchange(0);this._t._whileloading(this._t.bytesTotal,this._t.bytesTotal,this._t._get_html5_duration());this._t._onload(true);}}),emptied:aq(function(){}),ended:aq(function(){this._t._onfinish();}),error:aq(function(){this._t._onload(false);}),loadeddata:aq(function(){}),loadedmetadata:aq(function(){}),loadstart:aq(function(){this._t._onbufferchange(1);}),play:aq(function(){this._t._onbufferchange(0);}),playing:aq(function(){this._t._onbufferchange(0);}),progress:aq(function(q){if(this._t.loaded){return false;}var j,l=0,k=q.type==="progress",o=q.target.buffered;j=q.loaded||0;var p=q.total||1;if(o&&o.length){for(j=o.length;j--;){l=o.end(j)-o.start(j);}j=l/q.target.duration;k&&isNaN(j);}if(!isNaN(j)){this._t._onbufferchange(0);this._t._whileloading(j,p,this._t._get_html5_duration());j&&p&&j===p&&aA._html5_events.load.call(this,q);}}),ratechange:aq(function(){}),suspend:aq(function(j){aA._html5_events.progress.call(this,j);}),stalled:aq(function(){}),timeupdate:aq(function(){this._t._onTimer();}),waiting:aq(function(){this._t._onbufferchange(1);})};a9=function(p){var j=this,l,k,o;this.sID=p.id;this.url=p.url;this._iO=this.instanceOptions=this.options=am(p);this.pan=this.options.pan;this.volume=this.options.volume;this._lastURL=null;this.isHTML5=false;this._a=null;this.id3={};this._debug=function(){};this._debug();this.load=function(s){var r=null;if(typeof s!=="undefined"){j._iO=am(s);j.instanceOptions=j._iO;}else{s=j.options;j._iO=s;j.instanceOptions=j._iO;if(j._lastURL&&j._lastURL!==j.url){j._iO.url=j.url;j.url=null;}}if(!j._iO.url){j._iO.url=j.url;}if(j._iO.url===j.url&&j.readyState!==0&&j.readyState!==2){return j;}j._lastURL=j.url;j.loaded=false;j.readyState=1;j.playState=0;if(aC(j._iO)){r=j._setup_html5(j._iO);if(!r._called_load){r.load();r._called_load=true;j._iO.autoPlay&&j.play();}}else{try{j.isHTML5=false;j._iO=aE(aF(j._iO));at===8?aA.o._load(j.sID,j._iO.url,j._iO.stream,j._iO.autoPlay,j._iO.whileloading?1:0,j._iO.loops||1,j._iO.usePolicyFile):aA.o._load(j.sID,j._iO.url,j._iO.stream?true:false,j._iO.autoPlay?true:false,j._iO.loops||1,j._iO.autoLoad?true:false,j._iO.usePolicyFile);}catch(q){aU();}}return j;};this.unload=function(){if(j.readyState!==0){if(j.isHTML5){k();if(j._a){j._a.pause();j._a.src="";}}else{at===8?aA.o._unload(j.sID,aA.nullURL):aA.o._unload(j.sID);}l();}return j;};this.destruct=function(q){if(j.isHTML5){k();if(j._a){j._a.pause();j._a.src="";aM||j._remove_html5_events();}}else{j._iO.onfailure=null;aA.o._destroySound(j.sID);}q||aA.destroySound(j.sID,true);};this.start=this.play=function(s,r){var q;r=r===undefined?true:r;s||(s={});j._iO=am(s,j._iO);j._iO=am(j._iO,j.options);j.instanceOptions=j._iO;if(j._iO.serverURL){if(!j.connected){j.getAutoPlay()||j.setAutoPlay(true);return j;}}if(aC(j._iO)){j._setup_html5(j._iO);o();}if(j.playState===1&&!j.paused){if(q=j._iO.multiShot){j.isHTML5&&j.setPosition(j._iO.position);}else{return j;}}if(!j.loaded){if(j.readyState===0){if(!j.isHTML5){j._iO.autoPlay=true;}j.load(j._iO);}else{if(j.readyState===2){return j;}}}if(j.paused&&j.position&&j.position>0){j.resume();}else{j.playState=1;j.paused=false;if(!j.instanceCount||j._iO.multiShotEvents||at>8&&!j.isHTML5&&!j.getAutoPlay()){j.instanceCount++;}j.position=typeof j._iO.position!=="undefined"&&!isNaN(j._iO.position)?j._iO.position:0;if(!j.isHTML5){j._iO=aE(aF(j._iO));}if(j._iO.onplay&&r){j._iO.onplay.apply(j);j._onplay_called=true;}j.setVolume(j._iO.volume,true);j.setPan(j._iO.pan,true);if(j.isHTML5){o();j._setup_html5().play();}else{aA.o._start(j.sID,j._iO.loops||1,at===9?j.position:j.position/1000);}}return j;};this.stop=function(q){if(j.playState===1){j._onbufferchange(0);j.resetOnPosition(0);if(!j.isHTML5){j.playState=0;}j.paused=false;j._iO.onstop&&j._iO.onstop.apply(j);if(j.isHTML5){if(j._a){j.setPosition(0);j._a.pause();j.playState=0;j._onTimer();k();j.unload();}}else{aA.o._stop(j.sID,q);j._iO.serverURL&&j.unload();}j.instanceCount=0;j._iO={};}return j;};this.setAutoPlay=function(q){j._iO.autoPlay=q;if(j.isHTML5){j._a&&q&&j.play();}else{aA.o._setAutoPlay(j.sID,q);}q&&!j.instanceCount&&j.readyState===1&&j.instanceCount++;};this.getAutoPlay=function(){return j._iO.autoPlay;};this.setPosition=function(s){if(s===undefined){s=0;}var r=j.isHTML5?Math.max(s,0):Math.min(j.duration||j._iO.duration,Math.max(s,0));j.position=r;s=j.position/1000;j.resetOnPosition(j.position);j._iO.position=r;if(j.isHTML5){if(j._a){if(j._html5_canplay){if(j._a.currentTime!==s){try{j._a.currentTime=s;}catch(q){}}}}}else{s=at===9?j.position:s;if(j.readyState&&j.readyState!==2){aA.o._setPosition(j.sID,s,j.paused||!j.playState);}}j.isHTML5&&j.paused&&j._onTimer(true);return j;};this.pause=function(q){if(j.paused||j.playState===0&&j.readyState!==1){return j;}j.paused=true;if(j.isHTML5){j._setup_html5().pause();k();}else{if(q||q===undefined){aA.o._pause(j.sID);}}j._iO.onpause&&j._iO.onpause.apply(j);return j;};this.resume=function(){if(!j.paused){return j;}j.paused=false;j.playState=1;if(j.isHTML5){j._setup_html5().play();o();}else{j._iO.isMovieStar&&j.setPosition(j.position);aA.o._pause(j.sID);}if(!j._onplay_called&&j._iO.onplay){j._iO.onplay.apply(j);j._onplay_called=true;}else{j._iO.onresume&&j._iO.onresume.apply(j);}return j;};this.togglePause=function(){if(j.playState===0){j.play({position:at===9&&!j.isHTML5?j.position:j.position/1000});return j;}j.paused?j.resume():j.pause();return j;};this.setPan=function(r,q){if(typeof r==="undefined"){r=0;}if(typeof q==="undefined"){q=false;}j.isHTML5||aA.o._setPan(j.sID,r);j._iO.pan=r;if(!q){j.pan=r;}return j;};this.setVolume=function(r,q){if(typeof r==="undefined"){r=100;}if(typeof q==="undefined"){q=false;}if(j.isHTML5){if(j._a){j._a.volume=r/100;}}else{aA.o._setVolume(j.sID,aA.muted&&!j.muted||j.muted?0:r);}j._iO.volume=r;if(!q){j.volume=r;}return j;};this.mute=function(){j.muted=true;if(j.isHTML5){if(j._a){j._a.muted=true;}}else{aA.o._setVolume(j.sID,0);}return j;};this.unmute=function(){j.muted=false;var q=typeof j._iO.volume!=="undefined";if(j.isHTML5){if(j._a){j._a.muted=false;}}else{aA.o._setVolume(j.sID,q?j._iO.volume:j.options.volume);}return j;};this.toggleMute=function(){return j.muted?j.unmute():j.mute();};this.onposition=function(s,r,q){j._onPositionItems.push({position:s,method:r,scope:typeof q!=="undefined"?q:j,fired:false});return j;};this.processOnPosition=function(){var r,q;r=j._onPositionItems.length;if(!r||!j.playState||j._onPositionFired>=r){return false;}for(r=r;r--;){q=j._onPositionItems[r];if(!q.fired&&j.position>=q.position){q.method.apply(q.scope,[q.position]);q.fired=true;aA._onPositionFired++;}}return true;};this.resetOnPosition=function(s){var r,q;r=j._onPositionItems.length;if(!r){return false;}for(r=r;r--;){q=j._onPositionItems[r];if(q.fired&&s<=q.position){q.fired=false;aA._onPositionFired--;}}return true;};this._onTimer=function(r){var q={};if(j._hasTimer||r){if(j._a&&(r||(j.playState>0||j.readyState===1)&&!j.paused)){j.duration=j._get_html5_duration();j.durationEstimate=j.duration;r=j._a.currentTime?j._a.currentTime*1000:0;j._whileplaying(r,q,q,q,q);return true;}else{return false;}}};this._get_html5_duration=function(){var q=j._a?j._a.duration*1000:j._iO?j._iO.duration:undefined;return q&&!isNaN(q)&&q!==Infinity?q:j._iO?j._iO.duration:null;};o=function(){j.isHTML5&&bg(j);};k=function(){j.isHTML5&&a8(j);};l=function(){j._onPositionItems=[];j._onPositionFired=0;j._hasTimer=null;j._onplay_called=false;j._a=null;j._html5_canplay=false;j.bytesLoaded=null;j.bytesTotal=null;j.position=null;j.duration=j._iO&&j._iO.duration?j._iO.duration:null;j.durationEstimate=null;j.failures=0;j.loaded=false;j.playState=0;j.paused=false;j.readyState=0;j.muted=false;j.didBeforeFinish=false;j.didJustBeforeFinish=false;j.isBuffering=false;j.instanceOptions={};j.instanceCount=0;j.peakData={left:0,right:0};j.waveformData={left:[],right:[]};j.eqData=[];j.eqData.left=[];j.eqData.right=[];};l();this._setup_html5=function(s){s=am(j._iO,s);var r=aM?aA._global_a:j._a;decodeURI(s.url);var q=r&&r._t?r._t.instanceOptions:null;if(r){if(r._t&&q.url===s.url){return r;}aM&&r._t.playState&&r._t&&s.url!==q.url&&r._t.stop();l();r.src=s.url;}else{r=new Audio(s.url);if(aM){aA._global_a=r;}}r._called_load=false;j.isHTML5=true;j._a=r;r._t=j;j._add_html5_events();r.loop=s.loops>1?"loop":"";if(s.autoLoad||s.autoPlay){r.autobuffer="auto";r.preload="auto";j.load();}else{r.autobuffer=false;r.preload="none";}r.loop=s.loops>1?"loop":"";return r;};this._add_html5_events=function(){if(j._a._added_events){return false;}var q;j._a._added_events=true;for(q in aA._html5_events){aA._html5_events.hasOwnProperty(q)&&j._a&&j._a.addEventListener(q,aA._html5_events[q],false);}return true;};this._remove_html5_events=function(){j._a._added_events=false;for(var q in aA._html5_events){aA._html5_events.hasOwnProperty(q)&&j._a&&j._a.removeEventListener(q,aA._html5_events[q],false);}};this._whileloading=function(u,s,r,q){j.bytesLoaded=u;j.bytesTotal=s;j.duration=Math.floor(r);j.bufferLength=q;if(j._iO.isMovieStar){j.durationEstimate=j.duration;}else{j.durationEstimate=j._iO.duration?j.duration>j._iO.duration?j.duration:j._iO.duration:parseInt(j.bytesTotal/j.bytesLoaded*j.duration,10);if(j.durationEstimate===undefined){j.durationEstimate=j.duration;}}j.readyState!==3&&j._iO.whileloading&&j._iO.whileloading.apply(j);};this._onid3=function(u,s){var r=[],q,v;q=0;for(v=u.length;q<v;q++){r[u[q]]=s[q];}j.id3=am(j.id3,r);j._iO.onid3&&j._iO.onid3.apply(j);};this._whileplaying=function(u,s,r,q,v){if(isNaN(u)||u===null){return false;}if(j.playState===0&&u>0){u=0;}j.position=u;j.processOnPosition();if(at>8&&!j.isHTML5){if(j._iO.usePeakData&&typeof s!=="undefined"&&s){j.peakData={left:s.leftPeak,right:s.rightPeak};}if(j._iO.useWaveformData&&typeof r!=="undefined"&&r){j.waveformData={left:r.split(","),right:q.split(",")};}if(j._iO.useEQData){if(typeof v!=="undefined"&&v&&v.leftEQ){u=v.leftEQ.split(",");j.eqData=u;j.eqData.left=u;if(typeof v.rightEQ!=="undefined"&&v.rightEQ){j.eqData.right=v.rightEQ.split(",");}}}}if(j.playState===1){!j.isHTML5&&aA.flashVersion===8&&!j.position&&j.isBuffering&&j._onbufferchange(0);j._iO.whileplaying&&j._iO.whileplaying.apply(j);if((j.loaded||!j.loaded&&j._iO.isMovieStar)&&j._iO.onbeforefinish&&j._iO.onbeforefinishtime&&!j.didBeforeFinish&&j.duration-j.position<=j._iO.onbeforefinishtime){j._onbeforefinish();}}return true;};this._onconnect=function(q){q=q===1;if(j.connected=q){j.failures=0;if(ap(j.sID)){if(j.getAutoPlay()){j.play(undefined,j.getAutoPlay());}else{j._iO.autoLoad&&j.load();}}j._iO.onconnect&&j._iO.onconnect.apply(j,[q]);}};this._onload=function(q){q=q?true:false;j.loaded=q;j.readyState=q?3:2;j._onbufferchange(0);j._iO.onload&&j._iO.onload.apply(j,[q]);return true;};this._onfailure=function(s,r,q){j.failures++;j._iO.onfailure&&j.failures===1&&j._iO.onfailure(j,s,r,q);};this._onbeforefinish=function(){if(!j.didBeforeFinish){j.didBeforeFinish=true;j._iO.onbeforefinish&&j._iO.onbeforefinish.apply(j);}};this._onjustbeforefinish=function(){if(!j.didJustBeforeFinish){j.didJustBeforeFinish=true;j._iO.onjustbeforefinish&&j._iO.onjustbeforefinish.apply(j);}};this._onfinish=function(){var q=j._iO.onfinish;j._onbufferchange(0);j.resetOnPosition(0);j._iO.onbeforefinishcomplete&&j._iO.onbeforefinishcomplete.apply(j);j.didBeforeFinish=false;j.didJustBeforeFinish=false;if(j.instanceCount){j.instanceCount--;if(!j.instanceCount){j.playState=0;j.paused=false;j.instanceCount=0;j.instanceOptions={};j._iO={};k();}if(!j.instanceCount||j._iO.multiShotEvents){q&&q.apply(j);}}};this._onbufferchange=function(q){if(j.playState===0){return false;}if(q&&j.isBuffering||!q&&!j.isBuffering){return false;}j.isBuffering=q===1;j._iO.onbufferchange&&j._iO.onbufferchange.apply(j);return true;};this._ondataerror=function(){j.playState>0&&j._iO.ondataerror&&j._iO.ondataerror.apply(j);};};bb=function(){return av.body?av.body:av._docElement?av.documentElement:av.getElementsByTagName("div")[0];};a2=function(j){return av.getElementById(j);};am=function(p,j){var l={},k,o;for(k in p){if(p.hasOwnProperty(k)){l[k]=p[k];}}k=typeof j==="undefined"?aA.defaultOptions:j;for(o in k){if(k.hasOwnProperty(o)&&typeof l[o]==="undefined"){l[o]=k[o];}}return l;};ao=function(){function o(p){p=a3.call(p);var q=p.length;if(l){p[1]="on"+p[1];q>3&&p.pop();}else{q===3&&p.push(false);}return p;}function j(r,s){var q=r.shift(),p=[k[s]];l?q[p](r[0],r[1]):q[p].apply(q,r);}var l=au.attachEvent,k={add:l?"attachEvent":"addEventListener",remove:l?"detachEvent":"removeEventListener"};return{add:function(){j(o(arguments),"add");},remove:function(){j(o(arguments),"remove");}};}();aC=function(j){return !j.serverURL&&(j.type?aO({type:j.type}):aO(j.url)||ak);};aO=function(l){if(!aA.useHTML5Audio||!aA.hasHTML5){return false;}var j,k=aA.audioFormats;if(!ah){ah=[];for(j in k){if(k.hasOwnProperty(j)){ah.push(j);if(k[j].related){ah=ah.concat(k[j].related);}}}ah=RegExp("\\.("+ah.join("|")+")","i");}j=typeof l.type!=="undefined"?l.type:null;l=typeof l==="string"?l.toLowerCase().match(ah):null;if(!l||!l.length){if(j){l=j.indexOf(";");l=(l!==-1?j.substr(0,l):j).substr(6);}else{return false;}}else{l=l[0].substr(1);}if(l&&typeof aA.html5[l]!=="undefined"){return aA.html5[l];}else{if(!j){if(l&&aA.html5[l]){return aA.html5[l];}else{j="audio/"+l;}}j=aA.html5.canPlayType(j);return aA.html5[l]=j;}};bc=function(){function q(u){var s,r,v=false;if(!j||typeof j.canPlayType!=="function"){return false;}if(u instanceof Array){s=0;for(r=u.length;s<r&&!v;s++){if(aA.html5[u[s]]||j.canPlayType(u[s]).match(aA.html5Test)){v=true;aA.html5[u[s]]=true;}}return v;}else{return(u=j&&typeof j.canPlayType==="function"?j.canPlayType(u):false)&&(u.match(aA.html5Test)?true:false);}}if(!aA.useHTML5Audio||typeof Audio==="undefined"){return false;}var j=typeof Audio!=="undefined"?new Audio(null):null,l,k={},o,p;aX();o=aA.audioFormats;for(l in o){if(o.hasOwnProperty(l)){k[l]=q(o[l].type);if(o[l]&&o[l].related){for(p=o[l].related.length;p--;){aA.html5[o[l].related[p]]=k[l];}}}}k.canPlayType=j?q:null;aA.html5=am(aA.html5,k);return true;};a5=function(){};aF=function(j){if(at===8&&j.loops>1&&j.stream){j.stream=false;}return j;};aE=function(j){if(j&&!j.usePolicyFile&&(j.onid3||j.usePeakData||j.useWaveformData||j.useEQData)){j.usePolicyFile=true;}return j;};g=function(j){typeof console!=="undefined"&&typeof console.warn!=="undefined"&&console.warn(j);};aN=function(){return false;};h=function(k){for(var j in k){if(k.hasOwnProperty(j)&&typeof k[j]==="function"){k[j]=aN;}}};aG=function(j){if(typeof j==="undefined"){j=false;}if(ag||j){aA.disable(j);}};e=function(k){var j=null;if(k){if(k.match(/\.swf(\?.*)?$/i)){if(j=k.substr(k.toLowerCase().lastIndexOf(".swf?")+4)){return k;}}else{if(k.lastIndexOf("/")!==k.length-1){k+="/";}}}return(k&&k.lastIndexOf("/")!==-1?k.substr(0,k.lastIndexOf("/")+1):"./")+aA.movieURL;};f=function(){if(at!==8&&at!==9){aA.flashVersion=8;}var j=aA.debugMode||aA.debugFlash?"_debug.swf":".swf";if(aA.useHTML5Audio&&!ak&&aA.audioFormats.mp4.required&&aA.flashVersion<9){aA.flashVersion=9;}at=aA.flashVersion;aA.version=aA.versionNumber+(ak?" (HTML5-only mode)":at===9?" (AS3/Flash 9)":" (AS2/Flash 8)");if(at>8){aA.defaultOptions=am(aA.defaultOptions,aA.flash9Options);aA.features.buffering=true;}if(at>8&&aA.useMovieStar){aA.defaultOptions=am(aA.defaultOptions,aA.movieStarOptions);aA.filePatterns.flash9=RegExp("\\.(mp3|"+aA.netStreamTypes.join("|")+")(\\?.*)?$","i");aA.mimePattern=aA.netStreamMimeTypes;aA.features.movieStar=true;}else{aA.useMovieStar=false;aA.features.movieStar=false;}aA.filePattern=aA.filePatterns[at!==8?"flash9":"flash8"];aA.movieURL=(at===8?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",j);aA.features.peakData=aA.features.waveformData=aA.features.eqData=at>8;};ae=function(k,j){if(!aA.o||!aA.allowPolling){return false;}aA.o._setPolling(k,j);};aH=function(v,w){var q=w?w:aA.url,p=aA.altURL?aA.altURL:q,s;s=bb();var u,r,o=aY(),k,j=null;j=(j=av.getElementsByTagName("html")[0])&&j.dir&&j.dir.match(/rtl/i);v=typeof v==="undefined"?aA.id:v;if(aT&&aS){return false;}if(ak){f();aA.oMC=a2(aA.movieID);aJ();aS=aT=true;return false;}aT=true;f();aA.url=e(aA._overHTTP?q:p);w=aA.url;aA.wmode=!aA.wmode&&aA.useHighPerformance&&!aA.useMovieStar?"transparent":aA.wmode;if(aA.wmode!==null&&(al.match(/msie 8/i)||!aj&&!aA.useHighPerformance)&&navigator.platform.match(/win32|win64/i)){aA.specialWmodeCase=true;aA.wmode=null;}s={name:v,id:v,src:w,width:"100%",height:"100%",quality:"high",allowScriptAccess:aA.allowScriptAccess,bgcolor:aA.bgColor,pluginspage:"http://www.macromedia.com/go/getflashplayer",type:"application/x-shockwave-flash",wmode:aA.wmode,hasPriority:"true"};if(aA.debugFlash){s.FlashVars="debug=1";}aA.wmode||delete s.wmode;if(aj){q=av.createElement("div");r='<object id="'+v+'" data="'+w+'" type="'+s.type+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" width="'+s.width+'" height="'+s.height+'"><param name="movie" value="'+w+'" /><param name="AllowScriptAccess" value="'+aA.allowScriptAccess+'" /><param name="quality" value="'+s.quality+'" />'+(aA.wmode?'<param name="wmode" value="'+aA.wmode+'" /> ':"")+'<param name="bgcolor" value="'+aA.bgColor+'" />'+(aA.debugFlash?'<param name="FlashVars" value="'+s.FlashVars+'" />':"")+"</object>";}else{q=av.createElement("embed");for(u in s){s.hasOwnProperty(u)&&q.setAttribute(u,s[u]);}}bl();o=aY();if(s=bb()){aA.oMC=a2(aA.movieID)?a2(aA.movieID):av.createElement("div");if(aA.oMC.id){k=aA.oMC.className;aA.oMC.className=(k?k+" ":aA.swfCSS.swfDefault)+(o?" "+o:"");aA.oMC.appendChild(q);if(aj){u=aA.oMC.appendChild(av.createElement("div"));u.className=aA.swfCSS.swfBox;u.innerHTML=r;}aS=true;}else{aA.oMC.id=aA.movieID;aA.oMC.className=aA.swfCSS.swfDefault+" "+o;u=o=null;if(!aA.useFlashBlock){if(aA.useHighPerformance){o={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"};}else{o={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"};if(j){o.left=Math.abs(parseInt(o.left,10))+"px";}}}if(ad){aA.oMC.style.zIndex=10000;}if(!aA.debugFlash){for(k in o){if(o.hasOwnProperty(k)){aA.oMC.style[k]=o[k];}}}try{aj||aA.oMC.appendChild(q);s.appendChild(aA.oMC);if(aj){u=aA.oMC.appendChild(av.createElement("div"));u.className=aA.swfCSS.swfBox;u.innerHTML=r;}aS=true;}catch(l){throw Error(a5("appXHTML"));}}}return true;};ap=this.getSoundById;aQ=function(){if(ak){aH();return false;}if(aA.o){return false;}aA.o=aA.getMovie(aA.id);if(!aA.o){if(aP){if(aj){aA.oMC.innerHTML=aw;}else{aA.oMC.appendChild(aP);}aP=null;aT=true;}else{aH(aA.id,aA.url);}aA.o=aA.getMovie(aA.id);}aA.oninitmovie instanceof Function&&setTimeout(aA.oninitmovie,1);return true;};m=function(j){if(j){aA.url=j;}aQ();};aI=function(){setTimeout(a7,500);};a7=function(){if(aD){return false;}aD=true;ao.remove(au,"load",aI);if(aV&&!ac){return false;}var j;an||(j=aA.getMoviePercent());setTimeout(function(){j=aA.getMoviePercent();if(!an&&ab){if(j===null){if(aA.useFlashBlock||aA.flashLoadTimeout===0){aA.useFlashBlock&&n();}else{aG(true);}}else{aA.flashLoadTimeout!==0&&aG(true);}}},aA.flashLoadTimeout);};m=function(j){if(j){aA.url=j;}aQ();};aY=function(){var j=[];aA.debugMode&&j.push(aA.swfCSS.sm2Debug);aA.debugFlash&&j.push(aA.swfCSS.flashDebug);aA.useHighPerformance&&j.push(aA.swfCSS.highPerf);return j.join(" ");};n=function(){a5("fbHandler");var k=aA.getMoviePercent(),j=aA.swfCSS;if(aA.ok()){if(aA.oMC){aA.oMC.className=[aY(),j.swfDefault,j.swfLoaded+(aA.didFlashBlock?" "+j.swfUnblocked:"")].join(" ");}}else{if(a4){aA.oMC.className=aY()+" "+j.swfDefault+" "+(k===null?j.swfTimedout:j.swfError);}aA.didFlashBlock=true;af({type:"ontimeout",ignoreInit:true});aA.onerror instanceof Function&&aA.onerror.apply(au);}};a6=function(){function j(){ao.remove(au,"focus",a6);ao.remove(au,"load",a6);}if(ac||!aV){j();return true;}ac=ab=true;aL&&aV&&ao.remove(au,"mousemove",a6);aD=false;j();return true;};aR=function(j){if(an){return false;}if(ak){an=true;af();a0();return true;}aA.useFlashBlock&&aA.flashLoadTimeout&&!aA.getMoviePercent()||(an=true);if(ag||j){if(aA.useFlashBlock){aA.oMC.className=aY()+" "+(aA.getMoviePercent()===null?aA.swfCSS.swfTimedout:aA.swfCSS.swfError);}af({type:"ontimeout"});aA.onerror instanceof Function&&aA.onerror.apply(au);return false;}ao.add(au,"unload",aN);if(aA.waitForWindowLoad&&!bf){ao.add(au,"load",a0);return false;}else{a0();}return true;};ar=function(l,j,k){if(typeof ai[l]==="undefined"){ai[l]=[];}ai[l].push({method:j,scope:k||null,fired:false});};af=function(p){p||(p={type:"onready"});if(!an&&p&&!p.ignoreInit){return false;}var j={success:p&&p.ignoreInit?aA.ok():!ag},l=p&&p.type?ai[p.type]||[]:[];p=[];var k,o=a4&&aA.useFlashBlock&&!aA.ok();for(k=0;k<l.length;k++){l[k].fired!==true&&p.push(l[k]);}if(p.length){k=0;for(l=p.length;k<l;k++){p[k].scope?p[k].method.apply(p[k].scope,[j]):p[k].method(j);if(!o){p[k].fired=true;}}}return true;};a0=function(){au.setTimeout(function(){aA.useFlashBlock&&n();af();aA.onload instanceof Function&&aA.onload.apply(au);aA.waitForWindowLoad&&ao.add(au,"load",a0);},1);};aX=function(){if(a1!==undefined){return a1;}var q=false,j=navigator,l=j.plugins,k,o=au.ActiveXObject;if(l&&l.length){if((j=j.mimeTypes)&&j["application/x-shockwave-flash"]&&j["application/x-shockwave-flash"].enabledPlugin&&j["application/x-shockwave-flash"].enabledPlugin.description){q=true;}}else{if(typeof o!=="undefined"){try{k=new o("ShockwaveFlash.ShockwaveFlash");}catch(p){}q=!!k;}}return a1=q;};bi=function(){var k,j;if(al.match(/iphone os (1|2|3_0|3_1)/i)?true:false){aA.hasHTML5=false;ak=true;if(aA.oMC){aA.oMC.style.display="none";}return false;}if(aA.useHTML5Audio){if(!aA.html5||!aA.html5.canPlayType){aA.hasHTML5=false;return true;}else{aA.hasHTML5=true;}if(ay){if(aX()){return true;}}}else{return true;}for(j in aA.audioFormats){if(aA.audioFormats.hasOwnProperty(j)&&aA.audioFormats[j].required&&!aA.html5.canPlayType(aA.audioFormats[j].type)){k=true;}}if(aA.ignoreFlash){k=false;}ak=aA.useHTML5Audio&&aA.hasHTML5&&!k&&!aA.requireFlash;return aX()&&k;};aJ=function(){var l,j=[];if(an){return false;}if(aA.hasHTML5){for(l in aA.audioFormats){aA.audioFormats.hasOwnProperty(l)&&j.push(l+": "+aA.html5[l]);}}if(ak){if(!an){ao.remove(au,"load",aA.beginDelayedInit);aA.enabled=true;aR();}return true;}aQ();try{aA.o._externalInterfaceTest(false);if(aA.allowPolling){ae(true,aA.flashPollingInterval?aA.flashPollingInterval:aA.useFastPolling?10:50);}aA.debugMode||aA.o._disableDebug();aA.enabled=true;}catch(k){aG(true);aR();return false;}aR();ao.remove(au,"load",aA.beginDelayedInit);return true;};aB=function(){if(bj){return false;}aH();aQ();return bj=true;};aZ=function(){if(bh){return false;}bh=true;bl();if(!aA.useHTML5Audio){if(!aX()){aA.useHTML5Audio=true;}}bc();aA.html5.usingFlash=bi();a4=aA.html5.usingFlash;bh=true;av.removeEventListener&&av.removeEventListener("DOMContentLoaded",aZ,false);m();return true;};bg=function(j){if(!j._hasTimer){j._hasTimer=true;}};a8=function(j){if(j._hasTimer){j._hasTimer=false;}};aU=function(){aA.onerror instanceof Function&&aA.onerror();aA.disable();};aW=function(){if(!ay||!aX()){return false;}var l=aA.audioFormats,j,k;for(k in l){if(l.hasOwnProperty(k)){if(k==="mp3"||k==="mp4"){aA.html5[k]=false;if(l[k]&&l[k].related){for(;j--;){aA.html5[l[k].related[j]]=false;}}}}}};this._setSandboxType=function(){};this._externalInterfaceOK=function(){if(aA.swfLoaded){return false;}(new Date).getTime();aA.swfLoaded=true;aV=false;ay&&aW();aj?setTimeout(aJ,100):aJ();};bd=function(){if(av.readyState==="complete"){aZ();av.detachEvent("onreadystatechange",bd);}return true;};if(!aA.hasHTML5||a4){ao.add(au,"focus",a6);ao.add(au,"load",a6);ao.add(au,"load",aI);aL&&aV&&ao.add(au,"mousemove",a6);}if(av.addEventListener){av.addEventListener("DOMContentLoaded",aZ,false);}else{av.attachEvent?av.attachEvent("onreadystatechange",bd):aU();}av.readyState==="complete"&&setTimeout(aZ,100);}var d=null;if(typeof SM2_DEFER==="undefined"||!SM2_DEFER){d=new a;}c.SoundManager=a;c.soundManager=d;})(window);Zendesk.NS("Stats");Zendesk.Stats.ForumUI=(function(){this._statsInfo=function(){var a=$j("#stats_object");return{statsObject:a,objectType:a.attr("object_type"),objectId:a.attr("object_id"),windowStart:a.attr("window_start"),pageType:a.attr("page_type")};};this.setup=function(g){var f=Zendesk.Stats.ForumUI._statsInfo();$j("#detailed_stats_graph_container").hide();var e=[{div:"#forum_entry_create_sparkline",statName:"entry_create"},{div:"#forum_entry_view_sparkline",statName:"entry_view"},{div:"#forum_post_create_sparkline",statName:"post_create"},{div:"#forum_watching_entry_create_sparkline",statName:"watching_entry_create"},{div:"#forum_vote_create_sparkline",statName:"vote_create"}];if($j("#stats_summary_container").exists()){for(var c=0;c<e.length;c++){if(f.pageType=="entry"&&e[c]["statName"]=="entry_create"){continue;}else{var a=new Zendesk.Stats.Graph(e[c]["div"],{graphType:"sparkline",resource:"forum",objectType:f.objectType,objectId:f.objectId,statName:e[c]["statName"],start:f.windowStart,totalCountDiv:$j(e[c]["div"]).parent().parent().find(".stat_total")});a.draw();}}}var d=null;$j("#detailed_stats_graph").bind("plothover",function(j,k,h){if(h){if(d!=(h.pageX*h.datapoint[1])){d=h.pageX*h.datapoint[1];$j("#stats_point_value").remove();Zendesk.Stats.ForumUI.displayPointValue(h.pageX,h.pageY,h.datapoint[1]);}}else{$j("#stats_point_value").remove();d=null;}});$j(".sparkline").click(function(){if($j(this).hasClass("active")){return false;}else{g.setLocation("#stats/"+$j(this).attr("id"));}});};this._formatTotal=function(d){var c=String(d);var a=new RegExp("(-?[0-9]+)([0-9]{3})");while(a.test(c)){c=c.replace(a,"$1,$2");}return c;};this.showDetailGraph=function(a){$j("#comments_section").hide();$j("#stats_summary_container").show();var f=Zendesk.Stats.ForumUI._statsInfo();$j(".sparkline.active").removeClass("active");$j(a).addClass("active");var c=$j(a).attr("id");var e=new Zendesk.Stats.Graph("#detailed_stats_graph",{graphType:"area",resource:"forum",objectType:f.objectType,objectId:f.objectId,statName:c,start:f.windowStart});e.draw();$j(window).resize(function(){e.draw();});$j("#detailed_stats_graph_container").show();if(f.objectType!="entry"){var d={start:f.windowStart,stat_name:c};d[f.objectType+"_id"]=f.objectId;$j("#content_entries .frame:first").html('<div id="topic_search_loading" class="loading"></div>');$j.ajax({url:"/entries/top_entries_by_stat",data:d,success:function(g){$j("#content_entries .frame:first").html(g);}});}$j.ajax({url:"/api/v2/stats/aggregate_average/account/0/forum_stats_by_"+f.objectType+"/"+c+"?start="+f.windowStart,success:function(h){var g=Zendesk.Stats.ForumUI._formatTotal(h);$j("#account_wide_total_section").html('(vs. <span id="account_wide_total">'+g+"</span> account-wide)");}});$j(".forum-nav a").click(function(){if(f.pageType=="entry"){$j("#comments_section").toggle();}});};this.displayPointValue=function(a,d,c){$j('<div id="stats_point_value">'+c+"</div>").css({position:"absolute",display:"none",top:d-20,left:a-5,border:"2px solid #fdd","font-size":"12px",padding:"4px","background-color":"#fee",opacity:0.8}).appendTo("body").fadeIn(200);};return this;})();Zendesk.NS("Stats");Zendesk.Stats.Graph=function(a,d){this.graphData={};this.container=$j(a);this.resource=d.resource;this.statName=d.statName;this.objectId=d.objectId;this.objectType=d.objectType;this.graphType=d.graphType;this.totalCountDiv=d.totalCountDiv;if(d.start){this.startTime=d.start;}else{var c=new Date();this.startTime=c.setMonth(c.getMonth()-1)/1000;}this.flotOptions=Zendesk.Stats.FlotOptions[this.graphType];};Zendesk.Stats.Graph.prototype={statsURL:function(e,d,c,a){base="/api/v2/stats/graph_data/"+c+"/";if(a){base+=a+"/";}base+=e+"_stats_by_"+c;base+="/"+d;return base;},draw:function(){if(this.graphData[this.objectId]){this._updateDetailGraphTitle();this.render();}else{$j.getJSON(this.statsURL(this.resource,this.statName,this.objectType,this.objectId),{start:this.startTime,npoints:30}).done($j.proxy(this._onFetchGraphData,this,this.objectId));}},render:function(){var a=this.graphData[this.objectId]["data"];$j.plot(this.container,[{data:a}],this.flotOptions);},_onFetchGraphData:function(e,d){this.graphData[e]=d;if(this.totalCountDiv&&$j(this.totalCountDiv).text()==""){var a=0;for(var c=0;c<this.graphData[e]["data"].length;c++){a+=this.graphData[e]["data"][c][1];}$j(this.totalCountDiv).append(this._formatCount(a));}this._updateDetailGraphTitle();this.render();},_updateDetailGraphTitle:function(){var a=$j(".sparkline.active").parent().children(".sparkline_title").html();$j("#detailed_stats_graph_title").html(a);},_formatCount:function(d){var c=String(d);var a=new RegExp("(-?[0-9]+)([0-9]{3})");while(a.test(c)){c=c.replace(a,"$1,$2");}return c;}};Zendesk.Stats.FlotOptions={area:{colors:["#137ac6"],grid:{backgroundColor:"#fff",borderWidth:0,hoverable:true,mouseActiveRadius:"24",autoHighlight:false},yaxis:{min:0,tickFormatter:function(c,a){return Math.round(c);},maxFloor:5},xaxis:{mode:"time"},legend:{show:false},series:{lines:{show:true,fill:true,fillColor:"#e6f2fa"},points:{show:true,fill:true,fillColor:"#137ac6",radius:"1",symbol:"circle"}}},sparkline:{colors:["#137ac6"],shadowSize:0,grid:{show:false},yaxis:{min:0},xaxis:{mode:"time"},legend:{show:false},series:{lines:{show:true,fill:true,fillColor:"#e6f2fa",lineWidth:1}}}};
