<% @workers.times do |count| %>
# sidekiq worker <%= count %>
check process sidekiq_<%= @app_name %>_<%= count %>
  with pidfile /data/<%= @app_name %>/shared/pids/sidekiq_<%= count %>.pid
  start program = "/bin/sh -c 'cd /data/helpkit/current; ulimit -n 50000; /usr/bin/sidekiq_wrapper <%= @app_name %> start <%= @environment %> <%= count %> '" with timeout 90 seconds
  stop program = "/bin/env /usr/bin/sidekiq_wrapper <%= @app_name %> kill <%= @environment %> <%= count %>" with timeout 90 seconds
  if totalmem is greater than <%= @memory_limit %> MB for 3 cycles then restart 
  group <%= @app_name %>_sidekiq
  mode manual
<% end %>