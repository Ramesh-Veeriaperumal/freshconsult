<% advance_facebook_enabled = Account.current.advance_facebook_enabled? %>
<div id="got_pages">
  <% unless @associated_fb_pages.empty? %>
    <%= form_for :facebook_page, :url => { :controller=>"admin/social/facebook_pages", :action=>"enable_pages"}, :html => { :multipart => true , :method => :put } do |f| %>
      <div class="list-page facebook-list">
        <div class="list-page-header row-fluid"> 
        	<div class="span10">
      	  	<p class="muted"><%=t("#{advance_facebook_enabled ? '.associate_pages' : '.associate_page'}")%></p>
      	  </div>
        </div>
        <div class="list-page-body"> 
          <% if advance_facebook_enabled %>
            <div class = "fb-select-all">
              <input type="checkbox" id="fb-pages-select-all" checked />
              <label id ="fb-pages-deselect-all-label" class="fb-select-all-label" for= "fb_pages-select-all"> <%=t('.select_all')%> </label> 
            </div>
          <% end %>
          <table class="table table-striped">
          	<% @associated_fb_pages.each do |fb_page| %>
              <% source = fb_page.delete(:source) %>
              <% limit_reached = fb_page.delete(:limit_reached) %>
              <tr>
                <td class="fb_list_pic">
                  <div class="preview_pic">
      	    		    <%= image_tag fb_page[:page_img_url], :alt => fb_page[:page_name] %>
      	    	    </div>
                </td>
                <td class="fb_page_info">
                	<%= list_fb_page_as_option_tag("enable", "pages", { 
                                  :multiple => true, :checked => true, 
                                  :id => "enable_page_#{fb_page[:page_id]}" 
                                  }, fb_page.to_json, advance_facebook_enabled) if fb_page[:page_id] %>
                  <label for="enable_page_<%=fb_page[:page_id] %>">
                    <b><%= fb_page[:page_name] %></b>
                  </label>
        					<% if source %>
                    <% if limit_reached %>
                      <p class="muted"> <%= t('facebook_tab.page_limit_reached', {:source => source}) %> </p>
                    <% else %>
                      <p class="muted"> <%= t('facebook_tab.multi_page_add', {:source => source}) %> </p>
                    <% end %>
        					<% end %>
                </td>
              </tr>
            <% end %>
          </table>
        </div>
      </div>
    <% end %>
  <%else%>
    <div class="list-noinfo">
  	   <p><%=t('.no_page_info').html_safe%></p>
    </div>
  <% end %>
</div>

<%= javascript_tag do %>

jQuery(document).ready(function(){
  first_radio_tag = jQuery("td.fb_page_info input[type='radio']").addClass('fb_page_list_radio')[0];
  if(first_radio_tag != undefined){
    jQuery(first_radio_tag).attr('checked', 'checked');  
  }
  enableAssosiate();
});


jQuery(".fb_page_info input[type=checkbox]").change(function(){
  enableAssosiate();
});

jQuery("#fb-pages-select-all").on("click", function(){
  var select_fb_page;
  
  select_fb_page = this.checked ? true : false
  
  jQuery("input[name='enable[pages][]']").prop("checked", select_fb_page);
  
  enableAssosiate();
}); 

function enableAssosiate(){
  if(jQuery('.fb_page_info input[type=checkbox]:checked').length){
    jQuery('#pages_dialog-submit').removeAttr('disabled');
  }
  else{
    jQuery('#pages_dialog-submit').attr('disabled', 'true');
  }
}

<% end %>
